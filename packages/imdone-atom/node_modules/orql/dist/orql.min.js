!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,r.orql=n()}}(function(){var n;return function r(n,e,t){function o(a,i){if(!e[a]){if(!n[a]){var f="function"==typeof require&&require;if(!i&&f)return f(a,!0);if(u)return u(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var c=e[a]={exports:{}};n[a][0].call(c.exports,function(r){var e=n[a][1][r];return o(e?e:r)},c,c.exports,r,n,e,t)}return e[a].exports}for(var u="function"==typeof require&&require,a=0;a<t.length;a++)o(t[a]);return o}({1:[function(n,r,e){!function(){"use strict";function e(n,r){if(!r||!r.forEach)return!1;if(n.forEach){var e={};r.forEach(function(n){e[n]=!0});var t=0;return n.forEach(function(n){e[n]&&t++}),t==n.length?!0:!1}return r.some(function(r){return n===r})}function t(n){if("object"==typeof n){var r=n.name,e=n.args;if(n.forEach)return n.map(t);var u=e[0],a=null;2==e.length&&(a=u,u=e[1]);var i=null,f=!1;switch(r){case"eq":f=!0,i=function(n){return(o(n,a)||void 0)===u};break;case"ne":f=!0,i=function(n){return(o(n,a)||void 0)!==u};break;case"le":f=!0,i=function(n){return(o(n,a)||void 0)<=u};break;case"ge":f=!0,i=function(n){return(o(n,a)||void 0)>=u};break;case"lt":f=!0,i=function(n){return(o(n,a)||void 0)<u};break;case"gt":f=!0,i=function(n){return(o(n,a)||void 0)>u};break;default:var s=l.ops[r];if(!s)throw new Error("RQLError : no operator found in rql with : "+r);e&&e.length>0?(e=e.map(t),i=function(){return s.apply(this,e)}):i=function(){return s.call(this)}}return f?function(){var n=this.filter(i);return n}:i}return n}function o(n,r){if(!r)return n;var e=r.split("."),t=n;if(t){for(var o=0,u=e[o];u&&t[u];)t=t[u],u=e[++o];return o===e.length?t instanceof Date?t.valueOf():t:void 0}}function u(n,r){var e=function(r,e){"undefined"==typeof e&&(e=r,r=void 0);for(var t=(arguments,[]),o=0,u=this.length;u>o;o++){var a=this[o];n(i(a,r),e)&&t.push(a)}return t};return e.condition=n,e}function a(n){return function(r){return r?this.map(function(n){return o(n,r)}).reduce(n):this.reduce(n)}}function i(n,r){return r&&r.forEach?o(n,decodeURIComponent(r)):"undefined"==typeof r?o(n):o(n,decodeURIComponent(r))}var f=n("rql/parser"),s=f.parseQuery,c={},l=function(n,r){return"?"==r[0]&&(r=r.substring(1)),c[r]?c[r].call(n):l.compile(r).call(n)};l.parse=function(n){try{var r=s(n);return r.toString=function(){return n},r}catch(e){return null}},l.compile=function(n){var r=l.parse(n),e=t(r);return c[n]=e,e};var h=1;l.ops={isPresent:function(n,r){for(var e=[],t=r.length,u=0;t>u;++u)o(r[u],n)&&e.push(r[u]);return e},sort:function(){for(var n=[],r=0;r<arguments.length;r++){var e=arguments[r],t=e.charAt(0),u={attribute:e,ascending:!0};("-"==t||"+"==t)&&("-"==t&&(u.ascending=!1),u.attribute=u.attribute.substring(1)),n.push(u)}return this.sort(function(r,e){for(var t=1,u=n[0];u;t++){var a=o(r,u.attribute),i=o(e,u.attribute);if(a!=i)return u.ascending==a>i?1:-1;u=n[t]}return 0}),this},match:u(function(n,r){return new RegExp(r).test(n)}),"in":u(function(n,r){for(var e=!1,t=0;!e&&t<r.length;)r[t++]==n&&(e=!0);return e}),out:u(function(n,r){for(var e=!0,t=0;e&&t<r.length;)r[t++]==n&&(e=!1);return e}),contains:u(function(n,r){return e(r,n)}),excludes:u(function(n,r){return!e(r,n)}),or:function(){var n,r,e=[],t="__rqlId"+h++;try{for(n=0;n<arguments.length;n++){var o=arguments[n].call(this);r=o.length;for(var u=0;r>u;u++){var a=o[u];a[t]||(a[t]=!0,e.push(a))}}}finally{for(n=0,r=e.length;r>n;n++)delete e[t]}return e},and:function(){for(var n=this,r=0;r<arguments.length;++r){var e=arguments[r];n="function"==typeof e?e.call(n):l.ops.isPresent(e,n)}return n},select:function(){var n=arguments,r=arguments.length,e=this.map(function(e){for(var t={},o=0;r>o;o++){var u=n[o],a=i(e,u);"undefined"!=typeof a&&(t[u]=a)}return t});return e},unselect:function(){var n=arguments,r=arguments.length;return this.map(function(e){var t={};for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);for(var u=0;r>u;u++)delete t[n[u]];return t})},values:function(n){if(1==arguments.length)return this.map(function(r){return o(r,n)});var r=arguments,e=arguments.length;return this.map(function(n){var t=o(n),u=[];if(0===e)for(var a in t)t.hasOwnProperty(a)&&u.push(t[a]);else for(var i=0;e>i;i++){var f=r[i];u.push(t[f])}return u})},limit:function(n,r,e){var t=this.length;r=r||0;var o=this.slice(r,r+n);return e&&(o.start=r,o.end=r+o.length-1,o.totalCount=Math.min(t,"number"==typeof e?e:1/0)),o},distinct:function(){var n={},r=[],e=this.filter(function(e){return e=o(e),e&&"object"==typeof e?e.__found__?!1:(e.__found__=function(){},r.push(e),!0):n[e]?!1:(n[e]=!0,!0)});return r.forEach(function(n){delete n.__found__}),e},recurse:function(n){function r(t){if(t.forEach)t.forEach(r);else if(e.push(t),n)t=t[n],t&&"object"==typeof t&&r(t);else for(var o in t)t[o]&&"object"==typeof t[o]&&r(t[o])}var e=[];return r(o(this)),e},aggregate:function(){for(var n=[],r=[],e=0;e<arguments.length;e++){var t=arguments[e];"function"==typeof t?r.push(t):n.push(t)}var u={},a=n.length;this.forEach(function(r){r=o(r);for(var e="",t=0;a>t;t++)e+="/"+r[n[t]];var i=u[e];i||(i=u[e]=[]),i.push(r)});var i=r.length,f=[];for(var s in u){for(var c=u[s],l={},h=0;a>h;h++){var g=n[h];l[g]=c[0][g]}for(var p=0;i>p;p++){var d=r[p];l[p]=d.call(c)}f.push(l)}return f},between:u(function(n,r){return n=o(n),n>=r[0]&&n<r[1]}),sum:a(function(n,r){return o(n)+o(r)}),mean:function(n){return l.ops.sum.call(this,n)/this.length},max:a(function(n,r){return Math.max(o(n),o(r))}),min:a(function(n,r){return Math.min(o(n),o(r))}),count:function(){return this.length},first:function(){return this[0]},last:function(){return this[this.length-1]},random:function(){return this[Math.round(Math.random()*(this.length-1))]},one:function(){if(this.length>1)throw new Error("RQLError : More than one object found");return this[0]}},r.exports=l}()},{"rql/parser":2}],2:[function(r,e,t){({define:"undefined"!=typeof n?n:function(n,o){e.exports=o(t,r("./util/contains"))}}).define(["exports","./util/contains"],function(n,r){function e(e,u){function a(e){s.args.push(e),s=e,r(n.lastSeen,s.name)&&(c.cache[s.name]=s.args)}function i(n){if(s.name){if(s.name!==n)throw new Error("Can not mix conjunctions within a group, use paranthesis around each set of same conjuctions (& and |)")}else s.name=n}function f(n){if(n&&n.args){delete n.parent;for(var r=n.args,e=0,t=r.length;t>e;e++)f(r[e])}return n}("undefined"==typeof e||null===e)&&(e="");var s=new n.Query,c=s;if(c.cache={},"object"==typeof e){if(e instanceof n.Query)return e;for(var l in e){var s=new n.Query;c.args.push(s),s.name="eq",s.args=[l,e[l]]}return c}if("?"==e.charAt(0))throw new URIError("Query must not start with ?");n.jsonQueryCompatible&&(e=e.replace(/%3C=/g,"=le=").replace(/%3E=/g,"=ge=").replace(/%3C/g,"=lt=").replace(/%3E/g,"=gt=")),e.indexOf("/")>-1&&(e=e.replace(/[\+\*\$\-:\w%\._]*\/[\+\*\$\-:\w%\._\/]*/g,function(n){return"("+n.replace(/\//g,",")+")"})),e=e.replace(/(\([\+\*\$\-:\w%\._,]+\)|[\+\*\$\-:\w%\._]*|)([<>!]?=(?:[\w]*=)?|>|<)(\([\+\*\$\-:\w%\._,]+\)|[\+\*\$\-:\w%\._]*|)/g,function(n,r,e,t){if(e.length<3){if(!o[e])throw new URIError("Illegal operator "+e);e=o[e]}else e=e.substring(1,e.length-1);return e+"("+r+","+t+")"}),"?"==e.charAt(0)&&(e=e.substring(1));var h=e.replace(/(\))|([&\|,])?([\+\*\$\-:\w%\._]*)(\(?)/g,function(e,o,f,l,h){if(f&&("&"===f&&i("and"),"|"===f&&i("or")),h){var g=new n.Query;g.name=l,g.parent=s,a(g)}else if(o){var p=!s.name;if(s=s.parent,!s)throw new URIError("Closing paranthesis without an opening paranthesis");p&&s.args.push(s.args.pop().args)}else if((l||","===f)&&(s.args.push(t(l,u)),r(n.lastSeen,s.name)&&(c.cache[s.name]=s.args),"eq"===s.name&&s.args[0]===n.primaryKeyName)){var d=s.args[1];!d||d instanceof RegExp||(d=d.toString()),c.cache[n.primaryKeyName]=d}return""});if(s.parent)throw new URIError("Opening paranthesis without a closing paranthesis");if(h)throw new URIError("Illegal character in query string encountered "+h);return f(c),c}function t(r,e){var t=n.converters["default"];if("$"===r.charAt(0)){var o=parseInt(r.substring(1))-1;return o>=0&&e?e[o]:void 0}if(r.indexOf(":")>-1){var u=r.split(":",2);if(t=n.converters[u[0]],!t)throw new URIError("Unknown converter "+u[0]);r=u[1]}return t(r)}var o={"=":"eq","==":"eq",">":"gt",">=":"ge","<":"lt","<=":"le","!=":"ne"};n.primaryKeyName="id",n.lastSeen=["sort","select","values","limit"],n.jsonQueryCompatible=!0,n.parse=n.parseQuery=e,n.parseGently=function(){var r;try{r=e.apply(this,arguments)}catch(t){r=new n.Query,r.error=t.message}return r},n.commonOperatorMap={and:"&",or:"|",eq:"=",ne:"!=",le:"<=",ge:">=",lt:"<",gt:">"};var u=n.autoConverted={"true":!0,"false":!1,"null":null,undefined:void 0,Infinity:1/0,"-Infinity":-(1/0)};return n.converters={auto:function(r){if(u.hasOwnProperty(r))return u[r];var e=+r;return isNaN(e)||e.toString()!==r?(r=decodeURIComponent(r),n.jsonQueryCompatible&&"'"==r.charAt(0)&&"'"==r.charAt(r.length-1)?JSON.parse('"'+r.substring(1,r.length-1)+'"'):r):e},number:function(n){var r=+n;if(isNaN(r))throw new URIError("Invalid number "+r);return r},epoch:function(n){var r=new Date(+n);if(isNaN(r.getTime()))throw new URIError("Invalid date "+n);return r},isodate:function(r){var e="0000".substr(0,4-r.length)+r;return e+="0000-01-01T00:00:00Z".substring(e.length),n.converters.date(e)},date:function(n){var r=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/.exec(n);if(r?date=new Date(Date.UTC(+r[1],+r[2]-1,+r[3],+r[4],+r[5],+r[6])):date=new Date(n),isNaN(date.getTime()))throw new URIError("Invalid date "+n);return date},"boolean":function(n){return"true"===n},string:function(n){return decodeURIComponent(n)},re:function(n){return new RegExp(decodeURIComponent(n),"i")},RE:function(n){return new RegExp(decodeURIComponent(n))},glob:function(n){var r=decodeURIComponent(n).replace(/([\\|\||\(|\)|\[|\{|\^|\$|\*|\+|\?|\.|\<|\>])/g,function(n){return"\\"+n}).replace(/\\\*/g,".*").replace(/\\\?/g,".?");return r=".*"!==r.substring(0,2)?"^"+r:r.substring(2),".*"!==r.substring(r.length-2)?r+="$":r=r.substring(0,r.length-2),new RegExp(r,"i")}},n.converters["default"]=n.converters.auto,n.Query=function(){this.name="and",this.args=[]},n})},{"./util/contains":3}],3:[function(r,e,t){({define:"undefined"!=typeof n?n:function(n,r){e.exports=r(t)}}).define([],function(){function n(n,r){for(var e=0,t=n.length;t>e;e++)if(n[e]===r)return!0}return n})},{}]},{},[1])(1)});