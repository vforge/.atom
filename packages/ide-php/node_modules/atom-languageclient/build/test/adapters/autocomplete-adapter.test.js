var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _autocompleteAdapter = require('../../lib/adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

var _languageclient = require('../../lib/languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _sinon = require('sinon');

var _sinon2 = _interopRequireDefault(_sinon);

var _atom = require('atom');

var _chai = require('chai');

var _helpers = require('../helpers.js');

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

describe('AutoCompleteAdapter', () => {
  beforeEach(() => {
    global.sinon = _sinon2.default.sandbox.create();
  });
  afterEach(() => {
    global.sinon.restore();
  });

  const request = {
    editor: (0, _helpers.createFakeEditor)(),
    bufferPosition: new _atom.Point(123, 456),
    prefix: 'def',
    scopeDescriptor: 'some.scope'
  };

  const completionItems = [{
    label: 'label1',
    kind: ls.CompletionItemKind.Keyword,
    detail: 'description1',
    documentation: 'a very exciting keyword',
    sortText: 'z'
  }, {
    label: 'label2',
    kind: ls.CompletionItemKind.Field,
    detail: 'description2',
    documentation: 'a very exciting field',
    sortText: 'a'
  }, {
    label: 'label3',
    kind: ls.CompletionItemKind.Variable,
    detail: 'description3',
    documentation: 'a very exciting variable'
  }];

  describe('getSuggestions', () => {
    const fakeLanguageClient = new ls.LanguageClientConnection((0, _helpers.createSpyConnection)());
    _sinon2.default.stub(fakeLanguageClient, 'completion').resolves(completionItems);

    it('gets AutoComplete suggestions via LSP given an AutoCompleteRequest', async () => {
      const autoCompleteAdapter = new _autocompleteAdapter2.default();
      const results = await autoCompleteAdapter.getSuggestions(fakeLanguageClient, request);
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0].text).equals('label2');
      (0, _chai.expect)(results[1].description).equals('a very exciting variable');
      (0, _chai.expect)(results[2].type).equals('keyword');
    });
  });

  describe('requestToTextDocumentPositionParams', () => {
    it('creates a TextDocumentPositionParams from an AutocompleteRequest', () => {
      const result = _autocompleteAdapter2.default.requestToTextDocumentPositionParams(request);
      (0, _chai.expect)(result.textDocument.uri).equals('file:///a/b/c/d.js');
      (0, _chai.expect)(result.position).deep.equals({ line: 123, character: 456 });
    });
  });

  describe('completionItemsToSuggestions', () => {
    it('converts LSP CompletionItem array to AutoComplete Suggestions array', () => {
      const results = _autocompleteAdapter2.default.completionItemsToSuggestions(completionItems, request);
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0].text).equals('label2');
      (0, _chai.expect)(results[1].description).equals('a very exciting variable');
      (0, _chai.expect)(results[2].type).equals('keyword');
    });

    it('converts LSP CompletionList to AutoComplete Suggestions array', () => {
      const completionList = { items: completionItems, isIncomplete: false };
      const results = _autocompleteAdapter2.default.completionItemsToSuggestions(completionList, request);
      (0, _chai.expect)(results.length).equals(3);
      (0, _chai.expect)(results[0].description).equals('a very exciting field');
      (0, _chai.expect)(results[1].text).equals('label3');
    });

    it('converts empty array into an empty AutoComplete Suggestions array', () => {
      const results = _autocompleteAdapter2.default.completionItemsToSuggestions([], request);
      (0, _chai.expect)(results.length).equals(0);
    });
  });

  describe('completionItemToSuggestion', () => {
    it('converts LSP CompletionItem to AutoComplete Suggestion without textEdit', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'keyword',
        documentation: 'a truly useful keyword'
      };
      const result = _autocompleteAdapter2.default.completionItemToSuggestion(completionItem, request);
      (0, _chai.expect)(result.text).equals('insert');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.rightLabel).equals('keyword');
      (0, _chai.expect)(result.description).equals('a truly useful keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a truly useful keyword');
    });

    it('converts LSP CompletionItem to AutoComplete Suggestion with textEdit', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Variable,
        detail: 'number',
        documentation: 'a truly useful variable',
        textEdit: {
          range: {
            start: { line: 10, character: 20 },
            end: { line: 30, character: 40 }
          },
          newText: 'newText'
        }
      };
      const autocompleteRequest = {
        editor: (0, _helpers.createFakeEditor)(),
        bufferPosition: new _atom.Point(123, 456),
        prefix: 'def',
        scopeDescriptor: 'some.scope'
      };
      _sinon2.default.stub(autocompleteRequest.editor, 'getTextInBufferRange').returns('replacementPrefix');
      const result = _autocompleteAdapter2.default.completionItemToSuggestion(completionItem, autocompleteRequest);
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('variable');
      (0, _chai.expect)(result.rightLabel).equals('number');
      (0, _chai.expect)(result.description).equals('a truly useful variable');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a truly useful variable');
      (0, _chai.expect)(result.replacementPrefix).equals('replacementPrefix');
      (0, _chai.expect)(result.text).equals('newText');
      (0, _chai.expect)(autocompleteRequest.editor.getTextInBufferRange.calledOnce).equals(true);
      (0, _chai.expect)(autocompleteRequest.editor.getTextInBufferRange.getCall(0).args).deep.equals([new _atom.Range(new _atom.Point(10, 20), new _atom.Point(30, 40))]);
    });
  });

  describe('basicCompletionItemToSuggestion', () => {
    it('converts LSP CompletionItem with insertText and filterText to AutoComplete Suggestion', () => {
      const completionItem = {
        insertText: 'insert',
        label: 'label',
        filterText: 'filter',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'detail',
        documentation: 'a very exciting keyword'
      };
      const result = _autocompleteAdapter2.default.basicCompletionItemToSuggestion(completionItem);
      (0, _chai.expect)(result.text).equals('insert');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.rightLabel).equals('detail');
      (0, _chai.expect)(result.description).equals('a very exciting keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('a very exciting keyword');
    });

    it('converts LSP CompletionItem without insertText or filterText to AutoComplete Suggestion', () => {
      const completionItem = {
        label: 'label',
        kind: ls.CompletionItemKind.Keyword,
        detail: 'detail',
        documentation: 'A very useful keyword'
      };
      const result = _autocompleteAdapter2.default.basicCompletionItemToSuggestion(completionItem);
      (0, _chai.expect)(result.text).equals('label');
      (0, _chai.expect)(result.displayText).equals('label');
      (0, _chai.expect)(result.type).equals('keyword');
      (0, _chai.expect)(result.rightLabel).equals('detail');
      (0, _chai.expect)(result.description).equals('A very useful keyword');
      (0, _chai.expect)(result.descriptionMarkdown).equals('A very useful keyword');
    });
  });

  describe('applyTextEditToSuggestion', () => {
    const basicCompletionItem = {
      label: 'label',
      kind: ls.CompletionItemKind.Keyword,
      detail: 'detail',
      documentation: 'An incredible keyword'
    };

    it('does not do anything if there is no textEdit', () => {
      const completionItem = _extends({}, basicCompletionItem);
      _autocompleteAdapter2.default.applyTextEditToSuggestion(null, new _atom.TextEditor(), completionItem);
      (0, _chai.expect)(completionItem).deep.equals(basicCompletionItem);
    });

    it('applies changes from TextEdit to replacementPrefix and text', () => {
      const textEdit = {
        range: {
          start: { line: 1, character: 2 },
          end: { line: 3, character: 4 }
        },
        newText: 'newText'
      };
      const editor = new _atom.TextEditor();
      _sinon2.default.stub(editor, 'getTextInBufferRange').returns('replacementPrefix');

      const completionItem = _extends({}, basicCompletionItem);
      _autocompleteAdapter2.default.applyTextEditToSuggestion(textEdit, editor, completionItem);
      (0, _chai.expect)(completionItem.replacementPrefix).equals('replacementPrefix');
      (0, _chai.expect)(completionItem.text).equals('newText');
      (0, _chai.expect)(editor.getTextInBufferRange.calledOnce).equals(true);
      (0, _chai.expect)(editor.getTextInBufferRange.getCall(0).args).deep.equals([new _atom.Range(new _atom.Point(1, 2), new _atom.Point(3, 4))]);
    });
  });

  describe('completionKindToSuggestionType', () => {
    it('converts LSP CompletionKinds to AutoComplete SuggestionTypes', () => {
      const variable = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Variable);
      const constructor = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Constructor);
      const module = _autocompleteAdapter2.default.completionKindToSuggestionType(ls.CompletionItemKind.Module);
      (0, _chai.expect)(variable).equals('variable');
      (0, _chai.expect)(constructor).equals('function');
      (0, _chai.expect)(module).equals('module');
    });

    it('defaults to "value"', () => {
      const result = _autocompleteAdapter2.default.completionKindToSuggestionType(null);
      (0, _chai.expect)(result).equals('value');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Rlc3QvYWRhcHRlcnMvYXV0b2NvbXBsZXRlLWFkYXB0ZXIudGVzdC5qcyJdLCJuYW1lcyI6WyJscyIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsImdsb2JhbCIsInNpbm9uIiwic2FuZGJveCIsImNyZWF0ZSIsImFmdGVyRWFjaCIsInJlc3RvcmUiLCJyZXF1ZXN0IiwiZWRpdG9yIiwiYnVmZmVyUG9zaXRpb24iLCJwcmVmaXgiLCJzY29wZURlc2NyaXB0b3IiLCJjb21wbGV0aW9uSXRlbXMiLCJsYWJlbCIsImtpbmQiLCJDb21wbGV0aW9uSXRlbUtpbmQiLCJLZXl3b3JkIiwiZGV0YWlsIiwiZG9jdW1lbnRhdGlvbiIsInNvcnRUZXh0IiwiRmllbGQiLCJWYXJpYWJsZSIsImZha2VMYW5ndWFnZUNsaWVudCIsIkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbiIsInN0dWIiLCJyZXNvbHZlcyIsIml0IiwiYXV0b0NvbXBsZXRlQWRhcHRlciIsInJlc3VsdHMiLCJnZXRTdWdnZXN0aW9ucyIsImxlbmd0aCIsImVxdWFscyIsInRleHQiLCJkZXNjcmlwdGlvbiIsInR5cGUiLCJyZXN1bHQiLCJyZXF1ZXN0VG9UZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyIsInRleHREb2N1bWVudCIsInVyaSIsInBvc2l0aW9uIiwiZGVlcCIsImxpbmUiLCJjaGFyYWN0ZXIiLCJjb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zIiwiY29tcGxldGlvbkxpc3QiLCJpdGVtcyIsImlzSW5jb21wbGV0ZSIsImNvbXBsZXRpb25JdGVtIiwiaW5zZXJ0VGV4dCIsImZpbHRlclRleHQiLCJjb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbiIsImRpc3BsYXlUZXh0IiwicmlnaHRMYWJlbCIsImRlc2NyaXB0aW9uTWFya2Rvd24iLCJ0ZXh0RWRpdCIsInJhbmdlIiwic3RhcnQiLCJlbmQiLCJuZXdUZXh0IiwiYXV0b2NvbXBsZXRlUmVxdWVzdCIsInJldHVybnMiLCJyZXBsYWNlbWVudFByZWZpeCIsImdldFRleHRJbkJ1ZmZlclJhbmdlIiwiY2FsbGVkT25jZSIsImdldENhbGwiLCJhcmdzIiwiYmFzaWNDb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbiIsImJhc2ljQ29tcGxldGlvbkl0ZW0iLCJhcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uIiwidmFyaWFibGUiLCJjb21wbGV0aW9uS2luZFRvU3VnZ2VzdGlvblR5cGUiLCJjb25zdHJ1Y3RvciIsIkNvbnN0cnVjdG9yIiwibW9kdWxlIiwiTW9kdWxlIl0sIm1hcHBpbmdzIjoiOztBQUVBOzs7O0FBQ0E7O0lBQVlBLEU7O0FBQ1o7Ozs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBRUFDLFNBQVMscUJBQVQsRUFBZ0MsTUFBTTtBQUNwQ0MsYUFBVyxNQUFNO0FBQ2ZDLFdBQU9DLEtBQVAsR0FBZSxnQkFBTUMsT0FBTixDQUFjQyxNQUFkLEVBQWY7QUFDRCxHQUZEO0FBR0FDLFlBQVUsTUFBTTtBQUNkSixXQUFPQyxLQUFQLENBQWFJLE9BQWI7QUFDRCxHQUZEOztBQUlBLFFBQU1DLFVBQW9DO0FBQ3hDQyxZQUFRLGdDQURnQztBQUV4Q0Msb0JBQWdCLGdCQUFVLEdBQVYsRUFBZSxHQUFmLENBRndCO0FBR3hDQyxZQUFRLEtBSGdDO0FBSXhDQyxxQkFBaUI7QUFKdUIsR0FBMUM7O0FBT0EsUUFBTUMsa0JBQWtCLENBQ3RCO0FBQ0VDLFdBQU8sUUFEVDtBQUVFQyxVQUFNaEIsR0FBR2lCLGtCQUFILENBQXNCQyxPQUY5QjtBQUdFQyxZQUFRLGNBSFY7QUFJRUMsbUJBQWUseUJBSmpCO0FBS0VDLGNBQVU7QUFMWixHQURzQixFQVF0QjtBQUNFTixXQUFPLFFBRFQ7QUFFRUMsVUFBTWhCLEdBQUdpQixrQkFBSCxDQUFzQkssS0FGOUI7QUFHRUgsWUFBUSxjQUhWO0FBSUVDLG1CQUFlLHVCQUpqQjtBQUtFQyxjQUFVO0FBTFosR0FSc0IsRUFldEI7QUFDRU4sV0FBTyxRQURUO0FBRUVDLFVBQU1oQixHQUFHaUIsa0JBQUgsQ0FBc0JN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TUFBZixDQUFzQixPQUF0QjtBQUNELEtBSEQ7QUFJRCxHQWREO0FBZUQsQ0FqT0QiLCJmaWxlIjoiYXV0b2NvbXBsZXRlLWFkYXB0ZXIudGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XHJcblxyXG5pbXBvcnQgQXV0b0NvbXBsZXRlQWRhcHRlciBmcm9tICcuLi8uLi9saWIvYWRhcHRlcnMvYXV0b2NvbXBsZXRlLWFkYXB0ZXInO1xyXG5pbXBvcnQgKiBhcyBscyBmcm9tICcuLi8uLi9saWIvbGFuZ3VhZ2VjbGllbnQnO1xyXG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xyXG5pbXBvcnQge1BvaW50LCBSYW5nZSwgVGV4dEVkaXRvcn0gZnJvbSAnYXRvbSc7XHJcbmltcG9ydCB7ZXhwZWN0fSBmcm9tICdjaGFpJztcclxuaW1wb3J0IHtjcmVhdGVTcHlDb25uZWN0aW9uLCBjcmVhdGVGYWtlRWRpdG9yfSBmcm9tICcuLi9oZWxwZXJzLmpzJztcclxuXHJcbmRlc2NyaWJlKCdBdXRvQ29tcGxldGVBZGFwdGVyJywgKCkgPT4ge1xyXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgZ2xvYmFsLnNpbm9uID0gc2lub24uc2FuZGJveC5jcmVhdGUoKTtcclxuICB9KTtcclxuICBhZnRlckVhY2goKCkgPT4ge1xyXG4gICAgZ2xvYmFsLnNpbm9uLnJlc3RvcmUoKTtcclxuICB9KTtcclxuXHJcbiAgY29uc3QgcmVxdWVzdDogYXRvbSRBdXRvY29tcGxldGVSZXF1ZXN0ID0ge1xyXG4gICAgZWRpdG9yOiBjcmVhdGVGYWtlRWRpdG9yKCksXHJcbiAgICBidWZmZXJQb3NpdGlvbjogbmV3IFBvaW50KDEyMywgNDU2KSxcclxuICAgIHByZWZpeDogJ2RlZicsXHJcbiAgICBzY29wZURlc2NyaXB0b3I6ICdzb21lLnNjb3BlJyxcclxuICB9O1xyXG5cclxuICBjb25zdCBjb21wbGV0aW9uSXRlbXMgPSBbXHJcbiAgICB7XHJcbiAgICAgIGxhYmVsOiAnbGFiZWwxJyxcclxuICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLktleXdvcmQsXHJcbiAgICAgIGRldGFpbDogJ2Rlc2NyaXB0aW9uMScsXHJcbiAgICAgIGRvY3VtZW50YXRpb246ICdhIHZlcnkgZXhjaXRpbmcga2V5d29yZCcsXHJcbiAgICAgIHNvcnRUZXh0OiAneicsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBsYWJlbDogJ2xhYmVsMicsXHJcbiAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5GaWVsZCxcclxuICAgICAgZGV0YWlsOiAnZGVzY3JpcHRpb24yJyxcclxuICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyBmaWVsZCcsXHJcbiAgICAgIHNvcnRUZXh0OiAnYScsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBsYWJlbDogJ2xhYmVsMycsXHJcbiAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5WYXJpYWJsZSxcclxuICAgICAgZGV0YWlsOiAnZGVzY3JpcHRpb24zJyxcclxuICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyB2YXJpYWJsZScsXHJcbiAgICB9LFxyXG4gIF07XHJcblxyXG4gIGRlc2NyaWJlKCdnZXRTdWdnZXN0aW9ucycsICgpID0+IHtcclxuICAgIGNvbnN0IGZha2VMYW5ndWFnZUNsaWVudCA9IG5ldyBscy5MYW5ndWFnZUNsaWVudENvbm5lY3Rpb24oY3JlYXRlU3B5Q29ubmVjdGlvbigpKTtcclxuICAgIHNpbm9uLnN0dWIoZmFrZUxhbmd1YWdlQ2xpZW50LCAnY29tcGxldGlvbicpLnJlc29sdmVzKGNvbXBsZXRpb25JdGVtcyk7XHJcblxyXG4gICAgaXQoJ2dldHMgQXV0b0NvbXBsZXRlIHN1Z2dlc3Rpb25zIHZpYSBMU1AgZ2l2ZW4gYW4gQXV0b0NvbXBsZXRlUmVxdWVzdCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgYXV0b0NvbXBsZXRlQWRhcHRlciA9IG5ldyBBdXRvQ29tcGxldGVBZGFwdGVyKCk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBhdXRvQ29tcGxldGVBZGFwdGVyLmdldFN1Z2dlc3Rpb25zKGZha2VMYW5ndWFnZUNsaWVudCwgcmVxdWVzdCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzLmxlbmd0aCkuZXF1YWxzKDMpO1xyXG4gICAgICBleHBlY3QocmVzdWx0c1swXS50ZXh0KS5lcXVhbHMoJ2xhYmVsMicpO1xyXG4gICAgICBleHBlY3QocmVzdWx0c1sxXS5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHZlcnkgZXhjaXRpbmcgdmFyaWFibGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHNbMl0udHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ3JlcXVlc3RUb1RleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zJywgKCkgPT4ge1xyXG4gICAgaXQoJ2NyZWF0ZXMgYSBUZXh0RG9jdW1lbnRQb3NpdGlvblBhcmFtcyBmcm9tIGFuIEF1dG9jb21wbGV0ZVJlcXVlc3QnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IEF1dG9Db21wbGV0ZUFkYXB0ZXIucmVxdWVzdFRvVGV4dERvY3VtZW50UG9zaXRpb25QYXJhbXMocmVxdWVzdCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dERvY3VtZW50LnVyaSkuZXF1YWxzKCdmaWxlOi8vL2EvYi9jL2QuanMnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5wb3NpdGlvbikuZGVlcC5lcXVhbHMoe2xpbmU6IDEyMywgY2hhcmFjdGVyOiA0NTZ9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY29tcGxldGlvbkl0ZW1zVG9TdWdnZXN0aW9ucycsICgpID0+IHtcclxuICAgIGl0KCdjb252ZXJ0cyBMU1AgQ29tcGxldGlvbkl0ZW0gYXJyYXkgdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb25zIGFycmF5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCByZXN1bHRzID0gQXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uSXRlbXNUb1N1Z2dlc3Rpb25zKGNvbXBsZXRpb25JdGVtcywgcmVxdWVzdCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzLmxlbmd0aCkuZXF1YWxzKDMpO1xyXG4gICAgICBleHBlY3QocmVzdWx0c1swXS50ZXh0KS5lcXVhbHMoJ2xhYmVsMicpO1xyXG4gICAgICBleHBlY3QocmVzdWx0c1sxXS5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHZlcnkgZXhjaXRpbmcgdmFyaWFibGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHNbMl0udHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25MaXN0IHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9ucyBhcnJheScsICgpID0+IHtcclxuICAgICAgY29uc3QgY29tcGxldGlvbkxpc3QgPSB7aXRlbXM6IGNvbXBsZXRpb25JdGVtcywgaXNJbmNvbXBsZXRlOiBmYWxzZX07XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtc1RvU3VnZ2VzdGlvbnMoY29tcGxldGlvbkxpc3QsIHJlcXVlc3QpO1xyXG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLmVxdWFscygzKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0uZGVzY3JpcHRpb24pLmVxdWFscygnYSB2ZXJ5IGV4Y2l0aW5nIGZpZWxkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHRzWzFdLnRleHQpLmVxdWFscygnbGFiZWwzJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnY29udmVydHMgZW1wdHkgYXJyYXkgaW50byBhbiBlbXB0eSBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvbnMgYXJyYXknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtc1RvU3VnZ2VzdGlvbnMoW10sIHJlcXVlc3QpO1xyXG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLmVxdWFscygwKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnY29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25JdGVtIHRvIEF1dG9Db21wbGV0ZSBTdWdnZXN0aW9uIHdpdGhvdXQgdGV4dEVkaXQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25JdGVtID0ge1xyXG4gICAgICAgIGluc2VydFRleHQ6ICdpbnNlcnQnLFxyXG4gICAgICAgIGxhYmVsOiAnbGFiZWwnLFxyXG4gICAgICAgIGZpbHRlclRleHQ6ICdmaWx0ZXInLFxyXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxyXG4gICAgICAgIGRldGFpbDogJ2tleXdvcmQnLFxyXG4gICAgICAgIGRvY3VtZW50YXRpb246ICdhIHRydWx5IHVzZWZ1bCBrZXl3b3JkJyxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gQXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uSXRlbVRvU3VnZ2VzdGlvbihjb21wbGV0aW9uSXRlbSwgcmVxdWVzdCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkuZXF1YWxzKCdpbnNlcnQnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kaXNwbGF5VGV4dCkuZXF1YWxzKCdsYWJlbCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnR5cGUpLmVxdWFscygna2V5d29yZCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJpZ2h0TGFiZWwpLmVxdWFscygna2V5d29yZCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdHJ1bHkgdXNlZnVsIGtleXdvcmQnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbk1hcmtkb3duKS5lcXVhbHMoJ2EgdHJ1bHkgdXNlZnVsIGtleXdvcmQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBMU1AgQ29tcGxldGlvbkl0ZW0gdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb24gd2l0aCB0ZXh0RWRpdCcsICgpID0+IHtcclxuICAgICAgY29uc3QgY29tcGxldGlvbkl0ZW06IGxzLkNvbXBsZXRpb25JdGVtID0ge1xyXG4gICAgICAgIGluc2VydFRleHQ6ICdpbnNlcnQnLFxyXG4gICAgICAgIGxhYmVsOiAnbGFiZWwnLFxyXG4gICAgICAgIGZpbHRlclRleHQ6ICdmaWx0ZXInLFxyXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5WYXJpYWJsZSxcclxuICAgICAgICBkZXRhaWw6ICdudW1iZXInLFxyXG4gICAgICAgIGRvY3VtZW50YXRpb246ICdhIHRydWx5IHVzZWZ1bCB2YXJpYWJsZScsXHJcbiAgICAgICAgdGV4dEVkaXQ6IHtcclxuICAgICAgICAgIHJhbmdlOiB7XHJcbiAgICAgICAgICAgIHN0YXJ0OiB7bGluZTogMTAsIGNoYXJhY3RlcjogMjB9LFxyXG4gICAgICAgICAgICBlbmQ6IHtsaW5lOiAzMCwgY2hhcmFjdGVyOiA0MH0sXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgbmV3VGV4dDogJ25ld1RleHQnLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH07XHJcbiAgICAgIGNvbnN0IGF1dG9jb21wbGV0ZVJlcXVlc3Q6IGF0b20kQXV0b2NvbXBsZXRlUmVxdWVzdCA9IHtcclxuICAgICAgICBlZGl0b3I6IGNyZWF0ZUZha2VFZGl0b3IoKSxcclxuICAgICAgICBidWZmZXJQb3NpdGlvbjogbmV3IFBvaW50KDEyMywgNDU2KSxcclxuICAgICAgICBwcmVmaXg6ICdkZWYnLFxyXG4gICAgICAgIHNjb3BlRGVzY3JpcHRvcjogJ3NvbWUuc2NvcGUnLFxyXG4gICAgICB9O1xyXG4gICAgICBzaW5vbi5zdHViKGF1dG9jb21wbGV0ZVJlcXVlc3QuZWRpdG9yLCAnZ2V0VGV4dEluQnVmZmVyUmFuZ2UnKS5yZXR1cm5zKCdyZXBsYWNlbWVudFByZWZpeCcpO1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmNvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKGNvbXBsZXRpb25JdGVtLCBhdXRvY29tcGxldGVSZXF1ZXN0KTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kaXNwbGF5VGV4dCkuZXF1YWxzKCdsYWJlbCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnR5cGUpLmVxdWFscygndmFyaWFibGUnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5yaWdodExhYmVsKS5lcXVhbHMoJ251bWJlcicpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uKS5lcXVhbHMoJ2EgdHJ1bHkgdXNlZnVsIHZhcmlhYmxlJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb25NYXJrZG93bikuZXF1YWxzKCdhIHRydWx5IHVzZWZ1bCB2YXJpYWJsZScpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJlcGxhY2VtZW50UHJlZml4KS5lcXVhbHMoJ3JlcGxhY2VtZW50UHJlZml4Jyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudGV4dCkuZXF1YWxzKCduZXdUZXh0Jyk7XHJcbiAgICAgIGV4cGVjdChhdXRvY29tcGxldGVSZXF1ZXN0LmVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZS5jYWxsZWRPbmNlKS5lcXVhbHModHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChhdXRvY29tcGxldGVSZXF1ZXN0LmVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZS5nZXRDYWxsKDApLmFyZ3MpLmRlZXAuZXF1YWxzKFtcclxuICAgICAgICBuZXcgUmFuZ2UobmV3IFBvaW50KDEwLCAyMCksIG5ldyBQb2ludCgzMCwgNDApKSxcclxuICAgICAgXSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2Jhc2ljQ29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24nLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25JdGVtIHdpdGggaW5zZXJ0VGV4dCBhbmQgZmlsdGVyVGV4dCB0byBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvbicsICgpID0+IHtcclxuICAgICAgY29uc3QgY29tcGxldGlvbkl0ZW06IGxzLkNvbXBsZXRpb25JdGVtID0ge1xyXG4gICAgICAgIGluc2VydFRleHQ6ICdpbnNlcnQnLFxyXG4gICAgICAgIGxhYmVsOiAnbGFiZWwnLFxyXG4gICAgICAgIGZpbHRlclRleHQ6ICdmaWx0ZXInLFxyXG4gICAgICAgIGtpbmQ6IGxzLkNvbXBsZXRpb25JdGVtS2luZC5LZXl3b3JkLFxyXG4gICAgICAgIGRldGFpbDogJ2RldGFpbCcsXHJcbiAgICAgICAgZG9jdW1lbnRhdGlvbjogJ2EgdmVyeSBleGNpdGluZyBrZXl3b3JkJyxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gQXV0b0NvbXBsZXRlQWRhcHRlci5iYXNpY0NvbXBsZXRpb25JdGVtVG9TdWdnZXN0aW9uKGNvbXBsZXRpb25JdGVtKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC50ZXh0KS5lcXVhbHMoJ2luc2VydCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRpc3BsYXlUZXh0KS5lcXVhbHMoJ2xhYmVsJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQudHlwZSkuZXF1YWxzKCdrZXl3b3JkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQucmlnaHRMYWJlbCkuZXF1YWxzKCdkZXRhaWwnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kZXNjcmlwdGlvbikuZXF1YWxzKCdhIHZlcnkgZXhjaXRpbmcga2V5d29yZCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LmRlc2NyaXB0aW9uTWFya2Rvd24pLmVxdWFscygnYSB2ZXJ5IGV4Y2l0aW5nIGtleXdvcmQnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdjb252ZXJ0cyBMU1AgQ29tcGxldGlvbkl0ZW0gd2l0aG91dCBpbnNlcnRUZXh0IG9yIGZpbHRlclRleHQgdG8gQXV0b0NvbXBsZXRlIFN1Z2dlc3Rpb24nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25JdGVtOiBscy5Db21wbGV0aW9uSXRlbSA9IHtcclxuICAgICAgICBsYWJlbDogJ2xhYmVsJyxcclxuICAgICAgICBraW5kOiBscy5Db21wbGV0aW9uSXRlbUtpbmQuS2V5d29yZCxcclxuICAgICAgICBkZXRhaWw6ICdkZXRhaWwnLFxyXG4gICAgICAgIGRvY3VtZW50YXRpb246ICdBIHZlcnkgdXNlZnVsIGtleXdvcmQnLFxyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBBdXRvQ29tcGxldGVBZGFwdGVyLmJhc2ljQ29tcGxldGlvbkl0ZW1Ub1N1Z2dlc3Rpb24oY29tcGxldGlvbkl0ZW0pO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnRleHQpLmVxdWFscygnbGFiZWwnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5kaXNwbGF5VGV4dCkuZXF1YWxzKCdsYWJlbCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnR5cGUpLmVxdWFscygna2V5d29yZCcpO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJpZ2h0TGFiZWwpLmVxdWFscygnZGV0YWlsJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb24pLmVxdWFscygnQSB2ZXJ5IHVzZWZ1bCBrZXl3b3JkJyk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuZGVzY3JpcHRpb25NYXJrZG93bikuZXF1YWxzKCdBIHZlcnkgdXNlZnVsIGtleXdvcmQnKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnYXBwbHlUZXh0RWRpdFRvU3VnZ2VzdGlvbicsICgpID0+IHtcclxuICAgIGNvbnN0IGJhc2ljQ29tcGxldGlvbkl0ZW06IGxzLkNvbXBsZXRpb25JdGVtID0ge1xyXG4gICAgICBsYWJlbDogJ2xhYmVsJyxcclxuICAgICAga2luZDogbHMuQ29tcGxldGlvbkl0ZW1LaW5kLktleXdvcmQsXHJcbiAgICAgIGRldGFpbDogJ2RldGFpbCcsXHJcbiAgICAgIGRvY3VtZW50YXRpb246ICdBbiBpbmNyZWRpYmxlIGtleXdvcmQnLFxyXG4gICAgfTtcclxuXHJcbiAgICBpdCgnZG9lcyBub3QgZG8gYW55dGhpbmcgaWYgdGhlcmUgaXMgbm8gdGV4dEVkaXQnLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbXBsZXRpb25JdGVtID0gey4uLmJhc2ljQ29tcGxldGlvbkl0ZW19O1xyXG4gICAgICBBdXRvQ29tcGxldGVBZGFwdGVyLmFwcGx5VGV4dEVkaXRUb1N1Z2dlc3Rpb24obnVsbCwgbmV3IFRleHRFZGl0b3IoKSwgY29tcGxldGlvbkl0ZW0pO1xyXG4gICAgICBleHBlY3QoY29tcGxldGlvbkl0ZW0pLmRlZXAuZXF1YWxzKGJhc2ljQ29tcGxldGlvbkl0ZW0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ2FwcGxpZXMgY2hhbmdlcyBmcm9tIFRleHRFZGl0IHRvIHJlcGxhY2VtZW50UHJlZml4IGFuZCB0ZXh0JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0ZXh0RWRpdCA9IHtcclxuICAgICAgICByYW5nZToge1xyXG4gICAgICAgICAgc3RhcnQ6IHtsaW5lOiAxLCBjaGFyYWN0ZXI6IDJ9LFxyXG4gICAgICAgICAgZW5kOiB7bGluZTogMywgY2hhcmFjdGVyOiA0fSxcclxuICAgICAgICB9LFxyXG4gICAgICAgIG5ld1RleHQ6ICduZXdUZXh0JyxcclxuICAgICAgfTtcclxuICAgICAgY29uc3QgZWRpdG9yID0gbmV3IFRleHRFZGl0b3IoKTtcclxuICAgICAgc2lub24uc3R1YihlZGl0b3IsICdnZXRUZXh0SW5CdWZmZXJSYW5nZScpLnJldHVybnMoJ3JlcGxhY2VtZW50UHJlZml4Jyk7XHJcblxyXG4gICAgICBjb25zdCBjb21wbGV0aW9uSXRlbSA9IHsuLi5iYXNpY0NvbXBsZXRpb25JdGVtfTtcclxuICAgICAgQXV0b0NvbXBsZXRlQWRhcHRlci5hcHBseVRleHRFZGl0VG9TdWdnZXN0aW9uKHRleHRFZGl0LCBlZGl0b3IsIGNvbXBsZXRpb25JdGVtKTtcclxuICAgICAgZXhwZWN0KGNvbXBsZXRpb25JdGVtLnJlcGxhY2VtZW50UHJlZml4KS5lcXVhbHMoJ3JlcGxhY2VtZW50UHJlZml4Jyk7XHJcbiAgICAgIGV4cGVjdChjb21wbGV0aW9uSXRlbS50ZXh0KS5lcXVhbHMoJ25ld1RleHQnKTtcclxuICAgICAgZXhwZWN0KGVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZS5jYWxsZWRPbmNlKS5lcXVhbHModHJ1ZSk7XHJcbiAgICAgIGV4cGVjdChlZGl0b3IuZ2V0VGV4dEluQnVmZmVyUmFuZ2UuZ2V0Q2FsbCgwKS5hcmdzKS5kZWVwLmVxdWFscyhbbmV3IFJhbmdlKG5ldyBQb2ludCgxLCAyKSwgbmV3IFBvaW50KDMsIDQpKV0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdjb21wbGV0aW9uS2luZFRvU3VnZ2VzdGlvblR5cGUnLCAoKSA9PiB7XHJcbiAgICBpdCgnY29udmVydHMgTFNQIENvbXBsZXRpb25LaW5kcyB0byBBdXRvQ29tcGxldGUgU3VnZ2VzdGlvblR5cGVzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB2YXJpYWJsZSA9IEF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlKGxzLkNvbXBsZXRpb25JdGVtS2luZC5WYXJpYWJsZSk7XHJcbiAgICAgIGNvbnN0IGNvbnN0cnVjdG9yID0gQXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uS2luZFRvU3VnZ2VzdGlvblR5cGUobHMuQ29tcGxldGlvbkl0ZW1LaW5kLkNvbnN0cnVjdG9yKTtcclxuICAgICAgY29uc3QgbW9kdWxlID0gQXV0b0NvbXBsZXRlQWRhcHRlci5jb21wbGV0aW9uS2luZFRvU3VnZ2VzdGlvblR5cGUobHMuQ29tcGxldGlvbkl0ZW1LaW5kLk1vZHVsZSk7XHJcbiAgICAgIGV4cGVjdCh2YXJpYWJsZSkuZXF1YWxzKCd2YXJpYWJsZScpO1xyXG4gICAgICBleHBlY3QoY29uc3RydWN0b3IpLmVxdWFscygnZnVuY3Rpb24nKTtcclxuICAgICAgZXhwZWN0KG1vZHVsZSkuZXF1YWxzKCdtb2R1bGUnKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdkZWZhdWx0cyB0byBcInZhbHVlXCInLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IEF1dG9Db21wbGV0ZUFkYXB0ZXIuY29tcGxldGlvbktpbmRUb1N1Z2dlc3Rpb25UeXBlKG51bGwpO1xyXG4gICAgICBleHBlY3QocmVzdWx0KS5lcXVhbHMoJ3ZhbHVlJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdfQ==