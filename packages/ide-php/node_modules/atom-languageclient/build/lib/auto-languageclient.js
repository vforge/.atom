Object.defineProperty(exports, "__esModule", {
  value: true
});

var _child_process = require('child_process');

var cp = _interopRequireWildcard(_child_process);

var _languageclient = require('./languageclient');

var ls = _interopRequireWildcard(_languageclient);

var _vscodeJsonrpc = require('vscode-jsonrpc');

var rpc = _interopRequireWildcard(_vscodeJsonrpc);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _atom = require('atom');

var _logger = require('./logger');

var _serverManager = require('./server-manager.js');

var _convert = require('./convert.js');

var _convert2 = _interopRequireDefault(_convert);

var _applyEditAdapter = require('./adapters/apply-edit-adapter');

var _applyEditAdapter2 = _interopRequireDefault(_applyEditAdapter);

var _autocompleteAdapter = require('./adapters/autocomplete-adapter');

var _autocompleteAdapter2 = _interopRequireDefault(_autocompleteAdapter);

var _codeActionAdapter = require('./adapters/code-action-adapter');

var _codeActionAdapter2 = _interopRequireDefault(_codeActionAdapter);

var _codeFormatAdapter = require('./adapters/code-format-adapter');

var _codeFormatAdapter2 = _interopRequireDefault(_codeFormatAdapter);

var _codeHighlightAdapter = require('./adapters/code-highlight-adapter');

var _codeHighlightAdapter2 = _interopRequireDefault(_codeHighlightAdapter);

var _datatipAdapter = require('./adapters/datatip-adapter');

var _datatipAdapter2 = _interopRequireDefault(_datatipAdapter);

var _definitionAdapter = require('./adapters/definition-adapter');

var _definitionAdapter2 = _interopRequireDefault(_definitionAdapter);

var _documentSyncAdapter = require('./adapters/document-sync-adapter');

var _documentSyncAdapter2 = _interopRequireDefault(_documentSyncAdapter);

var _findReferencesAdapter = require('./adapters/find-references-adapter');

var _findReferencesAdapter2 = _interopRequireDefault(_findReferencesAdapter);

var _linterPushV2Adapter = require('./adapters/linter-push-v2-adapter');

var _linterPushV2Adapter2 = _interopRequireDefault(_linterPushV2Adapter);

var _notificationsAdapter = require('./adapters/notifications-adapter');

var _notificationsAdapter2 = _interopRequireDefault(_notificationsAdapter);

var _outlineViewAdapter = require('./adapters/outline-view-adapter');

var _outlineViewAdapter2 = _interopRequireDefault(_outlineViewAdapter);

var _signatureHelpAdapter = require('./adapters/signature-help-adapter');

var _signatureHelpAdapter2 = _interopRequireDefault(_signatureHelpAdapter);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

// Public: AutoLanguageClient provides a simple way to have all the supported
// Atom-IDE services wired up entirely for you by just subclassing it and
// implementing startServerProcess/getGrammarScopes/getLanguageName and
// getServerName.
class AutoLanguageClient {
  constructor() {
    this._disposable = new _atom.CompositeDisposable();
    this.processStdErr = '';
  }

  // Available if consumeBusySignal is setup


  // Shared adapters that can take the RPC connection as required


  // You must implement these so we know how to deal with your language and server
  // -------------------------------------------------------------------------

  // Return an array of the grammar scopes you handle, e.g. [ 'source.js' ]
  getGrammarScopes() {
    throw Error('Must implement getGrammarScopes when extending AutoLanguageClient');
  }

  // Return the name of the language you support, e.g. 'JavaScript'
  getLanguageName() {
    throw Error('Must implement getLanguageName when extending AutoLanguageClient');
  }

  // Return the name of your server, e.g. 'Eclipse JDT'
  getServerName() {
    throw Error('Must implement getServerName when extending AutoLanguageClient');
  }

  // Start your server process
  startServerProcess(projectPath) {
    throw Error('Must override startServerProcess to start language server process when extending AutoLanguageClient');
  }

  // You might want to override these for different behavior
  // ---------------------------------------------------------------------------

  // Determine whether we should start a server for a given editor if we don't have one yet
  shouldStartForEditor(editor) {
    return this.getGrammarScopes().includes(editor.getGrammar().scopeName);
  }

  // Return the parameters used to initialize a client - you may want to extend capabilities
  getInitializeParams(projectPath, process) {
    return {
      processId: process.pid,
      rootPath: projectPath,
      rootUri: _convert2.default.pathToUri(projectPath),
      capabilities: {
        workspace: {
          applyEdit: true,
          workspaceEdit: {
            documentChanges: true
          },
          didChangeConfiguration: {
            dynamicRegistration: false
          },
          didChangeWatchedFiles: {
            dynamicRegistration: false
          },
          symbol: {
            dynamicRegistration: false
          },
          executeCommand: {
            dynamicRegistration: false
          }
        },
        textDocument: {
          synchronization: {
            dynamicRegistration: false,
            willSave: true,
            willSaveWaitUntil: false,
            didSave: true
          },
          completion: {
            dynamicRegistration: false,
            completionItem: {
              snippetSupport: true,
              commitCharactersSupport: false
            },
            contextSupport: false
          },
          hover: {
            dynamicRegistration: false
          },
          signatureHelp: {
            dynamicRegistration: false
          },
          references: {
            dynamicRegistration: false
          },
          documentHighlight: {
            dynamicRegistration: false
          },
          documentSymbol: {
            dynamicRegistration: false
          },
          formatting: {
            dynamicRegistration: false
          },
          rangeFormatting: {
            dynamicRegistration: false
          },
          onTypeFormatting: {
            dynamicRegistration: false
          },
          definition: {
            dynamicRegistration: false
          },
          codeAction: {
            dynamicRegistration: false
          },
          codeLens: {
            dynamicRegistration: false
          },
          documentLink: {
            dynamicRegistration: false
          },
          rename: {
            dynamicRegistration: false
          }
        },
        experimental: {}
      }
    };
  }

  // Early wire-up of listeners before initialize method is sent
  preInitialization(connection) {}

  // Late wire-up of listeners after initialize method has been sent
  postInitialization(server) {}

  // Determine whether to use ipc, stdio or socket to connect to the server
  getConnectionType() {
    return this.socket != null ? 'socket' : 'stdio';
  }

  // Default implementation of the rest of the AutoLanguageClient
  // ---------------------------------------------------------------------------

  // Activate does very little for perf reasons - hooks in via ServerManager for later 'activation'
  activate() {
    this.name = `${this.getLanguageName()} (${this.getServerName()})`;
    this.logger = this.getLogger();
    this._serverManager = new _serverManager.ServerManager(p => this.startServer(p), this.logger, e => this.shouldStartForEditor(e), filepath => this.filterChangeWatchedFiles(filepath), () => this.busySignalService, this.getServerName());
    this._serverManager.startListening();
    process.on('exit', () => this.exitCleanup.bind(this));
  }

  exitCleanup() {
    this._serverManager.terminate();
  }

  // Deactivate disposes the resources we're using
  async deactivate() {
    this._disposable.dispose();
    this._serverManager.stopListening();
    await this._serverManager.stopAllServers();
  }

  spawnChildNode(args, options = {}) {
    this.logger.debug(`starting child Node "${args.join(' ')}"`);
    options.env = options.env || Object.create(process.env);
    options.env.ELECTRON_RUN_AS_NODE = '1';
    options.env.ELECTRON_NO_ATTACH_CONSOLE = '1';
    return cp.spawn(process.execPath, args, options);
  }

  // By default LSP logging is switched off but you can switch it on via the core.debugLSP setting
  getLogger() {
    return atom.config.get('core.debugLSP') ? new _logger.ConsoleLogger(this.name) : new _logger.NullLogger();
  }

  // Starts the server by starting the process, then initializing the language server and starting adapters
  async startServer(projectPath) {
    const startingSignal = this.busySignalService && this.busySignalService.reportBusy(`Starting ${this.getServerName()} for ${_path2.default.basename(projectPath)}`);
    let process;
    try {
      process = await this.startServerProcess(projectPath);
    } finally {
      startingSignal && startingSignal.dispose();
    }

    const connection = new ls.LanguageClientConnection(this.createRpcConnection(process), this.logger);
    this.preInitialization(connection);
    const initializeParams = this.getInitializeParams(projectPath, process);
    const initialization = connection.initialize(initializeParams);
    this.busySignalService && this.busySignalService.reportBusyWhile(`${this.getServerName()} initializing for ${_path2.default.basename(projectPath)}`, () => initialization);
    const initializeResponse = await initialization;
    const newServer = {
      projectPath,
      process,
      connection,
      capabilities: initializeResponse.capabilities,
      disposable: new _atom.CompositeDisposable()
    };
    this.postInitialization(newServer);
    connection.initialized();
    this.startExclusiveAdapters(newServer);
    return newServer;
  }

  captureServerErrors(childProcess) {
    childProcess.on('error', err => this.handleSpawnFailure(err));
    childProcess.on('exit', (code, signal) => this.logger.debug(`exited code ${code}`));
    childProcess.stderr.setEncoding('utf8');
    childProcess.stderr.on('data', chunk => {
      const errorString = chunk.toString();
      this.logger.warn('stderr', errorString);
      // Keep the last 5 lines for packages to use in messages
      this.processStdErr = (this.processStdErr + errorString).split('\n').slice(-5).join('\n');
    });
  }

  handleSpawnFailure(err) {
    atom.notifications.addError(`${this.getServerName()} language server for ${this.getLanguageName()} unable to start`, {
      dismissable: true,
      description: err.toString()
    });
  }

  // Creates the RPC connection which can be ipc, socket or stdio
  createRpcConnection(process) {
    let reader, writer;
    const connectionType = this.getConnectionType();
    switch (connectionType) {
      case 'ipc':
        reader = new rpc.IPCMessageReader(process);
        writer = new rpc.IPCMessageWriter(process);
        break;
      case 'socket':
        reader = new rpc.SocketMessageReader(this.socket);
        writer = new rpc.SocketMessageWriter(this.socket);
        break;
      case 'stdio':
        reader = new rpc.StreamMessageReader(process.stdout);
        writer = new rpc.StreamMessageWriter(process.stdin);
        break;
    }

    return rpc.createMessageConnection(reader, writer, {
      error: m => {
        this.logger.error(m);
      }
    });
  }

  // Start adapters that are not shared between servers
  startExclusiveAdapters(server) {
    _applyEditAdapter2.default.attach(server.connection);
    _notificationsAdapter2.default.attach(server.connection, this.name);

    if (_documentSyncAdapter2.default.canAdapt(server.capabilities)) {
      server.docSyncAdapter = new _documentSyncAdapter2.default(server.connection, server.capabilities.textDocumentSync, editor => this.shouldSyncForEditor(editor, server.projectPath));
      server.disposable.add(server.docSyncAdapter);
    }

    server.linterPushV2 = new _linterPushV2Adapter2.default(server.connection);
    if (this._linterDelegate != null) {
      server.linterPushV2.attach(this._linterDelegate);
    }

    if (_signatureHelpAdapter2.default.canAdapt(server.capabilities)) {
      server.signatureHelpAdapter = new _signatureHelpAdapter2.default(server, this.getGrammarScopes());
      if (this._signatureHelpRegistry != null) {
        server.signatureHelpAdapter.attach(this._signatureHelpRegistry);
      }
    }
  }

  shouldSyncForEditor(editor, projectPath) {
    return this.isFileInProject(editor, projectPath) && this.shouldStartForEditor(editor);
  }

  isFileInProject(editor, projectPath) {
    return (editor.getURI() || '').startsWith(projectPath);
  }

  // Autocomplete+ via LS completion---------------------------------------
  provideAutocomplete() {
    return {
      selector: this.getGrammarScopes().map(g => '.' + g).join(', '),
      inclusionPriority: 1,
      suggestionPriority: 2,
      excludeLowerPriority: false,
      getSuggestions: this.getSuggestions.bind(this)
    };
  }

  async getSuggestions(request) {
    const server = await this._serverManager.getServer(request.editor);
    if (server == null || !_autocompleteAdapter2.default.canAdapt(server.capabilities)) {
      return [];
    }

    this.autoComplete = this.autoComplete || new _autocompleteAdapter2.default();
    return this.autoComplete.getSuggestions(server.connection, request);
  }

  // Definitions via LS documentHighlight and gotoDefinition------------
  provideDefinitions() {
    return {
      name: this.name,
      priority: 20,
      grammarScopes: this.getGrammarScopes(),
      getDefinition: this.getDefinition.bind(this)
    };
  }

  async getDefinition(editor, point) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_definitionAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.definitions = this.definitions || new _definitionAdapter2.default();
    return this.definitions.getDefinition(server.connection, server.capabilities, this.getLanguageName(), editor, point);
  }

  // Outline View via LS documentSymbol---------------------------------
  provideOutlines() {
    return {
      name: this.name,
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getOutline: this.getOutline.bind(this)
    };
  }

  async getOutline(editor) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_outlineViewAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.outlineView = this.outlineView || new _outlineViewAdapter2.default();
    return this.outlineView.getOutline(server.connection, editor);
  }

  // Linter push v2 API via LS publishDiagnostics
  consumeLinterV2(registerIndie) {
    this._linterDelegate = registerIndie({ name: this.name });
    if (this._linterDelegate == null) {
      return;
    }

    for (const server of this._serverManager.getActiveServers()) {
      if (server.linterPushV2 != null) {
        server.linterPushV2.attach(this._linterDelegate);
      }
    }
  }

  // Find References via LS findReferences------------------------------
  provideFindReferences() {
    return {
      isEditorSupported: editor => this.getGrammarScopes().includes(editor.getGrammar().scopeName),
      findReferences: this.getReferences.bind(this)
    };
  }

  async getReferences(editor, point) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_findReferencesAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.findReferences = this.findReferences || new _findReferencesAdapter2.default();
    return this.findReferences.getReferences(server.connection, editor, point, server.projectPath);
  }

  // Datatip via LS textDocument/hover----------------------------------
  consumeDatatip(service) {
    this._disposable.add(service.addProvider({
      providerName: this.name,
      priority: 1,
      grammarScopes: this.getGrammarScopes(),
      validForScope: scopeName => {
        return this.getGrammarScopes().includes(scopeName);
      },
      datatip: this.getDatatip.bind(this)
    }));
  }

  async getDatatip(editor, point) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_datatipAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    this.datatip = this.datatip || new _datatipAdapter2.default();
    return this.datatip.getDatatip(server.connection, editor, point);
  }

  // Code Format via LS formatDocument & formatDocumentRange------------
  provideCodeFormat() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      formatCode: this.getCodeFormat.bind(this)
    };
  }

  async getCodeFormat(editor, range) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_codeFormatAdapter2.default.canAdapt(server.capabilities)) {
      return [];
    }

    return _codeFormatAdapter2.default.format(server.connection, server.capabilities, editor, range);
  }

  provideCodeHighlight() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      highlight: (editor, position) => {
        return this.getCodeHighlight(editor, position);
      }
    };
  }

  async getCodeHighlight(editor, position) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_codeHighlightAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    return _codeHighlightAdapter2.default.highlight(server.connection, server.capabilities, editor, position);
  }

  provideCodeActions() {
    return {
      grammarScopes: this.getGrammarScopes(),
      priority: 1,
      getCodeActions: (editor, range, diagnostics) => {
        return this.getCodeActions(editor, range, diagnostics);
      }
    };
  }

  async getCodeActions(editor, range, diagnostics) {
    const server = await this._serverManager.getServer(editor);
    if (server == null || !_codeActionAdapter2.default.canAdapt(server.capabilities)) {
      return null;
    }

    return _codeActionAdapter2.default.getCodeActions(server.connection, server.capabilities, server.linterPushV2, editor, range, diagnostics);
  }

  consumeSignatureHelp(registry) {
    this._signatureHelpRegistry = registry;
    for (const server of this._serverManager.getActiveServers()) {
      if (server.signatureHelpAdapter != null) {
        server.signatureHelpAdapter.attach(registry);
      }
    }
    return new _atom.Disposable(() => {
      this._signatureHelpRegistry = null;
    });
  }

  consumeBusySignal(service) {
    this.busySignalService = service;
    return new _atom.Disposable(() => delete this.busySignalService);
  }

  /**
   * `didChangeWatchedFiles` message filtering, override for custom logic.
   * @param filePath path of a file that has changed in the project path
   * @return false => message will not be sent to the language server
   */
  filterChangeWatchedFiles(filePath) {
    return true;
  }
}
exports.default = AutoLanguageClient;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi9hdXRvLWxhbmd1YWdlY2xpZW50LmpzIl0sIm5hbWVzIjpbImNwIiwibHMiLCJycGMiLCJBdXRvTGFuZ3VhZ2VDbGllbnQiLCJfZGlzcG9zYWJsZSIsInByb2Nlc3NTdGRFcnIiLCJnZXRHcmFtbWFyU2NvcGVzIiwiRXJyb3IiLCJnZXRMYW5ndWFnZU5hbWUiLCJnZXRTZXJ2ZXJOYW1lIiwic3RhcnRTZXJ2ZXJQcm9jZXNzIiwicHJvamVjdFBhdGgiLCJzaG91bGRTdGFydEZvckVkaXRvciIsImVkaXRvciIsImluY2x1ZGVzIiwiZ2V0R3JhbW1hciIsInNjb3BlTmFtZSIsImdldEluaXRpYWxpemVQYXJhbXMiLCJwcm9jZXNzIiwicHJvY2Vzc0lkIiwicGlkIiwicm9vdFBhdGgiLCJyb290VXJpIiwicGF0aFRvVXJpIiwiY2FwYWJpbGl0aWVzIiwid29ya3NwYWNlIiwiYXBwbHlFZGl0Iiwid29ya3NwYWNlRWRpdCIsImRvY3VtZW50Q2hhbmdlcyIsImRpZENoYW5nZUNvbmZpZ3VyYXRpb24iLCJkeW5hbWljUmVnaXN0cmF0aW9uIiwiZGlkQ2hhbmdlV2F0Y2hlZEZpbGVzIiwic3ltYm9sIiwiZXhlY3V0ZUNvbW1hbmQiLCJ0ZXh0RG9jdW1lbnQiLCJzeW5jaHJvbml6YXRpb24iLCJ3aWxsU2F2ZSIsIndpbGxTYXZlV2FpdFVudGlsIiwiZGlkU2F2ZSIsImNvbXBsZXRpb24iLCJjb21wbGV0aW9uSXRlbSIsInNuaXBwZXRTdXBwb3J0IiwiY29tbWl0Q2hhcmFjdGVyc1N1cHBvcnQiLCJjb250ZXh0U3VwcG9ydCIsImhvdmVyIiwic2lnbmF0dXJlSGVscCIsInJlZmVyZW5jZXMiLCJkb2N1bWVudEhpZ2hsaWdodCIsImRvY3VtZW50U3ltYm9sIiwiZm9ybWF0dGluZyIsInJhbmdlRm9ybWF0dGluZyIsIm9uVHlwZUZvcm1hdHRpbmciLCJkZWZpbml0aW9uIiwiY29kZUFjdGlvbiIsImNvZGVMZW5zIiwiZG9jdW1lbnRMaW5rIiwicmVuYW1lIiwiZXhwZXJpbWVudGFsIiwicHJlSW5pdGlhbGl6YXRpb24iLCJjb25uZWN0aW9uIiwicG9zdEluaXRpYWxpemF0aW9uIiwic2VydmVyIiwiZ2V0Q29ubmVjdGlvblR5cGUiLCJzb2NrZXQiLCJhY3RpdmF0ZSIsIm5hbWUiLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJfc2VydmVyTWFuYWdlciIsInAiLCJzdGFydFNlcnZlciIsImUiLCJmaWxlcGF0aCIsImZpbHRlckNoYW5nZVdhdGNoZWRGaWxlcyIsImJ1c3lTaWduYWxTZXJ2aWNlIiwic3RhcnRMaXN0ZW5pbmciLCJvbiIsImV4aXRDbGVhbnVwIiwiYmluZCIsInRlcm1pbmF0ZSIsImRlYWN0aXZhdGUiLCJkaXNwb3NlIiwic3RvcExpc3RlbmluZyIsInN0b3BBbGxTZXJ2ZXJzIiwic3Bhd25DaGlsZE5vZGUiLCJhcmdzIiwib3B0aW9ucyIsImRlYnVnIiwiam9pbiIsImVudiIsIk9iamVjdCIsImNyZWF0ZSIsIkVMRUNUUk9OX1JVTl9BU19OT0RFIiwiRUxFQ1RST05fTk9fQVRUQUNIX0NPTlNPTEUiLCJzcGF3biIsImV4ZWNQYXRoIiwiYXRvbSIsImNvbmZpZyIsImdldCIsInN0YXJ0aW5nU2lnbmFsIiwicmVwb3J0QnVzeSIsImJhc2VuYW1lIiwiTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uIiwiY3JlYXRlUnBjQ29ubmVjdGlvbiIsImluaXRpYWxpemVQYXJhbXMiLCJpbml0aWFsaXphdGlvbiIsImluaXRpYWxpemUiLCJyZXBvcnRCdXN5V2hpbGUiLCJpbml0aWFsaXplUmVzcG9uc2UiLCJuZXdTZXJ2ZXIiLCJkaXNwb3NhYmxlIiwiaW5pdGlhbGl6ZWQiLCJzdGFydEV4Y2x1c2l2ZUFkYXB0ZXJzIiwiY2FwdHVyZVNlcnZlckVycm9ycyIsImNoaWxkUHJvY2VzcyIsImVyciIsImhhbmRsZVNwYXduRmFpbHVyZSIsImNvZGUiLCJzaWduYWwiLCJzdGRlcnIiLCJzZXRFbmNvZGluZyIsImNodW5rIiwiZXJyb3JTdHJpbmciLCJ0b1N0cmluZyIsIndhcm4iLCJzcGxpdCIsInNsaWNlIiwibm90aWZpY2F0aW9ucyIsImFkZEVycm9yIiwiZGlzbWlzc2FibGUiLCJkZXNjcmlwdGlvbiIsInJlYWRlciIsIndyaXRlciIsImNvbm5lY3Rpb25UeXBlIiwiSVBDTWVzc2FnZVJlYWRlciIsIklQQ01lc3NhZ2VXcml0ZXIiLCJTb2NrZXRNZXNzYWdlUmVhZGVyIiwiU29ja2V0TWVzc2FnZVdyaXRlciIsIlN0cmVhbU1lc3NhZ2VSZWFkZXIiLCJzdGRvdXQiLCJTdHJlYW1NZXNzYWdlV3JpdGVyIiwic3RkaW4iLCJjcmVhdGVNZXNzYWdlQ29ubmVjdGlvbiIsImVycm9yIiwibSIsImF0dGFjaCIsImNhbkFkYXB0IiwiZG9jU3luY0FkYXB0ZXIiLCJ0ZXh0RG9jdW1lbnRTeW5jIiwic2hvdWxkU3luY0ZvckVkaXRvciIsImFkZCIsImxpbnRlclB1c2hWMiIsIl9saW50ZXJEZWxlZ2F0ZSIsInNpZ25hdHVyZUhlbHBBZGFwdGVyIiwiX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSIsImlzRmlsZUluUHJvamVjdCIsImdldFVSSSIsInN0YXJ0c1dpdGgiLCJwcm92aWRlQXV0b2NvbXBsZXRlIiwic2VsZWN0b3IiLCJtYXAiLCJnIiwiaW5jbHVzaW9uUHJpb3JpdHkiLCJzdWdnZXN0aW9uUHJpb3JpdHkiLCJleGNsdWRlTG93ZXJQcmlvcml0eSIsImdldFN1Z2dlc3Rpb25zIiwicmVxdWVzdCIsImdldFNlcnZlciIsImF1dG9Db21wbGV0ZSIsInByb3ZpZGVEZWZpbml0aW9ucyIsInByaW9yaXR5IiwiZ3JhbW1hclNjb3BlcyIsImdldERlZmluaXRpb24iLCJwb2ludCIsImRlZmluaXRpb25zIiwicHJvdmlkZU91dGxpbmVzIiwiZ2V0T3V0bGluZSIsIm91dGxpbmVWaWV3IiwiY29uc3VtZUxpbnRlclYyIiwicmVnaXN0ZXJJbmRpZSIsImdldEFjdGl2ZVNlcnZlcnMiLCJwcm92aWRlRmluZFJlZmVyZW5jZXMiLCJpc0VkaXRvclN1cHBvcnRlZCIsImZpbmRSZWZlcmVuY2VzIiwiZ2V0UmVmZXJlbmNlcyIsImNvbnN1bWVEYXRhdGlwIiwic2VydmljZSIsImFkZFByb3ZpZGVyIiwicHJvdmlkZXJOYW1lIiwidmFsaWRGb3JTY29wZSIsImRhdGF0aXAiLCJnZXREYXRhdGlwIiwicHJvdmlkZUNvZGVGb3JtYXQiLCJmb3JtYXRDb2RlIiwiZ2V0Q29kZUZvcm1hdCIsInJhbmdlIiwiZm9ybWF0IiwicHJvdmlkZUNvZGVIaWdobGlnaHQiLCJoaWdobGlnaHQiLCJwb3NpdGlvbiIsImdldENvZGVIaWdobGlnaHQiLCJwcm92aWRlQ29kZUFjdGlvbnMiLCJnZXRDb2RlQWN0aW9ucyIsImRpYWdub3N0aWNzIiwiY29uc3VtZVNpZ25hdHVyZUhlbHAiLCJyZWdpc3RyeSIsImNvbnN1bWVCdXN5U2lnbmFsIiwiZmlsZVBhdGgiXSwibWFwcGluZ3MiOiI7Ozs7QUFFQTs7SUFBWUEsRTs7QUFDWjs7SUFBWUMsRTs7QUFDWjs7SUFBWUMsRzs7QUFDWjs7OztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7Ozs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDZSxNQUFNQyxrQkFBTixDQUF5QjtBQUFBO0FBQUEsU0FDdENDLFdBRHNDLEdBQ3hCLCtCQUR3QjtBQUFBLFNBU3RDQyxhQVRzQyxHQVNkLEVBVGM7QUFBQTs7QUFNdEM7OztBQVFBOzs7QUFPQTtBQUNBOztBQUVBO0FBQ0FDLHFCQUFrQztBQUNoQyxVQUFNQyxNQUFNLG1FQUFOLENBQU47QUFDRDs7QUFFRDtBQUNBQyxvQkFBMEI7QUFDeEIsVUFBTUQsTUFBTSxrRUFBTixDQUFOO0FBQ0Q7O0FBRUQ7QUFDQUUsa0JBQXdCO0FBQ3RCLFVBQU1GLE1BQU0sZ0VBQU4sQ0FBTjtBQUNEOztBQUVEO0FBQ0FHLHFCQUFtQkMsV0FBbkIsRUFBMEc7QUFDeEcs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QUE4Qm1ELFFBQTlCO0FBQ0EsU0FBSyxNQUFNaEosTUFBWCxJQUFxQixLQUFLTyxjQUFMLENBQW9CZ0gsZ0JBQXBCLEVBQXJCLEVBQTZEO0FBQzNELFVBQUl2SCxPQUFPNEYsb0JBQVAsSUFBK0IsSUFBbkMsRUFBeUM7QUFDdkM1RixlQUFPNEYsb0JBQVAsQ0FBNEJSLE1BQTVCLENBQW1DNEQsUUFBbkM7QUFDRDtBQUNGO0FBQ0QsV0FBTyxxQkFBZSxNQUFNO0FBQzFCLFdBQUtuRCxzQkFBTCxHQUE4QixJQUE5QjtBQUNELEtBRk0sQ0FBUDtBQUdEOztBQUVEb0Qsb0JBQWtCcEIsT0FBbEIsRUFBbUU7QUFDakUsU0FBS2hILGlCQUFMLEdBQXlCZ0gsT0FBekI7QUFDQSxXQUFPLHFCQUFlLE1BQU0sT0FBTyxLQUFLaEgsaUJBQWpDLENBQVA7QUFDRDs7QUFFRDs7Ozs7QUFLQUQsMkJBQXlCc0ksUUFBekIsRUFBb0Q7QUFDbEQsV0FBTyxJQUFQO0FBQ0Q7QUExZ0JxQztrQkFBbkI1TSxrQiIsImZpbGUiOiJhdXRvLWxhbmd1YWdlY2xpZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcclxuXHJcbmltcG9ydCAqIGFzIGNwIGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xyXG5pbXBvcnQgKiBhcyBscyBmcm9tICcuL2xhbmd1YWdlY2xpZW50JztcclxuaW1wb3J0ICogYXMgcnBjIGZyb20gJ3ZzY29kZS1qc29ucnBjJztcclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCB7Q29tcG9zaXRlRGlzcG9zYWJsZSwgRGlzcG9zYWJsZX0gZnJvbSAnYXRvbSc7XHJcbmltcG9ydCB7Q29uc29sZUxvZ2dlciwgTnVsbExvZ2dlciwgdHlwZSBMb2dnZXJ9IGZyb20gJy4vbG9nZ2VyJztcclxuaW1wb3J0IHtTZXJ2ZXJNYW5hZ2VyLCB0eXBlIEFjdGl2ZVNlcnZlcn0gZnJvbSAnLi9zZXJ2ZXItbWFuYWdlci5qcyc7XHJcbmltcG9ydCBDb252ZXJ0IGZyb20gJy4vY29udmVydC5qcyc7XHJcblxyXG5pbXBvcnQgQXBwbHlFZGl0QWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2FwcGx5LWVkaXQtYWRhcHRlcic7XHJcbmltcG9ydCBBdXRvY29tcGxldGVBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvYXV0b2NvbXBsZXRlLWFkYXB0ZXInO1xyXG5pbXBvcnQgQ29kZUFjdGlvbkFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9jb2RlLWFjdGlvbi1hZGFwdGVyJztcclxuaW1wb3J0IENvZGVGb3JtYXRBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvY29kZS1mb3JtYXQtYWRhcHRlcic7XHJcbmltcG9ydCBDb2RlSGlnaGxpZ2h0QWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2NvZGUtaGlnaGxpZ2h0LWFkYXB0ZXInO1xyXG5pbXBvcnQgRGF0YXRpcEFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9kYXRhdGlwLWFkYXB0ZXInO1xyXG5pbXBvcnQgRGVmaW5pdGlvbkFkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9kZWZpbml0aW9uLWFkYXB0ZXInO1xyXG5pbXBvcnQgRG9jdW1lbnRTeW5jQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL2RvY3VtZW50LXN5bmMtYWRhcHRlcic7XHJcbmltcG9ydCBGaW5kUmVmZXJlbmNlc0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9maW5kLXJlZmVyZW5jZXMtYWRhcHRlcic7XHJcbmltcG9ydCBMaW50ZXJQdXNoVjJBZGFwdGVyIGZyb20gJy4vYWRhcHRlcnMvbGludGVyLXB1c2gtdjItYWRhcHRlcic7XHJcbmltcG9ydCBOb3RpZmljYXRpb25zQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL25vdGlmaWNhdGlvbnMtYWRhcHRlcic7XHJcbmltcG9ydCBPdXRsaW5lVmlld0FkYXB0ZXIgZnJvbSAnLi9hZGFwdGVycy9vdXRsaW5lLXZpZXctYWRhcHRlcic7XHJcbmltcG9ydCBTaWduYXR1cmVIZWxwQWRhcHRlciBmcm9tICcuL2FkYXB0ZXJzL3NpZ25hdHVyZS1oZWxwLWFkYXB0ZXInO1xyXG5cclxudHlwZSBDb25uZWN0aW9uVHlwZSA9ICdzdGRpbycgfCAnc29ja2V0JyB8ICdpcGMnO1xyXG5cclxuLy8gUHVibGljOiBBdXRvTGFuZ3VhZ2VDbGllbnQgcHJvdmlkZXMgYSBzaW1wbGUgd2F5IHRvIGhhdmUgYWxsIHRoZSBzdXBwb3J0ZWRcclxuLy8gQXRvbS1JREUgc2VydmljZXMgd2lyZWQgdXAgZW50aXJlbHkgZm9yIHlvdSBieSBqdXN0IHN1YmNsYXNzaW5nIGl0IGFuZFxyXG4vLyBpbXBsZW1lbnRpbmcgc3RhcnRTZXJ2ZXJQcm9jZXNzL2dldEdyYW1tYXJTY29wZXMvZ2V0TGFuZ3VhZ2VOYW1lIGFuZFxyXG4vLyBnZXRTZXJ2ZXJOYW1lLlxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRvTGFuZ3VhZ2VDbGllbnQge1xyXG4gIF9kaXNwb3NhYmxlID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKTtcclxuICBfc2VydmVyTWFuYWdlcjogU2VydmVyTWFuYWdlcjtcclxuICBfbGludGVyRGVsZWdhdGU6IGxpbnRlciRWMkluZGllRGVsZWdhdGU7XHJcbiAgX3NpZ25hdHVyZUhlbHBSZWdpc3RyeTogP2F0b21JZGUkU2lnbmF0dXJlSGVscFJlZ2lzdHJ5O1xyXG5cclxuICAvLyBBdmFpbGFibGUgaWYgY29uc3VtZUJ1c3lTaWduYWwgaXMgc2V0dXBcclxuICBidXN5U2lnbmFsU2VydmljZTogP2F0b21JZGUkQnVzeVNpZ25hbFNlcnZpY2U7XHJcblxyXG4gIHByb2Nlc3NTdGRFcnI6IHN0cmluZyA9ICcnO1xyXG4gIGxvZ2dlcjogTG9nZ2VyO1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBzb2NrZXQ6IG5ldCRTb2NrZXQ7XHJcblxyXG4gIC8vIFNoYXJlZCBhZGFwdGVycyB0aGF0IGNhbiB0YWtlIHRoZSBSUEMgY29ubmVjdGlvbiBhcyByZXF1aXJlZFxyXG4gIGF1dG9Db21wbGV0ZTogP0F1dG9jb21wbGV0ZUFkYXB0ZXI7XHJcbiAgZGF0YXRpcDogP0RhdGF0aXBBZGFwdGVyO1xyXG4gIGRlZmluaXRpb25zOiA/RGVmaW5pdGlvbkFkYXB0ZXI7XHJcbiAgZmluZFJlZmVyZW5jZXM6ID9GaW5kUmVmZXJlbmNlc0FkYXB0ZXI7XHJcbiAgb3V0bGluZVZpZXc6ID9PdXRsaW5lVmlld0FkYXB0ZXI7XHJcblxyXG4gIC8vIFlvdSBtdXN0IGltcGxlbWVudCB0aGVzZSBzbyB3ZSBrbm93IGhvdyB0byBkZWFsIHdpdGggeW91ciBsYW5ndWFnZSBhbmQgc2VydmVyXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvLyBSZXR1cm4gYW4gYXJyYXkgb2YgdGhlIGdyYW1tYXIgc2NvcGVzIHlvdSBoYW5kbGUsIGUuZy4gWyAnc291cmNlLmpzJyBdXHJcbiAgZ2V0R3JhbW1hclNjb3BlcygpOiBBcnJheTxzdHJpbmc+IHtcclxuICAgIHRocm93IEVycm9yKCdNdXN0IGltcGxlbWVudCBnZXRHcmFtbWFyU2NvcGVzIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gUmV0dXJuIHRoZSBuYW1lIG9mIHRoZSBsYW5ndWFnZSB5b3Ugc3VwcG9ydCwgZS5nLiAnSmF2YVNjcmlwdCdcclxuICBnZXRMYW5ndWFnZU5hbWUoKTogc3RyaW5nIHtcclxuICAgIHRocm93IEVycm9yKCdNdXN0IGltcGxlbWVudCBnZXRMYW5ndWFnZU5hbWUgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50Jyk7XHJcbiAgfVxyXG5cclxuICAvLyBSZXR1cm4gdGhlIG5hbWUgb2YgeW91ciBzZXJ2ZXIsIGUuZy4gJ0VjbGlwc2UgSkRUJ1xyXG4gIGdldFNlcnZlck5hbWUoKTogc3RyaW5nIHtcclxuICAgIHRocm93IEVycm9yKCdNdXN0IGltcGxlbWVudCBnZXRTZXJ2ZXJOYW1lIHdoZW4gZXh0ZW5kaW5nIEF1dG9MYW5ndWFnZUNsaWVudCcpO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RhcnQgeW91ciBzZXJ2ZXIgcHJvY2Vzc1xyXG4gIHN0YXJ0U2VydmVyUHJvY2Vzcyhwcm9qZWN0UGF0aDogc3RyaW5nKTogY2hpbGRfcHJvY2VzcyRDaGlsZFByb2Nlc3MgfCBQcm9taXNlPGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzPiB7XHJcbiAgICB0aHJvdyBFcnJvcignTXVzdCBvdmVycmlkZSBzdGFydFNlcnZlclByb2Nlc3MgdG8gc3RhcnQgbGFuZ3VhZ2Ugc2VydmVyIHByb2Nlc3Mgd2hlbiBleHRlbmRpbmcgQXV0b0xhbmd1YWdlQ2xpZW50Jyk7XHJcbiAgfVxyXG5cclxuICAvLyBZb3UgbWlnaHQgd2FudCB0byBvdmVycmlkZSB0aGVzZSBmb3IgZGlmZmVyZW50IGJlaGF2aW9yXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIC8vIERldGVybWluZSB3aGV0aGVyIHdlIHNob3VsZCBzdGFydCBhIHNlcnZlciBmb3IgYSBnaXZlbiBlZGl0b3IgaWYgd2UgZG9uJ3QgaGF2ZSBvbmUgeWV0XHJcbiAgc2hvdWxkU3RhcnRGb3JFZGl0b3IoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKS5pbmNsdWRlcyhlZGl0b3IuZ2V0R3JhbW1hcigpLnNjb3BlTmFtZSk7XHJcbiAgfVxyXG5cclxuICAvLyBSZXR1cm4gdGhlIHBhcmFtZXRlcnMgdXNlZCB0byBpbml0aWFsaXplIGEgY2xpZW50IC0geW91IG1heSB3YW50IHRvIGV4dGVuZCBjYXBhYmlsaXRpZXNcclxuICBnZXRJbml0aWFsaXplUGFyYW1zKHByb2plY3RQYXRoOiBzdHJpbmcsIHByb2Nlc3M6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzKTogbHMuSW5pdGlhbGl6ZVBhcmFtcyB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBwcm9jZXNzSWQ6IHByb2Nlc3MucGlkLFxyXG4gICAgICByb290UGF0aDogcHJvamVjdFBhdGgsXHJcbiAgICAgIHJvb3RVcmk6IENvbnZlcnQucGF0aFRvVXJpKHByb2plY3RQYXRoKSxcclxuICAgICAgY2FwYWJpbGl0aWVzOiB7XHJcbiAgICAgICAgd29ya3NwYWNlOiB7XHJcbiAgICAgICAgICBhcHBseUVkaXQ6IHRydWUsXHJcbiAgICAgICAgICB3b3Jrc3BhY2VFZGl0OiB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50Q2hhbmdlczogdHJ1ZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBkaWRDaGFuZ2VDb25maWd1cmF0aW9uOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGRpZENoYW5nZVdhdGNoZWRGaWxlczoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBzeW1ib2w6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZXhlY3V0ZUNvbW1hbmQ6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdGV4dERvY3VtZW50OiB7XHJcbiAgICAgICAgICBzeW5jaHJvbml6YXRpb246IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICAgIHdpbGxTYXZlOiB0cnVlLFxyXG4gICAgICAgICAgICB3aWxsU2F2ZVdhaXRVbnRpbDogZmFsc2UsXHJcbiAgICAgICAgICAgIGRpZFNhdmU6IHRydWUsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgY29tcGxldGlvbjoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgICAgY29tcGxldGlvbkl0ZW06IHtcclxuICAgICAgICAgICAgICBzbmlwcGV0U3VwcG9ydDogdHJ1ZSxcclxuICAgICAgICAgICAgICBjb21taXRDaGFyYWN0ZXJzU3VwcG9ydDogZmFsc2UsXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbnRleHRTdXBwb3J0OiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBob3Zlcjoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBzaWduYXR1cmVIZWxwOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHJlZmVyZW5jZXM6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZG9jdW1lbnRIaWdobGlnaHQ6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZG9jdW1lbnRTeW1ib2w6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZm9ybWF0dGluZzoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICByYW5nZUZvcm1hdHRpbmc6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgb25UeXBlRm9ybWF0dGluZzoge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICBkZWZpbml0aW9uOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIGNvZGVBY3Rpb246IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgY29kZUxlbnM6IHtcclxuICAgICAgICAgICAgZHluYW1pY1JlZ2lzdHJhdGlvbjogZmFsc2UsXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgZG9jdW1lbnRMaW5rOiB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNSZWdpc3RyYXRpb246IGZhbHNlLFxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgIHJlbmFtZToge1xyXG4gICAgICAgICAgICBkeW5hbWljUmVnaXN0cmF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICBleHBlcmltZW50YWw6IHt9LFxyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8vIEVhcmx5IHdpcmUtdXAgb2YgbGlzdGVuZXJzIGJlZm9yZSBpbml0aWFsaXplIG1ldGhvZCBpcyBzZW50XHJcbiAgcHJlSW5pdGlhbGl6YXRpb24oY29ubmVjdGlvbjogbHMuTGFuZ3VhZ2VDbGllbnRDb25uZWN0aW9uKTogdm9pZCB7fVxyXG5cclxuICAvLyBMYXRlIHdpcmUtdXAgb2YgbGlzdGVuZXJzIGFmdGVyIGluaXRpYWxpemUgbWV0aG9kIGhhcyBiZWVuIHNlbnRcclxuICBwb3N0SW5pdGlhbGl6YXRpb24oc2VydmVyOiBBY3RpdmVTZXJ2ZXIpOiB2b2lkIHt9XHJcblxyXG4gIC8vIERldGVybWluZSB3aGV0aGVyIHRvIHVzZSBpcGMsIHN0ZGlvIG9yIHNvY2tldCB0byBjb25uZWN0IHRvIHRoZSBzZXJ2ZXJcclxuICBnZXRDb25uZWN0aW9uVHlwZSgpOiBDb25uZWN0aW9uVHlwZSB7XHJcbiAgICByZXR1cm4gdGhpcy5zb2NrZXQgIT0gbnVsbCA/ICdzb2NrZXQnIDogJ3N0ZGlvJztcclxuICB9XHJcblxyXG4gIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb24gb2YgdGhlIHJlc3Qgb2YgdGhlIEF1dG9MYW5ndWFnZUNsaWVudFxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICAvLyBBY3RpdmF0ZSBkb2VzIHZlcnkgbGl0dGxlIGZvciBwZXJmIHJlYXNvbnMgLSBob29rcyBpbiB2aWEgU2VydmVyTWFuYWdlciBmb3IgbGF0ZXIgJ2FjdGl2YXRpb24nXHJcbiAgYWN0aXZhdGUoKTogdm9pZCB7XHJcbiAgICB0aGlzLm5hbWUgPSBgJHt0aGlzLmdldExhbmd1YWdlTmFtZSgpfSAoJHt0aGlzLmdldFNlcnZlck5hbWUoKX0pYDtcclxuICAgIHRoaXMubG9nZ2VyID0gdGhpcy5nZXRMb2dnZXIoKTtcclxuICAgIHRoaXMuX3NlcnZlck1hbmFnZXIgPSBuZXcgU2VydmVyTWFuYWdlcihcclxuICAgICAgcCA9PiB0aGlzLnN0YXJ0U2VydmVyKHApLFxyXG4gICAgICB0aGlzLmxvZ2dlcixcclxuICAgICAgZSA9PiB0aGlzLnNob3VsZFN0YXJ0Rm9yRWRpdG9yKGUpLFxyXG4gICAgICBmaWxlcGF0aCA9PiB0aGlzLmZpbHRlckNoYW5nZVdhdGNoZWRGaWxlcyhmaWxlcGF0aCksXHJcbiAgICAgICgpID0+IHRoaXMuYnVzeVNpZ25hbFNlcnZpY2UsXHJcbiAgICAgIHRoaXMuZ2V0U2VydmVyTmFtZSgpLFxyXG4gICAgKTtcclxuICAgIHRoaXMuX3NlcnZlck1hbmFnZXIuc3RhcnRMaXN0ZW5pbmcoKTtcclxuICAgIHByb2Nlc3Mub24oJ2V4aXQnLCAoKSA9PiB0aGlzLmV4aXRDbGVhbnVwLmJpbmQodGhpcykpO1xyXG4gIH1cclxuXHJcbiAgZXhpdENsZWFudXAoKTogdm9pZCB7XHJcbiAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnRlcm1pbmF0ZSgpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGVhY3RpdmF0ZSBkaXNwb3NlcyB0aGUgcmVzb3VyY2VzIHdlJ3JlIHVzaW5nXHJcbiAgYXN5bmMgZGVhY3RpdmF0ZSgpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgdGhpcy5fZGlzcG9zYWJsZS5kaXNwb3NlKCk7XHJcbiAgICB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLnN0b3BMaXN0ZW5pbmcoKTtcclxuICAgIGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuc3RvcEFsbFNlcnZlcnMoKTtcclxuICB9XHJcblxyXG4gIHNwYXduQ2hpbGROb2RlKGFyZ3M6IEFycmF5PHN0cmluZz4sIG9wdGlvbnM/OiBjaGlsZF9wcm9jZXNzJHNwYXduT3B0cyA9IHt9KTogY2hpbGRfcHJvY2VzcyRDaGlsZFByb2Nlc3Mge1xyXG4gICAgdGhpcy5sb2dnZXIuZGVidWcoYHN0YXJ0aW5nIGNoaWxkIE5vZGUgXCIke2FyZ3Muam9pbignICcpfVwiYCk7XHJcbiAgICBvcHRpb25zLmVudiA9IG9wdGlvbnMuZW52IHx8IE9iamVjdC5jcmVhdGUocHJvY2Vzcy5lbnYpO1xyXG4gICAgb3B0aW9ucy5lbnYuRUxFQ1RST05fUlVOX0FTX05PREUgPSAnMSc7XHJcbiAgICBvcHRpb25zLmVudi5FTEVDVFJPTl9OT19BVFRBQ0hfQ09OU09MRSA9ICcxJztcclxuICAgIHJldHVybiBjcC5zcGF3bihwcm9jZXNzLmV4ZWNQYXRoLCBhcmdzLCBvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIC8vIEJ5IGRlZmF1bHQgTFNQIGxvZ2dpbmcgaXMgc3dpdGNoZWQgb2ZmIGJ1dCB5b3UgY2FuIHN3aXRjaCBpdCBvbiB2aWEgdGhlIGNvcmUuZGVidWdMU1Agc2V0dGluZ1xyXG4gIGdldExvZ2dlcigpOiBMb2dnZXIge1xyXG4gICAgcmV0dXJuIGF0b20uY29uZmlnLmdldCgnY29yZS5kZWJ1Z0xTUCcpID8gbmV3IENvbnNvbGVMb2dnZXIodGhpcy5uYW1lKSA6IG5ldyBOdWxsTG9nZ2VyKCk7XHJcbiAgfVxyXG5cclxuICAvLyBTdGFydHMgdGhlIHNlcnZlciBieSBzdGFydGluZyB0aGUgcHJvY2VzcywgdGhlbiBpbml0aWFsaXppbmcgdGhlIGxhbmd1YWdlIHNlcnZlciBhbmQgc3RhcnRpbmcgYWRhcHRlcnNcclxuICBhc3luYyBzdGFydFNlcnZlcihwcm9qZWN0UGF0aDogc3RyaW5nKTogUHJvbWlzZTxBY3RpdmVTZXJ2ZXI+IHtcclxuICAgIGNvbnN0IHN0YXJ0aW5nU2lnbmFsID0gdGhpcy5idXN5U2lnbmFsU2VydmljZSAmJiB0aGlzLmJ1c3lTaWduYWxTZXJ2aWNlLnJlcG9ydEJ1c3koXHJcbiAgICAgIGBTdGFydGluZyAke3RoaXMuZ2V0U2VydmVyTmFtZSgpfSBmb3IgJHtwYXRoLmJhc2VuYW1lKHByb2plY3RQYXRoKX1gLFxyXG4gICAgKTtcclxuICAgIGxldCBwcm9jZXNzO1xyXG4gICAgdHJ5IHtcclxuICAgICAgcHJvY2VzcyA9IGF3YWl0IHRoaXMuc3RhcnRTZXJ2ZXJQcm9jZXNzKHByb2plY3RQYXRoKTtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHN0YXJ0aW5nU2lnbmFsICYmIHN0YXJ0aW5nU2lnbmFsLmRpc3Bvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb25uZWN0aW9uID0gbmV3IGxzLkxhbmd1YWdlQ2xpZW50Q29ubmVjdGlvbih0aGlzLmNyZWF0ZVJwY0Nvbm5lY3Rpb24ocHJvY2VzcyksIHRoaXMubG9nZ2VyKTtcclxuICAgIHRoaXMucHJlSW5pdGlhbGl6YXRpb24oY29ubmVjdGlvbik7XHJcbiAgICBjb25zdCBpbml0aWFsaXplUGFyYW1zID0gdGhpcy5nZXRJbml0aWFsaXplUGFyYW1zKHByb2plY3RQYXRoLCBwcm9jZXNzKTtcclxuICAgIGNvbnN0IGluaXRpYWxpemF0aW9uID0gY29ubmVjdGlvbi5pbml0aWFsaXplKGluaXRpYWxpemVQYXJhbXMpO1xyXG4gICAgdGhpcy5idXN5U2lnbmFsU2VydmljZSAmJiB0aGlzLmJ1c3lTaWduYWxTZXJ2aWNlLnJlcG9ydEJ1c3lXaGlsZShcclxuICAgICAgYCR7dGhpcy5nZXRTZXJ2ZXJOYW1lKCl9IGluaXRpYWxpemluZyBmb3IgJHtwYXRoLmJhc2VuYW1lKHByb2plY3RQYXRoKX1gLFxyXG4gICAgICAoKSA9PiBpbml0aWFsaXphdGlvbixcclxuICAgICk7XHJcbiAgICBjb25zdCBpbml0aWFsaXplUmVzcG9uc2UgPSBhd2FpdCBpbml0aWFsaXphdGlvbjtcclxuICAgIGNvbnN0IG5ld1NlcnZlciA9IHtcclxuICAgICAgcHJvamVjdFBhdGgsXHJcbiAgICAgIHByb2Nlc3MsXHJcbiAgICAgIGNvbm5lY3Rpb24sXHJcbiAgICAgIGNhcGFiaWxpdGllczogaW5pdGlhbGl6ZVJlc3BvbnNlLmNhcGFiaWxpdGllcyxcclxuICAgICAgZGlzcG9zYWJsZTogbmV3IENvbXBvc2l0ZURpc3Bvc2FibGUoKSxcclxuICAgIH07XHJcbiAgICB0aGlzLnBvc3RJbml0aWFsaXphdGlvbihuZXdTZXJ2ZXIpO1xyXG4gICAgY29ubmVjdGlvbi5pbml0aWFsaXplZCgpO1xyXG4gICAgdGhpcy5zdGFydEV4Y2x1c2l2ZUFkYXB0ZXJzKG5ld1NlcnZlcik7XHJcbiAgICByZXR1cm4gbmV3U2VydmVyO1xyXG4gIH1cclxuXHJcbiAgY2FwdHVyZVNlcnZlckVycm9ycyhjaGlsZFByb2Nlc3M6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzKTogdm9pZCB7XHJcbiAgICBjaGlsZFByb2Nlc3Mub24oJ2Vycm9yJywgZXJyID0+IHRoaXMuaGFuZGxlU3Bhd25GYWlsdXJlKGVycikpO1xyXG4gICAgY2hpbGRQcm9jZXNzLm9uKCdleGl0JywgKGNvZGUsIHNpZ25hbCkgPT4gdGhpcy5sb2dnZXIuZGVidWcoYGV4aXRlZCBjb2RlICR7Y29kZX1gKSk7XHJcbiAgICBjaGlsZFByb2Nlc3Muc3RkZXJyLnNldEVuY29kaW5nKCd1dGY4Jyk7XHJcbiAgICBjaGlsZFByb2Nlc3Muc3RkZXJyLm9uKCdkYXRhJywgKGNodW5rOiBCdWZmZXIpID0+IHtcclxuICAgICAgY29uc3QgZXJyb3JTdHJpbmcgPSBjaHVuay50b1N0cmluZygpO1xyXG4gICAgICB0aGlzLmxvZ2dlci53YXJuKCdzdGRlcnInLCBlcnJvclN0cmluZyk7XHJcbiAgICAgIC8vIEtlZXAgdGhlIGxhc3QgNSBsaW5lcyBmb3IgcGFja2FnZXMgdG8gdXNlIGluIG1lc3NhZ2VzXHJcbiAgICAgIHRoaXMucHJvY2Vzc1N0ZEVyciA9ICh0aGlzLnByb2Nlc3NTdGRFcnIgKyBlcnJvclN0cmluZylcclxuICAgICAgICAuc3BsaXQoJ1xcbicpXHJcbiAgICAgICAgLnNsaWNlKC01KVxyXG4gICAgICAgIC5qb2luKCdcXG4nKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaGFuZGxlU3Bhd25GYWlsdXJlKGVycjogYW55KTogdm9pZCB7XHJcbiAgICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkRXJyb3IoXHJcbiAgICAgIGAke3RoaXMuZ2V0U2VydmVyTmFtZSgpfSBsYW5ndWFnZSBzZXJ2ZXIgZm9yICR7dGhpcy5nZXRMYW5ndWFnZU5hbWUoKX0gdW5hYmxlIHRvIHN0YXJ0YCxcclxuICAgICAge1xyXG4gICAgICAgIGRpc21pc3NhYmxlOiB0cnVlLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiBlcnIudG9TdHJpbmcoKSxcclxuICAgICAgfSxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyBDcmVhdGVzIHRoZSBSUEMgY29ubmVjdGlvbiB3aGljaCBjYW4gYmUgaXBjLCBzb2NrZXQgb3Igc3RkaW9cclxuICBjcmVhdGVScGNDb25uZWN0aW9uKHByb2Nlc3M6IGNoaWxkX3Byb2Nlc3MkQ2hpbGRQcm9jZXNzKTogcnBjLkNvbm5lY3Rpb24ge1xyXG4gICAgbGV0IHJlYWRlciwgd3JpdGVyO1xyXG4gICAgY29uc3QgY29ubmVjdGlvblR5cGUgPSB0aGlzLmdldENvbm5lY3Rpb25UeXBlKCk7XHJcbiAgICBzd2l0Y2ggKGNvbm5lY3Rpb25UeXBlKSB7XHJcbiAgICAgIGNhc2UgJ2lwYyc6XHJcbiAgICAgICAgcmVhZGVyID0gbmV3IHJwYy5JUENNZXNzYWdlUmVhZGVyKHByb2Nlc3MpO1xyXG4gICAgICAgIHdyaXRlciA9IG5ldyBycGMuSVBDTWVzc2FnZVdyaXRlcihwcm9jZXNzKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSAnc29ja2V0JzpcclxuICAgICAgICByZWFkZXIgPSBuZXcgcnBjLlNvY2tldE1lc3NhZ2VSZWFkZXIodGhpcy5zb2NrZXQpO1xyXG4gICAgICAgIHdyaXRlciA9IG5ldyBycGMuU29ja2V0TWVzc2FnZVdyaXRlcih0aGlzLnNvY2tldCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ3N0ZGlvJzpcclxuICAgICAgICByZWFkZXIgPSBuZXcgcnBjLlN0cmVhbU1lc3NhZ2VSZWFkZXIocHJvY2Vzcy5zdGRvdXQpO1xyXG4gICAgICAgIHdyaXRlciA9IG5ldyBycGMuU3RyZWFtTWVzc2FnZVdyaXRlcihwcm9jZXNzLnN0ZGluKTtcclxuICAgICAgICBicmVhaztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcnBjLmNyZWF0ZU1lc3NhZ2VDb25uZWN0aW9uKHJlYWRlciwgd3JpdGVyLCB7XHJcbiAgICAgIGVycm9yOiBtID0+IHtcclxuICAgICAgICB0aGlzLmxvZ2dlci5lcnJvcihtKTtcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gU3RhcnQgYWRhcHRlcnMgdGhhdCBhcmUgbm90IHNoYXJlZCBiZXR3ZWVuIHNlcnZlcnNcclxuICBzdGFydEV4Y2x1c2l2ZUFkYXB0ZXJzKHNlcnZlcjogQWN0aXZlU2VydmVyKTogdm9pZCB7XHJcbiAgICBBcHBseUVkaXRBZGFwdGVyLmF0dGFjaChzZXJ2ZXIuY29ubmVjdGlvbik7XHJcbiAgICBOb3RpZmljYXRpb25zQWRhcHRlci5hdHRhY2goc2VydmVyLmNvbm5lY3Rpb24sIHRoaXMubmFtZSk7XHJcblxyXG4gICAgaWYgKERvY3VtZW50U3luY0FkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgc2VydmVyLmRvY1N5bmNBZGFwdGVyID0gbmV3IERvY3VtZW50U3luY0FkYXB0ZXIoc2VydmVyLmNvbm5lY3Rpb24sIHNlcnZlci5jYXBhYmlsaXRpZXMudGV4dERvY3VtZW50U3luYywgZWRpdG9yID0+XHJcbiAgICAgICAgdGhpcy5zaG91bGRTeW5jRm9yRWRpdG9yKGVkaXRvciwgc2VydmVyLnByb2plY3RQYXRoKSxcclxuICAgICAgKTtcclxuICAgICAgc2VydmVyLmRpc3Bvc2FibGUuYWRkKHNlcnZlci5kb2NTeW5jQWRhcHRlcik7XHJcbiAgICB9XHJcblxyXG4gICAgc2VydmVyLmxpbnRlclB1c2hWMiA9IG5ldyBMaW50ZXJQdXNoVjJBZGFwdGVyKHNlcnZlci5jb25uZWN0aW9uKTtcclxuICAgIGlmICh0aGlzLl9saW50ZXJEZWxlZ2F0ZSAhPSBudWxsKSB7XHJcbiAgICAgIHNlcnZlci5saW50ZXJQdXNoVjIuYXR0YWNoKHRoaXMuX2xpbnRlckRlbGVnYXRlKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoU2lnbmF0dXJlSGVscEFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgc2VydmVyLnNpZ25hdHVyZUhlbHBBZGFwdGVyID0gbmV3IFNpZ25hdHVyZUhlbHBBZGFwdGVyKHNlcnZlciwgdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCkpO1xyXG4gICAgICBpZiAodGhpcy5fc2lnbmF0dXJlSGVscFJlZ2lzdHJ5ICE9IG51bGwpIHtcclxuICAgICAgICBzZXJ2ZXIuc2lnbmF0dXJlSGVscEFkYXB0ZXIuYXR0YWNoKHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNob3VsZFN5bmNGb3JFZGl0b3IoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsIHByb2plY3RQYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLmlzRmlsZUluUHJvamVjdChlZGl0b3IsIHByb2plY3RQYXRoKSAmJiB0aGlzLnNob3VsZFN0YXJ0Rm9yRWRpdG9yKGVkaXRvcik7XHJcbiAgfVxyXG5cclxuICBpc0ZpbGVJblByb2plY3QoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsIHByb2plY3RQYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgIHJldHVybiAoZWRpdG9yLmdldFVSSSgpIHx8ICcnKS5zdGFydHNXaXRoKHByb2plY3RQYXRoKTtcclxuICB9XHJcblxyXG4gIC8vIEF1dG9jb21wbGV0ZSsgdmlhIExTIGNvbXBsZXRpb24tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICBwcm92aWRlQXV0b2NvbXBsZXRlKCk6IGF0b20kQXV0b2NvbXBsZXRlUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc2VsZWN0b3I6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpXHJcbiAgICAgICAgLm1hcChnID0+ICcuJyArIGcpXHJcbiAgICAgICAgLmpvaW4oJywgJyksXHJcbiAgICAgIGluY2x1c2lvblByaW9yaXR5OiAxLFxyXG4gICAgICBzdWdnZXN0aW9uUHJpb3JpdHk6IDIsXHJcbiAgICAgIGV4Y2x1ZGVMb3dlclByaW9yaXR5OiBmYWxzZSxcclxuICAgICAgZ2V0U3VnZ2VzdGlvbnM6IHRoaXMuZ2V0U3VnZ2VzdGlvbnMuYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRTdWdnZXN0aW9ucyhyZXF1ZXN0OiBhdG9tJEF1dG9jb21wbGV0ZVJlcXVlc3QpOiBQcm9taXNlPEFycmF5PGF0b20kQXV0b2NvbXBsZXRlU3VnZ2VzdGlvbj4+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKHJlcXVlc3QuZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhQXV0b2NvbXBsZXRlQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5hdXRvQ29tcGxldGUgPSB0aGlzLmF1dG9Db21wbGV0ZSB8fCBuZXcgQXV0b2NvbXBsZXRlQWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMuYXV0b0NvbXBsZXRlLmdldFN1Z2dlc3Rpb25zKHNlcnZlci5jb25uZWN0aW9uLCByZXF1ZXN0KTtcclxuICB9XHJcblxyXG4gIC8vIERlZmluaXRpb25zIHZpYSBMUyBkb2N1bWVudEhpZ2hsaWdodCBhbmQgZ290b0RlZmluaXRpb24tLS0tLS0tLS0tLS1cclxuICBwcm92aWRlRGVmaW5pdGlvbnMoKTogYXRvbUlkZSREZWZpbml0aW9uUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgbmFtZTogdGhpcy5uYW1lLFxyXG4gICAgICBwcmlvcml0eTogMjAsXHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBnZXREZWZpbml0aW9uOiB0aGlzLmdldERlZmluaXRpb24uYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXREZWZpbml0aW9uKGVkaXRvcjogVGV4dEVkaXRvciwgcG9pbnQ6IGF0b20kUG9pbnQpOiBQcm9taXNlPD9hdG9tSWRlJERlZmluaXRpb25RdWVyeVJlc3VsdD4ge1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhRGVmaW5pdGlvbkFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5kZWZpbml0aW9ucyA9IHRoaXMuZGVmaW5pdGlvbnMgfHwgbmV3IERlZmluaXRpb25BZGFwdGVyKCk7XHJcbiAgICByZXR1cm4gdGhpcy5kZWZpbml0aW9ucy5nZXREZWZpbml0aW9uKFxyXG4gICAgICBzZXJ2ZXIuY29ubmVjdGlvbixcclxuICAgICAgc2VydmVyLmNhcGFiaWxpdGllcyxcclxuICAgICAgdGhpcy5nZXRMYW5ndWFnZU5hbWUoKSxcclxuICAgICAgZWRpdG9yLFxyXG4gICAgICBwb2ludCxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvLyBPdXRsaW5lIFZpZXcgdmlhIExTIGRvY3VtZW50U3ltYm9sLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgcHJvdmlkZU91dGxpbmVzKCk6IGF0b21JZGUkT3V0bGluZVByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICBnZXRPdXRsaW5lOiB0aGlzLmdldE91dGxpbmUuYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRPdXRsaW5lKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogUHJvbWlzZTw/YXRvbUlkZSRPdXRsaW5lPiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFPdXRsaW5lVmlld0FkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5vdXRsaW5lVmlldyA9IHRoaXMub3V0bGluZVZpZXcgfHwgbmV3IE91dGxpbmVWaWV3QWRhcHRlcigpO1xyXG4gICAgcmV0dXJuIHRoaXMub3V0bGluZVZpZXcuZ2V0T3V0bGluZShzZXJ2ZXIuY29ubmVjdGlvbiwgZWRpdG9yKTtcclxuICB9XHJcblxyXG4gIC8vIExpbnRlciBwdXNoIHYyIEFQSSB2aWEgTFMgcHVibGlzaERpYWdub3N0aWNzXHJcbiAgY29uc3VtZUxpbnRlclYyKHJlZ2lzdGVySW5kaWU6ICh7bmFtZTogc3RyaW5nfSkgPT4gbGludGVyJFYySW5kaWVEZWxlZ2F0ZSk6IHZvaWQge1xyXG4gICAgdGhpcy5fbGludGVyRGVsZWdhdGUgPSByZWdpc3RlckluZGllKHtuYW1lOiB0aGlzLm5hbWV9KTtcclxuICAgIGlmICh0aGlzLl9saW50ZXJEZWxlZ2F0ZSA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGNvbnN0IHNlcnZlciBvZiB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldEFjdGl2ZVNlcnZlcnMoKSkge1xyXG4gICAgICBpZiAoc2VydmVyLmxpbnRlclB1c2hWMiAhPSBudWxsKSB7XHJcbiAgICAgICAgc2VydmVyLmxpbnRlclB1c2hWMi5hdHRhY2godGhpcy5fbGludGVyRGVsZWdhdGUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBGaW5kIFJlZmVyZW5jZXMgdmlhIExTIGZpbmRSZWZlcmVuY2VzLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgcHJvdmlkZUZpbmRSZWZlcmVuY2VzKCk6IGF0b21JZGUkRmluZFJlZmVyZW5jZXNQcm92aWRlciB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpc0VkaXRvclN1cHBvcnRlZDogKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKSA9PiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKS5pbmNsdWRlcyhlZGl0b3IuZ2V0R3JhbW1hcigpLnNjb3BlTmFtZSksXHJcbiAgICAgIGZpbmRSZWZlcmVuY2VzOiB0aGlzLmdldFJlZmVyZW5jZXMuYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRSZWZlcmVuY2VzKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBwb2ludDogYXRvbSRQb2ludCk6IFByb21pc2U8P2F0b21JZGUkRmluZFJlZmVyZW5jZXNSZXR1cm4+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUZpbmRSZWZlcmVuY2VzQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmZpbmRSZWZlcmVuY2VzID0gdGhpcy5maW5kUmVmZXJlbmNlcyB8fCBuZXcgRmluZFJlZmVyZW5jZXNBZGFwdGVyKCk7XHJcbiAgICByZXR1cm4gdGhpcy5maW5kUmVmZXJlbmNlcy5nZXRSZWZlcmVuY2VzKHNlcnZlci5jb25uZWN0aW9uLCBlZGl0b3IsIHBvaW50LCBzZXJ2ZXIucHJvamVjdFBhdGgpO1xyXG4gIH1cclxuXHJcbiAgLy8gRGF0YXRpcCB2aWEgTFMgdGV4dERvY3VtZW50L2hvdmVyLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIGNvbnN1bWVEYXRhdGlwKHNlcnZpY2U6IGF0b21JZGUkRGF0YXRpcFNlcnZpY2UpOiB2b2lkIHtcclxuICAgIHRoaXMuX2Rpc3Bvc2FibGUuYWRkKFxyXG4gICAgICBzZXJ2aWNlLmFkZFByb3ZpZGVyKHtcclxuICAgICAgICBwcm92aWRlck5hbWU6IHRoaXMubmFtZSxcclxuICAgICAgICBwcmlvcml0eTogMSxcclxuICAgICAgICBncmFtbWFyU2NvcGVzOiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKSxcclxuICAgICAgICB2YWxpZEZvclNjb3BlOiAoc2NvcGVOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgIHJldHVybiB0aGlzLmdldEdyYW1tYXJTY29wZXMoKS5pbmNsdWRlcyhzY29wZU5hbWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZGF0YXRpcDogdGhpcy5nZXREYXRhdGlwLmJpbmQodGhpcyksXHJcbiAgICAgIH0pLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldERhdGF0aXAoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsIHBvaW50OiBhdG9tJFBvaW50KTogUHJvbWlzZTw/YXRvbUlkZSREYXRhdGlwPiB7XHJcbiAgICBjb25zdCBzZXJ2ZXIgPSBhd2FpdCB0aGlzLl9zZXJ2ZXJNYW5hZ2VyLmdldFNlcnZlcihlZGl0b3IpO1xyXG4gICAgaWYgKHNlcnZlciA9PSBudWxsIHx8ICFEYXRhdGlwQWRhcHRlci5jYW5BZGFwdChzZXJ2ZXIuY2FwYWJpbGl0aWVzKSkge1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmRhdGF0aXAgPSB0aGlzLmRhdGF0aXAgfHwgbmV3IERhdGF0aXBBZGFwdGVyKCk7XHJcbiAgICByZXR1cm4gdGhpcy5kYXRhdGlwLmdldERhdGF0aXAoc2VydmVyLmNvbm5lY3Rpb24sIGVkaXRvciwgcG9pbnQpO1xyXG4gIH1cclxuXHJcbiAgLy8gQ29kZSBGb3JtYXQgdmlhIExTIGZvcm1hdERvY3VtZW50ICYgZm9ybWF0RG9jdW1lbnRSYW5nZS0tLS0tLS0tLS0tLVxyXG4gIHByb3ZpZGVDb2RlRm9ybWF0KCk6IGF0b21JZGUkUmFuZ2VDb2RlRm9ybWF0UHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICBmb3JtYXRDb2RlOiB0aGlzLmdldENvZGVGb3JtYXQuYmluZCh0aGlzKSxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRDb2RlRm9ybWF0KGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCByYW5nZTogYXRvbSRSYW5nZSk6IFByb21pc2U8QXJyYXk8YXRvbUlkZSRUZXh0RWRpdD4+IHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVGb3JtYXRBZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gQ29kZUZvcm1hdEFkYXB0ZXIuZm9ybWF0KHNlcnZlci5jb25uZWN0aW9uLCBzZXJ2ZXIuY2FwYWJpbGl0aWVzLCBlZGl0b3IsIHJhbmdlKTtcclxuICB9XHJcblxyXG4gIHByb3ZpZGVDb2RlSGlnaGxpZ2h0KCk6IGF0b21JZGUkQ29kZUhpZ2hsaWdodFByb3ZpZGVyIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgIGdyYW1tYXJTY29wZXM6IHRoaXMuZ2V0R3JhbW1hclNjb3BlcygpLFxyXG4gICAgICBwcmlvcml0eTogMSxcclxuICAgICAgaGlnaGxpZ2h0OiAoZWRpdG9yLCBwb3NpdGlvbikgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldENvZGVIaWdobGlnaHQoZWRpdG9yLCBwb3NpdGlvbik7XHJcbiAgICAgIH0sXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0Q29kZUhpZ2hsaWdodChlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcG9zaXRpb246IGF0b20kUG9pbnQpOiBQcm9taXNlPD9BcnJheTxhdG9tJFJhbmdlPj4ge1xyXG4gICAgY29uc3Qgc2VydmVyID0gYXdhaXQgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRTZXJ2ZXIoZWRpdG9yKTtcclxuICAgIGlmIChzZXJ2ZXIgPT0gbnVsbCB8fCAhQ29kZUhpZ2hsaWdodEFkYXB0ZXIuY2FuQWRhcHQoc2VydmVyLmNhcGFiaWxpdGllcykpIHtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIENvZGVIaWdobGlnaHRBZGFwdGVyLmhpZ2hsaWdodChzZXJ2ZXIuY29ubmVjdGlvbiwgc2VydmVyLmNhcGFiaWxpdGllcywgZWRpdG9yLCBwb3NpdGlvbik7XHJcbiAgfVxyXG5cclxuICBwcm92aWRlQ29kZUFjdGlvbnMoKTogYXRvbUlkZSRDb2RlQWN0aW9uUHJvdmlkZXIge1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgZ3JhbW1hclNjb3BlczogdGhpcy5nZXRHcmFtbWFyU2NvcGVzKCksXHJcbiAgICAgIHByaW9yaXR5OiAxLFxyXG4gICAgICBnZXRDb2RlQWN0aW9uczogKGVkaXRvciwgcmFuZ2UsIGRpYWdub3N0aWNzKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29kZUFjdGlvbnMoZWRpdG9yLCByYW5nZSwgZGlhZ25vc3RpY3MpO1xyXG4gICAgICB9LFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldENvZGVBY3Rpb25zKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCByYW5nZTogYXRvbSRSYW5nZSwgZGlhZ25vc3RpY3M6IEFycmF5PGF0b21JZGUkRGlhZ25vc3RpYz4pIHtcclxuICAgIGNvbnN0IHNlcnZlciA9IGF3YWl0IHRoaXMuX3NlcnZlck1hbmFnZXIuZ2V0U2VydmVyKGVkaXRvcik7XHJcbiAgICBpZiAoc2VydmVyID09IG51bGwgfHwgIUNvZGVBY3Rpb25BZGFwdGVyLmNhbkFkYXB0KHNlcnZlci5jYXBhYmlsaXRpZXMpKSB7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBDb2RlQWN0aW9uQWRhcHRlci5nZXRDb2RlQWN0aW9ucyhcclxuICAgICAgc2VydmVyLmNvbm5lY3Rpb24sXHJcbiAgICAgIHNlcnZlci5jYXBhYmlsaXRpZXMsXHJcbiAgICAgIHNlcnZlci5saW50ZXJQdXNoVjIsXHJcbiAgICAgIGVkaXRvcixcclxuICAgICAgcmFuZ2UsXHJcbiAgICAgIGRpYWdub3N0aWNzLFxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbnN1bWVTaWduYXR1cmVIZWxwKHJlZ2lzdHJ5OiBhdG9tSWRlJFNpZ25hdHVyZUhlbHBSZWdpc3RyeSk6IElEaXNwb3NhYmxlIHtcclxuICAgIHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSA9IHJlZ2lzdHJ5O1xyXG4gICAgZm9yIChjb25zdCBzZXJ2ZXIgb2YgdGhpcy5fc2VydmVyTWFuYWdlci5nZXRBY3RpdmVTZXJ2ZXJzKCkpIHtcclxuICAgICAgaWYgKHNlcnZlci5zaWduYXR1cmVIZWxwQWRhcHRlciAhPSBudWxsKSB7XHJcbiAgICAgICAgc2VydmVyLnNpZ25hdHVyZUhlbHBBZGFwdGVyLmF0dGFjaChyZWdpc3RyeSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiB7XHJcbiAgICAgIHRoaXMuX3NpZ25hdHVyZUhlbHBSZWdpc3RyeSA9IG51bGw7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN1bWVCdXN5U2lnbmFsKHNlcnZpY2U6IGF0b21JZGUkQnVzeVNpZ25hbFNlcnZpY2UpOiBJRGlzcG9zYWJsZSB7XHJcbiAgICB0aGlzLmJ1c3lTaWduYWxTZXJ2aWNlID0gc2VydmljZTtcclxuICAgIHJldHVybiBuZXcgRGlzcG9zYWJsZSgoKSA9PiBkZWxldGUgdGhpcy5idXN5U2lnbmFsU2VydmljZSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBgZGlkQ2hhbmdlV2F0Y2hlZEZpbGVzYCBtZXNzYWdlIGZpbHRlcmluZywgb3ZlcnJpZGUgZm9yIGN1c3RvbSBsb2dpYy5cclxuICAgKiBAcGFyYW0gZmlsZVBhdGggcGF0aCBvZiBhIGZpbGUgdGhhdCBoYXMgY2hhbmdlZCBpbiB0aGUgcHJvamVjdCBwYXRoXHJcbiAgICogQHJldHVybiBmYWxzZSA9PiBtZXNzYWdlIHdpbGwgbm90IGJlIHNlbnQgdG8gdGhlIGxhbmd1YWdlIHNlcnZlclxyXG4gICAqL1xyXG4gIGZpbHRlckNoYW5nZVdhdGNoZWRGaWxlcyhmaWxlUGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcbn1cclxuIl19