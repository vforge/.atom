'use strict';

var cov_15kwk4begg = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/nuclide-commons/nice.js',
      hash = '44791a402947481bb0465741b12dfefea8540ce5',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/nuclide-commons/nice.js',
    statementMap: {
      '0': {
        start: {
          line: 22,
          column: 21
        },
        end: {
          line: 22,
          column: 27
        }
      },
      '1': {
        start: {
          line: 23,
          column: 23
        },
        end: {
          line: 23,
          column: 31
        }
      },
      '2': {
        start: {
          line: 30,
          column: 19
        },
        end: {
          line: 30,
          column: 66
        }
      },
      '3': {
        start: {
          line: 31,
          column: 24
        },
        end: {
          line: 31,
          column: 52
        }
      },
      '4': {
        start: {
          line: 32,
          column: 25
        },
        end: {
          line: 32,
          column: 58
        }
      },
      '5': {
        start: {
          line: 33,
          column: 2
        },
        end: {
          line: 33,
          column: 26
        }
      },
      '6': {
        start: {
          line: 34,
          column: 2
        },
        end: {
          line: 34,
          column: 24
        }
      },
      '7': {
        start: {
          line: 54,
          column: 19
        },
        end: {
          line: 54,
          column: 45
        }
      },
      '8': {
        start: {
          line: 55,
          column: 2
        },
        end: {
          line: 57,
          column: 3
        }
      },
      '9': {
        start: {
          line: 56,
          column: 4
        },
        end: {
          line: 56,
          column: 35
        }
      },
      '10': {
        start: {
          line: 58,
          column: 2
        },
        end: {
          line: 70,
          column: 3
        }
      },
      '11': {
        start: {
          line: 69,
          column: 4
        },
        end: {
          line: 69,
          column: 48
        }
      },
      '12': {
        start: {
          line: 71,
          column: 2
        },
        end: {
          line: 71,
          column: 51
        }
      },
      '13': {
        start: {
          line: 74,
          column: 60
        },
        end: {
          line: 80,
          column: 2
        }
      },
      '14': {
        start: {
          line: 83,
          column: 2
        },
        end: {
          line: 83,
          column: 34
        }
      },
      '15': {
        start: {
          line: 87,
          column: 2
        },
        end: {
          line: 87,
          column: 36
        }
      },
      '16': {
        start: {
          line: 91,
          column: 25
        },
        end: {
          line: 91,
          column: 62
        }
      },
      '17': {
        start: {
          line: 92,
          column: 2
        },
        end: {
          line: 95,
          column: 3
        }
      },
      '18': {
        start: {
          line: 93,
          column: 4
        },
        end: {
          line: 93,
          column: 44
        }
      },
      '19': {
        start: {
          line: 94,
          column: 4
        },
        end: {
          line: 94,
          column: 50
        }
      },
      '20': {
        start: {
          line: 96,
          column: 2
        },
        end: {
          line: 96,
          column: 16
        }
      },
      '21': {
        start: {
          line: 104,
          column: 2
        },
        end: {
          line: 106,
          column: 57
        }
      },
      '22': {
        start: {
          line: 105,
          column: 4
        },
        end: {
          line: 105,
          column: 41
        }
      },
      '23': {
        start: {
          line: 106,
          column: 27
        },
        end: {
          line: 106,
          column: 55
        }
      }
    },
    fnMap: {
      '0': {
        name: 'niceSafeSpawn',
        decl: {
          start: {
            line: 25,
            column: 22
          },
          end: {
            line: 25,
            column: 35
          }
        },
        loc: {
          start: {
            line: 29,
            column: 39
          },
          end: {
            line: 35,
            column: 1
          }
        },
        line: 29
      },
      '1': {
        name: 'nicifyCommand',
        decl: {
          start: {
            line: 49,
            column: 15
          },
          end: {
            line: 49,
            column: 28
          }
        },
        loc: {
          start: {
            line: 53,
            column: 39
          },
          end: {
            line: 72,
            column: 1
          }
        },
        line: 53
      },
      '2': {
        name: 'hasNiceCommand',
        decl: {
          start: {
            line: 82,
            column: 9
          },
          end: {
            line: 82,
            column: 23
          }
        },
        loc: {
          start: {
            line: 82,
            column: 44
          },
          end: {
            line: 84,
            column: 1
          }
        },
        line: 82
      },
      '3': {
        name: 'hasIoniceCommand',
        decl: {
          start: {
            line: 86,
            column: 9
          },
          end: {
            line: 86,
            column: 25
          }
        },
        loc: {
          start: {
            line: 86,
            column: 46
          },
          end: {
            line: 88,
            column: 1
          }
        },
        line: 86
      },
      '4': {
        name: 'hasCommand',
        decl: {
          start: {
            line: 90,
            column: 15
          },
          end: {
            line: 90,
            column: 25
          }
        },
        loc: {
          start: {
            line: 90,
            column: 61
          },
          end: {
            line: 97,
            column: 1
          }
        },
        line: 90
      },
      '5': {
        name: 'niceObserveProcess',
        decl: {
          start: {
            line: 99,
            column: 16
          },
          end: {
            line: 99,
            column: 34
          }
        },
        loc: {
          start: {
            line: 103,
            column: 30
          },
          end: {
            line: 107,
            column: 1
          }
        },
        line: 103
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 104,
            column: 26
          },
          end: {
            line: 104,
            column: 27
          }
        },
        loc: {
          start: {
            line: 105,
            column: 4
          },
          end: {
            line: 105,
            column: 41
          }
        },
        line: 105
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 106,
            column: 14
          },
          end: {
            line: 106,
            column: 15
          }
        },
        loc: {
          start: {
            line: 106,
            column: 27
          },
          end: {
            line: 106,
            column: 55
          }
        },
        line: 106
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 54,
            column: 33
          },
          end: {
            line: 54,
            column: 43
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 54,
            column: 33
          },
          end: {
            line: 54,
            column: 37
          }
        }, {
          start: {
            line: 54,
            column: 41
          },
          end: {
            line: 54,
            column: 43
          }
        }],
        line: 54
      },
      '1': {
        loc: {
          start: {
            line: 55,
            column: 2
          },
          end: {
            line: 57,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 55,
            column: 2
          },
          end: {
            line: 57,
            column: 3
          }
        }, {
          start: {
            line: 55,
            column: 2
          },
          end: {
            line: 57,
            column: 3
          }
        }],
        line: 55
      },
      '2': {
        loc: {
          start: {
            line: 58,
            column: 2
          },
          end: {
            line: 70,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 58,
            column: 2
          },
          end: {
            line: 70,
            column: 3
          }
        }, {
          start: {
            line: 58,
            column: 2
          },
          end: {
            line: 70,
            column: 3
          }
        }],
        line: 58
      },
      '3': {
        loc: {
          start: {
            line: 92,
            column: 2
          },
          end: {
            line: 95,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 92,
            column: 2
          },
          end: {
            line: 95,
            column: 3
          }
        }, {
          start: {
            line: 92,
            column: 2
          },
          end: {
            line: 95,
            column: 3
          }
        }],
        line: 92
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.niceSafeSpawn = undefined;

var _asyncToGenerator = _interopRequireDefault(require('async-to-generator'));

let niceSafeSpawn = exports.niceSafeSpawn = (() => {
  var _ref = (0, _asyncToGenerator.default)(function* (command, args, execOptions) {
    cov_15kwk4begg.f[0]++;

    const nicified = (cov_15kwk4begg.s[2]++, yield nicifyCommand(command, args, execOptions));
    const processStream = (cov_15kwk4begg.s[3]++, (0, (_process || _load_process()).spawn)(...nicified).publish());
    const processPromise = (cov_15kwk4begg.s[4]++, processStream.take(1).toPromise());
    cov_15kwk4begg.s[5]++;
    processStream.connect();
    cov_15kwk4begg.s[6]++;
    return processPromise;
  });

  return function niceSafeSpawn(_x, _x2, _x3) {
    return _ref.apply(this, arguments);
  };
})();

/**
* Takes the arguments that you would normally pass to `spawn()` and returns an array of new
* arguments to use to run the command under `nice`.
 *
 * Example:
 *
 * ```js
 * observeProcess(...(await nicifyCommand('hg', ['diff']))).subscribe(...);
 * ```
 *
 * See also `scriptifyCommand()` which does a similar thing but for `script`.
 */


let nicifyCommand = (() => {
  var _ref2 = (0, _asyncToGenerator.default)(function* (command, args, options) {
    cov_15kwk4begg.f[1]++;

    const fullArgs = (cov_15kwk4begg.s[7]++, [command, ...((cov_15kwk4begg.b[0][0]++, args) || (cov_15kwk4begg.b[0][1]++, []))]);
    cov_15kwk4begg.s[8]++;
    if (yield hasNiceCommand()) {
      cov_15kwk4begg.b[1][0]++;
      cov_15kwk4begg.s[9]++;

      fullArgs.unshift(NICE_COMMAND);
    } else {
      cov_15kwk4begg.b[1][1]++;
    }
    cov_15kwk4begg.s[10]++;
    if (yield hasIoniceCommand()) {
      cov_15kwk4begg.b[2][0]++;
      cov_15kwk4begg.s[11]++;

      // Leave the process in the Best Effort class (default), but set it to the lowest priority for
      // that class. Priorities range from 0-7 with 4 as the default and lower numbers representing
      // higher priorities.
      //
      // See `man ionice` or http://linux.die.net/man/1/ionice
      //
      // It's not specified by POSIX like `nice` is but since it is included in util-linux which is
      // relatively core
      // (https://git.kernel.org/cgit/utils/util-linux/util-linux.git/tree/schedutils/ionice.c), I
      // think we can assume that it uses this interface if it exists.
      fullArgs.unshift(IONICE_COMMAND, '-n', '7');
    } else {
      cov_15kwk4begg.b[2][1]++;
    }
    cov_15kwk4begg.s[12]++;
    return [fullArgs[0], fullArgs.slice(1), options];
  });

  return function nicifyCommand(_x4, _x5, _x6) {
    return _ref2.apply(this, arguments);
  };
})();

let hasCommand = (() => {
  var _ref3 = (0, _asyncToGenerator.default)(function* (command) {
    cov_15kwk4begg.f[4]++;

    let result = (cov_15kwk4begg.s[16]++, commandAvailabilityCache.get(command));
    cov_15kwk4begg.s[17]++;
    if (result == null) {
      cov_15kwk4begg.b[3][0]++;
      cov_15kwk4begg.s[18]++;

      result = (yield (0, (_which || _load_which()).default)(command)) != null;
      cov_15kwk4begg.s[19]++;
      commandAvailabilityCache.set(command, result);
    } else {
      cov_15kwk4begg.b[3][1]++;
    }
    cov_15kwk4begg.s[20]++;
    return result;
  });

  return function hasCommand(_x7) {
    return _ref3.apply(this, arguments);
  };
})();

exports.niceObserveProcess = niceObserveProcess;

var _lruCache;

function _load_lruCache() {
  return _lruCache = _interopRequireDefault(require('lru-cache'));
}

var _rxjsBundlesRxMinJs = require('rxjs/bundles/Rx.min.js');

var _which;

function _load_which() {
  return _which = _interopRequireDefault(require('./which'));
}

var _process;

function _load_process() {
  return _process = require('./process');
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

const NICE_COMMAND = (cov_15kwk4begg.s[0]++, 'nice');
const IONICE_COMMAND = (cov_15kwk4begg.s[1]++, 'ionice');

const commandAvailabilityCache = (cov_15kwk4begg.s[13]++, (0, (_lruCache || _load_lruCache()).default)({
  max: 10,
  // Realistically this will not change very often so we can cache for long periods of time. We
  // probably could just check at startup and get away with it, but maybe someone will install
  // `ionice` and it would be nice to pick that up.
  maxAge: 1000 * 60 * 5 // 5 minutes
}));

function hasNiceCommand() {
  cov_15kwk4begg.f[2]++;
  cov_15kwk4begg.s[14]++;

  return hasCommand(NICE_COMMAND);
}

function hasIoniceCommand() {
  cov_15kwk4begg.f[3]++;
  cov_15kwk4begg.s[15]++;

  return hasCommand(IONICE_COMMAND);
}

function niceObserveProcess(command, args, options) {
  cov_15kwk4begg.f[5]++;
  cov_15kwk4begg.s[21]++;

  return _rxjsBundlesRxMinJs.Observable.defer(() => {
    cov_15kwk4begg.f[6]++;
    cov_15kwk4begg.s[22]++;
    return nicifyCommand(command, args, options);
  }).switchMap(spawnArgs => {
    cov_15kwk4begg.f[7]++;
    cov_15kwk4begg.s[23]++;
    return (0, (_process || _load_process()).observeProcess)(...spawnArgs);
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5pY2UuanMiXSwibmFtZXMiOlsiY29tbWFuZCIsImFyZ3MiLCJleGVjT3B0aW9ucyIsIm5pY2lmaWVkIiwibmljaWZ5Q29tbWFuZCIsInByb2Nlc3NTdHJlYW0iLCJwdWJsaXNoIiwicHJvY2Vzc1Byb21pc2UiLCJ0YWtlIiwidG9Qcm9taXNlIiwiY29ubmVjdCIsIm5pY2VTYWZlU3Bhd24iLCJvcHRpb25zIiwiZnVsbEFyZ3MiLCJoYXNOaWNlQ29tbWFuZCIsInVuc2hpZnQiLCJOSUNFX0NPTU1BTkQiLCJoYXNJb25pY2VDb21tYW5kIiwiSU9OSUNFX0NPTU1BTkQiLCJzbGljZSIsInJlc3VsdCIsImNvbW1hbmRBdmFpbGFiaWxpdHlDYWNoZSIsImdldCIsInNldCIsImhhc0NvbW1hbmQiLCJuaWNlT2JzZXJ2ZVByb2Nlc3MiLCJtYXgiLCJtYXhBZ2UiLCJkZWZlciIsInN3aXRjaE1hcCIsInNwYXduQXJncyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QUFBQTtBQUFBOztBQUM1QixTQUFPLCtCQUFXZ0IsS0FBWCxDQUFpQixNQUN0QjtBQUFBO0FBQUE7QUFBQSx5QkFBYzVCLE9BQWQsRUFBdUJDLElBQXZCLEVBQTZCVyxPQUE3QjtBQUFxQyxHQURoQyxFQUVMaUIsU0FGSyxDQUVLQyxhQUFhO0FBQUE7QUFBQTtBQUFBLDZEQUFlLEdBQUdBLFNBQWxCO0FBQTRCLEdBRjlDLENBQVA7QUFHRCIsImZpbGUiOiJuaWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuaW1wb3J0IHR5cGUge0xSVUNhY2hlfSBmcm9tICdscnUtY2FjaGUnO1xuaW1wb3J0IHR5cGUge09ic2VydmVQcm9jZXNzT3B0aW9ucywgUHJvY2Vzc01lc3NhZ2V9IGZyb20gJy4vcHJvY2Vzcyc7XG5cbmltcG9ydCBMUlUgZnJvbSAnbHJ1LWNhY2hlJztcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB3aGljaCBmcm9tICcuL3doaWNoJztcbmltcG9ydCB7c3Bhd24sIG9ic2VydmVQcm9jZXNzfSBmcm9tICcuL3Byb2Nlc3MnO1xuXG5jb25zdCBOSUNFX0NPTU1BTkQgPSAnbmljZSc7XG5jb25zdCBJT05JQ0VfQ09NTUFORCA9ICdpb25pY2UnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbmljZVNhZmVTcGF3bihcbiAgY29tbWFuZDogc3RyaW5nLFxuICBhcmdzOiBBcnJheTxzdHJpbmc+LFxuICBleGVjT3B0aW9ucz86IE9iamVjdCxcbik6IFByb21pc2U8Y2hpbGRfcHJvY2VzcyRDaGlsZFByb2Nlc3M+IHtcbiAgY29uc3QgbmljaWZpZWQgPSBhd2FpdCBuaWNpZnlDb21tYW5kKGNvbW1hbmQsIGFyZ3MsIGV4ZWNPcHRpb25zKTtcbiAgY29uc3QgcHJvY2Vzc1N0cmVhbSA9IHNwYXduKC4uLm5pY2lmaWVkKS5wdWJsaXNoKCk7XG4gIGNvbnN0IHByb2Nlc3NQcm9taXNlID0gcHJvY2Vzc1N0cmVhbS50YWtlKDEpLnRvUHJvbWlzZSgpO1xuICBwcm9jZXNzU3RyZWFtLmNvbm5lY3QoKTtcbiAgcmV0dXJuIHByb2Nlc3NQcm9taXNlO1xufVxuXG4vKipcbiogVGFrZXMgdGhlIGFyZ3VtZW50cyB0aGF0IHlvdSB3b3VsZCBub3JtYWxseSBwYXNzIHRvIGBzcGF3bigpYCBhbmQgcmV0dXJucyBhbiBhcnJheSBvZiBuZXdcbiogYXJndW1lbnRzIHRvIHVzZSB0byBydW4gdGhlIGNvbW1hbmQgdW5kZXIgYG5pY2VgLlxuICpcbiAqIEV4YW1wbGU6XG4gKlxuICogYGBganNcbiAqIG9ic2VydmVQcm9jZXNzKC4uLihhd2FpdCBuaWNpZnlDb21tYW5kKCdoZycsIFsnZGlmZiddKSkpLnN1YnNjcmliZSguLi4pO1xuICogYGBgXG4gKlxuICogU2VlIGFsc28gYHNjcmlwdGlmeUNvbW1hbmQoKWAgd2hpY2ggZG9lcyBhIHNpbWlsYXIgdGhpbmcgYnV0IGZvciBgc2NyaXB0YC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gbmljaWZ5Q29tbWFuZDxUPihcbiAgY29tbWFuZDogc3RyaW5nLFxuICBhcmdzPzogQXJyYXk8c3RyaW5nPixcbiAgb3B0aW9uczogVCxcbik6IFByb21pc2U8W3N0cmluZywgQXJyYXk8c3RyaW5nPiwgVF0+IHtcbiAgY29uc3QgZnVsbEFyZ3MgPSBbY29tbWFuZCwgLi4uKGFyZ3MgfHwgW10pXTtcbiAgaWYgKGF3YWl0IGhhc05pY2VDb21tYW5kKCkpIHtcbiAgICBmdWxsQXJncy51bnNoaWZ0KE5JQ0VfQ09NTUFORCk7XG4gIH1cbiAgaWYgKGF3YWl0IGhhc0lvbmljZUNvbW1hbmQoKSkge1xuICAgIC8vIExlYXZlIHRoZSBwcm9jZXNzIGluIHRoZSBCZXN0IEVmZm9ydCBjbGFzcyAoZGVmYXVsdCksIGJ1dCBzZXQgaXQgdG8gdGhlIGxvd2VzdCBwcmlvcml0eSBmb3JcbiAgICAvLyB0aGF0IGNsYXNzLiBQcmlvcml0aWVzIHJhbmdlIGZyb20gMC03IHdpdGggNCBhcyB0aGUgZGVmYXVsdCBhbmQgbG93ZXIgbnVtYmVycyByZXByZXNlbnRpbmdcbiAgICAvLyBoaWdoZXIgcHJpb3JpdGllcy5cbiAgICAvL1xuICAgIC8vIFNlZSBgbWFuIGlvbmljZWAgb3IgaHR0cDovL2xpbnV4LmRpZS5uZXQvbWFuLzEvaW9uaWNlXG4gICAgLy9cbiAgICAvLyBJdCdzIG5vdCBzcGVjaWZpZWQgYnkgUE9TSVggbGlrZSBgbmljZWAgaXMgYnV0IHNpbmNlIGl0IGlzIGluY2x1ZGVkIGluIHV0aWwtbGludXggd2hpY2ggaXNcbiAgICAvLyByZWxhdGl2ZWx5IGNvcmVcbiAgICAvLyAoaHR0cHM6Ly9naXQua2VybmVsLm9yZy9jZ2l0L3V0aWxzL3V0aWwtbGludXgvdXRpbC1saW51eC5naXQvdHJlZS9zY2hlZHV0aWxzL2lvbmljZS5jKSwgSVxuICAgIC8vIHRoaW5rIHdlIGNhbiBhc3N1bWUgdGhhdCBpdCB1c2VzIHRoaXMgaW50ZXJmYWNlIGlmIGl0IGV4aXN0cy5cbiAgICBmdWxsQXJncy51bnNoaWZ0KElPTklDRV9DT01NQU5ELCAnLW4nLCAnNycpO1xuICB9XG4gIHJldHVybiBbZnVsbEFyZ3NbMF0sIGZ1bGxBcmdzLnNsaWNlKDEpLCBvcHRpb25zXTtcbn1cblxuY29uc3QgY29tbWFuZEF2YWlsYWJpbGl0eUNhY2hlOiBMUlVDYWNoZTxzdHJpbmcsIGJvb2xlYW4+ID0gTFJVKHtcbiAgbWF4OiAxMCxcbiAgLy8gUmVhbGlzdGljYWxseSB0aGlzIHdpbGwgbm90IGNoYW5nZSB2ZXJ5IG9mdGVuIHNvIHdlIGNhbiBjYWNoZSBmb3IgbG9uZyBwZXJpb2RzIG9mIHRpbWUuIFdlXG4gIC8vIHByb2JhYmx5IGNvdWxkIGp1c3QgY2hlY2sgYXQgc3RhcnR1cCBhbmQgZ2V0IGF3YXkgd2l0aCBpdCwgYnV0IG1heWJlIHNvbWVvbmUgd2lsbCBpbnN0YWxsXG4gIC8vIGBpb25pY2VgIGFuZCBpdCB3b3VsZCBiZSBuaWNlIHRvIHBpY2sgdGhhdCB1cC5cbiAgbWF4QWdlOiAxMDAwICogNjAgKiA1LCAvLyA1IG1pbnV0ZXNcbn0pO1xuXG5mdW5jdGlvbiBoYXNOaWNlQ29tbWFuZCgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIGhhc0NvbW1hbmQoTklDRV9DT01NQU5EKTtcbn1cblxuZnVuY3Rpb24gaGFzSW9uaWNlQ29tbWFuZCgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgcmV0dXJuIGhhc0NvbW1hbmQoSU9OSUNFX0NPTU1BTkQpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBoYXNDb21tYW5kKGNvbW1hbmQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBsZXQgcmVzdWx0OiA/Ym9vbGVhbiA9IGNvbW1hbmRBdmFpbGFiaWxpdHlDYWNoZS5nZXQoY29tbWFuZCk7XG4gIGlmIChyZXN1bHQgPT0gbnVsbCkge1xuICAgIHJlc3VsdCA9IChhd2FpdCB3aGljaChjb21tYW5kKSkgIT0gbnVsbDtcbiAgICBjb21tYW5kQXZhaWxhYmlsaXR5Q2FjaGUuc2V0KGNvbW1hbmQsIHJlc3VsdCk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5pY2VPYnNlcnZlUHJvY2VzcyhcbiAgY29tbWFuZDogc3RyaW5nLFxuICBhcmdzPzogQXJyYXk8c3RyaW5nPixcbiAgb3B0aW9ucz86IE9ic2VydmVQcm9jZXNzT3B0aW9ucyxcbik6IE9ic2VydmFibGU8UHJvY2Vzc01lc3NhZ2U+IHtcbiAgcmV0dXJuIE9ic2VydmFibGUuZGVmZXIoKCkgPT5cbiAgICBuaWNpZnlDb21tYW5kKGNvbW1hbmQsIGFyZ3MsIG9wdGlvbnMpLFxuICApLnN3aXRjaE1hcChzcGF3bkFyZ3MgPT4gb2JzZXJ2ZVByb2Nlc3MoLi4uc3Bhd25BcmdzKSk7XG59XG4iXX0=