'use strict';

var cov_1jnnwtxz6s = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/nuclide-commons/memoizeUntilChanged.js',
      hash = '974cec36c8b88483c7f32e8cbaa21a0c2792a9ea',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/nuclide-commons/memoizeUntilChanged.js',
    statementMap: {
      '0': {
        start: {
          line: 19,
          column: 16
        },
        end: {
          line: 19,
          column: 33
        }
      },
      '1': {
        start: {
          line: 44,
          column: 19
        },
        end: {
          line: 44,
          column: 26
        }
      },
      '2': {
        start: {
          line: 45,
          column: 43
        },
        end: {
          line: 45,
          column: 78
        }
      },
      '3': {
        start: {
          line: 47,
          column: 2
        },
        end: {
          line: 54,
          column: 4
        }
      },
      '4': {
        start: {
          line: 48,
          column: 20
        },
        end: {
          line: 48,
          column: 41
        }
      },
      '5': {
        start: {
          line: 49,
          column: 4
        },
        end: {
          line: 52,
          column: 5
        }
      },
      '6': {
        start: {
          line: 50,
          column: 6
        },
        end: {
          line: 50,
          column: 28
        }
      },
      '7': {
        start: {
          line: 51,
          column: 6
        },
        end: {
          line: 51,
          column: 42
        }
      },
      '8': {
        start: {
          line: 53,
          column: 4
        },
        end: {
          line: 53,
          column: 22
        }
      },
      '9': {
        start: {
          line: 58,
          column: 30
        },
        end: {
          line: 58,
          column: 42
        }
      },
      '10': {
        start: {
          line: 59,
          column: 2
        },
        end: {
          line: 59,
          column: 32
        }
      },
      '11': {
        start: {
          line: 59,
          column: 14
        },
        end: {
          line: 59,
          column: 31
        }
      }
    },
    fnMap: {
      '0': {
        name: 'memoizeUntilChanged',
        decl: {
          start: {
            line: 38,
            column: 24
          },
          end: {
            line: 38,
            column: 43
          }
        },
        loc: {
          start: {
            line: 42,
            column: 5
          },
          end: {
            line: 55,
            column: 1
          }
        },
        line: 42
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 47,
            column: 9
          },
          end: {
            line: 47,
            column: 10
          }
        },
        loc: {
          start: {
            line: 47,
            column: 27
          },
          end: {
            line: 54,
            column: 3
          }
        },
        line: 47
      },
      '2': {
        name: 'createKeySelector',
        decl: {
          start: {
            line: 57,
            column: 9
          },
          end: {
            line: 57,
            column: 26
          }
        },
        loc: {
          start: {
            line: 57,
            column: 53
          },
          end: {
            line: 60,
            column: 1
          }
        },
        line: 57
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 59,
            column: 9
          },
          end: {
            line: 59,
            column: 10
          }
        },
        loc: {
          start: {
            line: 59,
            column: 14
          },
          end: {
            line: 59,
            column: 31
          }
        },
        line: 59
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 41,
            column: 2
          },
          end: {
            line: 41,
            column: 39
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 41,
            column: 29
          },
          end: {
            line: 41,
            column: 39
          }
        }],
        line: 41
      },
      '1': {
        loc: {
          start: {
            line: 45,
            column: 43
          },
          end: {
            line: 45,
            column: 78
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 45,
            column: 43
          },
          end: {
            line: 45,
            column: 55
          }
        }, {
          start: {
            line: 45,
            column: 59
          },
          end: {
            line: 45,
            column: 78
          }
        }],
        line: 45
      },
      '2': {
        loc: {
          start: {
            line: 49,
            column: 4
          },
          end: {
            line: 52,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 49,
            column: 4
          },
          end: {
            line: 52,
            column: 5
          }
        }, {
          start: {
            line: 49,
            column: 4
          },
          end: {
            line: 52,
            column: 5
          }
        }],
        line: 49
      },
      '3': {
        loc: {
          start: {
            line: 49,
            column: 8
          },
          end: {
            line: 49,
            column: 68
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 49,
            column: 8
          },
          end: {
            line: 49,
            column: 30
          }
        }, {
          start: {
            line: 49,
            column: 34
          },
          end: {
            line: 49,
            column: 68
          }
        }],
        line: 49
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0
    },
    b: {
      '0': [0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = memoizeUntilChanged;

var _collection;

function _load_collection() {
  return _collection = require('./collection');
}

var _Hasher;

function _load_Hasher() {
  return _Hasher = _interopRequireDefault(require('./Hasher'));
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

const NOTHING = (cov_1jnnwtxz6s.s[0]++, Symbol('nothing'));

/**
 * Create a memoized version of the provided function that caches only the latest result. This is
 * especially useful for optimizing React component methods without having to worry about
 * maintaining state explicitly. For example:
 *
 *     class MyComponent extends React.Component {
 *       constructor(props) {
 *         super(props);
 *         this._computeSomethingExpensive = memoizeUntilChanged(this._computeSomethingExpensive);
 *       }
 *       _computeSomethingExpensive(x) { ... }
 *       render() {
 *         const thingToRender = this._computeSomethingExpensive(this.props.value);
 *         return <div>{thingToRender}</div>;
 *       }
 *     }
 */
function memoizeUntilChanged(func, keySelector_, compareKeys = (cov_1jnnwtxz6s.b[0][0]++, (_collection || _load_collection()).arrayEqual)) {
  cov_1jnnwtxz6s.f[0]++;

  let prevArgKeys;
  let prevResult = (cov_1jnnwtxz6s.s[1]++, NOTHING);
  const keySelector = (cov_1jnnwtxz6s.s[2]++, (cov_1jnnwtxz6s.b[1][0]++, keySelector_) || (cov_1jnnwtxz6s.b[1][1]++, createKeySelector()));
  // $FlowIssue: Flow can't express that we want the args to be the same type as the input func's.
  cov_1jnnwtxz6s.s[3]++;
  return function (...args) {
    cov_1jnnwtxz6s.f[1]++;

    const argKeys = (cov_1jnnwtxz6s.s[4]++, args.map(keySelector));
    cov_1jnnwtxz6s.s[5]++;
    if ((cov_1jnnwtxz6s.b[3][0]++, prevResult === NOTHING) || (cov_1jnnwtxz6s.b[3][1]++, !compareKeys(argKeys, prevArgKeys))) {
      cov_1jnnwtxz6s.b[2][0]++;
      cov_1jnnwtxz6s.s[6]++;

      prevArgKeys = argKeys;
      cov_1jnnwtxz6s.s[7]++;
      prevResult = func.apply(this, args);
    } else {
      cov_1jnnwtxz6s.b[2][1]++;
    }
    cov_1jnnwtxz6s.s[8]++;
    return prevResult;
  };
}

function createKeySelector() {
  cov_1jnnwtxz6s.f[2]++;

  const hasher = (cov_1jnnwtxz6s.s[9]++, new (_Hasher || _load_Hasher()).default());
  cov_1jnnwtxz6s.s[10]++;
  return x => {
    cov_1jnnwtxz6s.f[3]++;
    cov_1jnnwtxz6s.s[11]++;
    return hasher.getHash(x);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lbW9pemVVbnRpbENoYW5nZWQuanMiXSwibmFtZXMiOlsibWVtb2l6ZVVudGlsQ2hhbmdlZCIsIk5PVEhJTkciLCJTeW1ib2wiLCJmdW5jIiwia2V5U2VsZWN0b3JfIiwiY29tcGFyZUtleXMiLCJwcmV2QXJnS2V5cyIsInByZXZSZXN1bHQiLCJrZXlTZWxlY3RvciIsImNyZWF0ZUtleVNlbGVjdG9yIiwiYXJncyIsImFyZ0tleXMiLCJtYXAiLCJhcHBseSIsImhhc2hlciIsIngiLCJnZXRIYXNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztrQkFxQ3dCQSxtQjs7OztBQXpCeEI7QUFBQTtBQUFBOzs7O0FBQ0E7QUFBQTtBQUFBOzs7O0FBYkE7Ozs7Ozs7Ozs7OztBQWtCQSxNQUFNQyxrQ0FBVUMsT0FBTyxTQUFQLENBQVYsQ0FBTjs7QUFFQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpQmUsU0FBU0YsbUJBQVQsQ0FDYkcsSUFEYSxFQUViQyxZQUZhLEVBR2JDLHdGQUhhLEVBSVY7QUFBQTs7QUFDSCxNQUFJQyxXQUFKO0FBQ0EsTUFBSUMscUNBQWFOLE9BQWIsQ0FBSjtBQUNBLFFBQU1PLHNDQUFtQyx1RUFBZ0JDLG1CQUFoQixDQUFuQyxDQUFOO0FBQ0E7QUFKRztBQUtILFNBQU8sVUFBUyxHQUFHQyxJQUFaLEVBQWtCO0FBQUE7O0FBQ3ZCLFVBQU1DLGtDQUFVRCxLQUFLRSxHQUFMLENBQVNKLFdBQVQsQ0FBVixDQUFOO0FBRHVCO0FBRXZCLFFBQUksMENBQWVQLE9BQWYsZ0NBQTBCLENBQUNJLFlBQVlNLE9BQVosRUFBcUJMLFdBQXJCLENBQTNCLENBQUosRUFBa0U7QUFBQTtBQUFBOztBQUNoRUEsb0JBQWNLLE9BQWQ7QUFEZ0U7QUFFaEVKLG1CQUFhSixLQUFLVSxLQUFMLENBQVcsSUFBWCxFQUFpQkgsSUFBakIsQ0FBYjtBQUNELEtBSEQ7QUFBQTtBQUFBO0FBRnVCO0FBTXZCLFdBQU9ILFVBQVA7QUFDRCxHQVBEO0FBUUQ7O0FBRUQsU0FBU0UsaUJBQVQsR0FBcUQ7QUFBQTs7QUFDbkQsUUFBTUssaUNBQXNCLHlDQUF0QixDQUFOO0FBRG1EO0FBRW5ELFNBQU9DLEtBQUs7QUFBQTtBQUFBO0FBQUEsa0JBQU9DLE9BQVAsQ0FBZUQsQ0FBZjtBQUFpQixHQUE3QjtBQUNEIiwiZmlsZSI6Im1lbW9pemVVbnRpbENoYW5nZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQge2FycmF5RXF1YWx9IGZyb20gJy4vY29sbGVjdGlvbic7XG5pbXBvcnQgSGFzaGVyIGZyb20gJy4vSGFzaGVyJztcblxudHlwZSBDb21wYXJlRnVuYyA9IChhOiBBcnJheTxhbnk+LCBiOiBBcnJheTxhbnk+KSA9PiBib29sZWFuO1xudHlwZSBLZXlTZWxlY3RvcjxULCBVPiA9ICh4OiBUKSA9PiBVO1xuXG5jb25zdCBOT1RISU5HID0gU3ltYm9sKCdub3RoaW5nJyk7XG5cbi8qKlxuICogQ3JlYXRlIGEgbWVtb2l6ZWQgdmVyc2lvbiBvZiB0aGUgcHJvdmlkZWQgZnVuY3Rpb24gdGhhdCBjYWNoZXMgb25seSB0aGUgbGF0ZXN0IHJlc3VsdC4gVGhpcyBpc1xuICogZXNwZWNpYWxseSB1c2VmdWwgZm9yIG9wdGltaXppbmcgUmVhY3QgY29tcG9uZW50IG1ldGhvZHMgd2l0aG91dCBoYXZpbmcgdG8gd29ycnkgYWJvdXRcbiAqIG1haW50YWluaW5nIHN0YXRlIGV4cGxpY2l0bHkuIEZvciBleGFtcGxlOlxuICpcbiAqICAgICBjbGFzcyBNeUNvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gKiAgICAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICogICAgICAgICBzdXBlcihwcm9wcyk7XG4gKiAgICAgICAgIHRoaXMuX2NvbXB1dGVTb21ldGhpbmdFeHBlbnNpdmUgPSBtZW1vaXplVW50aWxDaGFuZ2VkKHRoaXMuX2NvbXB1dGVTb21ldGhpbmdFeHBlbnNpdmUpO1xuICogICAgICAgfVxuICogICAgICAgX2NvbXB1dGVTb21ldGhpbmdFeHBlbnNpdmUoeCkgeyAuLi4gfVxuICogICAgICAgcmVuZGVyKCkge1xuICogICAgICAgICBjb25zdCB0aGluZ1RvUmVuZGVyID0gdGhpcy5fY29tcHV0ZVNvbWV0aGluZ0V4cGVuc2l2ZSh0aGlzLnByb3BzLnZhbHVlKTtcbiAqICAgICAgICAgcmV0dXJuIDxkaXY+e3RoaW5nVG9SZW5kZXJ9PC9kaXY+O1xuICogICAgICAgfVxuICogICAgIH1cbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gbWVtb2l6ZVVudGlsQ2hhbmdlZDxUOiBGdW5jdGlvbj4oXG4gIGZ1bmM6IFQsXG4gIGtleVNlbGVjdG9yXz86IEtleVNlbGVjdG9yPFQsIGFueT4sXG4gIGNvbXBhcmVLZXlzOiBDb21wYXJlRnVuYyA9IGFycmF5RXF1YWwsXG4pOiBUIHtcbiAgbGV0IHByZXZBcmdLZXlzO1xuICBsZXQgcHJldlJlc3VsdCA9IE5PVEhJTkc7XG4gIGNvbnN0IGtleVNlbGVjdG9yOiBLZXlTZWxlY3RvcjxULCBhbnk+ID0ga2V5U2VsZWN0b3JfIHx8IGNyZWF0ZUtleVNlbGVjdG9yKCk7XG4gIC8vICRGbG93SXNzdWU6IEZsb3cgY2FuJ3QgZXhwcmVzcyB0aGF0IHdlIHdhbnQgdGhlIGFyZ3MgdG8gYmUgdGhlIHNhbWUgdHlwZSBhcyB0aGUgaW5wdXQgZnVuYydzLlxuICByZXR1cm4gZnVuY3Rpb24oLi4uYXJncykge1xuICAgIGNvbnN0IGFyZ0tleXMgPSBhcmdzLm1hcChrZXlTZWxlY3Rvcik7XG4gICAgaWYgKHByZXZSZXN1bHQgPT09IE5PVEhJTkcgfHwgIWNvbXBhcmVLZXlzKGFyZ0tleXMsIHByZXZBcmdLZXlzKSkge1xuICAgICAgcHJldkFyZ0tleXMgPSBhcmdLZXlzO1xuICAgICAgcHJldlJlc3VsdCA9IGZ1bmMuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfVxuICAgIHJldHVybiBwcmV2UmVzdWx0O1xuICB9O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVLZXlTZWxlY3RvcjxUPigpOiBLZXlTZWxlY3RvcjxULCBhbnk+IHtcbiAgY29uc3QgaGFzaGVyOiBIYXNoZXI8YW55PiA9IG5ldyBIYXNoZXIoKTtcbiAgcmV0dXJuIHggPT4gaGFzaGVyLmdldEhhc2goeCk7XG59XG4iXX0=