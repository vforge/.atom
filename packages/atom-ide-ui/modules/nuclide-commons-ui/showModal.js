'use strict';

var cov_1f5cgg5bqw = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/nuclide-commons-ui/showModal.js',
      hash = 'e0c143795b8e3a47c7c5d53e6dca54360a1d9d9f',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/nuclide-commons-ui/showModal.js',
    statementMap: {
      '0': {
        start: {
          line: 56,
          column: 22
        },
        end: {
          line: 56,
          column: 51
        }
      },
      '1': {
        start: {
          line: 57,
          column: 20
        },
        end: {
          line: 61,
          column: 4
        }
      },
      '2': {
        start: {
          line: 63,
          column: 4
        },
        end: {
          line: 63,
          column: 60
        }
      },
      '3': {
        start: {
          line: 63,
          column: 55
        },
        end: {
          line: 63,
          column: 59
        }
      },
      '4': {
        start: {
          line: 65,
          column: 21
        },
        end: {
          line: 91,
          column: 3
        }
      },
      '5': {
        start: {
          line: 67,
          column: 6
        },
        end: {
          line: 69,
          column: 7
        }
      },
      '6': {
        start: {
          line: 68,
          column: 8
        },
        end: {
          line: 68,
          column: 15
        }
      },
      '7': {
        start: {
          line: 70,
          column: 6
        },
        end: {
          line: 70,
          column: 40
        }
      },
      '8': {
        start: {
          line: 71,
          column: 6
        },
        end: {
          line: 73,
          column: 7
        }
      },
      '9': {
        start: {
          line: 72,
          column: 8
        },
        end: {
          line: 72,
          column: 25
        }
      },
      '10': {
        start: {
          line: 76,
          column: 6
        },
        end: {
          line: 78,
          column: 7
        }
      },
      '11': {
        start: {
          line: 77,
          column: 8
        },
        end: {
          line: 77,
          column: 29
        }
      },
      '12': {
        start: {
          line: 81,
          column: 6
        },
        end: {
          line: 81,
          column: 26
        }
      },
      '13': {
        start: {
          line: 85,
          column: 6
        },
        end: {
          line: 87,
          column: 7
        }
      },
      '14': {
        start: {
          line: 86,
          column: 8
        },
        end: {
          line: 86,
          column: 28
        }
      },
      '15': {
        start: {
          line: 88,
          column: 6
        },
        end: {
          line: 88,
          column: 51
        }
      },
      '16': {
        start: {
          line: 89,
          column: 6
        },
        end: {
          line: 89,
          column: 26
        }
      },
      '17': {
        start: {
          line: 93,
          column: 2
        },
        end: {
          line: 98,
          column: 4
        }
      },
      '18': {
        start: {
          line: 99,
          column: 2
        },
        end: {
          line: 99,
          column: 20
        }
      },
      '19': {
        start: {
          line: 103,
          column: 26
        },
        end: {
          line: 103,
          column: 43
        }
      },
      '20': {
        start: {
          line: 115,
          column: 4
        },
        end: {
          line: 121,
          column: 6
        }
      },
      '21': {
        start: {
          line: 125,
          column: 17
        },
        end: {
          line: 125,
          column: 43
        }
      },
      '22': {
        start: {
          line: 126,
          column: 4
        },
        end: {
          line: 126,
          column: 43
        }
      },
      '23': {
        start: {
          line: 131,
          column: 4
        },
        end: {
          line: 133,
          column: 5
        }
      },
      '24': {
        start: {
          line: 132,
          column: 6
        },
        end: {
          line: 132,
          column: 19
        }
      }
    },
    fnMap: {
      '0': {
        name: 'showModal',
        decl: {
          start: {
            line: 52,
            column: 24
          },
          end: {
            line: 52,
            column: 33
          }
        },
        loc: {
          start: {
            line: 55,
            column: 15
          },
          end: {
            line: 100,
            column: 1
          }
        },
        line: 55
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 63,
            column: 49
          },
          end: {
            line: 63,
            column: 50
          }
        },
        loc: {
          start: {
            line: 63,
            column: 55
          },
          end: {
            line: 63,
            column: 59
          }
        },
        line: 63
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 66,
            column: 58
          },
          end: {
            line: 66,
            column: 59
          }
        },
        loc: {
          start: {
            line: 66,
            column: 72
          },
          end: {
            line: 74,
            column: 5
          }
        },
        line: 66
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 75,
            column: 33
          },
          end: {
            line: 75,
            column: 34
          }
        },
        loc: {
          start: {
            line: 75,
            column: 44
          },
          end: {
            line: 79,
            column: 5
          }
        },
        line: 75
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 80,
            column: 55
          },
          end: {
            line: 80,
            column: 56
          }
        },
        loc: {
          start: {
            line: 81,
            column: 6
          },
          end: {
            line: 81,
            column: 26
          }
        },
        line: 81
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 83,
            column: 4
          },
          end: {
            line: 83,
            column: 5
          }
        },
        loc: {
          start: {
            line: 83,
            column: 10
          },
          end: {
            line: 90,
            column: 5
          }
        },
        line: 83
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 114,
            column: 2
          },
          end: {
            line: 114,
            column: 3
          }
        },
        loc: {
          start: {
            line: 114,
            column: 23
          },
          end: {
            line: 122,
            column: 3
          }
        },
        line: 114
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 124,
            column: 2
          },
          end: {
            line: 124,
            column: 3
          }
        },
        loc: {
          start: {
            line: 124,
            column: 28
          },
          end: {
            line: 134,
            column: 3
          }
        },
        line: 124
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 54,
            column: 2
          },
          end: {
            line: 54,
            column: 29
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 54,
            column: 21
          },
          end: {
            line: 54,
            column: 29
          }
        }],
        line: 54
      },
      '1': {
        loc: {
          start: {
            line: 63,
            column: 4
          },
          end: {
            line: 63,
            column: 60
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 63,
            column: 4
          },
          end: {
            line: 63,
            column: 44
          }
        }, {
          start: {
            line: 63,
            column: 49
          },
          end: {
            line: 63,
            column: 59
          }
        }],
        line: 63
      },
      '2': {
        loc: {
          start: {
            line: 67,
            column: 6
          },
          end: {
            line: 69,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 67,
            column: 6
          },
          end: {
            line: 69,
            column: 7
          }
        }, {
          start: {
            line: 67,
            column: 6
          },
          end: {
            line: 69,
            column: 7
          }
        }],
        line: 67
      },
      '3': {
        loc: {
          start: {
            line: 71,
            column: 6
          },
          end: {
            line: 73,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 71,
            column: 6
          },
          end: {
            line: 73,
            column: 7
          }
        }, {
          start: {
            line: 71,
            column: 6
          },
          end: {
            line: 73,
            column: 7
          }
        }],
        line: 71
      },
      '4': {
        loc: {
          start: {
            line: 76,
            column: 6
          },
          end: {
            line: 78,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 76,
            column: 6
          },
          end: {
            line: 78,
            column: 7
          }
        }, {
          start: {
            line: 76,
            column: 6
          },
          end: {
            line: 78,
            column: 7
          }
        }],
        line: 76
      },
      '5': {
        loc: {
          start: {
            line: 85,
            column: 6
          },
          end: {
            line: 87,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 85,
            column: 6
          },
          end: {
            line: 87,
            column: 7
          }
        }, {
          start: {
            line: 85,
            column: 6
          },
          end: {
            line: 87,
            column: 7
          }
        }],
        line: 85
      },
      '6': {
        loc: {
          start: {
            line: 131,
            column: 4
          },
          end: {
            line: 133,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 131,
            column: 4
          },
          end: {
            line: 133,
            column: 5
          }
        }, {
          start: {
            line: 131,
            column: 4
          },
          end: {
            line: 133,
            column: 5
          }
        }],
        line: 131
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0
    },
    b: {
      '0': [0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = showModal;

var _react = _interopRequireWildcard(require('react'));

var _reactDom = _interopRequireDefault(require('react-dom'));

var _rxjsBundlesRxMinJs = require('rxjs/bundles/Rx.min.js');

var _UniversalDisposable;

function _load_UniversalDisposable() {
  return _UniversalDisposable = _interopRequireDefault(require('nuclide-commons/UniversalDisposable'));
}

var _TabbableContainer;

function _load_TabbableContainer() {
  return _TabbableContainer = _interopRequireDefault(require('./TabbableContainer'));
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

/**
 * Shows a modal dialog that renders a React element as its content.
 * The modal is automatically hidden when the user clicks outside of it, and on core:cancel (esc).
 * The modal panel unmounts its React component and destroys the panel as soon as it is hidden;
 * you may not hide the panel and then re-show it later.
 * Returns a disposable that you may use to hide and destroy the modal.
 */


/**
 * Given a function to dismiss the modal, return a React element for the content.
 * Call the function when e.g. the user clicks a Cancel or Submit button.
 */


/** Wrap options in an object so we can add new ones later without an explosion of params */
/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

/* global Node */
/* global HTMLElement */

function showModal(contentFactory, options = (cov_1f5cgg5bqw.b[0][0]++, defaults)) {
  cov_1f5cgg5bqw.f[0]++;

  const hostElement = (cov_1f5cgg5bqw.s[0]++, document.createElement('div'));
  const atomPanel = (cov_1f5cgg5bqw.s[1]++, atom.workspace.addModalPanel({
    item: hostElement,
    priority: options.priority,
    className: options.className
  }));
  const shouldDismissOnClickOutsideModal = (cov_1f5cgg5bqw.s[2]++, (cov_1f5cgg5bqw.b[1][0]++, options.shouldDismissOnClickOutsideModal) || (cov_1f5cgg5bqw.b[1][1]++, () => {
    cov_1f5cgg5bqw.f[1]++;
    cov_1f5cgg5bqw.s[3]++;
    return true;
  }));

  const disposable = (cov_1f5cgg5bqw.s[4]++, new (_UniversalDisposable || _load_UniversalDisposable()).default(_rxjsBundlesRxMinJs.Observable.fromEvent(document, 'mousedown').subscribe(({ target }) => {
    cov_1f5cgg5bqw.f[2]++;
    cov_1f5cgg5bqw.s[5]++;

    if (!shouldDismissOnClickOutsideModal()) {
      cov_1f5cgg5bqw.b[2][0]++;
      cov_1f5cgg5bqw.s[6]++;

      return;
    } else {
      cov_1f5cgg5bqw.b[2][1]++;
    }
    cov_1f5cgg5bqw.s[7]++;

    if (!(target instanceof Node)) {
      throw new Error('Invariant violation: "target instanceof Node"');
    }

    cov_1f5cgg5bqw.s[8]++;

    if (!atomPanel.getItem().contains(target)) {
      cov_1f5cgg5bqw.b[3][0]++;
      cov_1f5cgg5bqw.s[9]++;

      atomPanel.hide();
    } else {
      cov_1f5cgg5bqw.b[3][1]++;
    }
  }), atomPanel.onDidChangeVisible(visible => {
    cov_1f5cgg5bqw.f[3]++;
    cov_1f5cgg5bqw.s[10]++;

    if (!visible) {
      cov_1f5cgg5bqw.b[4][0]++;
      cov_1f5cgg5bqw.s[11]++;

      disposable.dispose();
    } else {
      cov_1f5cgg5bqw.b[4][1]++;
    }
  }), atom.commands.add('atom-workspace', 'core:cancel', () => {
    cov_1f5cgg5bqw.f[4]++;
    cov_1f5cgg5bqw.s[12]++;
    return disposable.dispose();
  }), () => {
    cov_1f5cgg5bqw.f[5]++;
    cov_1f5cgg5bqw.s[13]++;

    // Call onDismiss before unmounting the component and destroying the panel:
    if (options.onDismiss) {
      cov_1f5cgg5bqw.b[5][0]++;
      cov_1f5cgg5bqw.s[14]++;

      options.onDismiss();
    } else {
      cov_1f5cgg5bqw.b[5][1]++;
    }
    cov_1f5cgg5bqw.s[15]++;
    _reactDom.default.unmountComponentAtNode(hostElement);
    cov_1f5cgg5bqw.s[16]++;
    atomPanel.destroy();
  }));

  cov_1f5cgg5bqw.s[17]++;
  _reactDom.default.render(_react.createElement(
    ModalContainer,
    null,
    contentFactory(disposable.dispose.bind(disposable))
  ), hostElement);
  cov_1f5cgg5bqw.s[18]++;
  return disposable;
}

/** Flow makes {} an unsealed object (eyeroll) */
const defaults = (cov_1f5cgg5bqw.s[19]++, Object.freeze({}));

/**
 * Just exists to provide a div that we can focus on mount. This ensures we steal focus from any
 * editors or other panes while the modal is present.
 */
class ModalContainer extends _react.Component {
  render() {
    cov_1f5cgg5bqw.f[6]++;
    cov_1f5cgg5bqw.s[20]++;

    return _react.createElement(
      'div',
      { tabIndex: '-1' },
      _react.createElement(
        (_TabbableContainer || _load_TabbableContainer()).default,
        { contained: true },
        this.props.children
      )
    );
  }

  componentDidMount() {
    cov_1f5cgg5bqw.f[7]++;

    const node = (cov_1f5cgg5bqw.s[21]++, _reactDom.default.findDOMNode(this));
    cov_1f5cgg5bqw.s[22]++;

    if (!(node instanceof HTMLElement)) {
      throw new Error('Invariant violation: "node instanceof HTMLElement"');
    }
    // Steal the focus away from any active editor or pane, setting it on the modal;
    // but don't steal focus away from a descendant. This can happen if a React element focuses
    // during its componentDidMount. For example, <AtomInput> does this since the underlying
    // <atom-text-editor> does not support the autofocus attribute.


    cov_1f5cgg5bqw.s[23]++;
    if (!node.contains(document.activeElement)) {
      cov_1f5cgg5bqw.b[6][0]++;
      cov_1f5cgg5bqw.s[24]++;

      node.focus();
    } else {
      cov_1f5cgg5bqw.b[6][1]++;
    }
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNob3dNb2RhbC5qcyJdLCJuYW1lcyI6WyJzaG93TW9kYWwiLCJjb250ZW50RmFjdG9yeSIsIm9wdGlvbnMiLCJkZWZhdWx0cyIsImhvc3RFbGVtZW50IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYXRvbVBhbmVsIiwiYXRvbSIsIndvcmtzcGFjZSIsImFkZE1vZGFsUGFuZWwiLCJpdGVtIiwicHJpb3JpdHkiLCJjbGFzc05hbWUiLCJzaG91bGREaXNtaXNzT25DbGlja091dHNpZGVNb2RhbCIsImRpc3Bvc2FibGUiLCJmcm9tRXZlbnQiLCJzdWJzY3JpYmUiLCJ0YXJnZXQiLCJOb2RlIiwiZ2V0SXRlbSIsImNvbnRhaW5zIiwiaGlkZSIsIm9uRGlkQ2hhbmdlVmlzaWJsZSIsInZpc2libGUiLCJkaXNwb3NlIiwiY29tbWFuZHMiLCJhZGQiLCJvbkRpc21pc3MiLCJ1bm1vdW50Q29tcG9uZW50QXROb2RlIiwiZGVzdHJveSIsInJlbmRlciIsImJpbmQiLCJPYmplY3QiLCJmcmVlemUiLCJNb2RhbENvbnRhaW5lciIsIkNvbXBvbmVudCIsInByb3BzIiwiY2hpbGRyZW4iLCJjb21wb25lbnREaWRNb3VudCIsIm5vZGUiLCJmaW5kRE9NTm9kZSIsIkhUTUxFbGVtZW50IiwiYWN0aXZlRWxlbWVudCIsImZvY3VzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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LFVBQXhCLENBQWY7QUFESCxHQURGLEVBSUVYLFdBSkY7QUF0Q2E7QUE0Q2IsU0FBT1csVUFBUDtBQUNEOztBQUVEO0FBQ0EsTUFBTVosb0NBQW9COEIsT0FBT0MsTUFBUCxDQUFjLEVBQWQsQ0FBcEIsQ0FBTjs7QUFNQTs7OztBQUlBLE1BQU1DLGNBQU4sU0FBNkIsT0FBTUMsU0FBbkMsQ0FBb0Q7QUFDbERMLFdBQXFCO0FBQUE7QUFBQTs7QUFDbkIsV0FDRTtBQUFBO0FBQUEsUUFBSyxVQUFTLElBQWQ7QUFDRTtBQUFBO0FBQUEsVUFBbUIsV0FBVyxJQUE5QjtBQUNHLGFBQUtNLEtBQUwsQ0FBV0M7QUFEZDtBQURGLEtBREY7QUFPRDs7QUFFREMsc0JBQTBCO0FBQUE7O0FBQ3hCLFVBQU1DLGdDQUFPLGtCQUFTQyxXQUFULENBQXFCLElBQXJCLENBQVAsQ0FBTjtBQUR3Qjs7QUFBQSxVQUVkRCxnQkFBZ0JFLFdBRkY7QUFBQTtBQUFBO0FBR3hCO0FBQ0E7QUFDQTtBQUNBOzs7QUFOd0I7QUFPeEIsUUFBSSxDQUFDRixLQUFLbkIsUUFBTCxDQUFjaEIsU0FBU3NDLGFBQXZCLENBQUwsRUFBNEM7QUFBQTtBQUFBOztBQUMxQ0gsV0FBS0ksS0FBTDtBQUNELEtBRkQ7QUFBQTtBQUFBO0FBR0Q7QUFyQmlEIiwiZmlsZSI6InNob3dNb2RhbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbi8qIGdsb2JhbCBOb2RlICovXG4vKiBnbG9iYWwgSFRNTEVsZW1lbnQgKi9cblxuaW1wb3J0IGludmFyaWFudCBmcm9tICdhc3NlcnQnO1xuaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSAnbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGUnO1xuXG5pbXBvcnQgVGFiYmFibGVDb250YWluZXIgZnJvbSAnLi9UYWJiYWJsZUNvbnRhaW5lcic7XG5cbi8qKlxuICogR2l2ZW4gYSBmdW5jdGlvbiB0byBkaXNtaXNzIHRoZSBtb2RhbCwgcmV0dXJuIGEgUmVhY3QgZWxlbWVudCBmb3IgdGhlIGNvbnRlbnQuXG4gKiBDYWxsIHRoZSBmdW5jdGlvbiB3aGVuIGUuZy4gdGhlIHVzZXIgY2xpY2tzIGEgQ2FuY2VsIG9yIFN1Ym1pdCBidXR0b24uXG4gKi9cbnR5cGUgQ29udGVudEZhY3RvcnkgPSAoZGlzbWlzczogKCkgPT4gdm9pZCkgPT4gUmVhY3QuRWxlbWVudDxhbnk+O1xuXG4vKiogV3JhcCBvcHRpb25zIGluIGFuIG9iamVjdCBzbyB3ZSBjYW4gYWRkIG5ldyBvbmVzIGxhdGVyIHdpdGhvdXQgYW4gZXhwbG9zaW9uIG9mIHBhcmFtcyAqL1xudHlwZSBPcHRpb25zID0ge3xcbiAgLyoqIENhbGxlZCB3aGVuIHRoZSBtb2RhbCBpcyBkaXNtaXNzZWQgKGp1c3QgYmVmb3JlIGl0IGlzIGRlc3Ryb3llZCkuICovXG4gIG9uRGlzbWlzcz86ICgpID0+IHZvaWQsXG4gIC8qKlxuICAgKiBDYWxsZWQgd2hlbiB0aGUgdXNlciBjbGlja3Mgb3V0c2lkZSB0aGUgbW9kYWwsIHJldHVybiBmYWxzZSB0byBwcmV2ZW50IGRpc21pc3NhbC5cbiAgICogSWYgdW5zcGVjaWZpZWQgdGhlIG1vZGFsIHdpbGwgYmUgZGlzbWlzc2VkIGlmIHRoZSB1c2VyIGNsaWNrcyBvdXRzaWRlIHRoZSBtb2RhbC5cbiAgICovXG4gIHNob3VsZERpc21pc3NPbkNsaWNrT3V0c2lkZU1vZGFsPzogKCkgPT4gYm9vbGVhbixcbiAgLyoqIFBhc3NlZCB0byBhdG9tJ3MgdW5kZXJseWluZyBhZGRNb2RhbFBhbmVsIGZ1bmN0aW9uLiAqL1xuICBwcmlvcml0eT86IG51bWJlcixcbiAgLyoqIFBhc3NlZCB0byBhdG9tJ3MgdW5kZXJseWluZyBhZGRNb2RhbFBhbmVsIGZ1bmN0aW9uLiAqL1xuICBjbGFzc05hbWU/OiBzdHJpbmcsXG58fTtcblxuLyoqXG4gKiBTaG93cyBhIG1vZGFsIGRpYWxvZyB0aGF0IHJlbmRlcnMgYSBSZWFjdCBlbGVtZW50IGFzIGl0cyBjb250ZW50LlxuICogVGhlIG1vZGFsIGlzIGF1dG9tYXRpY2FsbHkgaGlkZGVuIHdoZW4gdGhlIHVzZXIgY2xpY2tzIG91dHNpZGUgb2YgaXQsIGFuZCBvbiBjb3JlOmNhbmNlbCAoZXNjKS5cbiAqIFRoZSBtb2RhbCBwYW5lbCB1bm1vdW50cyBpdHMgUmVhY3QgY29tcG9uZW50IGFuZCBkZXN0cm95cyB0aGUgcGFuZWwgYXMgc29vbiBhcyBpdCBpcyBoaWRkZW47XG4gKiB5b3UgbWF5IG5vdCBoaWRlIHRoZSBwYW5lbCBhbmQgdGhlbiByZS1zaG93IGl0IGxhdGVyLlxuICogUmV0dXJucyBhIGRpc3Bvc2FibGUgdGhhdCB5b3UgbWF5IHVzZSB0byBoaWRlIGFuZCBkZXN0cm95IHRoZSBtb2RhbC5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc2hvd01vZGFsKFxuICBjb250ZW50RmFjdG9yeTogQ29udGVudEZhY3RvcnksXG4gIG9wdGlvbnM6IE9wdGlvbnMgPSBkZWZhdWx0cyxcbik6IElEaXNwb3NhYmxlIHtcbiAgY29uc3QgaG9zdEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgY29uc3QgYXRvbVBhbmVsID0gYXRvbS53b3Jrc3BhY2UuYWRkTW9kYWxQYW5lbCh7XG4gICAgaXRlbTogaG9zdEVsZW1lbnQsXG4gICAgcHJpb3JpdHk6IG9wdGlvbnMucHJpb3JpdHksXG4gICAgY2xhc3NOYW1lOiBvcHRpb25zLmNsYXNzTmFtZSxcbiAgfSk7XG4gIGNvbnN0IHNob3VsZERpc21pc3NPbkNsaWNrT3V0c2lkZU1vZGFsID1cbiAgICBvcHRpb25zLnNob3VsZERpc21pc3NPbkNsaWNrT3V0c2lkZU1vZGFsIHx8ICgoKSA9PiB0cnVlKTtcblxuICBjb25zdCBkaXNwb3NhYmxlID0gbmV3IFVuaXZlcnNhbERpc3Bvc2FibGUoXG4gICAgT2JzZXJ2YWJsZS5mcm9tRXZlbnQoZG9jdW1lbnQsICdtb3VzZWRvd24nKS5zdWJzY3JpYmUoKHt0YXJnZXR9KSA9PiB7XG4gICAgICBpZiAoIXNob3VsZERpc21pc3NPbkNsaWNrT3V0c2lkZU1vZGFsKCkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaW52YXJpYW50KHRhcmdldCBpbnN0YW5jZW9mIE5vZGUpO1xuICAgICAgaWYgKCFhdG9tUGFuZWwuZ2V0SXRlbSgpLmNvbnRhaW5zKHRhcmdldCkpIHtcbiAgICAgICAgYXRvbVBhbmVsLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9KSxcbiAgICBhdG9tUGFuZWwub25EaWRDaGFuZ2VWaXNpYmxlKHZpc2libGUgPT4ge1xuICAgICAgaWYgKCF2aXNpYmxlKSB7XG4gICAgICAgIGRpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICAgICAgfVxuICAgIH0pLFxuICAgIGF0b20uY29tbWFuZHMuYWRkKCdhdG9tLXdvcmtzcGFjZScsICdjb3JlOmNhbmNlbCcsICgpID0+XG4gICAgICBkaXNwb3NhYmxlLmRpc3Bvc2UoKSxcbiAgICApLFxuICAgICgpID0+IHtcbiAgICAgIC8vIENhbGwgb25EaXNtaXNzIGJlZm9yZSB1bm1vdW50aW5nIHRoZSBjb21wb25lbnQgYW5kIGRlc3Ryb3lpbmcgdGhlIHBhbmVsOlxuICAgICAgaWYgKG9wdGlvbnMub25EaXNtaXNzKSB7XG4gICAgICAgIG9wdGlvbnMub25EaXNtaXNzKCk7XG4gICAgICB9XG4gICAgICBSZWFjdERPTS51bm1vdW50Q29tcG9uZW50QXROb2RlKGhvc3RFbGVtZW50KTtcbiAgICAgIGF0b21QYW5lbC5kZXN0cm95KCk7XG4gICAgfSxcbiAgKTtcblxuICBSZWFjdERPTS5yZW5kZXIoXG4gICAgPE1vZGFsQ29udGFpbmVyPlxuICAgICAge2NvbnRlbnRGYWN0b3J5KGRpc3Bvc2FibGUuZGlzcG9zZS5iaW5kKGRpc3Bvc2FibGUpKX1cbiAgICA8L01vZGFsQ29udGFpbmVyPixcbiAgICBob3N0RWxlbWVudCxcbiAgKTtcbiAgcmV0dXJuIGRpc3Bvc2FibGU7XG59XG5cbi8qKiBGbG93IG1ha2VzIHt9IGFuIHVuc2VhbGVkIG9iamVjdCAoZXllcm9sbCkgKi9cbmNvbnN0IGRlZmF1bHRzOiBPcHRpb25zID0gT2JqZWN0LmZyZWV6ZSh7fSk7XG5cbnR5cGUgUHJvcHMgPSB7XG4gIGNoaWxkcmVuPzogYW55LFxufTtcblxuLyoqXG4gKiBKdXN0IGV4aXN0cyB0byBwcm92aWRlIGEgZGl2IHRoYXQgd2UgY2FuIGZvY3VzIG9uIG1vdW50LiBUaGlzIGVuc3VyZXMgd2Ugc3RlYWwgZm9jdXMgZnJvbSBhbnlcbiAqIGVkaXRvcnMgb3Igb3RoZXIgcGFuZXMgd2hpbGUgdGhlIG1vZGFsIGlzIHByZXNlbnQuXG4gKi9cbmNsYXNzIE1vZGFsQ29udGFpbmVyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzPiB7XG4gIHJlbmRlcigpOiBSZWFjdC5Ob2RlIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiB0YWJJbmRleD1cIi0xXCI+XG4gICAgICAgIDxUYWJiYWJsZUNvbnRhaW5lciBjb250YWluZWQ9e3RydWV9PlxuICAgICAgICAgIHt0aGlzLnByb3BzLmNoaWxkcmVufVxuICAgICAgICA8L1RhYmJhYmxlQ29udGFpbmVyPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCk6IHZvaWQge1xuICAgIGNvbnN0IG5vZGUgPSBSZWFjdERPTS5maW5kRE9NTm9kZSh0aGlzKTtcbiAgICBpbnZhcmlhbnQobm9kZSBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KTtcbiAgICAvLyBTdGVhbCB0aGUgZm9jdXMgYXdheSBmcm9tIGFueSBhY3RpdmUgZWRpdG9yIG9yIHBhbmUsIHNldHRpbmcgaXQgb24gdGhlIG1vZGFsO1xuICAgIC8vIGJ1dCBkb24ndCBzdGVhbCBmb2N1cyBhd2F5IGZyb20gYSBkZXNjZW5kYW50LiBUaGlzIGNhbiBoYXBwZW4gaWYgYSBSZWFjdCBlbGVtZW50IGZvY3VzZXNcbiAgICAvLyBkdXJpbmcgaXRzIGNvbXBvbmVudERpZE1vdW50LiBGb3IgZXhhbXBsZSwgPEF0b21JbnB1dD4gZG9lcyB0aGlzIHNpbmNlIHRoZSB1bmRlcmx5aW5nXG4gICAgLy8gPGF0b20tdGV4dC1lZGl0b3I+IGRvZXMgbm90IHN1cHBvcnQgdGhlIGF1dG9mb2N1cyBhdHRyaWJ1dGUuXG4gICAgaWYgKCFub2RlLmNvbnRhaW5zKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpKSB7XG4gICAgICBub2RlLmZvY3VzKCk7XG4gICAgfVxuICB9XG59XG4iXX0=