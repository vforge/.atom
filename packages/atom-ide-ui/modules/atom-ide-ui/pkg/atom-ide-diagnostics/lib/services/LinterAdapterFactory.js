'use strict';

var cov_pr4nubjr7 = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-diagnostics/lib/services/LinterAdapterFactory.js',
      hash = 'f4e3c93035fa84b919cadd055093a00b6a62159c',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-diagnostics/lib/services/LinterAdapterFactory.js',
    statementMap: {
      '0': {
        start: {
          line: 22,
          column: 27
        },
        end: {
          line: 22,
          column: 51
        }
      },
      '1': {
        start: {
          line: 23,
          column: 2
        },
        end: {
          line: 33,
          column: 3
        }
      },
      '2': {
        start: {
          line: 24,
          column: 4
        },
        end: {
          line: 24,
          column: 53
        }
      },
      '3': {
        start: {
          line: 26,
          column: 23
        },
        end: {
          line: 26,
          column: 36
        }
      },
      '4': {
        start: {
          line: 28,
          column: 6
        },
        end: {
          line: 29,
          column: 67
        }
      },
      '5': {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 30,
          column: 70
        }
      },
      '6': {
        start: {
          line: 30,
          column: 45
        },
        end: {
          line: 30,
          column: 59
        }
      },
      '7': {
        start: {
          line: 31,
          column: 4
        },
        end: {
          line: 31,
          column: 62
        }
      },
      '8': {
        start: {
          line: 32,
          column: 4
        },
        end: {
          line: 32,
          column: 16
        }
      },
      '9': {
        start: {
          line: 37,
          column: 17
        },
        end: {
          line: 37,
          column: 19
        }
      },
      '10': {
        start: {
          line: 38,
          column: 2
        },
        end: {
          line: 38,
          column: 54
        }
      },
      '11': {
        start: {
          line: 40,
          column: 2
        },
        end: {
          line: 80,
          column: 3
        }
      },
      '12': {
        start: {
          line: 41,
          column: 4
        },
        end: {
          line: 41,
          column: 75
        }
      },
      '13': {
        start: {
          line: 42,
          column: 4
        },
        end: {
          line: 46,
          column: 6
        }
      },
      '14': {
        start: {
          line: 47,
          column: 4
        },
        end: {
          line: 55,
          column: 5
        }
      },
      '15': {
        start: {
          line: 48,
          column: 6
        },
        end: {
          line: 54,
          column: 7
        }
      },
      '16': {
        start: {
          line: 49,
          column: 8
        },
        end: {
          line: 53,
          column: 10
        }
      },
      '17': {
        start: {
          line: 57,
          column: 4
        },
        end: {
          line: 61,
          column: 6
        }
      },
      '18': {
        start: {
          line: 63,
          column: 4
        },
        end: {
          line: 63,
          column: 71
        }
      },
      '19': {
        start: {
          line: 64,
          column: 4
        },
        end: {
          line: 68,
          column: 6
        }
      },
      '20': {
        start: {
          line: 72,
          column: 4
        },
        end: {
          line: 74,
          column: 5
        }
      },
      '21': {
        start: {
          line: 73,
          column: 6
        },
        end: {
          line: 73,
          column: 31
        }
      },
      '22': {
        start: {
          line: 75,
          column: 4
        },
        end: {
          line: 79,
          column: 6
        }
      },
      '23': {
        start: {
          line: 82,
          column: 2
        },
        end: {
          line: 82,
          column: 16
        }
      },
      '24': {
        start: {
          line: 87,
          column: 2
        },
        end: {
          line: 89,
          column: 3
        }
      },
      '25': {
        start: {
          line: 88,
          column: 4
        },
        end: {
          line: 88,
          column: 21
        }
      }
    },
    fnMap: {
      '0': {
        name: 'createAdapter',
        decl: {
          start: {
            line: 18,
            column: 16
          },
          end: {
            line: 18,
            column: 29
          }
        },
        loc: {
          start: {
            line: 21,
            column: 18
          },
          end: {
            line: 34,
            column: 1
          }
        },
        line: 21
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 30,
            column: 36
          },
          end: {
            line: 30,
            column: 37
          }
        },
        loc: {
          start: {
            line: 30,
            column: 45
          },
          end: {
            line: 30,
            column: 59
          }
        },
        line: 30
      },
      '2': {
        name: 'validateLinter',
        decl: {
          start: {
            line: 36,
            column: 16
          },
          end: {
            line: 36,
            column: 30
          }
        },
        loc: {
          start: {
            line: 36,
            column: 72
          },
          end: {
            line: 83,
            column: 1
          }
        },
        line: 36
      },
      '3': {
        name: 'validate',
        decl: {
          start: {
            line: 85,
            column: 9
          },
          end: {
            line: 85,
            column: 17
          }
        },
        loc: {
          start: {
            line: 85,
            column: 78
          },
          end: {
            line: 90,
            column: 1
          }
        },
        line: 85
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 23,
            column: 2
          },
          end: {
            line: 33,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 23,
            column: 2
          },
          end: {
            line: 33,
            column: 3
          }
        }, {
          start: {
            line: 23,
            column: 2
          },
          end: {
            line: 33,
            column: 3
          }
        }],
        line: 23
      },
      '1': {
        loc: {
          start: {
            line: 40,
            column: 2
          },
          end: {
            line: 80,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 40,
            column: 2
          },
          end: {
            line: 80,
            column: 3
          }
        }, {
          start: {
            line: 40,
            column: 2
          },
          end: {
            line: 80,
            column: 3
          }
        }],
        line: 40
      },
      '2': {
        loc: {
          start: {
            line: 47,
            column: 4
          },
          end: {
            line: 55,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 47,
            column: 4
          },
          end: {
            line: 55,
            column: 5
          }
        }, {
          start: {
            line: 47,
            column: 4
          },
          end: {
            line: 55,
            column: 5
          }
        }],
        line: 47
      },
      '3': {
        loc: {
          start: {
            line: 58,
            column: 6
          },
          end: {
            line: 58,
            column: 63
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 58,
            column: 6
          },
          end: {
            line: 58,
            column: 31
          }
        }, {
          start: {
            line: 58,
            column: 35
          },
          end: {
            line: 58,
            column: 63
          }
        }],
        line: 58
      },
      '4': {
        loc: {
          start: {
            line: 72,
            column: 4
          },
          end: {
            line: 74,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 72,
            column: 4
          },
          end: {
            line: 74,
            column: 5
          }
        }, {
          start: {
            line: 72,
            column: 4
          },
          end: {
            line: 74,
            column: 5
          }
        }],
        line: 72
      },
      '5': {
        loc: {
          start: {
            line: 87,
            column: 2
          },
          end: {
            line: 89,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 87,
            column: 2
          },
          end: {
            line: 89,
            column: 3
          }
        }, {
          start: {
            line: 87,
            column: 2
          },
          end: {
            line: 89,
            column: 3
          }
        }],
        line: 87
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createAdapter = createAdapter;
exports.validateLinter = validateLinter;

var _LinterAdapter;

function _load_LinterAdapter() {
  return _LinterAdapter = require('./LinterAdapter');
}

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

function createAdapter(provider, busyReporter) {
  cov_pr4nubjr7.f[0]++;

  const validationErrors = (cov_pr4nubjr7.s[0]++, validateLinter(provider));
  cov_pr4nubjr7.s[1]++;
  if (validationErrors.length === 0) {
    cov_pr4nubjr7.b[0][0]++;
    cov_pr4nubjr7.s[2]++;

    return new (_LinterAdapter || _load_LinterAdapter()).LinterAdapter(provider, busyReporter);
  } else {
    cov_pr4nubjr7.b[0][1]++;

    const nameString = (cov_pr4nubjr7.s[3]++, provider.name);
    let message = (cov_pr4nubjr7.s[4]++, `nuclide-diagnostics-store found problems with the linter \`${nameString}\`. ` + 'Diagnostic messages from that linter will be unavailable.\n');
    cov_pr4nubjr7.s[5]++;
    message += validationErrors.map(error => {
      cov_pr4nubjr7.f[1]++;
      cov_pr4nubjr7.s[6]++;
      return `- ${error}\n`;
    }).join('');
    cov_pr4nubjr7.s[7]++;
    atom.notifications.addError(message, { dismissable: true });
    cov_pr4nubjr7.s[8]++;
    return null;
  }
}

function validateLinter(provider) {
  cov_pr4nubjr7.f[2]++;

  const errors = (cov_pr4nubjr7.s[9]++, []);
  cov_pr4nubjr7.s[10]++;
  validate(provider, 'Must not be undefined', errors);

  cov_pr4nubjr7.s[11]++;
  if (errors.length === 0) {
    cov_pr4nubjr7.b[1][0]++;
    cov_pr4nubjr7.s[12]++;

    validate(provider.grammarScopes, 'Must specify grammarScopes', errors);
    cov_pr4nubjr7.s[13]++;
    validate(Array.isArray(provider.grammarScopes), 'grammarScopes must be an Array', errors);
    cov_pr4nubjr7.s[14]++;
    if (errors.length === 0) {
      cov_pr4nubjr7.b[2][0]++;
      cov_pr4nubjr7.s[15]++;

      for (const grammar of provider.grammarScopes) {
        cov_pr4nubjr7.s[16]++;

        validate(typeof grammar === 'string', `Each grammarScope entry must be a string: ${grammar}`, errors);
      }
    } else {
      cov_pr4nubjr7.b[2][1]++;
    }

    cov_pr4nubjr7.s[17]++;
    validate((cov_pr4nubjr7.b[3][0]++, provider.scope === 'file') || (cov_pr4nubjr7.b[3][1]++, provider.scope === 'project'), `Scope must be 'file' or 'project'; found '${provider.scope}'`, errors);

    cov_pr4nubjr7.s[18]++;
    validate(provider.lint, 'lint function must be specified', errors);
    cov_pr4nubjr7.s[19]++;
    validate(typeof provider.lint === 'function', 'lint must be a function', errors);

    // Older LinterV1 providers didn't have to provide a name.
    // We'll tolerate this, since there's still a few out there.
    cov_pr4nubjr7.s[20]++;
    if (provider.name == null) {
      cov_pr4nubjr7.b[4][0]++;
      cov_pr4nubjr7.s[21]++;

      provider.name = 'Linter';
    } else {
      cov_pr4nubjr7.b[4][1]++;
    }
    cov_pr4nubjr7.s[22]++;
    validate(typeof provider.name === 'string', 'provider must have a name', errors);
  } else {
    cov_pr4nubjr7.b[1][1]++;
  }

  cov_pr4nubjr7.s[23]++;
  return errors;
}

function validate(condition, msg, errors) {
  cov_pr4nubjr7.f[3]++;
  cov_pr4nubjr7.s[24]++;

  // flowlint-next-line sketchy-null-mixed:off
  if (!condition) {
    cov_pr4nubjr7.b[5][0]++;
    cov_pr4nubjr7.s[25]++;

    errors.push(msg);
  } else {
    cov_pr4nubjr7.b[5][1]++;
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxpbnRlckFkYXB0ZXJGYWN0b3J5LmpzIl0sIm5hbWVzIjpbImNyZWF0ZUFkYXB0ZXIiLCJ2YWxpZGF0ZUxpbnRlciIsInByb3ZpZGVyIiwiYnVzeVJlcG9ydGVyIiwidmFsaWRhdGlvbkVycm9ycyIsImxlbmd0aCIsIm5hbWVTdHJpbmciLCJuYW1lIiwibWVzc2FnZSIsIm1hcCIsImVycm9yIiwiam9pbiIsImF0b20iLCJub3RpZmljYXRpb25zIiwiYWRkRXJyb3IiLCJkaXNtaXNzYWJsZSIsImVycm9ycyIsInZhbGlkYXRlIiwiZ3JhbW1hclNjb3BlcyIsIkFycmF5IiwiaXNBcnJheSIsImdyYW1tYXIiLCJzY29wZSIsImxpbnQiLCJjb25kaXRpb24iLCJtc2ciLCJwdXNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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LENBQUNRLFNBQUwsRUFBZ0I7QUFBQTtBQUFBOztBQUNkUixXQUFPVSxJQUFQLENBQVlELEdBQVo7QUFDRCxHQUZEO0FBQUE7QUFBQTtBQUdEIiwiZmlsZSI6IkxpbnRlckFkYXB0ZXJGYWN0b3J5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuaW1wb3J0IHR5cGUge0xpbnRlclByb3ZpZGVyfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQge0xpbnRlckFkYXB0ZXJ9IGZyb20gJy4vTGludGVyQWRhcHRlcic7XG5cbnR5cGUgQnVzeVJlcG9ydGVyID0gKHRpdGxlOiBzdHJpbmcpID0+IElEaXNwb3NhYmxlO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQWRhcHRlcihcbiAgcHJvdmlkZXI6IExpbnRlclByb3ZpZGVyLFxuICBidXN5UmVwb3J0ZXI6IEJ1c3lSZXBvcnRlcixcbik6ID9MaW50ZXJBZGFwdGVyIHtcbiAgY29uc3QgdmFsaWRhdGlvbkVycm9ycyA9IHZhbGlkYXRlTGludGVyKHByb3ZpZGVyKTtcbiAgaWYgKHZhbGlkYXRpb25FcnJvcnMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIG5ldyBMaW50ZXJBZGFwdGVyKHByb3ZpZGVyLCBidXN5UmVwb3J0ZXIpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IG5hbWVTdHJpbmcgPSBwcm92aWRlci5uYW1lO1xuICAgIGxldCBtZXNzYWdlID1cbiAgICAgIGBudWNsaWRlLWRpYWdub3N0aWNzLXN0b3JlIGZvdW5kIHByb2JsZW1zIHdpdGggdGhlIGxpbnRlciBcXGAke25hbWVTdHJpbmd9XFxgLiBgICtcbiAgICAgICdEaWFnbm9zdGljIG1lc3NhZ2VzIGZyb20gdGhhdCBsaW50ZXIgd2lsbCBiZSB1bmF2YWlsYWJsZS5cXG4nO1xuICAgIG1lc3NhZ2UgKz0gdmFsaWRhdGlvbkVycm9ycy5tYXAoZXJyb3IgPT4gYC0gJHtlcnJvcn1cXG5gKS5qb2luKCcnKTtcbiAgICBhdG9tLm5vdGlmaWNhdGlvbnMuYWRkRXJyb3IobWVzc2FnZSwge2Rpc21pc3NhYmxlOiB0cnVlfSk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlTGludGVyKHByb3ZpZGVyOiBMaW50ZXJQcm92aWRlcik6IEFycmF5PHN0cmluZz4ge1xuICBjb25zdCBlcnJvcnMgPSBbXTtcbiAgdmFsaWRhdGUocHJvdmlkZXIsICdNdXN0IG5vdCBiZSB1bmRlZmluZWQnLCBlcnJvcnMpO1xuXG4gIGlmIChlcnJvcnMubGVuZ3RoID09PSAwKSB7XG4gICAgdmFsaWRhdGUocHJvdmlkZXIuZ3JhbW1hclNjb3BlcywgJ011c3Qgc3BlY2lmeSBncmFtbWFyU2NvcGVzJywgZXJyb3JzKTtcbiAgICB2YWxpZGF0ZShcbiAgICAgIEFycmF5LmlzQXJyYXkocHJvdmlkZXIuZ3JhbW1hclNjb3BlcyksXG4gICAgICAnZ3JhbW1hclNjb3BlcyBtdXN0IGJlIGFuIEFycmF5JyxcbiAgICAgIGVycm9ycyxcbiAgICApO1xuICAgIGlmIChlcnJvcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICBmb3IgKGNvbnN0IGdyYW1tYXIgb2YgcHJvdmlkZXIuZ3JhbW1hclNjb3Blcykge1xuICAgICAgICB2YWxpZGF0ZShcbiAgICAgICAgICB0eXBlb2YgZ3JhbW1hciA9PT0gJ3N0cmluZycsXG4gICAgICAgICAgYEVhY2ggZ3JhbW1hclNjb3BlIGVudHJ5IG11c3QgYmUgYSBzdHJpbmc6ICR7Z3JhbW1hcn1gLFxuICAgICAgICAgIGVycm9ycyxcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YWxpZGF0ZShcbiAgICAgIHByb3ZpZGVyLnNjb3BlID09PSAnZmlsZScgfHwgcHJvdmlkZXIuc2NvcGUgPT09ICdwcm9qZWN0JyxcbiAgICAgIGBTY29wZSBtdXN0IGJlICdmaWxlJyBvciAncHJvamVjdCc7IGZvdW5kICcke3Byb3ZpZGVyLnNjb3BlfSdgLFxuICAgICAgZXJyb3JzLFxuICAgICk7XG5cbiAgICB2YWxpZGF0ZShwcm92aWRlci5saW50LCAnbGludCBmdW5jdGlvbiBtdXN0IGJlIHNwZWNpZmllZCcsIGVycm9ycyk7XG4gICAgdmFsaWRhdGUoXG4gICAgICB0eXBlb2YgcHJvdmlkZXIubGludCA9PT0gJ2Z1bmN0aW9uJyxcbiAgICAgICdsaW50IG11c3QgYmUgYSBmdW5jdGlvbicsXG4gICAgICBlcnJvcnMsXG4gICAgKTtcblxuICAgIC8vIE9sZGVyIExpbnRlclYxIHByb3ZpZGVycyBkaWRuJ3QgaGF2ZSB0byBwcm92aWRlIGEgbmFtZS5cbiAgICAvLyBXZSdsbCB0b2xlcmF0ZSB0aGlzLCBzaW5jZSB0aGVyZSdzIHN0aWxsIGEgZmV3IG91dCB0aGVyZS5cbiAgICBpZiAocHJvdmlkZXIubmFtZSA9PSBudWxsKSB7XG4gICAgICBwcm92aWRlci5uYW1lID0gJ0xpbnRlcic7XG4gICAgfVxuICAgIHZhbGlkYXRlKFxuICAgICAgdHlwZW9mIHByb3ZpZGVyLm5hbWUgPT09ICdzdHJpbmcnLFxuICAgICAgJ3Byb3ZpZGVyIG11c3QgaGF2ZSBhIG5hbWUnLFxuICAgICAgZXJyb3JzLFxuICAgICk7XG4gIH1cblxuICByZXR1cm4gZXJyb3JzO1xufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZShjb25kaXRpb246IG1peGVkLCBtc2c6IHN0cmluZywgZXJyb3JzOiBBcnJheTxzdHJpbmc+KTogdm9pZCB7XG4gIC8vIGZsb3dsaW50LW5leHQtbGluZSBza2V0Y2h5LW51bGwtbWl4ZWQ6b2ZmXG4gIGlmICghY29uZGl0aW9uKSB7XG4gICAgZXJyb3JzLnB1c2gobXNnKTtcbiAgfVxufVxuIl19