'use strict';

var cov_hxccgvabd = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-diagnostics/lib/redux/Epics.js',
      hash = '1c44ab8a005e7f853d4b393f8f27b6ff68eb75c9',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-diagnostics/lib/redux/Epics.js',
    statementMap: {
      '0': {
        start: {
          line: 28,
          column: 2
        },
        end: {
          line: 48,
          column: 5
        }
      },
      '1': {
        start: {
          line: 29,
          column: 4
        },
        end: {
          line: 29,
          column: 52
        }
      },
      '2': {
        start: {
          line: 30,
          column: 23
        },
        end: {
          line: 30,
          column: 37
        }
      },
      '3': {
        start: {
          line: 31,
          column: 46
        },
        end: {
          line: 33,
          column: 5
        }
      },
      '4': {
        start: {
          line: 32,
          column: 6
        },
        end: {
          line: 32,
          column: 46
        }
      },
      '5': {
        start: {
          line: 36,
          column: 8
        },
        end: {
          line: 38,
          column: 5
        }
      },
      '6': {
        start: {
          line: 37,
          column: 6
        },
        end: {
          line: 37,
          column: 56
        }
      },
      '7': {
        start: {
          line: 39,
          column: 20
        },
        end: {
          line: 44,
          column: 14
        }
      },
      '8': {
        start: {
          line: 42,
          column: 10
        },
        end: {
          line: 42,
          column: 79
        }
      },
      '9': {
        start: {
          line: 45,
          column: 4
        },
        end: {
          line: 47,
          column: 6
        }
      },
      '10': {
        start: {
          line: 59,
          column: 32
        },
        end: {
          line: 59,
          column: 38
        }
      },
      '11': {
        start: {
          line: 63,
          column: 25
        },
        end: {
          line: 75,
          column: 3
        }
      },
      '12': {
        start: {
          line: 65,
          column: 6
        },
        end: {
          line: 65,
          column: 51
        }
      },
      '13': {
        start: {
          line: 66,
          column: 24
        },
        end: {
          line: 66,
          column: 38
        }
      },
      '14': {
        start: {
          line: 67,
          column: 6
        },
        end: {
          line: 67,
          column: 23
        }
      },
      '15': {
        start: {
          line: 70,
          column: 6
        },
        end: {
          line: 70,
          column: 62
        }
      },
      '16': {
        start: {
          line: 72,
          column: 31
        },
        end: {
          line: 72,
          column: 45
        }
      },
      '17': {
        start: {
          line: 73,
          column: 6
        },
        end: {
          line: 73,
          column: 67
        }
      },
      '18': {
        start: {
          line: 77,
          column: 2
        },
        end: {
          line: 103,
          column: 7
        }
      },
      '19': {
        start: {
          line: 78,
          column: 24
        },
        end: {
          line: 78,
          column: 45
        }
      },
      '20': {
        start: {
          line: 82,
          column: 25
        },
        end: {
          line: 82,
          column: 36
        }
      },
      '21': {
        start: {
          line: 83,
          column: 6
        },
        end: {
          line: 83,
          column: 34
        }
      },
      '22': {
        start: {
          line: 86,
          column: 32
        },
        end: {
          line: 86,
          column: 71
        }
      },
      '23': {
        start: {
          line: 86,
          column: 55
        },
        end: {
          line: 86,
          column: 70
        }
      },
      '24': {
        start: {
          line: 87,
          column: 37
        },
        end: {
          line: 87,
          column: 39
        }
      },
      '25': {
        start: {
          line: 88,
          column: 6
        },
        end: {
          line: 94,
          column: 7
        }
      },
      '26': {
        start: {
          line: 89,
          column: 22
        },
        end: {
          line: 89,
          column: 66
        }
      },
      '27': {
        start: {
          line: 90,
          column: 8
        },
        end: {
          line: 92,
          column: 9
        }
      },
      '28': {
        start: {
          line: 91,
          column: 10
        },
        end: {
          line: 91,
          column: 16
        }
      },
      '29': {
        start: {
          line: 93,
          column: 8
        },
        end: {
          line: 93,
          column: 54
        }
      },
      '30': {
        start: {
          line: 97,
          column: 8
        },
        end: {
          line: 98,
          column: 42
        }
      },
      '31': {
        start: {
          line: 99,
          column: 6
        },
        end: {
          line: 101,
          column: 7
        }
      },
      '32': {
        start: {
          line: 100,
          column: 8
        },
        end: {
          line: 100,
          column: 74
        }
      },
      '33': {
        start: {
          line: 102,
          column: 6
        },
        end: {
          line: 102,
          column: 33
        }
      },
      '34': {
        start: {
          line: 109,
          column: 2
        },
        end: {
          line: 116,
          column: 22
        }
      },
      '35': {
        start: {
          line: 112,
          column: 6
        },
        end: {
          line: 114,
          column: 8
        }
      },
      '36': {
        start: {
          line: 123,
          column: 2
        },
        end: {
          line: 123,
          column: 41
        }
      },
      '37': {
        start: {
          line: 131,
          column: 2
        },
        end: {
          line: 168,
          column: 5
        }
      },
      '38': {
        start: {
          line: 132,
          column: 4
        },
        end: {
          line: 132,
          column: 58
        }
      },
      '39': {
        start: {
          line: 133,
          column: 32
        },
        end: {
          line: 133,
          column: 48
        }
      },
      '40': {
        start: {
          line: 134,
          column: 4
        },
        end: {
          line: 136,
          column: 5
        }
      },
      '41': {
        start: {
          line: 135,
          column: 6
        },
        end: {
          line: 135,
          column: 32
        }
      },
      '42': {
        start: {
          line: 137,
          column: 31
        },
        end: {
          line: 137,
          column: 45
        }
      },
      '43': {
        start: {
          line: 138,
          column: 4
        },
        end: {
          line: 167,
          column: 9
        }
      },
      '44': {
        start: {
          line: 140,
          column: 8
        },
        end: {
          line: 155,
          column: 62
        }
      },
      '45': {
        start: {
          line: 141,
          column: 10
        },
        end: {
          line: 141,
          column: 71
        }
      },
      '46': {
        start: {
          line: 144,
          column: 12
        },
        end: {
          line: 153,
          column: 18
        }
      },
      '47': {
        start: {
          line: 149,
          column: 54
        },
        end: {
          line: 152,
          column: 19
        }
      },
      '48': {
        start: {
          line: 155,
          column: 30
        },
        end: {
          line: 155,
          column: 61
        }
      },
      '49': {
        start: {
          line: 159,
          column: 8
        },
        end: {
          line: 159,
          column: 62
        }
      },
      '50': {
        start: {
          line: 162,
          column: 8
        },
        end: {
          line: 165,
          column: 10
        }
      },
      '51': {
        start: {
          line: 166,
          column: 8
        },
        end: {
          line: 166,
          column: 34
        }
      }
    },
    fnMap: {
      '0': {
        name: 'addProvider',
        decl: {
          start: {
            line: 25,
            column: 16
          },
          end: {
            line: 25,
            column: 27
          }
        },
        loc: {
          start: {
            line: 27,
            column: 22
          },
          end: {
            line: 49,
            column: 1
          }
        },
        line: 27
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 28,
            column: 55
          },
          end: {
            line: 28,
            column: 56
          }
        },
        loc: {
          start: {
            line: 28,
            column: 65
          },
          end: {
            line: 48,
            column: 3
          }
        },
        line: 28
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 31,
            column: 67
          },
          end: {
            line: 31,
            column: 68
          }
        },
        loc: {
          start: {
            line: 32,
            column: 6
          },
          end: {
            line: 32,
            column: 46
          }
        },
        line: 32
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 36,
            column: 35
          },
          end: {
            line: 36,
            column: 36
          }
        },
        loc: {
          start: {
            line: 37,
            column: 6
          },
          end: {
            line: 37,
            column: 56
          }
        },
        line: 37
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 41,
            column: 8
          },
          end: {
            line: 41,
            column: 9
          }
        },
        loc: {
          start: {
            line: 42,
            column: 10
          },
          end: {
            line: 42,
            column: 79
          }
        },
        line: 42
      },
      '5': {
        name: 'applyFix',
        decl: {
          start: {
            line: 54,
            column: 16
          },
          end: {
            line: 54,
            column: 24
          }
        },
        loc: {
          start: {
            line: 58,
            column: 22
          },
          end: {
            line: 104,
            column: 1
          }
        },
        line: 58
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 64,
            column: 42
          },
          end: {
            line: 64,
            column: 43
          }
        },
        loc: {
          start: {
            line: 64,
            column: 52
          },
          end: {
            line: 68,
            column: 5
          }
        },
        line: 64
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 69,
            column: 53
          },
          end: {
            line: 69,
            column: 54
          }
        },
        loc: {
          start: {
            line: 69,
            column: 63
          },
          end: {
            line: 74,
            column: 5
          }
        },
        line: 69
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 78,
            column: 12
          },
          end: {
            line: 78,
            column: 13
          }
        },
        loc: {
          start: {
            line: 78,
            column: 24
          },
          end: {
            line: 78,
            column: 45
          }
        },
        line: 78
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 79,
            column: 9
          },
          end: {
            line: 79,
            column: 10
          }
        },
        loc: {
          start: {
            line: 79,
            column: 21
          },
          end: {
            line: 103,
            column: 5
          }
        },
        line: 79
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 86,
            column: 48
          },
          end: {
            line: 86,
            column: 49
          }
        },
        loc: {
          start: {
            line: 86,
            column: 55
          },
          end: {
            line: 86,
            column: 70
          }
        },
        line: 86
      },
      '11': {
        name: 'notifyOfFixFailures',
        decl: {
          start: {
            line: 106,
            column: 16
          },
          end: {
            line: 106,
            column: 35
          }
        },
        loc: {
          start: {
            line: 108,
            column: 21
          },
          end: {
            line: 117,
            column: 1
          }
        },
        line: 108
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 111,
            column: 8
          },
          end: {
            line: 111,
            column: 9
          }
        },
        loc: {
          start: {
            line: 111,
            column: 14
          },
          end: {
            line: 115,
            column: 5
          }
        },
        line: 111
      },
      '13': {
        name: 'forkJoinArray',
        decl: {
          start: {
            line: 119,
            column: 9
          },
          end: {
            line: 119,
            column: 22
          }
        },
        loc: {
          start: {
            line: 121,
            column: 24
          },
          end: {
            line: 124,
            column: 1
          }
        },
        line: 121
      },
      '14': {
        name: 'fetchCodeActions',
        decl: {
          start: {
            line: 126,
            column: 16
          },
          end: {
            line: 126,
            column: 32
          }
        },
        loc: {
          start: {
            line: 129,
            column: 22
          },
          end: {
            line: 169,
            column: 1
          }
        },
        line: 129
      },
      '15': {
        name: '(anonymous_15)',
        decl: {
          start: {
            line: 131,
            column: 62
          },
          end: {
            line: 131,
            column: 63
          }
        },
        loc: {
          start: {
            line: 131,
            column: 72
          },
          end: {
            line: 168,
            column: 3
          }
        },
        line: 131
      },
      '16': {
        name: '(anonymous_16)',
        decl: {
          start: {
            line: 139,
            column: 19
          },
          end: {
            line: 139,
            column: 20
          }
        },
        loc: {
          start: {
            line: 140,
            column: 8
          },
          end: {
            line: 155,
            column: 62
          }
        },
        line: 140
      },
      '17': {
        name: '(anonymous_17)',
        decl: {
          start: {
            line: 140,
            column: 25
          },
          end: {
            line: 140,
            column: 26
          }
        },
        loc: {
          start: {
            line: 141,
            column: 10
          },
          end: {
            line: 141,
            column: 71
          }
        },
        line: 141
      },
      '18': {
        name: '(anonymous_18)',
        decl: {
          start: {
            line: 143,
            column: 21
          },
          end: {
            line: 143,
            column: 22
          }
        },
        loc: {
          start: {
            line: 143,
            column: 36
          },
          end: {
            line: 154,
            column: 11
          }
        },
        line: 143
      },
      '19': {
        name: '(anonymous_19)',
        decl: {
          start: {
            line: 149,
            column: 34
          },
          end: {
            line: 149,
            column: 35
          }
        },
        loc: {
          start: {
            line: 149,
            column: 54
          },
          end: {
            line: 152,
            column: 19
          }
        },
        line: 149
      },
      '20': {
        name: '(anonymous_20)',
        decl: {
          start: {
            line: 155,
            column: 15
          },
          end: {
            line: 155,
            column: 16
          }
        },
        loc: {
          start: {
            line: 155,
            column: 30
          },
          end: {
            line: 155,
            column: 61
          }
        },
        line: 155
      },
      '21': {
        name: '(anonymous_21)',
        decl: {
          start: {
            line: 158,
            column: 11
          },
          end: {
            line: 158,
            column: 12
          }
        },
        loc: {
          start: {
            line: 159,
            column: 8
          },
          end: {
            line: 159,
            column: 62
          }
        },
        line: 159
      },
      '22': {
        name: '(anonymous_22)',
        decl: {
          start: {
            line: 161,
            column: 13
          },
          end: {
            line: 161,
            column: 14
          }
        },
        loc: {
          start: {
            line: 161,
            column: 20
          },
          end: {
            line: 167,
            column: 7
          }
        },
        line: 161
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 42,
            column: 10
          },
          end: {
            line: 42,
            column: 79
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 42,
            column: 10
          },
          end: {
            line: 42,
            column: 44
          }
        }, {
          start: {
            line: 42,
            column: 48
          },
          end: {
            line: 42,
            column: 79
          }
        }],
        line: 42
      },
      '1': {
        loc: {
          start: {
            line: 90,
            column: 8
          },
          end: {
            line: 92,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 90,
            column: 8
          },
          end: {
            line: 92,
            column: 9
          }
        }, {
          start: {
            line: 90,
            column: 8
          },
          end: {
            line: 92,
            column: 9
          }
        }],
        line: 90
      },
      '2': {
        loc: {
          start: {
            line: 97,
            column: 8
          },
          end: {
            line: 98,
            column: 42
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 97,
            column: 8
          },
          end: {
            line: 97,
            column: 49
          }
        }, {
          start: {
            line: 98,
            column: 8
          },
          end: {
            line: 98,
            column: 42
          }
        }],
        line: 97
      },
      '3': {
        loc: {
          start: {
            line: 99,
            column: 6
          },
          end: {
            line: 101,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 99,
            column: 6
          },
          end: {
            line: 101,
            column: 7
          }
        }, {
          start: {
            line: 99,
            column: 6
          },
          end: {
            line: 101,
            column: 7
          }
        }],
        line: 99
      },
      '4': {
        loc: {
          start: {
            line: 134,
            column: 4
          },
          end: {
            line: 136,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 134,
            column: 4
          },
          end: {
            line: 136,
            column: 5
          }
        }, {
          start: {
            line: 134,
            column: 4
          },
          end: {
            line: 136,
            column: 5
          }
        }],
        line: 134
      },
      '5': {
        loc: {
          start: {
            line: 144,
            column: 19
          },
          end: {
            line: 153,
            column: 17
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 146,
            column: 16
          },
          end: {
            line: 146,
            column: 33
          }
        }, {
          start: {
            line: 147,
            column: 16
          },
          end: {
            line: 153,
            column: 17
          }
        }],
        line: 144
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0,
      '50': 0,
      '51': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _asyncToGenerator = _interopRequireDefault(require('async-to-generator'));

exports.addProvider = addProvider;
exports.applyFix = applyFix;
exports.notifyOfFixFailures = notifyOfFixFailures;
exports.fetchCodeActions = fetchCodeActions;

var _log4js;

function _load_log4js() {
  return _log4js = require('log4js');
}

var _textEdit;

function _load_textEdit() {
  return _textEdit = require('nuclide-commons-atom/text-edit');
}

var _rxjsBundlesRxMinJs = require('rxjs/bundles/Rx.min.js');

var _Actions;

function _load_Actions() {
  return _Actions = _interopRequireWildcard(require('./Actions'));
}

var _Selectors;

function _load_Selectors() {
  return _Selectors = _interopRequireWildcard(require('./Selectors'));
}

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function addProvider(actions) {
  cov_hxccgvabd.f[0]++;
  cov_hxccgvabd.s[0]++;

  return actions.ofType((_Actions || _load_Actions()).ADD_PROVIDER).mergeMap(action => {
    cov_hxccgvabd.f[1]++;
    cov_hxccgvabd.s[1]++;

    if (!(action.type === (_Actions || _load_Actions()).ADD_PROVIDER)) {
      throw new Error('Invariant violation: "action.type === Actions.ADD_PROVIDER"');
    }

    const { provider } = (cov_hxccgvabd.s[2]++, action.payload);
    const updateActions = (cov_hxccgvabd.s[3]++, provider.updates.map(update => {
      cov_hxccgvabd.f[2]++;
      cov_hxccgvabd.s[4]++;
      return (_Actions || _load_Actions()).updateMessages(provider, update);
    }));
    const invalidationActions = (cov_hxccgvabd.s[5]++, provider.invalidations.map(invalidation => {
      cov_hxccgvabd.f[3]++;
      cov_hxccgvabd.s[6]++;
      return (_Actions || _load_Actions()).invalidateMessages(provider, invalidation);
    }));
    const removed = (cov_hxccgvabd.s[7]++, actions.filter(a => {
      cov_hxccgvabd.f[4]++;
      cov_hxccgvabd.s[8]++;
      return (cov_hxccgvabd.b[0][0]++, a.type === (_Actions || _load_Actions()).REMOVE_PROVIDER) && (cov_hxccgvabd.b[0][1]++, a.payload.provider === provider);
    }).take(1));
    cov_hxccgvabd.s[9]++;
    return _rxjsBundlesRxMinJs.Observable.merge(updateActions, invalidationActions).takeUntil(removed);
  });
}

/**
 * Applies fixes. This epic is only for side-effects, so it returns `Observable<empty>`.
 */
/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

function applyFix(actions, store, extras) {
  cov_hxccgvabd.f[5]++;

  const { messageRangeTracker } = (cov_hxccgvabd.s[10]++, extras);

  // Map both type of "apply fix" actions to the same shape. This probably indicates that we don't
  // actually need two different action types.
  const messagesStream = (cov_hxccgvabd.s[11]++, _rxjsBundlesRxMinJs.Observable.merge(actions.ofType((_Actions || _load_Actions()).APPLY_FIX).map(action => {
    cov_hxccgvabd.f[6]++;
    cov_hxccgvabd.s[12]++;

    if (!(action.type === (_Actions || _load_Actions()).APPLY_FIX)) {
      throw new Error('Invariant violation: "action.type === Actions.APPLY_FIX"');
    }

    const { message } = (cov_hxccgvabd.s[13]++, action.payload);
    cov_hxccgvabd.s[14]++;
    return [message];
  }), actions.ofType((_Actions || _load_Actions()).APPLY_FIXES_FOR_FILE).map(action => {
    cov_hxccgvabd.f[7]++;
    cov_hxccgvabd.s[15]++;

    if (!(action.type === (_Actions || _load_Actions()).APPLY_FIXES_FOR_FILE)) {
      throw new Error('Invariant violation: "action.type === Actions.APPLY_FIXES_FOR_FILE"');
    }
    // TODO: Be consistent about file/filePath/path.


    const { file: filePath } = (cov_hxccgvabd.s[16]++, action.payload);
    cov_hxccgvabd.s[17]++;
    return (_Selectors || _load_Selectors()).getFileMessages(store.getState(), filePath);
  })));

  cov_hxccgvabd.s[18]++;
  return messagesStream.filter(messages => {
    cov_hxccgvabd.f[8]++;
    cov_hxccgvabd.s[19]++;
    return messages.length !== 0;
  }).map(messages => {
    cov_hxccgvabd.f[9]++;

    // We know that all of the messages have the same path based on the actions above, so just
    // grab it from the first message.
    const { filePath } = (cov_hxccgvabd.s[20]++, messages[0]);
    cov_hxccgvabd.s[21]++;

    if (!(filePath != null)) {
      throw new Error('Invariant violation: "filePath != null"');
    }

    // Get the fixes for each message.


    const messagesWithFixes = (cov_hxccgvabd.s[22]++, messages.filter(msg => {
      cov_hxccgvabd.f[10]++;
      cov_hxccgvabd.s[23]++;
      return msg.fix != null;
    }));
    const fixes = (cov_hxccgvabd.s[24]++, []);
    cov_hxccgvabd.s[25]++;
    for (const message of messagesWithFixes) {
      const range = (cov_hxccgvabd.s[26]++, messageRangeTracker.getCurrentRange(message));
      cov_hxccgvabd.s[27]++;
      if (range == null) {
        cov_hxccgvabd.b[1][0]++;
        cov_hxccgvabd.s[28]++;

        break;
      } else {
        cov_hxccgvabd.b[1][1]++;
      }
      cov_hxccgvabd.s[29]++;
      fixes.push(Object.assign({}, message.fix, { oldRange: range }));
    }

    const succeeded = (cov_hxccgvabd.s[30]++, (cov_hxccgvabd.b[2][0]++, messagesWithFixes.length === fixes.length) && (cov_hxccgvabd.b[2][1]++, (0, (_textEdit || _load_textEdit()).applyTextEdits)(filePath, ...fixes)));
    cov_hxccgvabd.s[31]++;
    if (succeeded) {
      cov_hxccgvabd.b[3][0]++;
      cov_hxccgvabd.s[32]++;

      return (_Actions || _load_Actions()).fixesApplied(filePath, new Set(messagesWithFixes));
    } else {
      cov_hxccgvabd.b[3][1]++;
    }
    cov_hxccgvabd.s[33]++;
    return (_Actions || _load_Actions()).fixFailed();
  });
}

function notifyOfFixFailures(actions) {
  cov_hxccgvabd.f[11]++;
  cov_hxccgvabd.s[34]++;

  return actions.ofType((_Actions || _load_Actions()).FIX_FAILED).do(() => {
    cov_hxccgvabd.f[12]++;
    cov_hxccgvabd.s[35]++;

    atom.notifications.addWarning('Failed to apply fix. Try saving to get fresh results and then try again.');
  }).ignoreElements();
}

function forkJoinArray(sources) {
  cov_hxccgvabd.f[13]++;
  cov_hxccgvabd.s[36]++;

  // $FlowFixMe: Needs a specialization for arrays
  return _rxjsBundlesRxMinJs.Observable.forkJoin(...sources);
}

function fetchCodeActions(actions, store) {
  cov_hxccgvabd.f[14]++;
  cov_hxccgvabd.s[37]++;

  // TODO(hansonw): Until we have have a UI for it, only handle one request at a time.
  return actions.ofType((_Actions || _load_Actions()).FETCH_CODE_ACTIONS).switchMap(action => {
    cov_hxccgvabd.f[15]++;
    cov_hxccgvabd.s[38]++;

    if (!(action.type === (_Actions || _load_Actions()).FETCH_CODE_ACTIONS)) {
      throw new Error('Invariant violation: "action.type === Actions.FETCH_CODE_ACTIONS"');
    }

    const { codeActionFetcher } = (cov_hxccgvabd.s[39]++, store.getState());
    cov_hxccgvabd.s[40]++;
    if (codeActionFetcher == null) {
      cov_hxccgvabd.b[4][0]++;
      cov_hxccgvabd.s[41]++;

      return _rxjsBundlesRxMinJs.Observable.empty();
    } else {
      cov_hxccgvabd.b[4][1]++;
    }
    const { messages, editor } = (cov_hxccgvabd.s[42]++, action.payload);
    cov_hxccgvabd.s[43]++;
    return forkJoinArray(messages.map(message => {
      cov_hxccgvabd.f[16]++;
      cov_hxccgvabd.s[44]++;
      return _rxjsBundlesRxMinJs.Observable.defer(() => {
        cov_hxccgvabd.f[17]++;
        cov_hxccgvabd.s[45]++;
        return codeActionFetcher.getCodeActionForDiagnostic(message, editor);
      }).switchMap(codeActions => {
        cov_hxccgvabd.f[18]++;
        cov_hxccgvabd.s[46]++;

        return codeActions.length === 0 ? ( // forkJoin emits nothing for empty arrays.
        cov_hxccgvabd.b[5][0]++, _rxjsBundlesRxMinJs.Observable.of([])) : (cov_hxccgvabd.b[5][1]++, forkJoinArray(
        // Eagerly fetch the titles so that they're immediately usable in a UI.
        codeActions.map((() => {
          var _ref = (0, _asyncToGenerator.default)(function* (codeAction) {
            cov_hxccgvabd.f[19]++;
            cov_hxccgvabd.s[47]++;
            return [yield codeAction.getTitle(), codeAction];
          });

          return function (_x) {
            return _ref.apply(this, arguments);
          };
        })())));
      }).map(codeActions => {
        cov_hxccgvabd.f[20]++;
        cov_hxccgvabd.s[48]++;
        return [message, new Map(codeActions)];
      });
    })).map(codeActionsForMessage => {
      cov_hxccgvabd.f[21]++;
      cov_hxccgvabd.s[49]++;
      return (_Actions || _load_Actions()).setCodeActions(new Map(codeActionsForMessage));
    }).catch(err => {
      cov_hxccgvabd.f[22]++;
      cov_hxccgvabd.s[50]++;

      (0, (_log4js || _load_log4js()).getLogger)('atom-ide-diagnostics').error(`Error fetching code actions for ${messages[0].filePath}`, err);
      cov_hxccgvabd.s[51]++;
      return _rxjsBundlesRxMinJs.Observable.empty();
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkVwaWNzLmpzIl0sIm5hbWVzIjpbImFkZFByb3ZpZGVyIiwiYXBwbHlGaXgiLCJub3RpZnlPZkZpeEZhaWx1cmVzIiwiZmV0Y2hDb2RlQWN0aW9ucyIsImFjdGlvbnMiLCJvZlR5cGUiLCJBRERfUFJPVklERVIiLCJtZXJnZU1hcCIsImFjdGlvbiIsInR5cGUiLCJwcm92aWRlciIsInBheWxvYWQiLCJ1cGRhdGVBY3Rpb25zIiwidXBkYXRlcyIsIm1hcCIsInVwZGF0ZSIsInVwZGF0ZU1lc3NhZ2VzIiwiaW52YWxpZGF0aW9uQWN0aW9ucyIsImludmFsaWRhdGlvbnMiLCJpbnZhbGlkYXRpb24iLCJpbnZhbGlkYXRlTWVzc2FnZXMiLCJyZW1vdmVkIiwiZmlsdGVyIiwiYSIsIlJFTU9WRV9QUk9WSURFUiIsInRha2UiLCJtZXJnZSIsInRha2VVbnRpbCIsInN0b3JlIiwiZXh0cmFzIiwibWVzc2FnZVJhbmdlVHJhY2tlciIsIm1lc3NhZ2VzU3RyZWFtIiwiQVBQTFlfRklYIiwibWVzc2FnZSIsIkFQUExZX0ZJWEVTX0ZPUl9GSUxFIiwiZmlsZSIsImZpbGVQYXRoIiwiZ2V0RmlsZU1lc3NhZ2VzIiwiZ2V0U3RhdGUiLCJtZXNzYWdlcyIsImxlbmd0aCIsIm1lc3NhZ2VzV2l0aEZpeGVzIiwibXNnIiwiZml4IiwiZml4ZXMiLCJyYW5nZSIsImdldEN1cnJlbnRSYW5nZSIsInB1c2giLCJvbGRSYW5nZSIsInN1Y2NlZWRlZCIsImZpeGVzQXBwbGllZCIsIlNldCIsImZpeEZhaWxlZCIsIkZJWF9GQUlMRUQiLCJkbyIsImF0b20iLCJub3RpZmljYXRpb25zIiwiYWRkV2FybmluZyIsImlnbm9yZUVsZW1lbnRzIiwiZm9ya0pvaW5BcnJheSIsInNvdXJjZXMiLCJmb3JrSm9pbiIsIkZFVENIX0NPREVfQUNUSU9OUyIsInN3aXRjaE1hcCIsImNvZGVBY3Rpb25GZXRjaGVyIiwiZW1wdHkiLCJlZGl0b3IiLCJkZWZlciIsImdldENvZGVBY3Rpb25Gb3JEaWFnbm9zdGljIiwiY29kZUFjdGlvbnMiLCJvZiIsImNvZGVBY3Rpb24iLCJnZXRUaXRsZSIsIk1hcCIsImNvZGVBY3Rpb25zRm9yTWVzc2FnZSIsInNldENvZGVBY3Rpb25zIiwiY2F0Y2giLCJlcnIiLCJlcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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Q0F1QkVDLE9BQU87QUFBQTtBQUFBOztBQUNaLGlEQUFVLHNCQUFWLEVBQWtDQyxLQUFsQyxDQUNHLG1DQUFrQ3ZDLFNBQVMsQ0FBVCxFQUFZSCxRQUFTLEVBRDFELEVBRUV5QyxHQUZGO0FBRFk7QUFLWixhQUFPLCtCQUFXWixLQUFYLEVBQVA7QUFDRCxLQTdCSSxDQUFQO0FBOEJELEdBckNNLENBQVA7QUFzQ0QiLCJmaWxlIjoiRXBpY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQgdHlwZSB7QWN0aW9uc09ic2VydmFibGV9IGZyb20gJ251Y2xpZGUtY29tbW9ucy9yZWR1eC1vYnNlcnZhYmxlJztcbmltcG9ydCB0eXBlIHtBY3Rpb24sIFN0b3JlfSBmcm9tICcuLi90eXBlcyc7XG5pbXBvcnQgdHlwZSBNZXNzYWdlUmFuZ2VUcmFja2VyIGZyb20gJy4uL01lc3NhZ2VSYW5nZVRyYWNrZXInO1xuaW1wb3J0IHR5cGUge1RleHRFZGl0fSBmcm9tICdudWNsaWRlLWNvbW1vbnMtYXRvbS90ZXh0LWVkaXQnO1xuXG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2Fzc2VydCc7XG5pbXBvcnQge2dldExvZ2dlcn0gZnJvbSAnbG9nNGpzJztcbmltcG9ydCB7YXBwbHlUZXh0RWRpdHN9IGZyb20gJ251Y2xpZGUtY29tbW9ucy1hdG9tL3RleHQtZWRpdCc7XG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gJ3J4anMnO1xuaW1wb3J0ICogYXMgQWN0aW9ucyBmcm9tICcuL0FjdGlvbnMnO1xuaW1wb3J0ICogYXMgU2VsZWN0b3JzIGZyb20gJy4vU2VsZWN0b3JzJztcblxuZXhwb3J0IGZ1bmN0aW9uIGFkZFByb3ZpZGVyKFxuICBhY3Rpb25zOiBBY3Rpb25zT2JzZXJ2YWJsZTxBY3Rpb24+LFxuKTogT2JzZXJ2YWJsZTxBY3Rpb24+IHtcbiAgcmV0dXJuIGFjdGlvbnMub2ZUeXBlKEFjdGlvbnMuQUREX1BST1ZJREVSKS5tZXJnZU1hcChhY3Rpb24gPT4ge1xuICAgIGludmFyaWFudChhY3Rpb24udHlwZSA9PT0gQWN0aW9ucy5BRERfUFJPVklERVIpO1xuICAgIGNvbnN0IHtwcm92aWRlcn0gPSBhY3Rpb24ucGF5bG9hZDtcbiAgICBjb25zdCB1cGRhdGVBY3Rpb25zOiBPYnNlcnZhYmxlPEFjdGlvbj4gPSBwcm92aWRlci51cGRhdGVzLm1hcCh1cGRhdGUgPT5cbiAgICAgIEFjdGlvbnMudXBkYXRlTWVzc2FnZXMocHJvdmlkZXIsIHVwZGF0ZSksXG4gICAgKTtcbiAgICBjb25zdCBpbnZhbGlkYXRpb25BY3Rpb25zOiBPYnNlcnZhYmxlPFxuICAgICAgQWN0aW9uLFxuICAgID4gPSBwcm92aWRlci5pbnZhbGlkYXRpb25zLm1hcChpbnZhbGlkYXRpb24gPT5cbiAgICAgIEFjdGlvbnMuaW52YWxpZGF0ZU1lc3NhZ2VzKHByb3ZpZGVyLCBpbnZhbGlkYXRpb24pLFxuICAgICk7XG4gICAgY29uc3QgcmVtb3ZlZCA9IGFjdGlvbnNcbiAgICAgIC5maWx0ZXIoXG4gICAgICAgIGEgPT5cbiAgICAgICAgICBhLnR5cGUgPT09IEFjdGlvbnMuUkVNT1ZFX1BST1ZJREVSICYmIGEucGF5bG9hZC5wcm92aWRlciA9PT0gcHJvdmlkZXIsXG4gICAgICApXG4gICAgICAudGFrZSgxKTtcbiAgICByZXR1cm4gT2JzZXJ2YWJsZS5tZXJnZSh1cGRhdGVBY3Rpb25zLCBpbnZhbGlkYXRpb25BY3Rpb25zKS50YWtlVW50aWwoXG4gICAgICByZW1vdmVkLFxuICAgICk7XG4gIH0pO1xufVxuXG4vKipcbiAqIEFwcGxpZXMgZml4ZXMuIFRoaXMgZXBpYyBpcyBvbmx5IGZvciBzaWRlLWVmZmVjdHMsIHNvIGl0IHJldHVybnMgYE9ic2VydmFibGU8ZW1wdHk+YC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5Rml4KFxuICBhY3Rpb25zOiBBY3Rpb25zT2JzZXJ2YWJsZTxBY3Rpb24+LFxuICBzdG9yZTogU3RvcmUsXG4gIGV4dHJhczoge21lc3NhZ2VSYW5nZVRyYWNrZXI6IE1lc3NhZ2VSYW5nZVRyYWNrZXJ9LFxuKTogT2JzZXJ2YWJsZTxBY3Rpb24+IHtcbiAgY29uc3Qge21lc3NhZ2VSYW5nZVRyYWNrZXJ9ID0gZXh0cmFzO1xuXG4gIC8vIE1hcCBib3RoIHR5cGUgb2YgXCJhcHBseSBmaXhcIiBhY3Rpb25zIHRvIHRoZSBzYW1lIHNoYXBlLiBUaGlzIHByb2JhYmx5IGluZGljYXRlcyB0aGF0IHdlIGRvbid0XG4gIC8vIGFjdHVhbGx5IG5lZWQgdHdvIGRpZmZlcmVudCBhY3Rpb24gdHlwZXMuXG4gIGNvbnN0IG1lc3NhZ2VzU3RyZWFtID0gT2JzZXJ2YWJsZS5tZXJnZShcbiAgICBhY3Rpb25zLm9mVHlwZShBY3Rpb25zLkFQUExZX0ZJWCkubWFwKGFjdGlvbiA9PiB7XG4gICAgICBpbnZhcmlhbnQoYWN0aW9uLnR5cGUgPT09IEFjdGlvbnMuQVBQTFlfRklYKTtcbiAgICAgIGNvbnN0IHttZXNzYWdlfSA9IGFjdGlvbi5wYXlsb2FkO1xuICAgICAgcmV0dXJuIFttZXNzYWdlXTtcbiAgICB9KSxcbiAgICBhY3Rpb25zLm9mVHlwZShBY3Rpb25zLkFQUExZX0ZJWEVTX0ZPUl9GSUxFKS5tYXAoYWN0aW9uID0+IHtcbiAgICAgIGludmFyaWFudChhY3Rpb24udHlwZSA9PT0gQWN0aW9ucy5BUFBMWV9GSVhFU19GT1JfRklMRSk7XG4gICAgICAvLyBUT0RPOiBCZSBjb25zaXN0ZW50IGFib3V0IGZpbGUvZmlsZVBhdGgvcGF0aC5cbiAgICAgIGNvbnN0IHtmaWxlOiBmaWxlUGF0aH0gPSBhY3Rpb24ucGF5bG9hZDtcbiAgICAgIHJldHVybiBTZWxlY3RvcnMuZ2V0RmlsZU1lc3NhZ2VzKHN0b3JlLmdldFN0YXRlKCksIGZpbGVQYXRoKTtcbiAgICB9KSxcbiAgKTtcblxuICByZXR1cm4gbWVzc2FnZXNTdHJlYW1cbiAgICAuZmlsdGVyKG1lc3NhZ2VzID0+IG1lc3NhZ2VzLmxlbmd0aCAhPT0gMClcbiAgICAubWFwKG1lc3NhZ2VzID0+IHtcbiAgICAgIC8vIFdlIGtub3cgdGhhdCBhbGwgb2YgdGhlIG1lc3NhZ2VzIGhhdmUgdGhlIHNhbWUgcGF0aCBiYXNlZCBvbiB0aGUgYWN0aW9ucyBhYm92ZSwgc28ganVzdFxuICAgICAgLy8gZ3JhYiBpdCBmcm9tIHRoZSBmaXJzdCBtZXNzYWdlLlxuICAgICAgY29uc3Qge2ZpbGVQYXRofSA9IG1lc3NhZ2VzWzBdO1xuICAgICAgaW52YXJpYW50KGZpbGVQYXRoICE9IG51bGwpO1xuXG4gICAgICAvLyBHZXQgdGhlIGZpeGVzIGZvciBlYWNoIG1lc3NhZ2UuXG4gICAgICBjb25zdCBtZXNzYWdlc1dpdGhGaXhlcyA9IG1lc3NhZ2VzLmZpbHRlcihtc2cgPT4gbXNnLmZpeCAhPSBudWxsKTtcbiAgICAgIGNvbnN0IGZpeGVzOiBBcnJheTxUZXh0RWRpdD4gPSBbXTtcbiAgICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlc1dpdGhGaXhlcykge1xuICAgICAgICBjb25zdCByYW5nZSA9IG1lc3NhZ2VSYW5nZVRyYWNrZXIuZ2V0Q3VycmVudFJhbmdlKG1lc3NhZ2UpO1xuICAgICAgICBpZiAocmFuZ2UgPT0gbnVsbCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGZpeGVzLnB1c2goey4uLm1lc3NhZ2UuZml4LCBvbGRSYW5nZTogcmFuZ2V9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3VjY2VlZGVkID1cbiAgICAgICAgbWVzc2FnZXNXaXRoRml4ZXMubGVuZ3RoID09PSBmaXhlcy5sZW5ndGggJiZcbiAgICAgICAgYXBwbHlUZXh0RWRpdHMoZmlsZVBhdGgsIC4uLmZpeGVzKTtcbiAgICAgIGlmIChzdWNjZWVkZWQpIHtcbiAgICAgICAgcmV0dXJuIEFjdGlvbnMuZml4ZXNBcHBsaWVkKGZpbGVQYXRoLCBuZXcgU2V0KG1lc3NhZ2VzV2l0aEZpeGVzKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gQWN0aW9ucy5maXhGYWlsZWQoKTtcbiAgICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vdGlmeU9mRml4RmFpbHVyZXMoXG4gIGFjdGlvbnM6IEFjdGlvbnNPYnNlcnZhYmxlPEFjdGlvbj4sXG4pOiBPYnNlcnZhYmxlPGVtcHR5PiB7XG4gIHJldHVybiBhY3Rpb25zXG4gICAgLm9mVHlwZShBY3Rpb25zLkZJWF9GQUlMRUQpXG4gICAgLmRvKCgpID0+IHtcbiAgICAgIGF0b20ubm90aWZpY2F0aW9ucy5hZGRXYXJuaW5nKFxuICAgICAgICAnRmFpbGVkIHRvIGFwcGx5IGZpeC4gVHJ5IHNhdmluZyB0byBnZXQgZnJlc2ggcmVzdWx0cyBhbmQgdGhlbiB0cnkgYWdhaW4uJyxcbiAgICAgICk7XG4gICAgfSlcbiAgICAuaWdub3JlRWxlbWVudHMoKTtcbn1cblxuZnVuY3Rpb24gZm9ya0pvaW5BcnJheTxUPihcbiAgc291cmNlczogQXJyYXk8T2JzZXJ2YWJsZTxUPiB8IFByb21pc2U8VD4+LFxuKTogT2JzZXJ2YWJsZTxBcnJheTxUPj4ge1xuICAvLyAkRmxvd0ZpeE1lOiBOZWVkcyBhIHNwZWNpYWxpemF0aW9uIGZvciBhcnJheXNcbiAgcmV0dXJuIE9ic2VydmFibGUuZm9ya0pvaW4oLi4uc291cmNlcyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmZXRjaENvZGVBY3Rpb25zKFxuICBhY3Rpb25zOiBBY3Rpb25zT2JzZXJ2YWJsZTxBY3Rpb24+LFxuICBzdG9yZTogU3RvcmUsXG4pOiBPYnNlcnZhYmxlPEFjdGlvbj4ge1xuICAvLyBUT0RPKGhhbnNvbncpOiBVbnRpbCB3ZSBoYXZlIGhhdmUgYSBVSSBmb3IgaXQsIG9ubHkgaGFuZGxlIG9uZSByZXF1ZXN0IGF0IGEgdGltZS5cbiAgcmV0dXJuIGFjdGlvbnMub2ZUeXBlKEFjdGlvbnMuRkVUQ0hfQ09ERV9BQ1RJT05TKS5zd2l0Y2hNYXAoYWN0aW9uID0+IHtcbiAgICBpbnZhcmlhbnQoYWN0aW9uLnR5cGUgPT09IEFjdGlvbnMuRkVUQ0hfQ09ERV9BQ1RJT05TKTtcbiAgICBjb25zdCB7Y29kZUFjdGlvbkZldGNoZXJ9ID0gc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICBpZiAoY29kZUFjdGlvbkZldGNoZXIgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIE9ic2VydmFibGUuZW1wdHkoKTtcbiAgICB9XG4gICAgY29uc3Qge21lc3NhZ2VzLCBlZGl0b3J9ID0gYWN0aW9uLnBheWxvYWQ7XG4gICAgcmV0dXJuIGZvcmtKb2luQXJyYXkoXG4gICAgICBtZXNzYWdlcy5tYXAobWVzc2FnZSA9PlxuICAgICAgICBPYnNlcnZhYmxlLmRlZmVyKCgpID0+XG4gICAgICAgICAgY29kZUFjdGlvbkZldGNoZXIuZ2V0Q29kZUFjdGlvbkZvckRpYWdub3N0aWMobWVzc2FnZSwgZWRpdG9yKSxcbiAgICAgICAgKVxuICAgICAgICAgIC5zd2l0Y2hNYXAoY29kZUFjdGlvbnMgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGNvZGVBY3Rpb25zLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgICA/IC8vIGZvcmtKb2luIGVtaXRzIG5vdGhpbmcgZm9yIGVtcHR5IGFycmF5cy5cbiAgICAgICAgICAgICAgICBPYnNlcnZhYmxlLm9mKFtdKVxuICAgICAgICAgICAgICA6IGZvcmtKb2luQXJyYXkoXG4gICAgICAgICAgICAgICAgICAvLyBFYWdlcmx5IGZldGNoIHRoZSB0aXRsZXMgc28gdGhhdCB0aGV5J3JlIGltbWVkaWF0ZWx5IHVzYWJsZSBpbiBhIFVJLlxuICAgICAgICAgICAgICAgICAgY29kZUFjdGlvbnMubWFwKGFzeW5jIGNvZGVBY3Rpb24gPT4gW1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBjb2RlQWN0aW9uLmdldFRpdGxlKCksXG4gICAgICAgICAgICAgICAgICAgIGNvZGVBY3Rpb24sXG4gICAgICAgICAgICAgICAgICBdKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLm1hcChjb2RlQWN0aW9ucyA9PiBbbWVzc2FnZSwgbmV3IE1hcChjb2RlQWN0aW9ucyldKSxcbiAgICAgICksXG4gICAgKVxuICAgICAgLm1hcChjb2RlQWN0aW9uc0Zvck1lc3NhZ2UgPT5cbiAgICAgICAgQWN0aW9ucy5zZXRDb2RlQWN0aW9ucyhuZXcgTWFwKGNvZGVBY3Rpb25zRm9yTWVzc2FnZSkpLFxuICAgICAgKVxuICAgICAgLmNhdGNoKGVyciA9PiB7XG4gICAgICAgIGdldExvZ2dlcignYXRvbS1pZGUtZGlhZ25vc3RpY3MnKS5lcnJvcihcbiAgICAgICAgICBgRXJyb3IgZmV0Y2hpbmcgY29kZSBhY3Rpb25zIGZvciAke21lc3NhZ2VzWzBdLmZpbGVQYXRofWAsXG4gICAgICAgICAgZXJyLFxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5lbXB0eSgpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuIl19