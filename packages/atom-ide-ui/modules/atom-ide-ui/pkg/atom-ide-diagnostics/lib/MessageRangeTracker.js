'use strict';

var cov_h754oyl8c = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-diagnostics/lib/MessageRangeTracker.js',
      hash = '130ca581184361c70f91e26cefa253ae82dedef2',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-diagnostics/lib/MessageRangeTracker.js',
    statementMap: {
      '0': {
        start: {
          line: 42,
          column: 4
        },
        end: {
          line: 42,
          column: 38
        }
      },
      '1': {
        start: {
          line: 43,
          column: 4
        },
        end: {
          line: 43,
          column: 42
        }
      },
      '2': {
        start: {
          line: 45,
          column: 4
        },
        end: {
          line: 67,
          column: 6
        }
      },
      '3': {
        start: {
          line: 47,
          column: 21
        },
        end: {
          line: 47,
          column: 37
        }
      },
      '4': {
        start: {
          line: 48,
          column: 8
        },
        end: {
          line: 50,
          column: 9
        }
      },
      '5': {
        start: {
          line: 49,
          column: 10
        },
        end: {
          line: 49,
          column: 17
        }
      },
      '6': {
        start: {
          line: 51,
          column: 32
        },
        end: {
          line: 51,
          column: 62
        }
      },
      '7': {
        start: {
          line: 52,
          column: 8
        },
        end: {
          line: 58,
          column: 9
        }
      },
      '8': {
        start: {
          line: 55,
          column: 10
        },
        end: {
          line: 57,
          column: 11
        }
      },
      '9': {
        start: {
          line: 56,
          column: 12
        },
        end: {
          line: 56,
          column: 45
        }
      },
      '10': {
        start: {
          line: 61,
          column: 8
        },
        end: {
          line: 63,
          column: 9
        }
      },
      '11': {
        start: {
          line: 62,
          column: 10
        },
        end: {
          line: 62,
          column: 27
        }
      },
      '12': {
        start: {
          line: 64,
          column: 8
        },
        end: {
          line: 64,
          column: 37
        }
      },
      '13': {
        start: {
          line: 65,
          column: 8
        },
        end: {
          line: 65,
          column: 38
        }
      },
      '14': {
        start: {
          line: 71,
          column: 4
        },
        end: {
          line: 71,
          column: 32
        }
      },
      '15': {
        start: {
          line: 76,
          column: 4
        },
        end: {
          line: 76,
          column: 30
        }
      },
      '16': {
        start: {
          line: 77,
          column: 19
        },
        end: {
          line: 77,
          column: 53
        }
      },
      '17': {
        start: {
          line: 79,
          column: 4
        },
        end: {
          line: 83,
          column: 5
        }
      },
      '18': {
        start: {
          line: 80,
          column: 6
        },
        end: {
          line: 80,
          column: 37
        }
      },
      '19': {
        start: {
          line: 82,
          column: 6
        },
        end: {
          line: 82,
          column: 18
        }
      },
      '20': {
        start: {
          line: 87,
          column: 4
        },
        end: {
          line: 87,
          column: 30
        }
      },
      '21': {
        start: {
          line: 89,
          column: 4
        },
        end: {
          line: 106,
          column: 5
        }
      },
      '22': {
        start: {
          line: 90,
          column: 6
        },
        end: {
          line: 90,
          column: 37
        }
      },
      '23': {
        start: {
          line: 91,
          column: 6
        },
        end: {
          line: 91,
          column: 58
        }
      },
      '24': {
        start: {
          line: 100,
          column: 28
        },
        end: {
          line: 102,
          column: 67
        }
      },
      '25': {
        start: {
          line: 102,
          column: 26
        },
        end: {
          line: 102,
          column: 63
        }
      },
      '26': {
        start: {
          line: 103,
          column: 6
        },
        end: {
          line: 105,
          column: 7
        }
      },
      '27': {
        start: {
          line: 104,
          column: 8
        },
        end: {
          line: 104,
          column: 48
        }
      },
      '28': {
        start: {
          line: 111,
          column: 4
        },
        end: {
          line: 111,
          column: 30
        }
      },
      '29': {
        start: {
          line: 113,
          column: 4
        },
        end: {
          line: 122,
          column: 5
        }
      },
      '30': {
        start: {
          line: 114,
          column: 6
        },
        end: {
          line: 114,
          column: 61
        }
      },
      '31': {
        start: {
          line: 116,
          column: 21
        },
        end: {
          line: 116,
          column: 55
        }
      },
      '32': {
        start: {
          line: 117,
          column: 6
        },
        end: {
          line: 121,
          column: 7
        }
      },
      '33': {
        start: {
          line: 120,
          column: 8
        },
        end: {
          line: 120,
          column: 25
        }
      },
      '34': {
        start: {
          line: 126,
          column: 16
        },
        end: {
          line: 126,
          column: 27
        }
      },
      '35': {
        start: {
          line: 127,
          column: 4
        },
        end: {
          line: 127,
          column: 27
        }
      },
      '36': {
        start: {
          line: 129,
          column: 19
        },
        end: {
          line: 135,
          column: 6
        }
      },
      '37': {
        start: {
          line: 136,
          column: 4
        },
        end: {
          line: 136,
          column: 47
        }
      },
      '38': {
        start: {
          line: 140,
          column: 31
        },
        end: {
          line: 144,
          column: 6
        }
      },
      '39': {
        start: {
          line: 141,
          column: 6
        },
        end: {
          line: 141,
          column: 44
        }
      },
      '40': {
        start: {
          line: 142,
          column: 6
        },
        end: {
          line: 142,
          column: 35
        }
      },
      '41': {
        start: {
          line: 143,
          column: 6
        },
        end: {
          line: 143,
          column: 51
        }
      },
      '42': {
        start: {
          line: 145,
          column: 4
        },
        end: {
          line: 145,
          column: 46
        }
      },
      '43': {
        start: {
          line: 149,
          column: 4
        },
        end: {
          line: 152,
          column: 6
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 41,
            column: 2
          },
          end: {
            line: 41,
            column: 3
          }
        },
        loc: {
          start: {
            line: 41,
            column: 16
          },
          end: {
            line: 68,
            column: 3
          }
        },
        line: 41
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 46,
            column: 25
          },
          end: {
            line: 46,
            column: 26
          }
        },
        loc: {
          start: {
            line: 46,
            column: 35
          },
          end: {
            line: 59,
            column: 7
          }
        },
        line: 46
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 60,
            column: 6
          },
          end: {
            line: 60,
            column: 7
          }
        },
        loc: {
          start: {
            line: 60,
            column: 12
          },
          end: {
            line: 66,
            column: 7
          }
        },
        line: 60
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 70,
            column: 2
          },
          end: {
            line: 70,
            column: 3
          }
        },
        loc: {
          start: {
            line: 70,
            column: 18
          },
          end: {
            line: 72,
            column: 3
          }
        },
        line: 70
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 75,
            column: 2
          },
          end: {
            line: 75,
            column: 3
          }
        },
        loc: {
          start: {
            line: 75,
            column: 63
          },
          end: {
            line: 84,
            column: 3
          }
        },
        line: 75
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 86,
            column: 2
          },
          end: {
            line: 86,
            column: 3
          }
        },
        loc: {
          start: {
            line: 86,
            column: 67
          },
          end: {
            line: 107,
            column: 3
          }
        },
        line: 86
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 102,
            column: 16
          },
          end: {
            line: 102,
            column: 17
          }
        },
        loc: {
          start: {
            line: 102,
            column: 26
          },
          end: {
            line: 102,
            column: 63
          }
        },
        line: 102
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 110,
            column: 2
          },
          end: {
            line: 110,
            column: 3
          }
        },
        loc: {
          start: {
            line: 110,
            column: 70
          },
          end: {
            line: 123,
            column: 3
          }
        },
        line: 110
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 125,
            column: 2
          },
          end: {
            line: 125,
            column: 3
          }
        },
        loc: {
          start: {
            line: 125,
            column: 76
          },
          end: {
            line: 146,
            column: 3
          }
        },
        line: 125
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 140,
            column: 51
          },
          end: {
            line: 140,
            column: 52
          }
        },
        loc: {
          start: {
            line: 140,
            column: 57
          },
          end: {
            line: 144,
            column: 5
          }
        },
        line: 140
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 148,
            column: 2
          },
          end: {
            line: 148,
            column: 3
          }
        },
        loc: {
          start: {
            line: 148,
            column: 29
          },
          end: {
            line: 153,
            column: 3
          }
        },
        line: 148
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 48,
            column: 8
          },
          end: {
            line: 50,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 48,
            column: 8
          },
          end: {
            line: 50,
            column: 9
          }
        }, {
          start: {
            line: 48,
            column: 8
          },
          end: {
            line: 50,
            column: 9
          }
        }],
        line: 48
      },
      '1': {
        loc: {
          start: {
            line: 55,
            column: 10
          },
          end: {
            line: 57,
            column: 11
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 55,
            column: 10
          },
          end: {
            line: 57,
            column: 11
          }
        }, {
          start: {
            line: 55,
            column: 10
          },
          end: {
            line: 57,
            column: 11
          }
        }],
        line: 55
      },
      '2': {
        loc: {
          start: {
            line: 79,
            column: 4
          },
          end: {
            line: 83,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 79,
            column: 4
          },
          end: {
            line: 83,
            column: 5
          }
        }, {
          start: {
            line: 79,
            column: 4
          },
          end: {
            line: 83,
            column: 5
          }
        }],
        line: 79
      },
      '3': {
        loc: {
          start: {
            line: 79,
            column: 8
          },
          end: {
            line: 79,
            column: 42
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 79,
            column: 8
          },
          end: {
            line: 79,
            column: 22
          }
        }, {
          start: {
            line: 79,
            column: 26
          },
          end: {
            line: 79,
            column: 42
          }
        }],
        line: 79
      },
      '4': {
        loc: {
          start: {
            line: 103,
            column: 6
          },
          end: {
            line: 105,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 103,
            column: 6
          },
          end: {
            line: 105,
            column: 7
          }
        }, {
          start: {
            line: 103,
            column: 6
          },
          end: {
            line: 105,
            column: 7
          }
        }],
        line: 103
      },
      '5': {
        loc: {
          start: {
            line: 117,
            column: 6
          },
          end: {
            line: 121,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 117,
            column: 6
          },
          end: {
            line: 121,
            column: 7
          }
        }, {
          start: {
            line: 117,
            column: 6
          },
          end: {
            line: 121,
            column: 7
          }
        }],
        line: 117
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _UniversalDisposable;

function _load_UniversalDisposable() {
  return _UniversalDisposable = _interopRequireDefault(require('nuclide-commons/UniversalDisposable'));
}

var _textEditor;

function _load_textEditor() {
  return _textEditor = require('nuclide-commons-atom/text-editor');
}

var _collection;

function _load_collection() {
  return _collection = require('nuclide-commons/collection');
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * This class tracks the position of messages as the contents of the editor changes. It does this
 * using markers. Note that there's no visible change to the editor; the markers are just a means to
 * track ranges as surrounding lines change.
 */
/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

class MessageRangeTracker {

  /**
   * Stores all current markers, indexed by FileDiagnosticMessage.
   * invariant: No messages for closed files, no destroyed markers.
   */
  constructor() {
    cov_h754oyl8c.f[0]++;
    cov_h754oyl8c.s[0]++;

    this._messageToMarker = new Map();
    cov_h754oyl8c.s[1]++;
    this._fileToMessages = new (_collection || _load_collection()).MultiMap();

    cov_h754oyl8c.s[2]++;
    this._disposables = new (_UniversalDisposable || _load_UniversalDisposable()).default((0, (_textEditor || _load_textEditor()).observeTextEditors)(editor => {
      cov_h754oyl8c.f[1]++;

      const path = (cov_h754oyl8c.s[3]++, editor.getPath());
      cov_h754oyl8c.s[4]++;
      if (path == null) {
        cov_h754oyl8c.b[0][0]++;
        cov_h754oyl8c.s[5]++;

        return;
      } else {
        cov_h754oyl8c.b[0][1]++;
      }
      const messagesForPath = (cov_h754oyl8c.s[6]++, this._fileToMessages.get(path));
      cov_h754oyl8c.s[7]++;
      for (const message of messagesForPath) {
        cov_h754oyl8c.s[8]++;

        // There might already be a marker because there can be multiple TextEditors open for a
        // given file.
        if (!this._messageToMarker.has(message)) {
          cov_h754oyl8c.b[1][0]++;
          cov_h754oyl8c.s[9]++;

          this._addMarker(editor, message);
        } else {
          cov_h754oyl8c.b[1][1]++;
        }
      }
    }), () => {
      cov_h754oyl8c.f[2]++;
      cov_h754oyl8c.s[10]++;

      for (const marker of this._messageToMarker.values()) {
        cov_h754oyl8c.s[11]++;

        marker.destroy();
      }
      cov_h754oyl8c.s[12]++;
      this._fileToMessages.clear();
      cov_h754oyl8c.s[13]++;
      this._messageToMarker.clear();
    });
  }
  /**
   * Stores all current FileDiagnosticMessages, indexed by file. Includes those for files that are
   * not open.
   */


  dispose() {
    cov_h754oyl8c.f[3]++;
    cov_h754oyl8c.s[14]++;

    this._disposables.dispose();
  }

  /** Return a Range if the marker is still valid, otherwise return null */
  getCurrentRange(message) {
    cov_h754oyl8c.f[4]++;
    cov_h754oyl8c.s[15]++;

    this._assertNotDisposed();
    const marker = (cov_h754oyl8c.s[16]++, this._messageToMarker.get(message));

    cov_h754oyl8c.s[17]++;
    if ((cov_h754oyl8c.b[3][0]++, marker != null) && (cov_h754oyl8c.b[3][1]++, marker.isValid())) {
      cov_h754oyl8c.b[2][0]++;
      cov_h754oyl8c.s[18]++;

      return marker.getBufferRange();
    } else {
      cov_h754oyl8c.b[2][1]++;
      cov_h754oyl8c.s[19]++;

      return null;
    }
  }

  addFileMessages(messages) {
    cov_h754oyl8c.f[5]++;
    cov_h754oyl8c.s[20]++;

    this._assertNotDisposed();

    cov_h754oyl8c.s[21]++;
    for (const message of messages) {
      cov_h754oyl8c.s[22]++;

      if (!(message.fix != null)) {
        throw new Error('Invariant violation: "message.fix != null"');
      }

      cov_h754oyl8c.s[23]++;

      this._fileToMessages.add(message.filePath, message);

      // If the file is currently open, create a marker.

      // TODO If there is a long delay between when the file is saved and results appear, the file
      // may have changed in the mean time. Meaning that the markers we place here may be in the
      // wrong place already. Consider detecting such cases (perhaps with a checksum included in the
      // fix) and rejecting the fixes, since we can't accurately track their locations.

      const editorForFile = (cov_h754oyl8c.s[24]++, atom.workspace.getTextEditors().filter(editor => {
        cov_h754oyl8c.f[6]++;
        cov_h754oyl8c.s[25]++;
        return editor.getPath() === message.filePath;
      })[0]);
      cov_h754oyl8c.s[26]++;
      if (editorForFile != null) {
        cov_h754oyl8c.b[4][0]++;
        cov_h754oyl8c.s[27]++;

        this._addMarker(editorForFile, message);
      } else {
        cov_h754oyl8c.b[4][1]++;
      }
    }
  }

  /** Remove the given messages, if they are currently present */
  removeFileMessages(messages) {
    cov_h754oyl8c.f[7]++;
    cov_h754oyl8c.s[28]++;

    this._assertNotDisposed();

    cov_h754oyl8c.s[29]++;
    for (const message of messages) {
      cov_h754oyl8c.s[30]++;

      this._fileToMessages.delete(message.filePath, message);

      const marker = (cov_h754oyl8c.s[31]++, this._messageToMarker.get(message));
      cov_h754oyl8c.s[32]++;
      if (marker != null) {
        cov_h754oyl8c.b[5][0]++;
        cov_h754oyl8c.s[33]++;

        // No need to remove from the set explicitly since we do that on the marker's onDidDestroy
        // handler.
        marker.destroy();
      } else {
        cov_h754oyl8c.b[5][1]++;
      }
    }
  }

  _addMarker(editor, message) {
    cov_h754oyl8c.f[8]++;

    const fix = (cov_h754oyl8c.s[34]++, message.fix);
    cov_h754oyl8c.s[35]++;

    if (!(fix != null)) {
      throw new Error('Invariant violation: "fix != null"');
    }

    const marker = (cov_h754oyl8c.s[36]++, editor.markBufferRange(fix.oldRange, {
      // 'touch' is the least permissive invalidation strategy: It will invalidate for
      // changes that touch the marked region in any way. We want to invalidate
      // aggressively because an incorrect fix application is far worse than a failed
      // application.
      invalidate: 'touch'
    }));
    cov_h754oyl8c.s[37]++;
    this._messageToMarker.set(message, marker);

    // The marker will be destroyed automatically when its associated TextBuffer is destroyed. Clean
    // up when that happens.
    const markerSubscription = (cov_h754oyl8c.s[38]++, marker.onDidDestroy(() => {
      cov_h754oyl8c.f[9]++;
      cov_h754oyl8c.s[39]++;

      this._messageToMarker.delete(message);
      cov_h754oyl8c.s[40]++;
      markerSubscription.dispose();
      cov_h754oyl8c.s[41]++;
      this._disposables.remove(markerSubscription);
    }));
    cov_h754oyl8c.s[42]++;
    this._disposables.add(markerSubscription);
  }

  _assertNotDisposed() {
    cov_h754oyl8c.f[10]++;
    cov_h754oyl8c.s[43]++;

    if (!!this._disposables.disposed) {
      throw new Error(`${this.constructor.name} has been disposed`);
    }
  }
}
exports.default = MessageRangeTracker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lc3NhZ2VSYW5nZVRyYWNrZXIuanMiXSwibmFtZXMiOlsiTWVzc2FnZVJhbmdlVHJhY2tlciIsImNvbnN0cnVjdG9yIiwiX21lc3NhZ2VUb01hcmtlciIsIk1hcCIsIl9maWxlVG9NZXNzYWdlcyIsIl9kaXNwb3NhYmxlcyIsImVkaXRvciIsInBhdGgiLCJnZXRQYXRoIiwibWVzc2FnZXNGb3JQYXRoIiwiZ2V0IiwibWVzc2FnZSIsImhhcyIsIl9hZGRNYXJrZXIiLCJtYXJrZXIiLCJ2YWx1ZXMiLCJkZXN0cm95IiwiY2xlYXIiLCJkaXNwb3NlIiwiZ2V0Q3VycmVudFJhbmdlIiwiX2Fzc2VydE5vdERpc3Bvc2VkIiwiaXNWYWxpZCIsImdldEJ1ZmZlclJhbmdlIiwiYWRkRmlsZU1lc3NhZ2VzIiwibWVzc2FnZXMiLCJmaXgiLCJhZGQiLCJmaWxlUGF0aCIsImVkaXRvckZvckZpbGUiLCJhdG9tIiwid29ya3NwYWNlIiwiZ2V0VGV4dEVkaXRvcnMiLCJmaWx0ZXIiLCJyZW1vdmVGaWxlTWVzc2FnZXMiLCJkZWxldGUiLCJtYXJrQnVmZmVyUmFuZ2UiLCJvbGRSYW5nZSIsImludmFsaWRhdGUiLCJzZXQiLCJtYXJrZXJTdWJzY3JpcHRpb24iLCJvbkRpZERlc3Ryb3kiLCJyZW1vdmUiLCJkaXNwb3NlZCIsIm5hbWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWdCQTtBQUFBO0FBQUE7Ozs7QUFDQTtBQUFBO0FBQUE7Ozs7QUFDQTtBQUFBO0FBQUE7Ozs7QUFFQTs7Ozs7QUFwQkE7Ozs7Ozs7Ozs7OztBQXlCZSxNQUFNQSxtQkFBTixDQUEwQjs7QUFPdkM7Ozs7QUFRQUMsZ0JBQWM7QUFBQTtBQUFBOztBQUNaLFNBQUtDLGdCQUFMLEdBQXdCLElBQUlDLEdBQUosRUFBeEI7QUFEWTtBQUVa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YykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQgdHlwZSB7RmlsZURpYWdub3N0aWNNZXNzYWdlfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB0eXBlIHtOdWNsaWRlVXJpfSBmcm9tICdudWNsaWRlLWNvbW1vbnMvbnVjbGlkZVVyaSc7XG5cbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAnYXNzZXJ0JztcbmltcG9ydCBVbml2ZXJzYWxEaXNwb3NhYmxlIGZyb20gJ251Y2xpZGUtY29tbW9ucy9Vbml2ZXJzYWxEaXNwb3NhYmxlJztcbmltcG9ydCB7b2JzZXJ2ZVRleHRFZGl0b3JzfSBmcm9tICdudWNsaWRlLWNvbW1vbnMtYXRvbS90ZXh0LWVkaXRvcic7XG5pbXBvcnQge011bHRpTWFwfSBmcm9tICdudWNsaWRlLWNvbW1vbnMvY29sbGVjdGlvbic7XG5cbi8qKlxuICogVGhpcyBjbGFzcyB0cmFja3MgdGhlIHBvc2l0aW9uIG9mIG1lc3NhZ2VzIGFzIHRoZSBjb250ZW50cyBvZiB0aGUgZWRpdG9yIGNoYW5nZXMuIEl0IGRvZXMgdGhpc1xuICogdXNpbmcgbWFya2Vycy4gTm90ZSB0aGF0IHRoZXJlJ3Mgbm8gdmlzaWJsZSBjaGFuZ2UgdG8gdGhlIGVkaXRvcjsgdGhlIG1hcmtlcnMgYXJlIGp1c3QgYSBtZWFucyB0b1xuICogdHJhY2sgcmFuZ2VzIGFzIHN1cnJvdW5kaW5nIGxpbmVzIGNoYW5nZS5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTWVzc2FnZVJhbmdlVHJhY2tlciB7XG4gIC8qKlxuICAgKiBTdG9yZXMgYWxsIGN1cnJlbnQgRmlsZURpYWdub3N0aWNNZXNzYWdlcywgaW5kZXhlZCBieSBmaWxlLiBJbmNsdWRlcyB0aG9zZSBmb3IgZmlsZXMgdGhhdCBhcmVcbiAgICogbm90IG9wZW4uXG4gICAqL1xuICBfZmlsZVRvTWVzc2FnZXM6IE11bHRpTWFwPE51Y2xpZGVVcmksIEZpbGVEaWFnbm9zdGljTWVzc2FnZT47XG5cbiAgLyoqXG4gICAqIFN0b3JlcyBhbGwgY3VycmVudCBtYXJrZXJzLCBpbmRleGVkIGJ5IEZpbGVEaWFnbm9zdGljTWVzc2FnZS5cbiAgICogaW52YXJpYW50OiBObyBtZXNzYWdlcyBmb3IgY2xvc2VkIGZpbGVzLCBubyBkZXN0cm95ZWQgbWFya2Vycy5cbiAgICovXG4gIF9tZXNzYWdlVG9NYXJrZXI6IE1hcDxGaWxlRGlhZ25vc3RpY01lc3NhZ2UsIGF0b20kTWFya2VyPjtcblxuICBfZGlzcG9zYWJsZXM6IFVuaXZlcnNhbERpc3Bvc2FibGU7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5fbWVzc2FnZVRvTWFya2VyID0gbmV3IE1hcCgpO1xuICAgIHRoaXMuX2ZpbGVUb01lc3NhZ2VzID0gbmV3IE11bHRpTWFwKCk7XG5cbiAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKFxuICAgICAgb2JzZXJ2ZVRleHRFZGl0b3JzKGVkaXRvciA9PiB7XG4gICAgICAgIGNvbnN0IHBhdGggPSBlZGl0b3IuZ2V0UGF0aCgpO1xuICAgICAgICBpZiAocGF0aCA9PSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzRm9yUGF0aCA9IHRoaXMuX2ZpbGVUb01lc3NhZ2VzLmdldChwYXRoKTtcbiAgICAgICAgZm9yIChjb25zdCBtZXNzYWdlIG9mIG1lc3NhZ2VzRm9yUGF0aCkge1xuICAgICAgICAgIC8vIFRoZXJlIG1pZ2h0IGFscmVhZHkgYmUgYSBtYXJrZXIgYmVjYXVzZSB0aGVyZSBjYW4gYmUgbXVsdGlwbGUgVGV4dEVkaXRvcnMgb3BlbiBmb3IgYVxuICAgICAgICAgIC8vIGdpdmVuIGZpbGUuXG4gICAgICAgICAgaWYgKCF0aGlzLl9tZXNzYWdlVG9NYXJrZXIuaGFzKG1lc3NhZ2UpKSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRNYXJrZXIoZWRpdG9yLCBtZXNzYWdlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAgKCkgPT4ge1xuICAgICAgICBmb3IgKGNvbnN0IG1hcmtlciBvZiB0aGlzLl9tZXNzYWdlVG9NYXJrZXIudmFsdWVzKCkpIHtcbiAgICAgICAgICBtYXJrZXIuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2ZpbGVUb01lc3NhZ2VzLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuX21lc3NhZ2VUb01hcmtlci5jbGVhcigpO1xuICAgICAgfSxcbiAgICApO1xuICB9XG5cbiAgZGlzcG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5kaXNwb3NlKCk7XG4gIH1cblxuICAvKiogUmV0dXJuIGEgUmFuZ2UgaWYgdGhlIG1hcmtlciBpcyBzdGlsbCB2YWxpZCwgb3RoZXJ3aXNlIHJldHVybiBudWxsICovXG4gIGdldEN1cnJlbnRSYW5nZShtZXNzYWdlOiBGaWxlRGlhZ25vc3RpY01lc3NhZ2UpOiA/YXRvbSRSYW5nZSB7XG4gICAgdGhpcy5fYXNzZXJ0Tm90RGlzcG9zZWQoKTtcbiAgICBjb25zdCBtYXJrZXIgPSB0aGlzLl9tZXNzYWdlVG9NYXJrZXIuZ2V0KG1lc3NhZ2UpO1xuXG4gICAgaWYgKG1hcmtlciAhPSBudWxsICYmIG1hcmtlci5pc1ZhbGlkKCkpIHtcbiAgICAgIHJldHVybiBtYXJrZXIuZ2V0QnVmZmVyUmFuZ2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgYWRkRmlsZU1lc3NhZ2VzKG1lc3NhZ2VzOiBJdGVyYWJsZTxGaWxlRGlhZ25vc3RpY01lc3NhZ2U+KTogdm9pZCB7XG4gICAgdGhpcy5fYXNzZXJ0Tm90RGlzcG9zZWQoKTtcblxuICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcykge1xuICAgICAgaW52YXJpYW50KG1lc3NhZ2UuZml4ICE9IG51bGwpO1xuICAgICAgdGhpcy5fZmlsZVRvTWVzc2FnZXMuYWRkKG1lc3NhZ2UuZmlsZVBhdGgsIG1lc3NhZ2UpO1xuXG4gICAgICAvLyBJZiB0aGUgZmlsZSBpcyBjdXJyZW50bHkgb3BlbiwgY3JlYXRlIGEgbWFya2VyLlxuXG4gICAgICAvLyBUT0RPIElmIHRoZXJlIGlzIGEgbG9uZyBkZWxheSBiZXR3ZWVuIHdoZW4gdGhlIGZpbGUgaXMgc2F2ZWQgYW5kIHJlc3VsdHMgYXBwZWFyLCB0aGUgZmlsZVxuICAgICAgLy8gbWF5IGhhdmUgY2hhbmdlZCBpbiB0aGUgbWVhbiB0aW1lLiBNZWFuaW5nIHRoYXQgdGhlIG1hcmtlcnMgd2UgcGxhY2UgaGVyZSBtYXkgYmUgaW4gdGhlXG4gICAgICAvLyB3cm9uZyBwbGFjZSBhbHJlYWR5LiBDb25zaWRlciBkZXRlY3Rpbmcgc3VjaCBjYXNlcyAocGVyaGFwcyB3aXRoIGEgY2hlY2tzdW0gaW5jbHVkZWQgaW4gdGhlXG4gICAgICAvLyBmaXgpIGFuZCByZWplY3RpbmcgdGhlIGZpeGVzLCBzaW5jZSB3ZSBjYW4ndCBhY2N1cmF0ZWx5IHRyYWNrIHRoZWlyIGxvY2F0aW9ucy5cblxuICAgICAgY29uc3QgZWRpdG9yRm9yRmlsZSA9IGF0b20ud29ya3NwYWNlXG4gICAgICAgIC5nZXRUZXh0RWRpdG9ycygpXG4gICAgICAgIC5maWx0ZXIoZWRpdG9yID0+IGVkaXRvci5nZXRQYXRoKCkgPT09IG1lc3NhZ2UuZmlsZVBhdGgpWzBdO1xuICAgICAgaWYgKGVkaXRvckZvckZpbGUgIT0gbnVsbCkge1xuICAgICAgICB0aGlzLl9hZGRNYXJrZXIoZWRpdG9yRm9yRmlsZSwgbWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqIFJlbW92ZSB0aGUgZ2l2ZW4gbWVzc2FnZXMsIGlmIHRoZXkgYXJlIGN1cnJlbnRseSBwcmVzZW50ICovXG4gIHJlbW92ZUZpbGVNZXNzYWdlcyhtZXNzYWdlczogSXRlcmFibGU8RmlsZURpYWdub3N0aWNNZXNzYWdlPik6IHZvaWQge1xuICAgIHRoaXMuX2Fzc2VydE5vdERpc3Bvc2VkKCk7XG5cbiAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgbWVzc2FnZXMpIHtcbiAgICAgIHRoaXMuX2ZpbGVUb01lc3NhZ2VzLmRlbGV0ZShtZXNzYWdlLmZpbGVQYXRoLCBtZXNzYWdlKTtcblxuICAgICAgY29uc3QgbWFya2VyID0gdGhpcy5fbWVzc2FnZVRvTWFya2VyLmdldChtZXNzYWdlKTtcbiAgICAgIGlmIChtYXJrZXIgIT0gbnVsbCkge1xuICAgICAgICAvLyBObyBuZWVkIHRvIHJlbW92ZSBmcm9tIHRoZSBzZXQgZXhwbGljaXRseSBzaW5jZSB3ZSBkbyB0aGF0IG9uIHRoZSBtYXJrZXIncyBvbkRpZERlc3Ryb3lcbiAgICAgICAgLy8gaGFuZGxlci5cbiAgICAgICAgbWFya2VyLmRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfYWRkTWFya2VyKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLCBtZXNzYWdlOiBGaWxlRGlhZ25vc3RpY01lc3NhZ2UpOiB2b2lkIHtcbiAgICBjb25zdCBmaXggPSBtZXNzYWdlLmZpeDtcbiAgICBpbnZhcmlhbnQoZml4ICE9IG51bGwpO1xuXG4gICAgY29uc3QgbWFya2VyID0gZWRpdG9yLm1hcmtCdWZmZXJSYW5nZShmaXgub2xkUmFuZ2UsIHtcbiAgICAgIC8vICd0b3VjaCcgaXMgdGhlIGxlYXN0IHBlcm1pc3NpdmUgaW52YWxpZGF0aW9uIHN0cmF0ZWd5OiBJdCB3aWxsIGludmFsaWRhdGUgZm9yXG4gICAgICAvLyBjaGFuZ2VzIHRoYXQgdG91Y2ggdGhlIG1hcmtlZCByZWdpb24gaW4gYW55IHdheS4gV2Ugd2FudCB0byBpbnZhbGlkYXRlXG4gICAgICAvLyBhZ2dyZXNzaXZlbHkgYmVjYXVzZSBhbiBpbmNvcnJlY3QgZml4IGFwcGxpY2F0aW9uIGlzIGZhciB3b3JzZSB0aGFuIGEgZmFpbGVkXG4gICAgICAvLyBhcHBsaWNhdGlvbi5cbiAgICAgIGludmFsaWRhdGU6ICd0b3VjaCcsXG4gICAgfSk7XG4gICAgdGhpcy5fbWVzc2FnZVRvTWFya2VyLnNldChtZXNzYWdlLCBtYXJrZXIpO1xuXG4gICAgLy8gVGhlIG1hcmtlciB3aWxsIGJlIGRlc3Ryb3llZCBhdXRvbWF0aWNhbGx5IHdoZW4gaXRzIGFzc29jaWF0ZWQgVGV4dEJ1ZmZlciBpcyBkZXN0cm95ZWQuIENsZWFuXG4gICAgLy8gdXAgd2hlbiB0aGF0IGhhcHBlbnMuXG4gICAgY29uc3QgbWFya2VyU3Vic2NyaXB0aW9uID0gbWFya2VyLm9uRGlkRGVzdHJveSgoKSA9PiB7XG4gICAgICB0aGlzLl9tZXNzYWdlVG9NYXJrZXIuZGVsZXRlKG1lc3NhZ2UpO1xuICAgICAgbWFya2VyU3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcbiAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzLnJlbW92ZShtYXJrZXJTdWJzY3JpcHRpb24pO1xuICAgIH0pO1xuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmFkZChtYXJrZXJTdWJzY3JpcHRpb24pO1xuICB9XG5cbiAgX2Fzc2VydE5vdERpc3Bvc2VkKCk6IHZvaWQge1xuICAgIGludmFyaWFudChcbiAgICAgICF0aGlzLl9kaXNwb3NhYmxlcy5kaXNwb3NlZCxcbiAgICAgIGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0gaGFzIGJlZW4gZGlzcG9zZWRgLFxuICAgICk7XG4gIH1cbn1cbiJdfQ==