'use strict';

var cov_1cyvd4gbte = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-outline-view/lib/createOutlines.js',
      hash = '723af6bddb56d692c3a306a974333da2419af19b',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-outline-view/lib/createOutlines.js',
    statementMap: {
      '0': {
        start: {
          line: 30,
          column: 25
        },
        end: {
          line: 30,
          column: 28
        }
      },
      '1': {
        start: {
          line: 86,
          column: 2
        },
        end: {
          line: 86,
          column: 70
        }
      },
      '2': {
        start: {
          line: 92,
          column: 2
        },
        end: {
          line: 92,
          column: 56
        }
      },
      '3': {
        start: {
          line: 98,
          column: 2
        },
        end: {
          line: 125,
          column: 3
        }
      },
      '4': {
        start: {
          line: 100,
          column: 6
        },
        end: {
          line: 100,
          column: 54
        }
      },
      '5': {
        start: {
          line: 102,
          column: 6
        },
        end: {
          line: 105,
          column: 9
        }
      },
      '6': {
        start: {
          line: 110,
          column: 6
        },
        end: {
          line: 112,
          column: 8
        }
      },
      '7': {
        start: {
          line: 114,
          column: 22
        },
        end: {
          line: 114,
          column: 35
        }
      },
      '8': {
        start: {
          line: 115,
          column: 6
        },
        end: {
          line: 117,
          column: 7
        }
      },
      '9': {
        start: {
          line: 116,
          column: 8
        },
        end: {
          line: 116,
          column: 60
        }
      },
      '10': {
        start: {
          line: 118,
          column: 6
        },
        end: {
          line: 118,
          column: 57
        }
      },
      '11': {
        start: {
          line: 120,
          column: 6
        },
        end: {
          line: 120,
          column: 58
        }
      },
      '12': {
        start: {
          line: 124,
          column: 6
        },
        end: {
          line: 124,
          column: 32
        }
      },
      '13': {
        start: {
          line: 132,
          column: 19
        },
        end: {
          line: 132,
          column: 70
        }
      },
      '14': {
        start: {
          line: 133,
          column: 23
        },
        end: {
          line: 139,
          column: 3
        }
      },
      '15': {
        start: {
          line: 136,
          column: 6
        },
        end: {
          line: 136,
          column: 50
        }
      },
      '16': {
        start: {
          line: 141,
          column: 2
        },
        end: {
          line: 143,
          column: 4
        }
      },
      '17': {
        start: {
          line: 142,
          column: 4
        },
        end: {
          line: 142,
          column: 54
        }
      },
      '18': {
        start: {
          line: 150,
          column: 20
        },
        end: {
          line: 150,
          column: 70
        }
      },
      '19': {
        start: {
          line: 151,
          column: 2
        },
        end: {
          line: 162,
          column: 4
        }
      },
      '20': {
        start: {
          line: 161,
          column: 47
        },
        end: {
          line: 161,
          column: 75
        }
      },
      '21': {
        start: {
          line: 171,
          column: 2
        },
        end: {
          line: 171,
          column: 40
        }
      },
      '22': {
        start: {
          line: 173,
          column: 2
        },
        end: {
          line: 179,
          column: 4
        }
      },
      '23': {
        start: {
          line: 188,
          column: 16
        },
        end: {
          line: 188,
          column: 21
        }
      },
      '24': {
        start: {
          line: 189,
          column: 19
        },
        end: {
          line: 201,
          column: 4
        }
      },
      '25': {
        start: {
          line: 190,
          column: 24
        },
        end: {
          line: 190,
          column: 65
        }
      },
      '26': {
        start: {
          line: 191,
          column: 21
        },
        end: {
          line: 191,
          column: 79
        }
      },
      '27': {
        start: {
          line: 192,
          column: 4
        },
        end: {
          line: 194,
          column: 5
        }
      },
      '28': {
        start: {
          line: 193,
          column: 6
        },
        end: {
          line: 193,
          column: 18
        }
      },
      '29': {
        start: {
          line: 195,
          column: 4
        },
        end: {
          line: 195,
          column: 19
        }
      },
      '30': {
        start: {
          line: 196,
          column: 4
        },
        end: {
          line: 200,
          column: 6
        }
      },
      '31': {
        start: {
          line: 202,
          column: 2
        },
        end: {
          line: 202,
          column: 43
        }
      },
      '32': {
        start: {
          line: 209,
          column: 24
        },
        end: {
          line: 209,
          column: 49
        }
      },
      '33': {
        start: {
          line: 210,
          column: 22
        },
        end: {
          line: 210,
          column: 45
        }
      },
      '34': {
        start: {
          line: 211,
          column: 2
        },
        end: {
          line: 213,
          column: 3
        }
      },
      '35': {
        start: {
          line: 212,
          column: 4
        },
        end: {
          line: 212,
          column: 17
        }
      },
      '36': {
        start: {
          line: 214,
          column: 2
        },
        end: {
          line: 223,
          column: 3
        }
      },
      '37': {
        start: {
          line: 215,
          column: 31
        },
        end: {
          line: 215,
          column: 68
        }
      },
      '38': {
        start: {
          line: 219,
          column: 4
        },
        end: {
          line: 222,
          column: 6
        }
      },
      '39': {
        start: {
          line: 224,
          column: 2
        },
        end: {
          line: 227,
          column: 4
        }
      }
    },
    fnMap: {
      '0': {
        name: 'createOutlines',
        decl: {
          start: {
            line: 83,
            column: 16
          },
          end: {
            line: 83,
            column: 30
          }
        },
        loc: {
          start: {
            line: 85,
            column: 28
          },
          end: {
            line: 87,
            column: 1
          }
        },
        line: 85
      },
      '1': {
        name: 'outlinesForProviderResults',
        decl: {
          start: {
            line: 89,
            column: 9
          },
          end: {
            line: 89,
            column: 35
          }
        },
        loc: {
          start: {
            line: 91,
            column: 28
          },
          end: {
            line: 93,
            column: 1
          }
        },
        line: 91
      },
      '2': {
        name: 'uiOutlinesForResult',
        decl: {
          start: {
            line: 95,
            column: 9
          },
          end: {
            line: 95,
            column: 28
          }
        },
        loc: {
          start: {
            line: 97,
            column: 28
          },
          end: {
            line: 126,
            column: 1
          }
        },
        line: 97
      },
      '3': {
        name: 'highlightedOutlines',
        decl: {
          start: {
            line: 128,
            column: 9
          },
          end: {
            line: 128,
            column: 28
          }
        },
        loc: {
          start: {
            line: 131,
            column: 28
          },
          end: {
            line: 144,
            column: 1
          }
        },
        line: 131
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 135,
            column: 43
          },
          end: {
            line: 135,
            column: 44
          }
        },
        loc: {
          start: {
            line: 136,
            column: 6
          },
          end: {
            line: 136,
            column: 50
          }
        },
        line: 136
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 141,
            column: 40
          },
          end: {
            line: 141,
            column: 41
          }
        },
        loc: {
          start: {
            line: 142,
            column: 4
          },
          end: {
            line: 142,
            column: 54
          }
        },
        line: 142
      },
      '6': {
        name: 'treeToUiTree',
        decl: {
          start: {
            line: 146,
            column: 9
          },
          end: {
            line: 146,
            column: 21
          }
        },
        loc: {
          start: {
            line: 149,
            column: 20
          },
          end: {
            line: 163,
            column: 1
          }
        },
        line: 149
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 161,
            column: 39
          },
          end: {
            line: 161,
            column: 40
          }
        },
        loc: {
          start: {
            line: 161,
            column: 47
          },
          end: {
            line: 161,
            column: 75
          }
        },
        line: 161
      },
      '8': {
        name: 'highlightCurrentNode',
        decl: {
          start: {
            line: 167,
            column: 9
          },
          end: {
            line: 167,
            column: 29
          }
        },
        loc: {
          start: {
            line: 170,
            column: 16
          },
          end: {
            line: 180,
            column: 1
          }
        },
        line: 170
      },
      '9': {
        name: 'highlightCurrentNodeInTrees',
        decl: {
          start: {
            line: 182,
            column: 9
          },
          end: {
            line: 182,
            column: 36
          }
        },
        loc: {
          start: {
            line: 185,
            column: 27
          },
          end: {
            line: 203,
            column: 1
          }
        },
        line: 185
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 189,
            column: 36
          },
          end: {
            line: 189,
            column: 37
          }
        },
        loc: {
          start: {
            line: 189,
            column: 44
          },
          end: {
            line: 201,
            column: 3
          }
        },
        line: 189
      },
      '11': {
        name: 'shouldHighlightNode',
        decl: {
          start: {
            line: 205,
            column: 9
          },
          end: {
            line: 205,
            column: 28
          }
        },
        loc: {
          start: {
            line: 208,
            column: 11
          },
          end: {
            line: 228,
            column: 1
          }
        },
        line: 208
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 98,
            column: 2
          },
          end: {
            line: 125,
            column: 3
          }
        },
        type: 'switch',
        locations: [{
          start: {
            line: 99,
            column: 4
          },
          end: {
            line: 100,
            column: 54
          }
        }, {
          start: {
            line: 101,
            column: 4
          },
          end: {
            line: 105,
            column: 9
          }
        }, {
          start: {
            line: 106,
            column: 4
          },
          end: {
            line: 112,
            column: 8
          }
        }, {
          start: {
            line: 113,
            column: 4
          },
          end: {
            line: 118,
            column: 57
          }
        }, {
          start: {
            line: 119,
            column: 4
          },
          end: {
            line: 120,
            column: 58
          }
        }, {
          start: {
            line: 121,
            column: 4
          },
          end: {
            line: 124,
            column: 32
          }
        }],
        line: 98
      },
      '1': {
        loc: {
          start: {
            line: 115,
            column: 6
          },
          end: {
            line: 117,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 115,
            column: 6
          },
          end: {
            line: 117,
            column: 7
          }
        }, {
          start: {
            line: 115,
            column: 6
          },
          end: {
            line: 117,
            column: 7
          }
        }],
        line: 115
      },
      '2': {
        loc: {
          start: {
            line: 150,
            column: 20
          },
          end: {
            line: 150,
            column: 70
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 150,
            column: 20
          },
          end: {
            line: 150,
            column: 28
          }
        }, {
          start: {
            line: 150,
            column: 32
          },
          end: {
            line: 150,
            column: 70
          }
        }],
        line: 150
      },
      '3': {
        loc: {
          start: {
            line: 152,
            column: 10
          },
          end: {
            line: 152,
            column: 49
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 152,
            column: 21
          },
          end: {
            line: 152,
            column: 30
          }
        }, {
          start: {
            line: 152,
            column: 33
          },
          end: {
            line: 152,
            column: 49
          }
        }],
        line: 152
      },
      '4': {
        loc: {
          start: {
            line: 153,
            column: 10
          },
          end: {
            line: 153,
            column: 49
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 153,
            column: 21
          },
          end: {
            line: 153,
            column: 30
          }
        }, {
          start: {
            line: 153,
            column: 33
          },
          end: {
            line: 153,
            column: 49
          }
        }],
        line: 153
      },
      '5': {
        loc: {
          start: {
            line: 154,
            column: 15
          },
          end: {
            line: 156,
            column: 29
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 155,
            column: 8
          },
          end: {
            line: 155,
            column: 38
          }
        }, {
          start: {
            line: 156,
            column: 8
          },
          end: {
            line: 156,
            column: 29
          }
        }],
        line: 154
      },
      '6': {
        loc: {
          start: {
            line: 157,
            column: 19
          },
          end: {
            line: 157,
            column: 68
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 157,
            column: 31
          },
          end: {
            line: 157,
            column: 40
          }
        }, {
          start: {
            line: 157,
            column: 43
          },
          end: {
            line: 157,
            column: 68
          }
        }],
        line: 157
      },
      '7': {
        loc: {
          start: {
            line: 192,
            column: 4
          },
          end: {
            line: 194,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 192,
            column: 4
          },
          end: {
            line: 194,
            column: 5
          }
        }, {
          start: {
            line: 192,
            column: 4
          },
          end: {
            line: 194,
            column: 5
          }
        }],
        line: 192
      },
      '8': {
        loc: {
          start: {
            line: 192,
            column: 8
          },
          end: {
            line: 192,
            column: 70
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 192,
            column: 8
          },
          end: {
            line: 192,
            column: 40
          }
        }, {
          start: {
            line: 192,
            column: 44
          },
          end: {
            line: 192,
            column: 70
          }
        }],
        line: 192
      },
      '9': {
        loc: {
          start: {
            line: 202,
            column: 9
          },
          end: {
            line: 202,
            column: 42
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 202,
            column: 19
          },
          end: {
            line: 202,
            column: 27
          }
        }, {
          start: {
            line: 202,
            column: 30
          },
          end: {
            line: 202,
            column: 42
          }
        }],
        line: 202
      },
      '10': {
        loc: {
          start: {
            line: 211,
            column: 2
          },
          end: {
            line: 213,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 211,
            column: 2
          },
          end: {
            line: 213,
            column: 3
          }
        }, {
          start: {
            line: 211,
            column: 2
          },
          end: {
            line: 213,
            column: 3
          }
        }],
        line: 211
      },
      '11': {
        loc: {
          start: {
            line: 214,
            column: 2
          },
          end: {
            line: 223,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 214,
            column: 2
          },
          end: {
            line: 223,
            column: 3
          }
        }, {
          start: {
            line: 214,
            column: 2
          },
          end: {
            line: 223,
            column: 3
          }
        }],
        line: 214
      },
      '12': {
        loc: {
          start: {
            line: 220,
            column: 6
          },
          end: {
            line: 221,
            column: 51
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 220,
            column: 6
          },
          end: {
            line: 220,
            column: 56
          }
        }, {
          start: {
            line: 221,
            column: 6
          },
          end: {
            line: 221,
            column: 51
          }
        }],
        line: 220
      },
      '13': {
        loc: {
          start: {
            line: 225,
            column: 4
          },
          end: {
            line: 226,
            column: 49
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 225,
            column: 4
          },
          end: {
            line: 225,
            column: 54
          }
        }, {
          start: {
            line: 226,
            column: 4
          },
          end: {
            line: 226,
            column: 49
          }
        }],
        line: 225
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0
    },
    b: {
      '0': [0, 0, 0, 0, 0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0],
      '10': [0, 0],
      '11': [0, 0],
      '12': [0, 0],
      '13': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createOutlines = createOutlines;

var _rxjsBundlesRxMinJs = require('rxjs/bundles/Rx.min.js');

var _featureConfig;

function _load_featureConfig() {
  return _featureConfig = _interopRequireDefault(require('nuclide-commons-atom/feature-config'));
}

var _textEditor;

function _load_textEditor() {
  return _textEditor = require('nuclide-commons-atom/text-editor');
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

const LOADING_DELAY_MS = (cov_1cyvd4gbte.s[0]++, 500);

/**
 * Includes additional information that is useful to the UI, but redundant or nonsensical for
 * providers to include in their responses.
 */
function createOutlines(editorService) {
  cov_1cyvd4gbte.f[0]++;
  cov_1cyvd4gbte.s[1]++;

  return outlinesForProviderResults(editorService.getResultsStream());
}

function outlinesForProviderResults(providerResults) {
  cov_1cyvd4gbte.f[1]++;
  cov_1cyvd4gbte.s[2]++;

  return providerResults.switchMap(uiOutlinesForResult);
}

function uiOutlinesForResult(result) {
  cov_1cyvd4gbte.f[2]++;
  cov_1cyvd4gbte.s[3]++;

  switch (result.kind) {
    case 'not-text-editor':
      cov_1cyvd4gbte.b[0][0]++;
      cov_1cyvd4gbte.s[4]++;

      return _rxjsBundlesRxMinJs.Observable.of({ kind: 'not-text-editor' });
    case 'no-provider':
      cov_1cyvd4gbte.b[0][1]++;
      cov_1cyvd4gbte.s[5]++;

      return _rxjsBundlesRxMinJs.Observable.of({
        kind: 'no-provider',
        grammar: result.grammar.name
      });
    case 'pane-change':
      cov_1cyvd4gbte.b[0][2]++;
      cov_1cyvd4gbte.s[6]++;

      // Originally, we displayed a empty pane immediately, but this caused an undesireable
      // flickering effect so we prefer stale information for the first LOADING_DELAY_MS.
      // If we haven't received anything after LOADING_DELAY_MS, display a loading indicator.
      return _rxjsBundlesRxMinJs.Observable.concat(_rxjsBundlesRxMinJs.Observable.of({ kind: 'loading' }).delay(LOADING_DELAY_MS));
    case 'result':
      cov_1cyvd4gbte.b[0][3]++;

      const outline = (cov_1cyvd4gbte.s[7]++, result.result);
      cov_1cyvd4gbte.s[8]++;
      if (outline == null) {
        cov_1cyvd4gbte.b[1][0]++;
        cov_1cyvd4gbte.s[9]++;

        return _rxjsBundlesRxMinJs.Observable.of({ kind: 'provider-no-outline' });
      } else {
        cov_1cyvd4gbte.b[1][1]++;
      }
      cov_1cyvd4gbte.s[10]++;
      return highlightedOutlines(outline, result.editor);
    case 'provider-error':
      cov_1cyvd4gbte.b[0][4]++;
      cov_1cyvd4gbte.s[11]++;

      return _rxjsBundlesRxMinJs.Observable.of({ kind: 'provider-no-outline' });
    default:
      cov_1cyvd4gbte.b[0][5]++;
      cov_1cyvd4gbte.s[12]++;

      // Don't change the UI after 'edit' or 'save' events.
      // It's better to just leave the existing outline visible until the new results come in.
      return _rxjsBundlesRxMinJs.Observable.empty();
  }
}

function highlightedOutlines(outline, editor) {
  cov_1cyvd4gbte.f[3]++;

  const nameOnly = (cov_1cyvd4gbte.s[13]++, (_featureConfig || _load_featureConfig()).default.get('atom-ide-outline-view.nameOnly'));
  const outlineForUi = (cov_1cyvd4gbte.s[14]++, {
    kind: 'outline',
    outlineTrees: outline.outlineTrees.map(outlineTree => {
      cov_1cyvd4gbte.f[4]++;
      cov_1cyvd4gbte.s[15]++;
      return treeToUiTree(outlineTree, Boolean(nameOnly));
    }),
    editor
  });

  cov_1cyvd4gbte.s[16]++;
  return (0, (_textEditor || _load_textEditor()).getCursorPositions)(editor).map(cursorLocation => {
    cov_1cyvd4gbte.f[5]++;
    cov_1cyvd4gbte.s[17]++;
    return highlightCurrentNode(outlineForUi, cursorLocation);
  });
}

function treeToUiTree(outlineTree, nameOnly) {
  cov_1cyvd4gbte.f[6]++;

  const shortName = (cov_1cyvd4gbte.s[18]++, (cov_1cyvd4gbte.b[2][0]++, nameOnly) && (cov_1cyvd4gbte.b[2][1]++, outlineTree.representativeName != null));
  cov_1cyvd4gbte.s[19]++;
  return {
    icon: nameOnly ? (cov_1cyvd4gbte.b[3][0]++, undefined) : (cov_1cyvd4gbte.b[3][1]++, outlineTree.icon),
    kind: nameOnly ? (cov_1cyvd4gbte.b[4][0]++, undefined) : (cov_1cyvd4gbte.b[4][1]++, outlineTree.kind),
    plainText: shortName ? (cov_1cyvd4gbte.b[5][0]++, outlineTree.representativeName) : (cov_1cyvd4gbte.b[5][1]++, outlineTree.plainText),
    tokenizedText: shortName ? (cov_1cyvd4gbte.b[6][0]++, undefined) : (cov_1cyvd4gbte.b[6][1]++, outlineTree.tokenizedText),
    startPosition: outlineTree.startPosition,
    endPosition: outlineTree.endPosition,
    highlighted: false,
    children: outlineTree.children.map(tree => {
      cov_1cyvd4gbte.f[7]++;
      cov_1cyvd4gbte.s[20]++;
      return treeToUiTree(tree, nameOnly);
    })
  };
}

// Return an outline object with the node under the cursor highlighted. Does not mutate the
// original.
function highlightCurrentNode(outline, cursorLocation) {
  cov_1cyvd4gbte.f[8]++;
  cov_1cyvd4gbte.s[21]++;

  if (!(outline.kind === 'outline')) {
    throw new Error('Invariant violation: "outline.kind === \'outline\'"');
  }
  // $FlowIssue


  cov_1cyvd4gbte.s[22]++;
  return Object.assign({}, outline, {
    outlineTrees: highlightCurrentNodeInTrees(outline.outlineTrees, cursorLocation)
  });
}

function highlightCurrentNodeInTrees(outlineTrees, cursorLocation) {
  cov_1cyvd4gbte.f[9]++;

  // The corresponding UI component uses React.PureComponent.
  // Minimize the amount of re-rendering per keystroke by only copying on change.
  let changed = (cov_1cyvd4gbte.s[23]++, false);
  const newTrees = (cov_1cyvd4gbte.s[24]++, outlineTrees.map(tree => {
    cov_1cyvd4gbte.f[10]++;

    const highlighted = (cov_1cyvd4gbte.s[25]++, shouldHighlightNode(tree, cursorLocation));
    const children = (cov_1cyvd4gbte.s[26]++, highlightCurrentNodeInTrees(tree.children, cursorLocation));
    cov_1cyvd4gbte.s[27]++;
    if ((cov_1cyvd4gbte.b[8][0]++, highlighted === tree.highlighted) && (cov_1cyvd4gbte.b[8][1]++, children === tree.children)) {
      cov_1cyvd4gbte.b[7][0]++;
      cov_1cyvd4gbte.s[28]++;

      return tree;
    } else {
      cov_1cyvd4gbte.b[7][1]++;
    }
    cov_1cyvd4gbte.s[29]++;
    changed = true;
    cov_1cyvd4gbte.s[30]++;
    return Object.assign({}, tree, {
      highlighted,
      children
    });
  }));
  cov_1cyvd4gbte.s[31]++;
  return changed ? (cov_1cyvd4gbte.b[9][0]++, newTrees) : (cov_1cyvd4gbte.b[9][1]++, outlineTrees);
}

function shouldHighlightNode(outlineTree, cursorLocation) {
  cov_1cyvd4gbte.f[11]++;

  const startPosition = (cov_1cyvd4gbte.s[32]++, outlineTree.startPosition);
  const endPosition = (cov_1cyvd4gbte.s[33]++, outlineTree.endPosition);
  cov_1cyvd4gbte.s[34]++;
  if (endPosition == null) {
    cov_1cyvd4gbte.b[10][0]++;
    cov_1cyvd4gbte.s[35]++;

    return false;
  } else {
    cov_1cyvd4gbte.b[10][1]++;
  }
  cov_1cyvd4gbte.s[36]++;
  if (outlineTree.children.length !== 0) {
    cov_1cyvd4gbte.b[11][0]++;

    const childStartPosition = (cov_1cyvd4gbte.s[37]++, outlineTree.children[0].startPosition);
    // Since the parent is rendered in the list above the children, it doesn't really make sense to
    // highlight it if you are below the start position of any child. However, if you are at the top
    // of a class it does seem desirable to highlight it.
    cov_1cyvd4gbte.s[38]++;
    return (cov_1cyvd4gbte.b[12][0]++, cursorLocation.isGreaterThanOrEqual(startPosition)) && (cov_1cyvd4gbte.b[12][1]++, cursorLocation.isLessThan(childStartPosition));
  } else {
    cov_1cyvd4gbte.b[11][1]++;
  }
  cov_1cyvd4gbte.s[39]++;
  return (cov_1cyvd4gbte.b[13][0]++, cursorLocation.isGreaterThanOrEqual(startPosition)) && (cov_1cyvd4gbte.b[13][1]++, cursorLocation.isLessThanOrEqual(endPosition));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZU91dGxpbmVzLmpzIl0sIm5hbWVzIjpbImNyZWF0ZU91dGxpbmVzIiwiTE9BRElOR19ERUxBWV9NUyIsImVkaXRvclNlcnZpY2UiLCJvdXRsaW5lc0ZvclByb3ZpZGVyUmVzdWx0cyIsImdldFJlc3VsdHNTdHJlYW0iLCJwcm92aWRlclJlc3VsdHMiLCJzd2l0Y2hNYXAiLCJ1aU91dGxpbmVzRm9yUmVzdWx0IiwicmVzdWx0Iiwia2luZCIsIm9mIiwiZ3JhbW1hciIsIm5hbWUiLCJjb25jYXQiLCJkZWxheSIsIm91dGxpbmUiLCJoaWdobGlnaHRlZE91dGxpbmVzIiwiZWRpdG9yIiwiZW1wdHkiLCJuYW1lT25seSIsImdldCIsIm91dGxpbmVGb3JVaSIsIm91dGxpbmVUcmVlcyIsIm1hcCIsIm91dGxpbmVUcmVlIiwiQm9vbGVhbiIsImN1cnNvckxvY2F0aW9uIiwidHJlZVRvVWlUcmVlIiwic2hvcnROYW1lIiwicmVwcmVzZW50YXRpdmVOYW1lIiwiaWNvbiIsInVuZGVmaW5lZCIsInBsYWluVGV4dCIsInRva2VuaXplZFRleHQiLCJzdGFydFBvc2l0aW9uIiwiZW5kUG9zaXRpb24iLCJoaWdobGlnaHRlZCIsImNoaWxkcmVuIiwidHJlZSIsImhpZ2hsaWdodEN1cnJlbnROb2RlIiwiaGlnaGxpZ2h0Q3VycmVudE5vZGVJblRyZWVzIiwiY2hhbmdlZCIsIm5ld1RyZWVzIiwic2hvdWxkSGlnaGxpZ2h0Tm9kZSIsImxlbmd0aCIsImNoaWxkU3RhcnRQb3NpdGlvbiIsImlzR3JlYXRlclRoYW5PckVxdWFsIiwiaXNMZXNzVGhhbiIsImlzTGVzc1RoYW5PckVxdWFsIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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WCxDQUFOO0FBRndDO0FBR3hDLFFBQUksMkNBQWdCWSxLQUFLRixXQUFyQixnQ0FBb0NDLGFBQWFDLEtBQUtELFFBQXRELENBQUosRUFBb0U7QUFBQTtBQUFBOztBQUNsRSxhQUFPQyxJQUFQO0FBQ0QsS0FGRDtBQUFBO0FBQUE7QUFId0M7QUFNeENHLGNBQVUsSUFBVjtBQU53QztBQU94Qyw2QkFDS0gsSUFETDtBQUVFRixpQkFGRjtBQUdFQztBQUhGO0FBS0QsR0FaZ0IsQ0FBWCxDQUFOO0FBSnlCO0FBaUJ6QixTQUFPSSxxQ0FBVUMsUUFBViwrQkFBcUJwQixZQUFyQixDQUFQO0FBQ0Q7O0FBRUQsU0FBU3FCLG1CQUFULENBQ0VuQixXQURGLEVBRUVFLGNBRkYsRUFHVztBQUFBOztBQUNULFFBQU1RLHlDQUFnQlYsWUFBWVUsYUFBNUIsQ0FBTjtBQUNBLFFBQU1DLHVDQUFjWCxZQUFZVyxXQUExQixDQUFOO0FBRlM7QUFHVCxNQUFJQSxlQUFlLElBQW5CLEVBQXlCO0FBQUE7QUFBQTs7QUFDdkIsV0FBTyxLQUFQO0FBQ0QsR0FGRDtBQUFBO0FBQUE7QUFIUztBQU1ULE1BQUlYLFlBQVlhLFFBQVosQ0FBcUJPLE1BQXJCLEtBQWdDLENBQXBDLEVBQXVDO0FBQUE7O0FBQ3JDLFVBQU1DLDhDQUFxQnJCLFlBQVlhLFFBQVosQ0FBcUIsQ0FBckIsRUFBd0JILGFBQTdDLENBQU47QUFDQTtBQUNBO0FBQ0E7QUFKcUM7QUFLckMsV0FDRSwyQ0FBZVksb0JBQWYsQ0FBb0NaLGFBQXBDLGtDQUNBUixlQUFlcUIsVUFBZixDQUEwQkYsa0JBQTFCLENBREEsQ0FERjtBQUlELEdBVEQ7QUFBQTtBQUFBO0FBTlM7QUFnQlQsU0FDRSwyQ0FBZUMsb0JBQWYsQ0FBb0NaLGFBQXBDLGtDQUNBUixlQUFlc0IsaUJBQWYsQ0FBaUNiLFdBQWpDLENBREEsQ0FERjtBQUlEIiwiZmlsZSI6ImNyZWF0ZU91dGxpbmVzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuaW1wb3J0IHR5cGUge1xuICBPdXRsaW5lLFxuICBPdXRsaW5lUHJvdmlkZXIsXG4gIE91dGxpbmVUcmVlLFxuICBPdXRsaW5lVHJlZUtpbmQsXG59IGZyb20gJy4vdHlwZXMnO1xuaW1wb3J0IHR5cGUge1Rva2VuaXplZFRleHR9IGZyb20gJ251Y2xpZGUtY29tbW9ucy90b2tlbml6ZWQtdGV4dCc7XG5pbXBvcnQgdHlwZSBBY3RpdmVFZGl0b3JSZWdpc3RyeSwge1xuICBSZXN1bHQsXG59IGZyb20gJ251Y2xpZGUtY29tbW9ucy1hdG9tL0FjdGl2ZUVkaXRvclJlZ2lzdHJ5JztcblxuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcbmltcG9ydCBmZWF0dXJlQ29uZmlnIGZyb20gJ251Y2xpZGUtY29tbW9ucy1hdG9tL2ZlYXR1cmUtY29uZmlnJztcbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAnYXNzZXJ0JztcblxuaW1wb3J0IHtnZXRDdXJzb3JQb3NpdGlvbnN9IGZyb20gJ251Y2xpZGUtY29tbW9ucy1hdG9tL3RleHQtZWRpdG9yJztcblxuY29uc3QgTE9BRElOR19ERUxBWV9NUyA9IDUwMDtcblxuZXhwb3J0IHR5cGUgT3V0bGluZVRyZWVGb3JVaSA9IHtcbiAgaWNvbj86IHN0cmluZywgLy8gZnJvbSBhdG9tJE9jdGljb24sIGJ1dCB3ZSB1c2Ugc3RyaW5nIGZvciBjb252ZW5pZW5jZSBvZiByZW1vdGluZ1xuICBraW5kPzogT3V0bGluZVRyZWVLaW5kLCAvLyBraW5kIHlvdSBjYW4gcGFzcyB0byB0aGUgVUkgZm9yIHRoZW1pbmdcbiAgcGxhaW5UZXh0Pzogc3RyaW5nLFxuICB0b2tlbml6ZWRUZXh0PzogVG9rZW5pemVkVGV4dCxcblxuICBzdGFydFBvc2l0aW9uOiBhdG9tJFBvaW50LFxuICBlbmRQb3NpdGlvbj86IGF0b20kUG9pbnQsXG4gIGNoaWxkcmVuOiBBcnJheTxPdXRsaW5lVHJlZUZvclVpPixcbiAgaGlnaGxpZ2h0ZWQ6IGJvb2xlYW4sXG59O1xuXG4vKipcbiAqIEluY2x1ZGVzIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24gdGhhdCBpcyB1c2VmdWwgdG8gdGhlIFVJLCBidXQgcmVkdW5kYW50IG9yIG5vbnNlbnNpY2FsIGZvclxuICogcHJvdmlkZXJzIHRvIGluY2x1ZGUgaW4gdGhlaXIgcmVzcG9uc2VzLlxuICovXG5leHBvcnQgdHlwZSBPdXRsaW5lRm9yVWkgPVxuICB8IHtcbiAgICAgIC8vIFRoZSBpbml0aWFsIHN0YXRlIGF0IHN0YXJ0dXAuXG4gICAgICBraW5kOiAnZW1wdHknLFxuICAgIH1cbiAgfCB7XG4gICAgICAvLyBUaGUgdGhpbmcgdGhhdCBjdXJyZW50bHkgaGFzIGZvY3VzIGlzIG5vdCBhIHRleHQgZWRpdG9yLlxuICAgICAga2luZDogJ25vdC10ZXh0LWVkaXRvcicsXG4gICAgfVxuICB8IHtcbiAgICAgIC8vIEN1cnJlbnRseSBhd2FpdGluZyByZXN1bHRzIGZyb20gYSBwcm92aWRlciAoZm9yIGxvbmdlciB0aGFuIGEgY2VydGFpbiBkZWxheSkuXG4gICAgICBraW5kOiAnbG9hZGluZycsXG4gICAgfVxuICB8IHtcbiAgICAgIC8vIEluZGljYXRlcyB0aGF0IG5vIHByb3ZpZGVyIGlzIHJlZ2lzdGVyZWQgZm9yIHRoZSBnaXZlbiBncmFtbWFyLlxuICAgICAga2luZDogJ25vLXByb3ZpZGVyJyxcbiAgICAgIC8vIEh1bWFuLXJlYWRhYmxlIG5hbWUgZm9yIHRoZSBncmFtbWFyLlxuICAgICAgZ3JhbW1hcjogc3RyaW5nLFxuICAgIH1cbiAgfCB7XG4gICAgICAvLyBJbmRpY2F0ZXMgdGhhdCBhIHByb3ZpZGVyIGlzIHJlZ2lzdGVyZWQgYnV0IHRoYXQgaXQgZGlkIG5vdCByZXR1cm4gYW4gb3V0bGluZS5cbiAgICAgIGtpbmQ6ICdwcm92aWRlci1uby1vdXRsaW5lJyxcbiAgICB9XG4gIHwge1xuICAgICAga2luZDogJ291dGxpbmUnLFxuICAgICAgb3V0bGluZVRyZWVzOiBBcnJheTxPdXRsaW5lVHJlZUZvclVpPixcbiAgICAgIC8qKlxuICAgKiBVc2UgYSBUZXh0RWRpdG9yIGluc3RlYWQgb2YgYSBwYXRoIHNvIHRoYXQ6XG4gICAqIC0gSWYgdGhlcmUgYXJlIG11bHRpcGxlIGVkaXRvcnMgZm9yIGEgZmlsZSwgd2UgYWx3YXlzIGp1bXAgdG8gb3V0bGluZSBpdGVtXG4gICAqICAgbG9jYXRpb25zIGluIHRoZSBjb3JyZWN0IGVkaXRvci5cbiAgICogLSBKdW1waW5nIHRvIG91dGxpbmUgaXRlbSBsb2NhdGlvbnMgd29ya3MgZm9yIG5ldywgdW5zYXZlZCBmaWxlcy5cbiAgICovXG4gICAgICBlZGl0b3I6IGF0b20kVGV4dEVkaXRvcixcbiAgICB9O1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlT3V0bGluZXMoXG4gIGVkaXRvclNlcnZpY2U6IEFjdGl2ZUVkaXRvclJlZ2lzdHJ5PE91dGxpbmVQcm92aWRlciwgP091dGxpbmU+LFxuKTogT2JzZXJ2YWJsZTxPdXRsaW5lRm9yVWk+IHtcbiAgcmV0dXJuIG91dGxpbmVzRm9yUHJvdmlkZXJSZXN1bHRzKGVkaXRvclNlcnZpY2UuZ2V0UmVzdWx0c1N0cmVhbSgpKTtcbn1cblxuZnVuY3Rpb24gb3V0bGluZXNGb3JQcm92aWRlclJlc3VsdHMoXG4gIHByb3ZpZGVyUmVzdWx0czogT2JzZXJ2YWJsZTxSZXN1bHQ8T3V0bGluZVByb3ZpZGVyLCA/T3V0bGluZT4+LFxuKTogT2JzZXJ2YWJsZTxPdXRsaW5lRm9yVWk+IHtcbiAgcmV0dXJuIHByb3ZpZGVyUmVzdWx0cy5zd2l0Y2hNYXAodWlPdXRsaW5lc0ZvclJlc3VsdCk7XG59XG5cbmZ1bmN0aW9uIHVpT3V0bGluZXNGb3JSZXN1bHQoXG4gIHJlc3VsdDogUmVzdWx0PE91dGxpbmVQcm92aWRlciwgP091dGxpbmU+LFxuKTogT2JzZXJ2YWJsZTxPdXRsaW5lRm9yVWk+IHtcbiAgc3dpdGNoIChyZXN1bHQua2luZCkge1xuICAgIGNhc2UgJ25vdC10ZXh0LWVkaXRvcic6XG4gICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZih7a2luZDogJ25vdC10ZXh0LWVkaXRvcid9KTtcbiAgICBjYXNlICduby1wcm92aWRlcic6XG4gICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZih7XG4gICAgICAgIGtpbmQ6ICduby1wcm92aWRlcicsXG4gICAgICAgIGdyYW1tYXI6IHJlc3VsdC5ncmFtbWFyLm5hbWUsXG4gICAgICB9KTtcbiAgICBjYXNlICdwYW5lLWNoYW5nZSc6XG4gICAgICAvLyBPcmlnaW5hbGx5LCB3ZSBkaXNwbGF5ZWQgYSBlbXB0eSBwYW5lIGltbWVkaWF0ZWx5LCBidXQgdGhpcyBjYXVzZWQgYW4gdW5kZXNpcmVhYmxlXG4gICAgICAvLyBmbGlja2VyaW5nIGVmZmVjdCBzbyB3ZSBwcmVmZXIgc3RhbGUgaW5mb3JtYXRpb24gZm9yIHRoZSBmaXJzdCBMT0FESU5HX0RFTEFZX01TLlxuICAgICAgLy8gSWYgd2UgaGF2ZW4ndCByZWNlaXZlZCBhbnl0aGluZyBhZnRlciBMT0FESU5HX0RFTEFZX01TLCBkaXNwbGF5IGEgbG9hZGluZyBpbmRpY2F0b3IuXG4gICAgICByZXR1cm4gT2JzZXJ2YWJsZS5jb25jYXQoXG4gICAgICAgIE9ic2VydmFibGUub2Yoe2tpbmQ6ICdsb2FkaW5nJ30pLmRlbGF5KExPQURJTkdfREVMQVlfTVMpLFxuICAgICAgKTtcbiAgICBjYXNlICdyZXN1bHQnOlxuICAgICAgY29uc3Qgb3V0bGluZSA9IHJlc3VsdC5yZXN1bHQ7XG4gICAgICBpZiAob3V0bGluZSA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKHtraW5kOiAncHJvdmlkZXItbm8tb3V0bGluZSd9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBoaWdobGlnaHRlZE91dGxpbmVzKG91dGxpbmUsIHJlc3VsdC5lZGl0b3IpO1xuICAgIGNhc2UgJ3Byb3ZpZGVyLWVycm9yJzpcbiAgICAgIHJldHVybiBPYnNlcnZhYmxlLm9mKHtraW5kOiAncHJvdmlkZXItbm8tb3V0bGluZSd9KTtcbiAgICBkZWZhdWx0OlxuICAgICAgLy8gRG9uJ3QgY2hhbmdlIHRoZSBVSSBhZnRlciAnZWRpdCcgb3IgJ3NhdmUnIGV2ZW50cy5cbiAgICAgIC8vIEl0J3MgYmV0dGVyIHRvIGp1c3QgbGVhdmUgdGhlIGV4aXN0aW5nIG91dGxpbmUgdmlzaWJsZSB1bnRpbCB0aGUgbmV3IHJlc3VsdHMgY29tZSBpbi5cbiAgICAgIHJldHVybiBPYnNlcnZhYmxlLmVtcHR5KCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaGlnaGxpZ2h0ZWRPdXRsaW5lcyhcbiAgb3V0bGluZTogT3V0bGluZSxcbiAgZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsXG4pOiBPYnNlcnZhYmxlPE91dGxpbmVGb3JVaT4ge1xuICBjb25zdCBuYW1lT25seSA9IGZlYXR1cmVDb25maWcuZ2V0KCdhdG9tLWlkZS1vdXRsaW5lLXZpZXcubmFtZU9ubHknKTtcbiAgY29uc3Qgb3V0bGluZUZvclVpID0ge1xuICAgIGtpbmQ6ICdvdXRsaW5lJyxcbiAgICBvdXRsaW5lVHJlZXM6IG91dGxpbmUub3V0bGluZVRyZWVzLm1hcChvdXRsaW5lVHJlZSA9PlxuICAgICAgdHJlZVRvVWlUcmVlKG91dGxpbmVUcmVlLCBCb29sZWFuKG5hbWVPbmx5KSksXG4gICAgKSxcbiAgICBlZGl0b3IsXG4gIH07XG5cbiAgcmV0dXJuIGdldEN1cnNvclBvc2l0aW9ucyhlZGl0b3IpLm1hcChjdXJzb3JMb2NhdGlvbiA9PlxuICAgIGhpZ2hsaWdodEN1cnJlbnROb2RlKG91dGxpbmVGb3JVaSwgY3Vyc29yTG9jYXRpb24pLFxuICApO1xufVxuXG5mdW5jdGlvbiB0cmVlVG9VaVRyZWUoXG4gIG91dGxpbmVUcmVlOiBPdXRsaW5lVHJlZSxcbiAgbmFtZU9ubHk6IGJvb2xlYW4sXG4pOiBPdXRsaW5lVHJlZUZvclVpIHtcbiAgY29uc3Qgc2hvcnROYW1lID0gbmFtZU9ubHkgJiYgb3V0bGluZVRyZWUucmVwcmVzZW50YXRpdmVOYW1lICE9IG51bGw7XG4gIHJldHVybiB7XG4gICAgaWNvbjogbmFtZU9ubHkgPyB1bmRlZmluZWQgOiBvdXRsaW5lVHJlZS5pY29uLFxuICAgIGtpbmQ6IG5hbWVPbmx5ID8gdW5kZWZpbmVkIDogb3V0bGluZVRyZWUua2luZCxcbiAgICBwbGFpblRleHQ6IHNob3J0TmFtZVxuICAgICAgPyBvdXRsaW5lVHJlZS5yZXByZXNlbnRhdGl2ZU5hbWVcbiAgICAgIDogb3V0bGluZVRyZWUucGxhaW5UZXh0LFxuICAgIHRva2VuaXplZFRleHQ6IHNob3J0TmFtZSA/IHVuZGVmaW5lZCA6IG91dGxpbmVUcmVlLnRva2VuaXplZFRleHQsXG4gICAgc3RhcnRQb3NpdGlvbjogb3V0bGluZVRyZWUuc3RhcnRQb3NpdGlvbixcbiAgICBlbmRQb3NpdGlvbjogb3V0bGluZVRyZWUuZW5kUG9zaXRpb24sXG4gICAgaGlnaGxpZ2h0ZWQ6IGZhbHNlLFxuICAgIGNoaWxkcmVuOiBvdXRsaW5lVHJlZS5jaGlsZHJlbi5tYXAodHJlZSA9PiB0cmVlVG9VaVRyZWUodHJlZSwgbmFtZU9ubHkpKSxcbiAgfTtcbn1cblxuLy8gUmV0dXJuIGFuIG91dGxpbmUgb2JqZWN0IHdpdGggdGhlIG5vZGUgdW5kZXIgdGhlIGN1cnNvciBoaWdobGlnaHRlZC4gRG9lcyBub3QgbXV0YXRlIHRoZVxuLy8gb3JpZ2luYWwuXG5mdW5jdGlvbiBoaWdobGlnaHRDdXJyZW50Tm9kZShcbiAgb3V0bGluZTogT3V0bGluZUZvclVpLFxuICBjdXJzb3JMb2NhdGlvbjogYXRvbSRQb2ludCxcbik6IE91dGxpbmVGb3JVaSB7XG4gIGludmFyaWFudChvdXRsaW5lLmtpbmQgPT09ICdvdXRsaW5lJyk7XG4gIC8vICRGbG93SXNzdWVcbiAgcmV0dXJuIHtcbiAgICAuLi5vdXRsaW5lLFxuICAgIG91dGxpbmVUcmVlczogaGlnaGxpZ2h0Q3VycmVudE5vZGVJblRyZWVzKFxuICAgICAgb3V0bGluZS5vdXRsaW5lVHJlZXMsXG4gICAgICBjdXJzb3JMb2NhdGlvbixcbiAgICApLFxuICB9O1xufVxuXG5mdW5jdGlvbiBoaWdobGlnaHRDdXJyZW50Tm9kZUluVHJlZXMoXG4gIG91dGxpbmVUcmVlczogQXJyYXk8T3V0bGluZVRyZWVGb3JVaT4sXG4gIGN1cnNvckxvY2F0aW9uOiBhdG9tJFBvaW50LFxuKTogQXJyYXk8T3V0bGluZVRyZWVGb3JVaT4ge1xuICAvLyBUaGUgY29ycmVzcG9uZGluZyBVSSBjb21wb25lbnQgdXNlcyBSZWFjdC5QdXJlQ29tcG9uZW50LlxuICAvLyBNaW5pbWl6ZSB0aGUgYW1vdW50IG9mIHJlLXJlbmRlcmluZyBwZXIga2V5c3Ryb2tlIGJ5IG9ubHkgY29weWluZyBvbiBjaGFuZ2UuXG4gIGxldCBjaGFuZ2VkID0gZmFsc2U7XG4gIGNvbnN0IG5ld1RyZWVzID0gb3V0bGluZVRyZWVzLm1hcCh0cmVlID0+IHtcbiAgICBjb25zdCBoaWdobGlnaHRlZCA9IHNob3VsZEhpZ2hsaWdodE5vZGUodHJlZSwgY3Vyc29yTG9jYXRpb24pO1xuICAgIGNvbnN0IGNoaWxkcmVuID0gaGlnaGxpZ2h0Q3VycmVudE5vZGVJblRyZWVzKHRyZWUuY2hpbGRyZW4sIGN1cnNvckxvY2F0aW9uKTtcbiAgICBpZiAoaGlnaGxpZ2h0ZWQgPT09IHRyZWUuaGlnaGxpZ2h0ZWQgJiYgY2hpbGRyZW4gPT09IHRyZWUuY2hpbGRyZW4pIHtcbiAgICAgIHJldHVybiB0cmVlO1xuICAgIH1cbiAgICBjaGFuZ2VkID0gdHJ1ZTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4udHJlZSxcbiAgICAgIGhpZ2hsaWdodGVkLFxuICAgICAgY2hpbGRyZW4sXG4gICAgfTtcbiAgfSk7XG4gIHJldHVybiBjaGFuZ2VkID8gbmV3VHJlZXMgOiBvdXRsaW5lVHJlZXM7XG59XG5cbmZ1bmN0aW9uIHNob3VsZEhpZ2hsaWdodE5vZGUoXG4gIG91dGxpbmVUcmVlOiBPdXRsaW5lVHJlZUZvclVpLFxuICBjdXJzb3JMb2NhdGlvbjogYXRvbSRQb2ludCxcbik6IGJvb2xlYW4ge1xuICBjb25zdCBzdGFydFBvc2l0aW9uID0gb3V0bGluZVRyZWUuc3RhcnRQb3NpdGlvbjtcbiAgY29uc3QgZW5kUG9zaXRpb24gPSBvdXRsaW5lVHJlZS5lbmRQb3NpdGlvbjtcbiAgaWYgKGVuZFBvc2l0aW9uID09IG51bGwpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgaWYgKG91dGxpbmVUcmVlLmNoaWxkcmVuLmxlbmd0aCAhPT0gMCkge1xuICAgIGNvbnN0IGNoaWxkU3RhcnRQb3NpdGlvbiA9IG91dGxpbmVUcmVlLmNoaWxkcmVuWzBdLnN0YXJ0UG9zaXRpb247XG4gICAgLy8gU2luY2UgdGhlIHBhcmVudCBpcyByZW5kZXJlZCBpbiB0aGUgbGlzdCBhYm92ZSB0aGUgY2hpbGRyZW4sIGl0IGRvZXNuJ3QgcmVhbGx5IG1ha2Ugc2Vuc2UgdG9cbiAgICAvLyBoaWdobGlnaHQgaXQgaWYgeW91IGFyZSBiZWxvdyB0aGUgc3RhcnQgcG9zaXRpb24gb2YgYW55IGNoaWxkLiBIb3dldmVyLCBpZiB5b3UgYXJlIGF0IHRoZSB0b3BcbiAgICAvLyBvZiBhIGNsYXNzIGl0IGRvZXMgc2VlbSBkZXNpcmFibGUgdG8gaGlnaGxpZ2h0IGl0LlxuICAgIHJldHVybiAoXG4gICAgICBjdXJzb3JMb2NhdGlvbi5pc0dyZWF0ZXJUaGFuT3JFcXVhbChzdGFydFBvc2l0aW9uKSAmJlxuICAgICAgY3Vyc29yTG9jYXRpb24uaXNMZXNzVGhhbihjaGlsZFN0YXJ0UG9zaXRpb24pXG4gICAgKTtcbiAgfVxuICByZXR1cm4gKFxuICAgIGN1cnNvckxvY2F0aW9uLmlzR3JlYXRlclRoYW5PckVxdWFsKHN0YXJ0UG9zaXRpb24pICYmXG4gICAgY3Vyc29yTG9jYXRpb24uaXNMZXNzVGhhbk9yRXF1YWwoZW5kUG9zaXRpb24pXG4gICk7XG59XG4iXX0=