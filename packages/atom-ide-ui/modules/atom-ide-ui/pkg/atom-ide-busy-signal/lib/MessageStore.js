'use strict';

var cov_26momxyjt0 = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-busy-signal/lib/MessageStore.js',
      hash = '6fde195189de8aa4b003d063bf09eafb024e736a',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-busy-signal/lib/MessageStore.js',
    statementMap: {
      '0': {
        start: {
          line: 25,
          column: 28
        },
        end: {
          line: 25,
          column: 31
        }
      },
      '1': {
        start: {
          line: 36,
          column: 4
        },
        end: {
          line: 36,
          column: 31
        }
      },
      '2': {
        start: {
          line: 40,
          column: 30
        },
        end: {
          line: 40,
          column: 49
        }
      },
      '3': {
        start: {
          line: 41,
          column: 4
        },
        end: {
          line: 43,
          column: 5
        }
      },
      '4': {
        start: {
          line: 42,
          column: 6
        },
        end: {
          line: 42,
          column: 24
        }
      },
      '5': {
        start: {
          line: 44,
          column: 4
        },
        end: {
          line: 44,
          column: 41
        }
      },
      '6': {
        start: {
          line: 45,
          column: 4
        },
        end: {
          line: 45,
          column: 35
        }
      },
      '7': {
        start: {
          line: 50,
          column: 4
        },
        end: {
          line: 52,
          column: 6
        }
      },
      '8': {
        start: {
          line: 51,
          column: 6
        },
        end: {
          line: 51,
          column: 37
        }
      },
      '9': {
        start: {
          line: 53,
          column: 28
        },
        end: {
          line: 55,
          column: 39
        }
      },
      '10': {
        start: {
          line: 54,
          column: 19
        },
        end: {
          line: 54,
          column: 32
        }
      },
      '11': {
        start: {
          line: 55,
          column: 24
        },
        end: {
          line: 55,
          column: 38
        }
      },
      '12': {
        start: {
          line: 61,
          column: 4
        },
        end: {
          line: 64,
          column: 5
        }
      },
      '13': {
        start: {
          line: 62,
          column: 6
        },
        end: {
          line: 62,
          column: 48
        }
      },
      '14': {
        start: {
          line: 63,
          column: 6
        },
        end: {
          line: 63,
          column: 53
        }
      },
      '15': {
        start: {
          line: 68,
          column: 4
        },
        end: {
          line: 68,
          column: 20
        }
      },
      '16': {
        start: {
          line: 70,
          column: 26
        },
        end: {
          line: 70,
          column: 39
        }
      },
      '17': {
        start: {
          line: 72,
          column: 6
        },
        end: {
          line: 74,
          column: 20
        }
      },
      '18': {
        start: {
          line: 75,
          column: 23
        },
        end: {
          line: 75,
          column: 66
        }
      },
      '19': {
        start: {
          line: 76,
          column: 31
        },
        end: {
          line: 76,
          column: 56
        }
      },
      '20': {
        start: {
          line: 78,
          column: 20
        },
        end: {
          line: 84,
          column: 5
        }
      },
      '21': {
        start: {
          line: 85,
          column: 4
        },
        end: {
          line: 85,
          column: 32
        }
      },
      '22': {
        start: {
          line: 86,
          column: 4
        },
        end: {
          line: 86,
          column: 65
        }
      },
      '23': {
        start: {
          line: 86,
          column: 33
        },
        end: {
          line: 86,
          column: 63
        }
      },
      '24': {
        start: {
          line: 89,
          column: 34
        },
        end: {
          line: 89,
          column: 75
        }
      },
      '25': {
        start: {
          line: 91,
          column: 6
        },
        end: {
          line: 91,
          column: 67
        }
      },
      '26': {
        start: {
          line: 92,
          column: 4
        },
        end: {
          line: 111,
          column: 5
        }
      },
      '27': {
        start: {
          line: 93,
          column: 6
        },
        end: {
          line: 93,
          column: 45
        }
      },
      '28': {
        start: {
          line: 96,
          column: 22
        },
        end: {
          line: 96,
          column: 23
        }
      },
      '29': {
        start: {
          line: 97,
          column: 23
        },
        end: {
          line: 97,
          column: 52
        }
      },
      '30': {
        start: {
          line: 97,
          column: 29
        },
        end: {
          line: 97,
          column: 52
        }
      },
      '31': {
        start: {
          line: 98,
          column: 6
        },
        end: {
          line: 109,
          column: 30
        }
      },
      '32': {
        start: {
          line: 99,
          column: 8
        },
        end: {
          line: 99,
          column: 48
        }
      },
      '33': {
        start: {
          line: 100,
          column: 8
        },
        end: {
          line: 100,
          column: 47
        }
      },
      '34': {
        start: {
          line: 107,
          column: 8
        },
        end: {
          line: 107,
          column: 44
        }
      },
      '35': {
        start: {
          line: 108,
          column: 8
        },
        end: {
          line: 108,
          column: 46
        }
      },
      '36': {
        start: {
          line: 110,
          column: 6
        },
        end: {
          line: 110,
          column: 39
        }
      },
      '37': {
        start: {
          line: 113,
          column: 4
        },
        end: {
          line: 125,
          column: 5
        }
      },
      '38': {
        start: {
          line: 114,
          column: 6
        },
        end: {
          line: 114,
          column: 41
        }
      },
      '39': {
        start: {
          line: 115,
          column: 19
        },
        end: {
          line: 115,
          column: 38
        }
      },
      '40': {
        start: {
          line: 116,
          column: 23
        },
        end: {
          line: 123,
          column: 8
        }
      },
      '41': {
        start: {
          line: 118,
          column: 10
        },
        end: {
          line: 120,
          column: 18
        }
      },
      '42': {
        start: {
          line: 121,
          column: 27
        },
        end: {
          line: 121,
          column: 46
        }
      },
      '43': {
        start: {
          line: 122,
          column: 8
        },
        end: {
          line: 122,
          column: 48
        }
      },
      '44': {
        start: {
          line: 124,
          column: 6
        },
        end: {
          line: 124,
          column: 39
        }
      },
      '45': {
        start: {
          line: 127,
          column: 4
        },
        end: {
          line: 131,
          column: 5
        }
      },
      '46': {
        start: {
          line: 130,
          column: 6
        },
        end: {
          line: 130,
          column: 37
        }
      },
      '47': {
        start: {
          line: 133,
          column: 4
        },
        end: {
          line: 133,
          column: 28
        }
      },
      '48': {
        start: {
          line: 139,
          column: 4
        },
        end: {
          line: 139,
          column: 19
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 35,
            column: 2
          },
          end: {
            line: 35,
            column: 3
          }
        },
        loc: {
          start: {
            line: 35,
            column: 61
          },
          end: {
            line: 37,
            column: 3
          }
        },
        line: 35
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 39,
            column: 2
          },
          end: {
            line: 39,
            column: 3
          }
        },
        loc: {
          start: {
            line: 39,
            column: 18
          },
          end: {
            line: 46,
            column: 3
          }
        },
        line: 39
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 48,
            column: 2
          },
          end: {
            line: 48,
            column: 3
          }
        },
        loc: {
          start: {
            line: 48,
            column: 19
          },
          end: {
            line: 65,
            column: 3
          }
        },
        line: 48
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 50,
            column: 41
          },
          end: {
            line: 50,
            column: 42
          }
        },
        loc: {
          start: {
            line: 51,
            column: 6
          },
          end: {
            line: 51,
            column: 37
          }
        },
        line: 51
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 54,
            column: 14
          },
          end: {
            line: 54,
            column: 15
          }
        },
        loc: {
          start: {
            line: 54,
            column: 19
          },
          end: {
            line: 54,
            column: 32
          }
        },
        line: 54
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 55,
            column: 12
          },
          end: {
            line: 55,
            column: 13
          }
        },
        loc: {
          start: {
            line: 55,
            column: 24
          },
          end: {
            line: 55,
            column: 38
          }
        },
        line: 55
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 67,
            column: 2
          },
          end: {
            line: 67,
            column: 3
          }
        },
        loc: {
          start: {
            line: 67,
            column: 62
          },
          end: {
            line: 140,
            column: 3
          }
        },
        line: 67
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 86,
            column: 27
          },
          end: {
            line: 86,
            column: 28
          }
        },
        loc: {
          start: {
            line: 86,
            column: 33
          },
          end: {
            line: 86,
            column: 63
          }
        },
        line: 86
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 97,
            column: 23
          },
          end: {
            line: 97,
            column: 24
          }
        },
        loc: {
          start: {
            line: 97,
            column: 29
          },
          end: {
            line: 97,
            column: 52
          }
        },
        line: 97
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 98,
            column: 29
          },
          end: {
            line: 98,
            column: 30
          }
        },
        loc: {
          start: {
            line: 98,
            column: 35
          },
          end: {
            line: 109,
            column: 7
          }
        },
        line: 98
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 116,
            column: 60
          },
          end: {
            line: 116,
            column: 61
          }
        },
        loc: {
          start: {
            line: 116,
            column: 68
          },
          end: {
            line: 123,
            column: 7
          }
        },
        line: 116
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 61,
            column: 4
          },
          end: {
            line: 64,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 61,
            column: 4
          },
          end: {
            line: 64,
            column: 5
          }
        }, {
          start: {
            line: 61,
            column: 4
          },
          end: {
            line: 64,
            column: 5
          }
        }],
        line: 61
      },
      '1': {
        loc: {
          start: {
            line: 72,
            column: 6
          },
          end: {
            line: 74,
            column: 20
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 73,
            column: 10
          },
          end: {
            line: 73,
            column: 28
          }
        }, {
          start: {
            line: 74,
            column: 10
          },
          end: {
            line: 74,
            column: 20
          }
        }],
        line: 72
      },
      '2': {
        loc: {
          start: {
            line: 72,
            column: 6
          },
          end: {
            line: 72,
            column: 51
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 72,
            column: 6
          },
          end: {
            line: 72,
            column: 21
          }
        }, {
          start: {
            line: 72,
            column: 25
          },
          end: {
            line: 72,
            column: 51
          }
        }],
        line: 72
      },
      '3': {
        loc: {
          start: {
            line: 75,
            column: 23
          },
          end: {
            line: 75,
            column: 66
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 75,
            column: 41
          },
          end: {
            line: 75,
            column: 45
          }
        }, {
          start: {
            line: 75,
            column: 48
          },
          end: {
            line: 75,
            column: 66
          }
        }],
        line: 75
      },
      '4': {
        loc: {
          start: {
            line: 89,
            column: 34
          },
          end: {
            line: 89,
            column: 75
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 89,
            column: 52
          },
          end: {
            line: 89,
            column: 56
          }
        }, {
          start: {
            line: 89,
            column: 59
          },
          end: {
            line: 89,
            column: 75
          }
        }],
        line: 89
      },
      '5': {
        loc: {
          start: {
            line: 91,
            column: 6
          },
          end: {
            line: 91,
            column: 67
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 91,
            column: 28
          },
          end: {
            line: 91,
            column: 53
          }
        }, {
          start: {
            line: 91,
            column: 56
          },
          end: {
            line: 91,
            column: 67
          }
        }],
        line: 91
      },
      '6': {
        loc: {
          start: {
            line: 92,
            column: 4
          },
          end: {
            line: 111,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 92,
            column: 4
          },
          end: {
            line: 111,
            column: 5
          }
        }, {
          start: {
            line: 92,
            column: 4
          },
          end: {
            line: 111,
            column: 5
          }
        }],
        line: 92
      },
      '7': {
        loc: {
          start: {
            line: 113,
            column: 4
          },
          end: {
            line: 125,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 113,
            column: 4
          },
          end: {
            line: 125,
            column: 5
          }
        }, {
          start: {
            line: 113,
            column: 4
          },
          end: {
            line: 125,
            column: 5
          }
        }],
        line: 113
      },
      '8': {
        loc: {
          start: {
            line: 113,
            column: 8
          },
          end: {
            line: 113,
            column: 54
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 113,
            column: 8
          },
          end: {
            line: 113,
            column: 23
          }
        }, {
          start: {
            line: 113,
            column: 27
          },
          end: {
            line: 113,
            column: 54
          }
        }],
        line: 113
      },
      '9': {
        loc: {
          start: {
            line: 118,
            column: 10
          },
          end: {
            line: 120,
            column: 18
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 119,
            column: 14
          },
          end: {
            line: 119,
            column: 36
          }
        }, {
          start: {
            line: 120,
            column: 14
          },
          end: {
            line: 120,
            column: 18
          }
        }],
        line: 118
      },
      '10': {
        loc: {
          start: {
            line: 118,
            column: 10
          },
          end: {
            line: 118,
            column: 60
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 118,
            column: 10
          },
          end: {
            line: 118,
            column: 22
          }
        }, {
          start: {
            line: 118,
            column: 26
          },
          end: {
            line: 118,
            column: 60
          }
        }],
        line: 118
      },
      '11': {
        loc: {
          start: {
            line: 127,
            column: 4
          },
          end: {
            line: 131,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 127,
            column: 4
          },
          end: {
            line: 131,
            column: 5
          }
        }, {
          start: {
            line: 127,
            column: 4
          },
          end: {
            line: 131,
            column: 5
          }
        }],
        line: 127
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0],
      '10': [0, 0],
      '11': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MessageStore = undefined;

var _rxjsBundlesRxMinJs = require('rxjs/bundles/Rx.min.js');

var _UniversalDisposable;

function _load_UniversalDisposable() {
  return _UniversalDisposable = _interopRequireDefault(require('nuclide-commons/UniversalDisposable'));
}

var _collection;

function _load_collection() {
  return _collection = require('nuclide-commons/collection');
}

var _BusyMessageInstance;

function _load_BusyMessageInstance() {
  return _BusyMessageInstance = require('./BusyMessageInstance');
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// The "busy debounce delay" is for busy messages that were created with the
// 'debounce' option set to true. The icon and tooltip message won't appear
// until this many milliseconds have elapsed; if the busy message gets disposed
// before this time, then the user won't see anything.
/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

const BUSY_DEBOUNCE_DELAY = (cov_26momxyjt0.s[0]++, 300);

class MessageStore {
  constructor() {
    this._counter = 0;
    this._messages = new Set();
    this._currentVisibleMessages = [];
    this._messageStream = new _rxjsBundlesRxMinJs.BehaviorSubject([]);
  }

  getMessageStream() {
    cov_26momxyjt0.f[0]++;
    cov_26momxyjt0.s[1]++;

    return this._messageStream;
  }

  dispose() {
    cov_26momxyjt0.f[1]++;

    const messagesToDispose = (cov_26momxyjt0.s[2]++, [...this._messages]);
    cov_26momxyjt0.s[3]++;
    for (const message of messagesToDispose) {
      cov_26momxyjt0.s[4]++;

      message.dispose();
    }
    cov_26momxyjt0.s[5]++;

    if (!(this._messages.size === 0)) {
      throw new Error('Invariant violation: "this._messages.size === 0"');
    }

    cov_26momxyjt0.s[6]++;

    this._messageStream.complete();
  }

  _publish() {
    cov_26momxyjt0.f[2]++;
    cov_26momxyjt0.s[7]++;

    // Currently visible messages should no longer reveal the tooltip again.
    this._currentVisibleMessages.forEach(message => {
      cov_26momxyjt0.f[3]++;
      cov_26momxyjt0.s[8]++;
      return message.setRevealTooltip(false);
    });
    const visibleMessages = (cov_26momxyjt0.s[9]++, [...this._messages].filter(m => {
      cov_26momxyjt0.f[4]++;
      cov_26momxyjt0.s[10]++;
      return m.isVisible();
    }).sort((m1, m2) => {
      cov_26momxyjt0.f[5]++;
      cov_26momxyjt0.s[11]++;
      return m1.compare(m2);
    }));

    // We only send out on messageStream when the list of visible
    // BusyMessageInstance object identities has changed, e.g. when ones
    // are made visible or invisible or new ones are created. We don't send
    // out just on title change.
    cov_26momxyjt0.s[12]++;
    if (!(0, (_collection || _load_collection()).arrayEqual)(this._currentVisibleMessages, visibleMessages)) {
      cov_26momxyjt0.b[0][0]++;
      cov_26momxyjt0.s[13]++;

      this._messageStream.next(visibleMessages);
      cov_26momxyjt0.s[14]++;
      this._currentVisibleMessages = visibleMessages;
    } else {
      cov_26momxyjt0.b[0][1]++;
    }
  }

  add(title, options) {
    cov_26momxyjt0.f[6]++;
    cov_26momxyjt0.s[15]++;

    this._counter++;

    const creationOrder = (cov_26momxyjt0.s[16]++, this._counter);
    const waitingFor = (cov_26momxyjt0.s[17]++, (cov_26momxyjt0.b[2][0]++, options != null) && (cov_26momxyjt0.b[2][1]++, options.waitingFor != null) ? (cov_26momxyjt0.b[1][0]++, options.waitingFor) : (cov_26momxyjt0.b[1][1]++, 'computer'));
    const onDidClick = (cov_26momxyjt0.s[18]++, options == null ? (cov_26momxyjt0.b[3][0]++, null) : (cov_26momxyjt0.b[3][1]++, options.onDidClick));
    const messageDisposables = (cov_26momxyjt0.s[19]++, new (_UniversalDisposable || _load_UniversalDisposable()).default());

    const message = (cov_26momxyjt0.s[20]++, new (_BusyMessageInstance || _load_BusyMessageInstance()).BusyMessageInstance(this._publish.bind(this), creationOrder, waitingFor, onDidClick, messageDisposables));
    cov_26momxyjt0.s[21]++;
    this._messages.add(message);
    cov_26momxyjt0.s[22]++;
    messageDisposables.add(() => {
      cov_26momxyjt0.f[7]++;
      cov_26momxyjt0.s[23]++;
      return this._messages.delete(message);
    });

    // debounce defaults 'true' for busy-signal, and 'false' for action-required
    const debounceRaw = (cov_26momxyjt0.s[24]++, options == null ? (cov_26momxyjt0.b[4][0]++, null) : (cov_26momxyjt0.b[4][1]++, options.debounce));
    const debounce = (cov_26momxyjt0.s[25]++, debounceRaw == null ? (cov_26momxyjt0.b[5][0]++, waitingFor === 'computer') : (cov_26momxyjt0.b[5][1]++, debounceRaw));
    cov_26momxyjt0.s[26]++;
    if (debounce) {
      cov_26momxyjt0.b[6][0]++;
      cov_26momxyjt0.s[27]++;

      message.setIsVisibleForDebounce(false);
      // After the debounce time, we'll check whether the messageId is still
      // around (i.e. hasn't yet been disposed), and if so we'll display it.
      let timeoutId = (cov_26momxyjt0.s[28]++, 0);
      cov_26momxyjt0.s[29]++;
      const teardown = () => {
        cov_26momxyjt0.f[8]++;
        cov_26momxyjt0.s[30]++;
        return clearTimeout(timeoutId);
      };
      cov_26momxyjt0.s[31]++;
      timeoutId = setTimeout(() => {
        cov_26momxyjt0.f[9]++;
        cov_26momxyjt0.s[32]++;

        if (!!messageDisposables.disposed) {
          throw new Error('Invariant violation: "!messageDisposables.disposed"');
        }

        cov_26momxyjt0.s[33]++;

        if (!this._messages.has(message)) {
          throw new Error('Invariant violation: "this._messages.has(message)"');
        }
        // If the message was disposed, then it should have already called
        // clearTimeout, so this timeout handler shouldn't have been invoked.
        // And also the message should have been removed from this._messages.
        // So both tests above should necessary fail.
        // If the messageStore was disposed, then every message in it should
        // already have been disposed, as per above.


        cov_26momxyjt0.s[34]++;
        messageDisposables.remove(teardown);
        cov_26momxyjt0.s[35]++;
        message.setIsVisibleForDebounce(true);
      }, BUSY_DEBOUNCE_DELAY);
      cov_26momxyjt0.s[36]++;
      messageDisposables.add(teardown);
    } else {
      cov_26momxyjt0.b[6][1]++;
    }

    cov_26momxyjt0.s[37]++;
    if ((cov_26momxyjt0.b[8][0]++, options != null) && (cov_26momxyjt0.b[8][1]++, options.onlyForFile != null)) {
      cov_26momxyjt0.b[7][0]++;
      cov_26momxyjt0.s[38]++;

      message.setIsVisibleForFile(false);
      const file = (cov_26momxyjt0.s[39]++, options.onlyForFile);
      const teardown = (cov_26momxyjt0.s[40]++, atom.workspace.observeActivePaneItem(item => {
        cov_26momxyjt0.f[10]++;

        const activePane = (cov_26momxyjt0.s[41]++, (cov_26momxyjt0.b[10][0]++, item != null) && (cov_26momxyjt0.b[10][1]++, typeof item.getPath === 'function') ? (cov_26momxyjt0.b[9][0]++, String(item.getPath())) : (cov_26momxyjt0.b[9][1]++, null));
        const newVisible = (cov_26momxyjt0.s[42]++, activePane === file);
        cov_26momxyjt0.s[43]++;
        message.setIsVisibleForFile(newVisible);
      }));
      cov_26momxyjt0.s[44]++;
      messageDisposables.add(teardown);
    } else {
      cov_26momxyjt0.b[7][1]++;
    }

    cov_26momxyjt0.s[45]++;
    if (options.revealTooltip) {
      cov_26momxyjt0.b[11][0]++;
      cov_26momxyjt0.s[46]++;

      // When the UI component receives this message, it'll reveal the tooltip.
      // We'll clear this flag after the message becomes visible the first time.
      message.setRevealTooltip(true);
    } else {
      cov_26momxyjt0.b[11][1]++;
    }

    cov_26momxyjt0.s[47]++;
    message.setTitle(title);

    // Quick note that there aren't races in the above code! 'message' will not
    // be displayed until it has a title. So we can set visibility all we like,
    // and then when the title is set, it will display or not as appropriate.

    cov_26momxyjt0.s[48]++;
    return message;
  }
}
exports.MessageStore = MessageStore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1lc3NhZ2VTdG9yZS5qcyJdLCJuYW1lcyI6WyJCVVNZX0RFQk9VTkNFX0RFTEFZIiwiTWVzc2FnZVN0b3JlIiwiX2NvdW50ZXIiLCJfbWVzc2FnZXMiLCJTZXQiLCJfY3VycmVudFZpc2libGVNZXNzYWdlcyIsIl9tZXNzYWdlU3RyZWFtIiwiZ2V0TWVzc2FnZVN0cmVhbSIsImRpc3Bvc2UiLCJtZXNzYWdlc1RvRGlzcG9zZSIsIm1lc3NhZ2UiLCJzaXplIiwiY29tcGxldGUiLCJfcHVibGlzaCIsImZvckVhY2giLCJzZXRSZXZlYWxUb29sdGlwIiwidmlzaWJsZU1lc3NhZ2VzIiwiZmlsdGVyIiwibSIsImlzVmlzaWJsZSIsInNvcnQiLCJtMSIsIm0yIiwiY29tcGFyZSIsIm5leHQiLCJhZGQiLCJ0aXRsZSIsIm9wdGlvbnMiLCJjcmVhdGlvbk9yZGVyIiwid2FpdGluZ0ZvciIsIm9uRGlkQ2xpY2siLCJtZXNzYWdlRGlzcG9zYWJsZXMiLCJiaW5kIiwiZGVsZXRlIiwiZGVib3VuY2VSYXciLCJkZWJvdW5jZSIsInNldElzVmlzaWJsZUZvckRlYm91bmNlIiwidGltZW91dElkIiwidGVhcmRvd24iLCJzZXRUaW1lb3V0IiwiZGlzcG9zZWQiLCJoYXMiLCJyZW1vdmUiLCJvbmx5Rm9yRmlsZSIsInNldElzVmlzaWJsZUZvckZpbGUiLCJmaWxlIiwiYXRvbSIsIndvcmtzcGFjZSIsIm9ic2VydmVBY3RpdmVQYW5lSXRlbSIsIml0ZW0iLCJhY3RpdmVQYW5lIiwiZ2V0UGF0aCIsIlN0cmluZyIsIm5ld1Zpc2libGUiLCJyZXZlYWxUb29sdGlwIiwic2V0VGl0bGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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LG1CQUFSLENBQTRCLEtBQTVCO0FBQ0EsWUFBTUMsZ0NBQU9sQixRQUFRZ0IsV0FBZixDQUFOO0FBQ0EsWUFBTUwsb0NBQVdRLEtBQUtDLFNBQUwsQ0FBZUMscUJBQWYsQ0FBcUNDLFFBQVE7QUFBQTs7QUFDNUQsY0FBTUMsc0NBQ0osb0NBQVEsSUFBUixpQ0FBZ0IsT0FBT0QsS0FBS0UsT0FBWixLQUF3QixVQUF4QywrQkFDSUMsT0FBT0gsS0FBS0UsT0FBTCxFQUFQLENBREosK0JBRUksSUFGSixDQURJLENBQU47QUFJQSxjQUFNRSxzQ0FBYUgsZUFBZUwsSUFBNUIsQ0FBTjtBQUw0RDtBQU01RG5DLGdCQUFRa0MsbUJBQVIsQ0FBNEJTLFVBQTVCO0FBQ0QsT0FQZ0IsQ0FBWCxDQUFOO0FBSGtEO0FBV2xEdEIseUJBQW1CTixHQUFuQixDQUF1QmEsUUFBdkI7QUFDRCxLQVpEO0FBQUE7QUFBQTs7QUE5QzBEO0FBNEQxRCxRQUFJWCxRQUFRMkIsYUFBWixFQUEyQjtBQUFBO0FBQUE7O0FBQ3pCO0FBQ0E7QUFDQTVDLGNBQVFLLGdCQUFSLENBQXlCLElBQXpCO0FBQ0QsS0FKRDtBQUFBO0FBQUE7O0FBNUQwRDtBQWtFMURMLFlBQVE2QyxRQUFSLENBQWlCN0IsS0FBakI7O0FBRUE7QUFDQTtBQUNBOztBQXRFMEQ7QUF3RTFELFdBQU9oQixPQUFQO0FBQ0Q7QUFqSHVCO1FBQWJULFksR0FBQUEsWSIsImZpbGUiOiJNZXNzYWdlU3RvcmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQgdHlwZSB7QnVzeU1lc3NhZ2UsIEJ1c3lTaWduYWxPcHRpb25zfSBmcm9tICcuL3R5cGVzJztcblxuaW1wb3J0IGludmFyaWFudCBmcm9tICdhc3NlcnQnO1xuaW1wb3J0IHtPYnNlcnZhYmxlLCBCZWhhdmlvclN1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IFVuaXZlcnNhbERpc3Bvc2FibGUgZnJvbSAnbnVjbGlkZS1jb21tb25zL1VuaXZlcnNhbERpc3Bvc2FibGUnO1xuaW1wb3J0IHthcnJheUVxdWFsfSBmcm9tICdudWNsaWRlLWNvbW1vbnMvY29sbGVjdGlvbic7XG5pbXBvcnQge0J1c3lNZXNzYWdlSW5zdGFuY2V9IGZyb20gJy4vQnVzeU1lc3NhZ2VJbnN0YW5jZSc7XG5cbi8vIFRoZSBcImJ1c3kgZGVib3VuY2UgZGVsYXlcIiBpcyBmb3IgYnVzeSBtZXNzYWdlcyB0aGF0IHdlcmUgY3JlYXRlZCB3aXRoIHRoZVxuLy8gJ2RlYm91bmNlJyBvcHRpb24gc2V0IHRvIHRydWUuIFRoZSBpY29uIGFuZCB0b29sdGlwIG1lc3NhZ2Ugd29uJ3QgYXBwZWFyXG4vLyB1bnRpbCB0aGlzIG1hbnkgbWlsbGlzZWNvbmRzIGhhdmUgZWxhcHNlZDsgaWYgdGhlIGJ1c3kgbWVzc2FnZSBnZXRzIGRpc3Bvc2VkXG4vLyBiZWZvcmUgdGhpcyB0aW1lLCB0aGVuIHRoZSB1c2VyIHdvbid0IHNlZSBhbnl0aGluZy5cbmNvbnN0IEJVU1lfREVCT1VOQ0VfREVMQVkgPSAzMDA7XG5cbmV4cG9ydCBjbGFzcyBNZXNzYWdlU3RvcmUge1xuICBfY291bnRlcjogbnVtYmVyID0gMDtcbiAgX21lc3NhZ2VzOiBTZXQ8QnVzeU1lc3NhZ2VJbnN0YW5jZT4gPSBuZXcgU2V0KCk7XG4gIF9jdXJyZW50VmlzaWJsZU1lc3NhZ2VzOiBBcnJheTxCdXN5TWVzc2FnZUluc3RhbmNlPiA9IFtdO1xuICBfbWVzc2FnZVN0cmVhbTogQmVoYXZpb3JTdWJqZWN0PFxuICAgIEFycmF5PEJ1c3lNZXNzYWdlSW5zdGFuY2U+LFxuICA+ID0gbmV3IEJlaGF2aW9yU3ViamVjdChbXSk7XG5cbiAgZ2V0TWVzc2FnZVN0cmVhbSgpOiBPYnNlcnZhYmxlPEFycmF5PEJ1c3lNZXNzYWdlSW5zdGFuY2U+PiB7XG4gICAgcmV0dXJuIHRoaXMuX21lc3NhZ2VTdHJlYW07XG4gIH1cblxuICBkaXNwb3NlKCk6IHZvaWQge1xuICAgIGNvbnN0IG1lc3NhZ2VzVG9EaXNwb3NlID0gWy4uLnRoaXMuX21lc3NhZ2VzXTtcbiAgICBmb3IgKGNvbnN0IG1lc3NhZ2Ugb2YgbWVzc2FnZXNUb0Rpc3Bvc2UpIHtcbiAgICAgIG1lc3NhZ2UuZGlzcG9zZSgpO1xuICAgIH1cbiAgICBpbnZhcmlhbnQodGhpcy5fbWVzc2FnZXMuc2l6ZSA9PT0gMCk7XG4gICAgdGhpcy5fbWVzc2FnZVN0cmVhbS5jb21wbGV0ZSgpO1xuICB9XG5cbiAgX3B1Ymxpc2goKTogdm9pZCB7XG4gICAgLy8gQ3VycmVudGx5IHZpc2libGUgbWVzc2FnZXMgc2hvdWxkIG5vIGxvbmdlciByZXZlYWwgdGhlIHRvb2x0aXAgYWdhaW4uXG4gICAgdGhpcy5fY3VycmVudFZpc2libGVNZXNzYWdlcy5mb3JFYWNoKG1lc3NhZ2UgPT5cbiAgICAgIG1lc3NhZ2Uuc2V0UmV2ZWFsVG9vbHRpcChmYWxzZSksXG4gICAgKTtcbiAgICBjb25zdCB2aXNpYmxlTWVzc2FnZXMgPSBbLi4udGhpcy5fbWVzc2FnZXNdXG4gICAgICAuZmlsdGVyKG0gPT4gbS5pc1Zpc2libGUoKSlcbiAgICAgIC5zb3J0KChtMSwgbTIpID0+IG0xLmNvbXBhcmUobTIpKTtcblxuICAgIC8vIFdlIG9ubHkgc2VuZCBvdXQgb24gbWVzc2FnZVN0cmVhbSB3aGVuIHRoZSBsaXN0IG9mIHZpc2libGVcbiAgICAvLyBCdXN5TWVzc2FnZUluc3RhbmNlIG9iamVjdCBpZGVudGl0aWVzIGhhcyBjaGFuZ2VkLCBlLmcuIHdoZW4gb25lc1xuICAgIC8vIGFyZSBtYWRlIHZpc2libGUgb3IgaW52aXNpYmxlIG9yIG5ldyBvbmVzIGFyZSBjcmVhdGVkLiBXZSBkb24ndCBzZW5kXG4gICAgLy8gb3V0IGp1c3Qgb24gdGl0bGUgY2hhbmdlLlxuICAgIGlmICghYXJyYXlFcXVhbCh0aGlzLl9jdXJyZW50VmlzaWJsZU1lc3NhZ2VzLCB2aXNpYmxlTWVzc2FnZXMpKSB7XG4gICAgICB0aGlzLl9tZXNzYWdlU3RyZWFtLm5leHQodmlzaWJsZU1lc3NhZ2VzKTtcbiAgICAgIHRoaXMuX2N1cnJlbnRWaXNpYmxlTWVzc2FnZXMgPSB2aXNpYmxlTWVzc2FnZXM7XG4gICAgfVxuICB9XG5cbiAgYWRkKHRpdGxlOiBzdHJpbmcsIG9wdGlvbnM6IEJ1c3lTaWduYWxPcHRpb25zKTogQnVzeU1lc3NhZ2Uge1xuICAgIHRoaXMuX2NvdW50ZXIrKztcblxuICAgIGNvbnN0IGNyZWF0aW9uT3JkZXIgPSB0aGlzLl9jb3VudGVyO1xuICAgIGNvbnN0IHdhaXRpbmdGb3IgPVxuICAgICAgb3B0aW9ucyAhPSBudWxsICYmIG9wdGlvbnMud2FpdGluZ0ZvciAhPSBudWxsXG4gICAgICAgID8gb3B0aW9ucy53YWl0aW5nRm9yXG4gICAgICAgIDogJ2NvbXB1dGVyJztcbiAgICBjb25zdCBvbkRpZENsaWNrID0gb3B0aW9ucyA9PSBudWxsID8gbnVsbCA6IG9wdGlvbnMub25EaWRDbGljaztcbiAgICBjb25zdCBtZXNzYWdlRGlzcG9zYWJsZXMgPSBuZXcgVW5pdmVyc2FsRGlzcG9zYWJsZSgpO1xuXG4gICAgY29uc3QgbWVzc2FnZSA9IG5ldyBCdXN5TWVzc2FnZUluc3RhbmNlKFxuICAgICAgdGhpcy5fcHVibGlzaC5iaW5kKHRoaXMpLFxuICAgICAgY3JlYXRpb25PcmRlcixcbiAgICAgIHdhaXRpbmdGb3IsXG4gICAgICBvbkRpZENsaWNrLFxuICAgICAgbWVzc2FnZURpc3Bvc2FibGVzLFxuICAgICk7XG4gICAgdGhpcy5fbWVzc2FnZXMuYWRkKG1lc3NhZ2UpO1xuICAgIG1lc3NhZ2VEaXNwb3NhYmxlcy5hZGQoKCkgPT4gdGhpcy5fbWVzc2FnZXMuZGVsZXRlKG1lc3NhZ2UpKTtcblxuICAgIC8vIGRlYm91bmNlIGRlZmF1bHRzICd0cnVlJyBmb3IgYnVzeS1zaWduYWwsIGFuZCAnZmFsc2UnIGZvciBhY3Rpb24tcmVxdWlyZWRcbiAgICBjb25zdCBkZWJvdW5jZVJhdzogP2Jvb2xlYW4gPSBvcHRpb25zID09IG51bGwgPyBudWxsIDogb3B0aW9ucy5kZWJvdW5jZTtcbiAgICBjb25zdCBkZWJvdW5jZTogYm9vbGVhbiA9XG4gICAgICBkZWJvdW5jZVJhdyA9PSBudWxsID8gd2FpdGluZ0ZvciA9PT0gJ2NvbXB1dGVyJyA6IGRlYm91bmNlUmF3O1xuICAgIGlmIChkZWJvdW5jZSkge1xuICAgICAgbWVzc2FnZS5zZXRJc1Zpc2libGVGb3JEZWJvdW5jZShmYWxzZSk7XG4gICAgICAvLyBBZnRlciB0aGUgZGVib3VuY2UgdGltZSwgd2UnbGwgY2hlY2sgd2hldGhlciB0aGUgbWVzc2FnZUlkIGlzIHN0aWxsXG4gICAgICAvLyBhcm91bmQgKGkuZS4gaGFzbid0IHlldCBiZWVuIGRpc3Bvc2VkKSwgYW5kIGlmIHNvIHdlJ2xsIGRpc3BsYXkgaXQuXG4gICAgICBsZXQgdGltZW91dElkID0gMDtcbiAgICAgIGNvbnN0IHRlYXJkb3duID0gKCkgPT4gY2xlYXJUaW1lb3V0KHRpbWVvdXRJZCk7XG4gICAgICB0aW1lb3V0SWQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgaW52YXJpYW50KCFtZXNzYWdlRGlzcG9zYWJsZXMuZGlzcG9zZWQpO1xuICAgICAgICBpbnZhcmlhbnQodGhpcy5fbWVzc2FnZXMuaGFzKG1lc3NhZ2UpKTtcbiAgICAgICAgLy8gSWYgdGhlIG1lc3NhZ2Ugd2FzIGRpc3Bvc2VkLCB0aGVuIGl0IHNob3VsZCBoYXZlIGFscmVhZHkgY2FsbGVkXG4gICAgICAgIC8vIGNsZWFyVGltZW91dCwgc28gdGhpcyB0aW1lb3V0IGhhbmRsZXIgc2hvdWxkbid0IGhhdmUgYmVlbiBpbnZva2VkLlxuICAgICAgICAvLyBBbmQgYWxzbyB0aGUgbWVzc2FnZSBzaG91bGQgaGF2ZSBiZWVuIHJlbW92ZWQgZnJvbSB0aGlzLl9tZXNzYWdlcy5cbiAgICAgICAgLy8gU28gYm90aCB0ZXN0cyBhYm92ZSBzaG91bGQgbmVjZXNzYXJ5IGZhaWwuXG4gICAgICAgIC8vIElmIHRoZSBtZXNzYWdlU3RvcmUgd2FzIGRpc3Bvc2VkLCB0aGVuIGV2ZXJ5IG1lc3NhZ2UgaW4gaXQgc2hvdWxkXG4gICAgICAgIC8vIGFscmVhZHkgaGF2ZSBiZWVuIGRpc3Bvc2VkLCBhcyBwZXIgYWJvdmUuXG4gICAgICAgIG1lc3NhZ2VEaXNwb3NhYmxlcy5yZW1vdmUodGVhcmRvd24pO1xuICAgICAgICBtZXNzYWdlLnNldElzVmlzaWJsZUZvckRlYm91bmNlKHRydWUpO1xuICAgICAgfSwgQlVTWV9ERUJPVU5DRV9ERUxBWSk7XG4gICAgICBtZXNzYWdlRGlzcG9zYWJsZXMuYWRkKHRlYXJkb3duKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucyAhPSBudWxsICYmIG9wdGlvbnMub25seUZvckZpbGUgIT0gbnVsbCkge1xuICAgICAgbWVzc2FnZS5zZXRJc1Zpc2libGVGb3JGaWxlKGZhbHNlKTtcbiAgICAgIGNvbnN0IGZpbGUgPSBvcHRpb25zLm9ubHlGb3JGaWxlO1xuICAgICAgY29uc3QgdGVhcmRvd24gPSBhdG9tLndvcmtzcGFjZS5vYnNlcnZlQWN0aXZlUGFuZUl0ZW0oaXRlbSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVBhbmUgPVxuICAgICAgICAgIGl0ZW0gIT0gbnVsbCAmJiB0eXBlb2YgaXRlbS5nZXRQYXRoID09PSAnZnVuY3Rpb24nXG4gICAgICAgICAgICA/IFN0cmluZyhpdGVtLmdldFBhdGgoKSlcbiAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgY29uc3QgbmV3VmlzaWJsZSA9IGFjdGl2ZVBhbmUgPT09IGZpbGU7XG4gICAgICAgIG1lc3NhZ2Uuc2V0SXNWaXNpYmxlRm9yRmlsZShuZXdWaXNpYmxlKTtcbiAgICAgIH0pO1xuICAgICAgbWVzc2FnZURpc3Bvc2FibGVzLmFkZCh0ZWFyZG93bik7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMucmV2ZWFsVG9vbHRpcCkge1xuICAgICAgLy8gV2hlbiB0aGUgVUkgY29tcG9uZW50IHJlY2VpdmVzIHRoaXMgbWVzc2FnZSwgaXQnbGwgcmV2ZWFsIHRoZSB0b29sdGlwLlxuICAgICAgLy8gV2UnbGwgY2xlYXIgdGhpcyBmbGFnIGFmdGVyIHRoZSBtZXNzYWdlIGJlY29tZXMgdmlzaWJsZSB0aGUgZmlyc3QgdGltZS5cbiAgICAgIG1lc3NhZ2Uuc2V0UmV2ZWFsVG9vbHRpcCh0cnVlKTtcbiAgICB9XG5cbiAgICBtZXNzYWdlLnNldFRpdGxlKHRpdGxlKTtcblxuICAgIC8vIFF1aWNrIG5vdGUgdGhhdCB0aGVyZSBhcmVuJ3QgcmFjZXMgaW4gdGhlIGFib3ZlIGNvZGUhICdtZXNzYWdlJyB3aWxsIG5vdFxuICAgIC8vIGJlIGRpc3BsYXllZCB1bnRpbCBpdCBoYXMgYSB0aXRsZS4gU28gd2UgY2FuIHNldCB2aXNpYmlsaXR5IGFsbCB3ZSBsaWtlLFxuICAgIC8vIGFuZCB0aGVuIHdoZW4gdGhlIHRpdGxlIGlzIHNldCwgaXQgd2lsbCBkaXNwbGF5IG9yIG5vdCBhcyBhcHByb3ByaWF0ZS5cblxuICAgIHJldHVybiBtZXNzYWdlO1xuICB9XG59XG4iXX0=