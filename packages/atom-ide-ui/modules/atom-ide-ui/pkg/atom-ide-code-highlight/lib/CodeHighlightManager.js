'use strict';

var cov_1w0a7hkd2w = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-code-highlight/lib/CodeHighlightManager.js',
      hash = 'b97efab80f315e813612e43f38bdd5f3482307ce',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-code-highlight/lib/CodeHighlightManager.js',
    statementMap: {
      '0': {
        start: {
          line: 22,
          column: 27
        },
        end: {
          line: 22,
          column: 30
        }
      },
      '1': {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 30,
          column: 45
        }
      },
      '2': {
        start: {
          line: 31,
          column: 4
        },
        end: {
          line: 31,
          column: 23
        }
      },
      '3': {
        start: {
          line: 32,
          column: 4
        },
        end: {
          line: 32,
          column: 76
        }
      },
      '4': {
        start: {
          line: 36,
          column: 4
        },
        end: {
          line: 82,
          column: 9
        }
      },
      '5': {
        start: {
          line: 38,
          column: 8
        },
        end: {
          line: 40,
          column: 9
        }
      },
      '6': {
        start: {
          line: 39,
          column: 10
        },
        end: {
          line: 39,
          column: 36
        }
      },
      '7': {
        start: {
          line: 41,
          column: 35
        },
        end: {
          line: 48,
          column: 11
        }
      },
      '8': {
        start: {
          line: 44,
          column: 24
        },
        end: {
          line: 44,
          column: 47
        }
      },
      '9': {
        start: {
          line: 47,
          column: 24
        },
        end: {
          line: 47,
          column: 78
        }
      },
      '10': {
        start: {
          line: 50,
          column: 29
        },
        end: {
          line: 55,
          column: 54
        }
      },
      '11': {
        start: {
          line: 55,
          column: 21
        },
        end: {
          line: 55,
          column: 53
        }
      },
      '12': {
        start: {
          line: 57,
          column: 30
        },
        end: {
          line: 59,
          column: 9
        }
      },
      '13': {
        start: {
          line: 61,
          column: 8
        },
        end: {
          line: 76,
          column: 10
        }
      },
      '14': {
        start: {
          line: 64,
          column: 22
        },
        end: {
          line: 64,
          column: 44
        }
      },
      '15': {
        start: {
          line: 66,
          column: 14
        },
        end: {
          line: 73,
          column: 17
        }
      },
      '16': {
        start: {
          line: 69,
          column: 16
        },
        end: {
          line: 72,
          column: 18
        }
      },
      '17': {
        start: {
          line: 79,
          column: 8
        },
        end: {
          line: 81,
          column: 9
        }
      },
      '18': {
        start: {
          line: 80,
          column: 10
        },
        end: {
          line: 80,
          column: 48
        }
      },
      '19': {
        start: {
          line: 89,
          column: 21
        },
        end: {
          line: 89,
          column: 65
        }
      },
      '20': {
        start: {
          line: 90,
          column: 4
        },
        end: {
          line: 92,
          column: 5
        }
      },
      '21': {
        start: {
          line: 91,
          column: 6
        },
        end: {
          line: 91,
          column: 18
        }
      },
      '22': {
        start: {
          line: 94,
          column: 4
        },
        end: {
          line: 99,
          column: 5
        }
      },
      '23': {
        start: {
          line: 95,
          column: 6
        },
        end: {
          line: 95,
          column: 56
        }
      },
      '24': {
        start: {
          line: 97,
          column: 6
        },
        end: {
          line: 97,
          column: 76
        }
      },
      '25': {
        start: {
          line: 98,
          column: 6
        },
        end: {
          line: 98,
          column: 18
        }
      },
      '26': {
        start: {
          line: 103,
          column: 4
        },
        end: {
          line: 103,
          column: 27
        }
      },
      '27': {
        start: {
          line: 104,
          column: 4
        },
        end: {
          line: 104,
          column: 75
        }
      },
      '28': {
        start: {
          line: 104,
          column: 40
        },
        end: {
          line: 104,
          column: 73
        }
      },
      '29': {
        start: {
          line: 105,
          column: 4
        },
        end: {
          line: 110,
          column: 7
        }
      },
      '30': {
        start: {
          line: 106,
          column: 6
        },
        end: {
          line: 109,
          column: 9
        }
      },
      '31': {
        start: {
          line: 117,
          column: 4
        },
        end: {
          line: 119,
          column: 52
        }
      },
      '32': {
        start: {
          line: 118,
          column: 21
        },
        end: {
          line: 118,
          column: 44
        }
      },
      '33': {
        start: {
          line: 119,
          column: 21
        },
        end: {
          line: 119,
          column: 50
        }
      },
      '34': {
        start: {
          line: 123,
          column: 4
        },
        end: {
          line: 123,
          column: 64
        }
      },
      '35': {
        start: {
          line: 123,
          column: 46
        },
        end: {
          line: 123,
          column: 62
        }
      },
      '36': {
        start: {
          line: 127,
          column: 4
        },
        end: {
          line: 127,
          column: 49
        }
      },
      '37': {
        start: {
          line: 131,
          column: 4
        },
        end: {
          line: 131,
          column: 34
        }
      },
      '38': {
        start: {
          line: 132,
          column: 4
        },
        end: {
          line: 132,
          column: 27
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 29,
            column: 2
          },
          end: {
            line: 29,
            column: 3
          }
        },
        loc: {
          start: {
            line: 29,
            column: 16
          },
          end: {
            line: 33,
            column: 3
          }
        },
        line: 29
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 35,
            column: 2
          },
          end: {
            line: 35,
            column: 3
          }
        },
        loc: {
          start: {
            line: 35,
            column: 41
          },
          end: {
            line: 83,
            column: 3
          }
        },
        line: 35
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 37,
            column: 17
          },
          end: {
            line: 37,
            column: 18
          }
        },
        loc: {
          start: {
            line: 37,
            column: 27
          },
          end: {
            line: 77,
            column: 7
          }
        },
        line: 37
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 44,
            column: 15
          },
          end: {
            line: 44,
            column: 16
          }
        },
        loc: {
          start: {
            line: 44,
            column: 24
          },
          end: {
            line: 44,
            column: 47
          }
        },
        line: 44
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 47,
            column: 12
          },
          end: {
            line: 47,
            column: 13
          }
        },
        loc: {
          start: {
            line: 47,
            column: 24
          },
          end: {
            line: 47,
            column: 78
          }
        },
        line: 47
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 55,
            column: 15
          },
          end: {
            line: 55,
            column: 16
          }
        },
        loc: {
          start: {
            line: 55,
            column: 21
          },
          end: {
            line: 55,
            column: 53
          }
        },
        line: 55
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 64,
            column: 16
          },
          end: {
            line: 64,
            column: 17
          }
        },
        loc: {
          start: {
            line: 64,
            column: 22
          },
          end: {
            line: 64,
            column: 44
          }
        },
        line: 64
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 65,
            column: 23
          },
          end: {
            line: 65,
            column: 24
          }
        },
        loc: {
          start: {
            line: 65,
            column: 35
          },
          end: {
            line: 74,
            column: 13
          }
        },
        line: 65
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 68,
            column: 26
          },
          end: {
            line: 68,
            column: 27
          }
        },
        loc: {
          start: {
            line: 68,
            column: 38
          },
          end: {
            line: 73,
            column: 15
          }
        },
        line: 68
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 78,
            column: 17
          },
          end: {
            line: 78,
            column: 18
          }
        },
        loc: {
          start: {
            line: 78,
            column: 39
          },
          end: {
            line: 82,
            column: 7
          }
        },
        line: 78
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 85,
            column: 2
          },
          end: {
            line: 85,
            column: 3
          }
        },
        loc: {
          start: {
            line: 88,
            column: 33
          },
          end: {
            line: 100,
            column: 3
          }
        },
        line: 88
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 102,
            column: 2
          },
          end: {
            line: 102,
            column: 3
          }
        },
        loc: {
          start: {
            line: 102,
            column: 77
          },
          end: {
            line: 111,
            column: 3
          }
        },
        line: 102
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 104,
            column: 31
          },
          end: {
            line: 104,
            column: 32
          }
        },
        loc: {
          start: {
            line: 104,
            column: 40
          },
          end: {
            line: 104,
            column: 73
          }
        },
        line: 104
      },
      '13': {
        name: '(anonymous_13)',
        decl: {
          start: {
            line: 105,
            column: 26
          },
          end: {
            line: 105,
            column: 27
          }
        },
        loc: {
          start: {
            line: 105,
            column: 36
          },
          end: {
            line: 110,
            column: 5
          }
        },
        line: 105
      },
      '14': {
        name: '(anonymous_14)',
        decl: {
          start: {
            line: 113,
            column: 2
          },
          end: {
            line: 113,
            column: 3
          }
        },
        loc: {
          start: {
            line: 116,
            column: 13
          },
          end: {
            line: 120,
            column: 3
          }
        },
        line: 116
      },
      '15': {
        name: '(anonymous_15)',
        decl: {
          start: {
            line: 118,
            column: 11
          },
          end: {
            line: 118,
            column: 12
          }
        },
        loc: {
          start: {
            line: 118,
            column: 21
          },
          end: {
            line: 118,
            column: 44
          }
        },
        line: 118
      },
      '16': {
        name: '(anonymous_16)',
        decl: {
          start: {
            line: 119,
            column: 12
          },
          end: {
            line: 119,
            column: 13
          }
        },
        loc: {
          start: {
            line: 119,
            column: 21
          },
          end: {
            line: 119,
            column: 50
          }
        },
        line: 119
      },
      '17': {
        name: '(anonymous_17)',
        decl: {
          start: {
            line: 122,
            column: 2
          },
          end: {
            line: 122,
            column: 3
          }
        },
        loc: {
          start: {
            line: 122,
            column: 26
          },
          end: {
            line: 124,
            column: 3
          }
        },
        line: 122
      },
      '18': {
        name: '(anonymous_18)',
        decl: {
          start: {
            line: 123,
            column: 36
          },
          end: {
            line: 123,
            column: 37
          }
        },
        loc: {
          start: {
            line: 123,
            column: 46
          },
          end: {
            line: 123,
            column: 62
          }
        },
        line: 123
      },
      '19': {
        name: '(anonymous_19)',
        decl: {
          start: {
            line: 126,
            column: 2
          },
          end: {
            line: 126,
            column: 3
          }
        },
        loc: {
          start: {
            line: 126,
            column: 60
          },
          end: {
            line: 128,
            column: 3
          }
        },
        line: 126
      },
      '20': {
        name: '(anonymous_20)',
        decl: {
          start: {
            line: 130,
            column: 2
          },
          end: {
            line: 130,
            column: 3
          }
        },
        loc: {
          start: {
            line: 130,
            column: 12
          },
          end: {
            line: 133,
            column: 3
          }
        },
        line: 130
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 38,
            column: 8
          },
          end: {
            line: 40,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 38,
            column: 8
          },
          end: {
            line: 40,
            column: 9
          }
        }, {
          start: {
            line: 38,
            column: 8
          },
          end: {
            line: 40,
            column: 9
          }
        }],
        line: 38
      },
      '1': {
        loc: {
          start: {
            line: 79,
            column: 8
          },
          end: {
            line: 81,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 79,
            column: 8
          },
          end: {
            line: 81,
            column: 9
          }
        }, {
          start: {
            line: 79,
            column: 8
          },
          end: {
            line: 81,
            column: 9
          }
        }],
        line: 79
      },
      '2': {
        loc: {
          start: {
            line: 90,
            column: 4
          },
          end: {
            line: 92,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 90,
            column: 4
          },
          end: {
            line: 92,
            column: 5
          }
        }, {
          start: {
            line: 90,
            column: 4
          },
          end: {
            line: 92,
            column: 5
          }
        }],
        line: 90
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _asyncToGenerator = _interopRequireDefault(require('async-to-generator'));

var _log4js;

function _load_log4js() {
  return _log4js = require('log4js');
}

var _rxjsBundlesRxMinJs = require('rxjs/bundles/Rx.min.js');

var _event;

function _load_event() {
  return _event = require('nuclide-commons/event');
}

var _UniversalDisposable;

function _load_UniversalDisposable() {
  return _UniversalDisposable = _interopRequireDefault(require('nuclide-commons/UniversalDisposable'));
}

var _ProviderRegistry;

function _load_ProviderRegistry() {
  return _ProviderRegistry = _interopRequireDefault(require('nuclide-commons-atom/ProviderRegistry'));
}

var _debounced;

function _load_debounced() {
  return _debounced = require('nuclide-commons-atom/debounced');
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const HIGHLIGHT_DELAY_MS = (cov_1w0a7hkd2w.s[0]++, 250); /**
                                                          * Copyright (c) 2017-present, Facebook, Inc.
                                                          * All rights reserved.
                                                          *
                                                          * This source code is licensed under the BSD-style license found in the
                                                          * LICENSE file in the root directory of this source tree. An additional grant
                                                          * of patent rights can be found in the PATENTS file in the same directory.
                                                          *
                                                          * 
                                                          * @format
                                                          */

class CodeHighlightManager {

  constructor() {
    cov_1w0a7hkd2w.f[0]++;
    cov_1w0a7hkd2w.s[1]++;

    this._providers = new (_ProviderRegistry || _load_ProviderRegistry()).default();
    cov_1w0a7hkd2w.s[2]++;
    this._markers = [];
    cov_1w0a7hkd2w.s[3]++;
    this._subscriptions = new (_UniversalDisposable || _load_UniversalDisposable()).default(this._highlightEditors());
  }

  _highlightEditors() {
    var _this = this;

    cov_1w0a7hkd2w.f[1]++;
    cov_1w0a7hkd2w.s[4]++;

    return (0, (_debounced || _load_debounced()).observeActiveEditorsDebounced)(0).switchMap(editor => {
      cov_1w0a7hkd2w.f[2]++;
      cov_1w0a7hkd2w.s[5]++;

      if (editor == null) {
        cov_1w0a7hkd2w.b[0][0]++;
        cov_1w0a7hkd2w.s[6]++;

        return _rxjsBundlesRxMinJs.Observable.empty();
      } else {
        cov_1w0a7hkd2w.b[0][1]++;
      }
      const changeCursorEvents = (cov_1w0a7hkd2w.s[7]++, (0, (_event || _load_event()).observableFromSubscribeFunction)(editor.onDidChangeCursorPosition.bind(editor)).map(event => {
        cov_1w0a7hkd2w.f[3]++;
        cov_1w0a7hkd2w.s[8]++;
        return event.newBufferPosition;
      }).filter(
      // If we're moving around inside highlighted ranges, that's fine.
      position => {
        cov_1w0a7hkd2w.f[4]++;
        cov_1w0a7hkd2w.s[9]++;
        return !this._isPositionInHighlightedRanges(editor, position);
      }));

      const changeEvents = (cov_1w0a7hkd2w.s[10]++, (0, (_event || _load_event()).observableFromSubscribeFunction)(editor.onDidChange.bind(editor))
      // Ensure we start highlighting immediately.
      .startWith(null).map(() => {
        cov_1w0a7hkd2w.f[5]++;
        cov_1w0a7hkd2w.s[11]++;
        return editor.getCursorBufferPosition();
      }));

      const destroyEvents = (cov_1w0a7hkd2w.s[12]++, (0, (_event || _load_event()).observableFromSubscribeFunction)(editor.onDidDestroy.bind(editor)));

      cov_1w0a7hkd2w.s[13]++;
      return _rxjsBundlesRxMinJs.Observable.merge(changeCursorEvents, changeEvents)
      // Destroy old markers immediately - never show stale results.
      .do(() => {
        cov_1w0a7hkd2w.f[6]++;
        cov_1w0a7hkd2w.s[14]++;
        return this._destroyMarkers();
      }).switchMap(position => {
        cov_1w0a7hkd2w.f[7]++;
        cov_1w0a7hkd2w.s[15]++;

        return _rxjsBundlesRxMinJs.Observable.timer(HIGHLIGHT_DELAY_MS).switchMap((0, _asyncToGenerator.default)(function* () {
          cov_1w0a7hkd2w.f[8]++;
          cov_1w0a7hkd2w.s[16]++;

          return {
            editor,
            ranges: yield _this._getHighlightedRanges(editor, position)
          };
        }));
      }).takeUntil(destroyEvents);
    }).subscribe(({ editor, ranges }) => {
      cov_1w0a7hkd2w.f[9]++;
      cov_1w0a7hkd2w.s[17]++;

      if (ranges != null) {
        cov_1w0a7hkd2w.b[1][0]++;
        cov_1w0a7hkd2w.s[18]++;

        this._highlightRanges(editor, ranges);
      } else {
        cov_1w0a7hkd2w.b[1][1]++;
      }
    });
  }

  _getHighlightedRanges(editor, position) {
    var _this2 = this;

    return (0, _asyncToGenerator.default)(function* () {
      cov_1w0a7hkd2w.f[10]++;

      const provider = (cov_1w0a7hkd2w.s[19]++, _this2._providers.getProviderForEditor(editor));
      cov_1w0a7hkd2w.s[20]++;
      if (!provider) {
        cov_1w0a7hkd2w.b[2][0]++;
        cov_1w0a7hkd2w.s[21]++;

        return null;
      } else {
        cov_1w0a7hkd2w.b[2][1]++;
      }

      cov_1w0a7hkd2w.s[22]++;
      try {
        cov_1w0a7hkd2w.s[23]++;

        return yield provider.highlight(editor, position);
      } catch (e) {
        cov_1w0a7hkd2w.s[24]++;

        (0, (_log4js || _load_log4js()).getLogger)('code-highlight').error('Error getting code highlights', e);
        cov_1w0a7hkd2w.s[25]++;
        return null;
      }
    })();
  }

  _highlightRanges(editor, ranges) {
    cov_1w0a7hkd2w.f[11]++;
    cov_1w0a7hkd2w.s[26]++;

    this._destroyMarkers();
    cov_1w0a7hkd2w.s[27]++;
    this._markers = ranges.map(range => {
      cov_1w0a7hkd2w.f[12]++;
      cov_1w0a7hkd2w.s[28]++;
      return editor.markBufferRange(range, {});
    });
    cov_1w0a7hkd2w.s[29]++;
    this._markers.forEach(marker => {
      cov_1w0a7hkd2w.f[13]++;
      cov_1w0a7hkd2w.s[30]++;

      editor.decorateMarker(marker, {
        type: 'highlight',
        class: 'code-highlight-marker'
      });
    });
  }

  _isPositionInHighlightedRanges(editor, position) {
    cov_1w0a7hkd2w.f[14]++;
    cov_1w0a7hkd2w.s[31]++;

    return this._markers.map(marker => {
      cov_1w0a7hkd2w.f[15]++;
      cov_1w0a7hkd2w.s[32]++;
      return marker.getBufferRange();
    }).some(range => {
      cov_1w0a7hkd2w.f[16]++;
      cov_1w0a7hkd2w.s[33]++;
      return range.containsPoint(position);
    });
  }

  _destroyMarkers() {
    cov_1w0a7hkd2w.f[17]++;
    cov_1w0a7hkd2w.s[34]++;

    this._markers.splice(0).forEach(marker => {
      cov_1w0a7hkd2w.f[18]++;
      cov_1w0a7hkd2w.s[35]++;
      return marker.destroy();
    });
  }

  addProvider(provider) {
    cov_1w0a7hkd2w.f[19]++;
    cov_1w0a7hkd2w.s[36]++;

    return this._providers.addProvider(provider);
  }

  dispose() {
    cov_1w0a7hkd2w.f[20]++;
    cov_1w0a7hkd2w.s[37]++;

    this._subscriptions.dispose();
    cov_1w0a7hkd2w.s[38]++;
    this._destroyMarkers();
  }
}
exports.default = CodeHighlightManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvZGVIaWdobGlnaHRNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbIkhJR0hMSUdIVF9ERUxBWV9NUyIsIkNvZGVIaWdobGlnaHRNYW5hZ2VyIiwiY29uc3RydWN0b3IiLCJfcHJvdmlkZXJzIiwiX21hcmtlcnMiLCJfc3Vic2NyaXB0aW9ucyIsIl9oaWdobGlnaHRFZGl0b3JzIiwic3dpdGNoTWFwIiwiZWRpdG9yIiwiZW1wdHkiLCJjaGFuZ2VDdXJzb3JFdmVudHMiLCJvbkRpZENoYW5nZUN1cnNvclBvc2l0aW9uIiwiYmluZCIsIm1hcCIsImV2ZW50IiwibmV3QnVmZmVyUG9zaXRpb24iLCJmaWx0ZXIiLCJwb3NpdGlvbiIsIl9pc1Bvc2l0aW9uSW5IaWdobGlnaHRlZFJhbmdlcyIsImNoYW5nZUV2ZW50cyIsIm9uRGlkQ2hhbmdlIiwic3RhcnRXaXRoIiwiZ2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24iLCJkZXN0cm95RXZlbnRzIiwib25EaWREZXN0cm95IiwibWVyZ2UiLCJkbyIsIl9kZXN0cm95TWFya2VycyIsInRpbWVyIiwicmFuZ2VzIiwiX2dldEhpZ2hsaWdodGVkUmFuZ2VzIiwidGFrZVVudGlsIiwic3Vic2NyaWJlIiwiX2hpZ2hsaWdodFJhbmdlcyIsInByb3ZpZGVyIiwiZ2V0UHJvdmlkZXJGb3JFZGl0b3IiLCJoaWdobGlnaHQiLCJlIiwiZXJyb3IiLCJyYW5nZSIsIm1hcmtCdWZmZXJSYW5nZSIsImZvckVhY2giLCJtYXJrZXIiLCJkZWNvcmF0ZU1hcmtlciIsInR5cGUiLCJjbGFzcyIsImdldEJ1ZmZlclJhbmdlIiwic29tZSIsImNvbnRhaW5zUG9pbnQiLCJzcGxpY2UiLCJkZXN0cm95IiwiYWRkUHJvdmlkZXIiLCJkaXNwb3NlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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LFNBQUt2QixRQUFMLENBQWM2QyxNQUFkLENBQXFCLENBQXJCLEVBQXdCUixPQUF4QixDQUFnQ0MsVUFBVTtBQUFBO0FBQUE7QUFBQSxvQkFBT1EsT0FBUDtBQUFnQixLQUExRDtBQUNEOztBQUVEQyxjQUFZakIsUUFBWixFQUEwRDtBQUFBO0FBQUE7O0FBQ3hELFdBQU8sS0FBSy9CLFVBQUwsQ0FBZ0JnRCxXQUFoQixDQUE0QmpCLFFBQTVCLENBQVA7QUFDRDs7QUFFRGtCLFlBQVU7QUFBQTtBQUFBOztBQUNSLFNBQUsvQyxjQUFMLENBQW9CK0MsT0FBcEI7QUFEUTtBQUVSLFNBQUt6QixlQUFMO0FBQ0Q7QUE3R3VDO2tCQUFyQjFCLG9CIiwiZmlsZSI6IkNvZGVIaWdobGlnaHRNYW5hZ2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuaW1wb3J0IHR5cGUge0NvZGVIaWdobGlnaHRQcm92aWRlcn0gZnJvbSAnLi90eXBlcyc7XG5cbmltcG9ydCB7Z2V0TG9nZ2VyfSBmcm9tICdsb2c0anMnO1xuaW1wb3J0IHtPYnNlcnZhYmxlfSBmcm9tICdyeGpzJztcbmltcG9ydCB7b2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbn0gZnJvbSAnbnVjbGlkZS1jb21tb25zL2V2ZW50JztcbmltcG9ydCBVbml2ZXJzYWxEaXNwb3NhYmxlIGZyb20gJ251Y2xpZGUtY29tbW9ucy9Vbml2ZXJzYWxEaXNwb3NhYmxlJztcbmltcG9ydCBQcm92aWRlclJlZ2lzdHJ5IGZyb20gJ251Y2xpZGUtY29tbW9ucy1hdG9tL1Byb3ZpZGVyUmVnaXN0cnknO1xuaW1wb3J0IHtvYnNlcnZlQWN0aXZlRWRpdG9yc0RlYm91bmNlZH0gZnJvbSAnbnVjbGlkZS1jb21tb25zLWF0b20vZGVib3VuY2VkJztcblxuY29uc3QgSElHSExJR0hUX0RFTEFZX01TID0gMjUwO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDb2RlSGlnaGxpZ2h0TWFuYWdlciB7XG4gIF9zdWJzY3JpcHRpb25zOiBVbml2ZXJzYWxEaXNwb3NhYmxlO1xuICBfcHJvdmlkZXJzOiBQcm92aWRlclJlZ2lzdHJ5PENvZGVIaWdobGlnaHRQcm92aWRlcj47XG4gIF9tYXJrZXJzOiBBcnJheTxhdG9tJE1hcmtlcj47XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5fcHJvdmlkZXJzID0gbmV3IFByb3ZpZGVyUmVnaXN0cnkoKTtcbiAgICB0aGlzLl9tYXJrZXJzID0gW107XG4gICAgdGhpcy5fc3Vic2NyaXB0aW9ucyA9IG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKHRoaXMuX2hpZ2hsaWdodEVkaXRvcnMoKSk7XG4gIH1cblxuICBfaGlnaGxpZ2h0RWRpdG9ycygpOiByeGpzJFN1YnNjcmlwdGlvbiB7XG4gICAgcmV0dXJuIG9ic2VydmVBY3RpdmVFZGl0b3JzRGVib3VuY2VkKDApXG4gICAgICAuc3dpdGNoTWFwKGVkaXRvciA9PiB7XG4gICAgICAgIGlmIChlZGl0b3IgPT0gbnVsbCkge1xuICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLmVtcHR5KCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhbmdlQ3Vyc29yRXZlbnRzID0gb2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbihcbiAgICAgICAgICBlZGl0b3Iub25EaWRDaGFuZ2VDdXJzb3JQb3NpdGlvbi5iaW5kKGVkaXRvciksXG4gICAgICAgIClcbiAgICAgICAgICAubWFwKGV2ZW50ID0+IGV2ZW50Lm5ld0J1ZmZlclBvc2l0aW9uKVxuICAgICAgICAgIC5maWx0ZXIoXG4gICAgICAgICAgICAvLyBJZiB3ZSdyZSBtb3ZpbmcgYXJvdW5kIGluc2lkZSBoaWdobGlnaHRlZCByYW5nZXMsIHRoYXQncyBmaW5lLlxuICAgICAgICAgICAgcG9zaXRpb24gPT4gIXRoaXMuX2lzUG9zaXRpb25JbkhpZ2hsaWdodGVkUmFuZ2VzKGVkaXRvciwgcG9zaXRpb24pLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgY2hhbmdlRXZlbnRzID0gb2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbihcbiAgICAgICAgICBlZGl0b3Iub25EaWRDaGFuZ2UuYmluZChlZGl0b3IpLFxuICAgICAgICApXG4gICAgICAgICAgLy8gRW5zdXJlIHdlIHN0YXJ0IGhpZ2hsaWdodGluZyBpbW1lZGlhdGVseS5cbiAgICAgICAgICAuc3RhcnRXaXRoKG51bGwpXG4gICAgICAgICAgLm1hcCgoKSA9PiBlZGl0b3IuZ2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oKSk7XG5cbiAgICAgICAgY29uc3QgZGVzdHJveUV2ZW50cyA9IG9ic2VydmFibGVGcm9tU3Vic2NyaWJlRnVuY3Rpb24oXG4gICAgICAgICAgZWRpdG9yLm9uRGlkRGVzdHJveS5iaW5kKGVkaXRvciksXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBPYnNlcnZhYmxlLm1lcmdlKGNoYW5nZUN1cnNvckV2ZW50cywgY2hhbmdlRXZlbnRzKVxuICAgICAgICAgICAgLy8gRGVzdHJveSBvbGQgbWFya2VycyBpbW1lZGlhdGVseSAtIG5ldmVyIHNob3cgc3RhbGUgcmVzdWx0cy5cbiAgICAgICAgICAgIC5kbygoKSA9PiB0aGlzLl9kZXN0cm95TWFya2VycygpKVxuICAgICAgICAgICAgLnN3aXRjaE1hcChwb3NpdGlvbiA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLnRpbWVyKFxuICAgICAgICAgICAgICAgIEhJR0hMSUdIVF9ERUxBWV9NUyxcbiAgICAgICAgICAgICAgKS5zd2l0Y2hNYXAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICBlZGl0b3IsXG4gICAgICAgICAgICAgICAgICByYW5nZXM6IGF3YWl0IHRoaXMuX2dldEhpZ2hsaWdodGVkUmFuZ2VzKGVkaXRvciwgcG9zaXRpb24pLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50YWtlVW50aWwoZGVzdHJveUV2ZW50cylcbiAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgICAuc3Vic2NyaWJlKCh7ZWRpdG9yLCByYW5nZXN9KSA9PiB7XG4gICAgICAgIGlmIChyYW5nZXMgIT0gbnVsbCkge1xuICAgICAgICAgIHRoaXMuX2hpZ2hsaWdodFJhbmdlcyhlZGl0b3IsIHJhbmdlcyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgX2dldEhpZ2hsaWdodGVkUmFuZ2VzKFxuICAgIGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLFxuICAgIHBvc2l0aW9uOiBhdG9tJFBvaW50LFxuICApOiBQcm9taXNlPD9BcnJheTxhdG9tJFJhbmdlPj4ge1xuICAgIGNvbnN0IHByb3ZpZGVyID0gdGhpcy5fcHJvdmlkZXJzLmdldFByb3ZpZGVyRm9yRWRpdG9yKGVkaXRvcik7XG4gICAgaWYgKCFwcm92aWRlcikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBwcm92aWRlci5oaWdobGlnaHQoZWRpdG9yLCBwb3NpdGlvbik7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgZ2V0TG9nZ2VyKCdjb2RlLWhpZ2hsaWdodCcpLmVycm9yKCdFcnJvciBnZXR0aW5nIGNvZGUgaGlnaGxpZ2h0cycsIGUpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgX2hpZ2hsaWdodFJhbmdlcyhlZGl0b3I6IGF0b20kVGV4dEVkaXRvciwgcmFuZ2VzOiBBcnJheTxhdG9tJFJhbmdlPik6IHZvaWQge1xuICAgIHRoaXMuX2Rlc3Ryb3lNYXJrZXJzKCk7XG4gICAgdGhpcy5fbWFya2VycyA9IHJhbmdlcy5tYXAocmFuZ2UgPT4gZWRpdG9yLm1hcmtCdWZmZXJSYW5nZShyYW5nZSwge30pKTtcbiAgICB0aGlzLl9tYXJrZXJzLmZvckVhY2gobWFya2VyID0+IHtcbiAgICAgIGVkaXRvci5kZWNvcmF0ZU1hcmtlcihtYXJrZXIsIHtcbiAgICAgICAgdHlwZTogJ2hpZ2hsaWdodCcsXG4gICAgICAgIGNsYXNzOiAnY29kZS1oaWdobGlnaHQtbWFya2VyJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgX2lzUG9zaXRpb25JbkhpZ2hsaWdodGVkUmFuZ2VzKFxuICAgIGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLFxuICAgIHBvc2l0aW9uOiBhdG9tJFBvaW50LFxuICApOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fbWFya2Vyc1xuICAgICAgLm1hcChtYXJrZXIgPT4gbWFya2VyLmdldEJ1ZmZlclJhbmdlKCkpXG4gICAgICAuc29tZShyYW5nZSA9PiByYW5nZS5jb250YWluc1BvaW50KHBvc2l0aW9uKSk7XG4gIH1cblxuICBfZGVzdHJveU1hcmtlcnMoKTogdm9pZCB7XG4gICAgdGhpcy5fbWFya2Vycy5zcGxpY2UoMCkuZm9yRWFjaChtYXJrZXIgPT4gbWFya2VyLmRlc3Ryb3koKSk7XG4gIH1cblxuICBhZGRQcm92aWRlcihwcm92aWRlcjogQ29kZUhpZ2hsaWdodFByb3ZpZGVyKTogSURpc3Bvc2FibGUge1xuICAgIHJldHVybiB0aGlzLl9wcm92aWRlcnMuYWRkUHJvdmlkZXIocHJvdmlkZXIpO1xuICB9XG5cbiAgZGlzcG9zZSgpIHtcbiAgICB0aGlzLl9zdWJzY3JpcHRpb25zLmRpc3Bvc2UoKTtcbiAgICB0aGlzLl9kZXN0cm95TWFya2VycygpO1xuICB9XG59XG4iXX0=