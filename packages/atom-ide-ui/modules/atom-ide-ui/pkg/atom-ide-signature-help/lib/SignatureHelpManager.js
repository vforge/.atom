'use strict';

var cov_2np255chip = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-signature-help/lib/SignatureHelpManager.js',
      hash = 'a0e038a7dfb7a1b8c430602702984d25b43daa71',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-signature-help/lib/SignatureHelpManager.js',
    statementMap: {
      '0': {
        start: {
          line: 26,
          column: 29
        },
        end: {
          line: 26,
          column: 32
        }
      },
      '1': {
        start: {
          line: 29,
          column: 26
        },
        end: {
          line: 29,
          column: 30
        }
      },
      '2': {
        start: {
          line: 38,
          column: 4
        },
        end: {
          line: 38,
          column: 52
        }
      },
      '3': {
        start: {
          line: 39,
          column: 4
        },
        end: {
          line: 45,
          column: 6
        }
      },
      '4': {
        start: {
          line: 43,
          column: 8
        },
        end: {
          line: 43,
          column: 66
        }
      },
      '5': {
        start: {
          line: 49,
          column: 4
        },
        end: {
          line: 49,
          column: 32
        }
      },
      '6': {
        start: {
          line: 53,
          column: 4
        },
        end: {
          line: 53,
          column: 35
        }
      },
      '7': {
        start: {
          line: 57,
          column: 4
        },
        end: {
          line: 57,
          column: 56
        }
      },
      '8': {
        start: {
          line: 70,
          column: 4
        },
        end: {
          line: 91,
          column: 19
        }
      },
      '9': {
        start: {
          line: 72,
          column: 8
        },
        end: {
          line: 74,
          column: 9
        }
      },
      '10': {
        start: {
          line: 73,
          column: 10
        },
        end: {
          line: 73,
          column: 62
        }
      },
      '11': {
        start: {
          line: 75,
          column: 8
        },
        end: {
          line: 83,
          column: 10
        }
      },
      '12': {
        start: {
          line: 78,
          column: 30
        },
        end: {
          line: 78,
          column: 62
        }
      },
      '13': {
        start: {
          line: 82,
          column: 35
        },
        end: {
          line: 82,
          column: 58
        }
      },
      '14': {
        start: {
          line: 86,
          column: 8
        },
        end: {
          line: 88,
          column: 9
        }
      },
      '15': {
        start: {
          line: 87,
          column: 10
        },
        end: {
          line: 87,
          column: 67
        }
      },
      '16': {
        start: {
          line: 89,
          column: 8
        },
        end: {
          line: 89,
          column: 34
        }
      },
      '17': {
        start: {
          line: 98,
          column: 4
        },
        end: {
          line: 130,
          column: 6
        }
      },
      '18': {
        start: {
          line: 100,
          column: 44
        },
        end: {
          line: 100,
          column: 78
        }
      },
      '19': {
        start: {
          line: 105,
          column: 10
        },
        end: {
          line: 114,
          column: 11
        }
      },
      '20': {
        start: {
          line: 113,
          column: 12
        },
        end: {
          line: 113,
          column: 25
        }
      },
      '21': {
        start: {
          line: 115,
          column: 10
        },
        end: {
          line: 125,
          column: 11
        }
      },
      '22': {
        start: {
          line: 118,
          column: 12
        },
        end: {
          line: 124,
          column: 13
        }
      },
      '23': {
        start: {
          line: 119,
          column: 14
        },
        end: {
          line: 123,
          column: 15
        }
      },
      '24': {
        start: {
          line: 120,
          column: 16
        },
        end: {
          line: 122,
          column: 17
        }
      },
      '25': {
        start: {
          line: 121,
          column: 18
        },
        end: {
          line: 121,
          column: 30
        }
      },
      '26': {
        start: {
          line: 126,
          column: 10
        },
        end: {
          line: 126,
          column: 23
        }
      },
      '27': {
        start: {
          line: 129,
          column: 33
        },
        end: {
          line: 129,
          column: 45
        }
      },
      '28': {
        start: {
          line: 137,
          column: 4
        },
        end: {
          line: 159,
          column: 6
        }
      },
      '29': {
        start: {
          line: 142,
          column: 31
        },
        end: {
          line: 142,
          column: 78
        }
      },
      '30': {
        start: {
          line: 146,
          column: 40
        },
        end: {
          line: 146,
          column: 52
        }
      },
      '31': {
        start: {
          line: 147,
          column: 28
        },
        end: {
          line: 147,
          column: 62
        }
      },
      '32': {
        start: {
          line: 154,
          column: 36
        },
        end: {
          line: 154,
          column: 54
        }
      },
      '33': {
        start: {
          line: 171,
          column: 4
        },
        end: {
          line: 192,
          column: 6
        }
      },
      '34': {
        start: {
          line: 173,
          column: 8
        },
        end: {
          line: 175,
          column: 9
        }
      },
      '35': {
        start: {
          line: 178,
          column: 10
        },
        end: {
          line: 185,
          column: 13
        }
      },
      '36': {
        start: {
          line: 179,
          column: 31
        },
        end: {
          line: 179,
          column: 70
        }
      },
      '37': {
        start: {
          line: 180,
          column: 12
        },
        end: {
          line: 183,
          column: 14
        }
      },
      '38': {
        start: {
          line: 184,
          column: 12
        },
        end: {
          line: 184,
          column: 24
        }
      },
      '39': {
        start: {
          line: 187,
          column: 21
        },
        end: {
          line: 187,
          column: 57
        }
      },
      '40': {
        start: {
          line: 202,
          column: 4
        },
        end: {
          line: 233,
          column: 7
        }
      },
      '41': {
        start: {
          line: 203,
          column: 29
        },
        end: {
          line: 203,
          column: 49
        }
      },
      '42': {
        start: {
          line: 204,
          column: 6
        },
        end: {
          line: 206,
          column: 7
        }
      },
      '43': {
        start: {
          line: 205,
          column: 8
        },
        end: {
          line: 205,
          column: 34
        }
      },
      '44': {
        start: {
          line: 208,
          column: 30
        },
        end: {
          line: 208,
          column: 62
        }
      },
      '45': {
        start: {
          line: 210,
          column: 6
        },
        end: {
          line: 232,
          column: 8
        }
      },
      '46': {
        start: {
          line: 215,
          column: 14
        },
        end: {
          line: 217,
          column: 15
        }
      },
      '47': {
        start: {
          line: 220,
          column: 12
        },
        end: {
          line: 230,
          column: 15
        }
      },
      '48': {
        start: {
          line: 221,
          column: 33
        },
        end: {
          line: 228,
          column: 15
        }
      },
      '49': {
        start: {
          line: 229,
          column: 14
        },
        end: {
          line: 229,
          column: 57
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 37,
            column: 2
          },
          end: {
            line: 37,
            column: 3
          }
        },
        loc: {
          start: {
            line: 37,
            column: 16
          },
          end: {
            line: 46,
            column: 3
          }
        },
        line: 37
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 42,
            column: 67
          },
          end: {
            line: 42,
            column: 68
          }
        },
        loc: {
          start: {
            line: 42,
            column: 73
          },
          end: {
            line: 44,
            column: 7
          }
        },
        line: 42
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 48,
            column: 2
          },
          end: {
            line: 48,
            column: 3
          }
        },
        loc: {
          start: {
            line: 48,
            column: 12
          },
          end: {
            line: 50,
            column: 3
          }
        },
        line: 48
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 52,
            column: 2
          },
          end: {
            line: 52,
            column: 3
          }
        },
        loc: {
          start: {
            line: 52,
            column: 46
          },
          end: {
            line: 54,
            column: 3
          }
        },
        line: 52
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 56,
            column: 2
          },
          end: {
            line: 56,
            column: 3
          }
        },
        loc: {
          start: {
            line: 56,
            column: 56
          },
          end: {
            line: 58,
            column: 3
          }
        },
        line: 56
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 69,
            column: 2
          },
          end: {
            line: 69,
            column: 3
          }
        },
        loc: {
          start: {
            line: 69,
            column: 43
          },
          end: {
            line: 92,
            column: 3
          }
        },
        line: 69
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 71,
            column: 17
          },
          end: {
            line: 71,
            column: 18
          }
        },
        loc: {
          start: {
            line: 71,
            column: 27
          },
          end: {
            line: 84,
            column: 7
          }
        },
        line: 71
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 78,
            column: 24
          },
          end: {
            line: 78,
            column: 25
          }
        },
        loc: {
          start: {
            line: 78,
            column: 30
          },
          end: {
            line: 78,
            column: 62
          }
        },
        line: 78
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 82,
            column: 17
          },
          end: {
            line: 82,
            column: 18
          }
        },
        loc: {
          start: {
            line: 82,
            column: 35
          },
          end: {
            line: 82,
            column: 58
          }
        },
        line: 82
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 85,
            column: 17
          },
          end: {
            line: 85,
            column: 18
          }
        },
        loc: {
          start: {
            line: 85,
            column: 46
          },
          end: {
            line: 90,
            column: 7
          }
        },
        line: 85
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 97,
            column: 2
          },
          end: {
            line: 97,
            column: 3
          }
        },
        loc: {
          start: {
            line: 97,
            column: 69
          },
          end: {
            line: 131,
            column: 3
          }
        },
        line: 97
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 100,
            column: 38
          },
          end: {
            line: 100,
            column: 39
          }
        },
        loc: {
          start: {
            line: 100,
            column: 44
          },
          end: {
            line: 100,
            column: 78
          }
        },
        line: 100
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 104,
            column: 16
          },
          end: {
            line: 104,
            column: 17
          }
        },
        loc: {
          start: {
            line: 104,
            column: 26
          },
          end: {
            line: 127,
            column: 9
          }
        },
        line: 104
      },
      '13': {
        name: '(anonymous_13)',
        decl: {
          start: {
            line: 129,
            column: 28
          },
          end: {
            line: 129,
            column: 29
          }
        },
        loc: {
          start: {
            line: 129,
            column: 33
          },
          end: {
            line: 129,
            column: 45
          }
        },
        line: 129
      },
      '14': {
        name: '(anonymous_14)',
        decl: {
          start: {
            line: 136,
            column: 2
          },
          end: {
            line: 136,
            column: 3
          }
        },
        loc: {
          start: {
            line: 136,
            column: 75
          },
          end: {
            line: 160,
            column: 3
          }
        },
        line: 136
      },
      '15': {
        name: '(anonymous_15)',
        decl: {
          start: {
            line: 142,
            column: 25
          },
          end: {
            line: 142,
            column: 26
          }
        },
        loc: {
          start: {
            line: 142,
            column: 31
          },
          end: {
            line: 142,
            column: 78
          }
        },
        line: 142
      },
      '16': {
        name: '(anonymous_16)',
        decl: {
          start: {
            line: 146,
            column: 30
          },
          end: {
            line: 146,
            column: 31
          }
        },
        loc: {
          start: {
            line: 146,
            column: 40
          },
          end: {
            line: 146,
            column: 52
          }
        },
        line: 146
      },
      '17': {
        name: '(anonymous_17)',
        decl: {
          start: {
            line: 147,
            column: 19
          },
          end: {
            line: 147,
            column: 20
          }
        },
        loc: {
          start: {
            line: 147,
            column: 28
          },
          end: {
            line: 147,
            column: 62
          }
        },
        line: 147
      },
      '18': {
        name: '(anonymous_18)',
        decl: {
          start: {
            line: 154,
            column: 12
          },
          end: {
            line: 154,
            column: 13
          }
        },
        loc: {
          start: {
            line: 154,
            column: 36
          },
          end: {
            line: 154,
            column: 54
          }
        },
        line: 154
      },
      '19': {
        name: '(anonymous_19)',
        decl: {
          start: {
            line: 166,
            column: 2
          },
          end: {
            line: 166,
            column: 3
          }
        },
        loc: {
          start: {
            line: 169,
            column: 32
          },
          end: {
            line: 193,
            column: 3
          }
        },
        line: 169
      },
      '20': {
        name: '(anonymous_20)',
        decl: {
          start: {
            line: 172,
            column: 23
          },
          end: {
            line: 172,
            column: 24
          }
        },
        loc: {
          start: {
            line: 173,
            column: 8
          },
          end: {
            line: 175,
            column: 9
          }
        },
        line: 173
      },
      '21': {
        name: '(anonymous_21)',
        decl: {
          start: {
            line: 177,
            column: 19
          },
          end: {
            line: 177,
            column: 20
          }
        },
        loc: {
          start: {
            line: 177,
            column: 31
          },
          end: {
            line: 186,
            column: 9
          }
        },
        line: 177
      },
      '22': {
        name: '(anonymous_22)',
        decl: {
          start: {
            line: 178,
            column: 64
          },
          end: {
            line: 178,
            column: 65
          }
        },
        loc: {
          start: {
            line: 178,
            column: 71
          },
          end: {
            line: 185,
            column: 11
          }
        },
        line: 178
      },
      '23': {
        name: '(anonymous_23)',
        decl: {
          start: {
            line: 187,
            column: 16
          },
          end: {
            line: 187,
            column: 17
          }
        },
        loc: {
          start: {
            line: 187,
            column: 21
          },
          end: {
            line: 187,
            column: 57
          }
        },
        line: 187
      },
      '24': {
        name: '(anonymous_24)',
        decl: {
          start: {
            line: 198,
            column: 2
          },
          end: {
            line: 198,
            column: 3
          }
        },
        loc: {
          start: {
            line: 201,
            column: 23
          },
          end: {
            line: 234,
            column: 3
          }
        },
        line: 201
      },
      '25': {
        name: '(anonymous_25)',
        decl: {
          start: {
            line: 202,
            column: 28
          },
          end: {
            line: 202,
            column: 29
          }
        },
        loc: {
          start: {
            line: 202,
            column: 34
          },
          end: {
            line: 233,
            column: 5
          }
        },
        line: 202
      },
      '26': {
        name: '(anonymous_26)',
        decl: {
          start: {
            line: 214,
            column: 12
          },
          end: {
            line: 214,
            column: 13
          }
        },
        loc: {
          start: {
            line: 215,
            column: 14
          },
          end: {
            line: 217,
            column: 15
          }
        },
        line: 215
      },
      '27': {
        name: '(anonymous_27)',
        decl: {
          start: {
            line: 219,
            column: 21
          },
          end: {
            line: 219,
            column: 22
          }
        },
        loc: {
          start: {
            line: 219,
            column: 30
          },
          end: {
            line: 231,
            column: 11
          }
        },
        line: 219
      },
      '28': {
        name: '(anonymous_28)',
        decl: {
          start: {
            line: 220,
            column: 37
          },
          end: {
            line: 220,
            column: 38
          }
        },
        loc: {
          start: {
            line: 220,
            column: 43
          },
          end: {
            line: 230,
            column: 13
          }
        },
        line: 220
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 72,
            column: 8
          },
          end: {
            line: 74,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 72,
            column: 8
          },
          end: {
            line: 74,
            column: 9
          }
        }, {
          start: {
            line: 72,
            column: 8
          },
          end: {
            line: 74,
            column: 9
          }
        }],
        line: 72
      },
      '1': {
        loc: {
          start: {
            line: 86,
            column: 8
          },
          end: {
            line: 88,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 86,
            column: 8
          },
          end: {
            line: 88,
            column: 9
          }
        }, {
          start: {
            line: 86,
            column: 8
          },
          end: {
            line: 88,
            column: 9
          }
        }],
        line: 86
      },
      '2': {
        loc: {
          start: {
            line: 86,
            column: 12
          },
          end: {
            line: 86,
            column: 51
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 86,
            column: 12
          },
          end: {
            line: 86,
            column: 26
          }
        }, {
          start: {
            line: 86,
            column: 30
          },
          end: {
            line: 86,
            column: 51
          }
        }],
        line: 86
      },
      '3': {
        loc: {
          start: {
            line: 105,
            column: 10
          },
          end: {
            line: 114,
            column: 11
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 105,
            column: 10
          },
          end: {
            line: 114,
            column: 11
          }
        }, {
          start: {
            line: 105,
            column: 10
          },
          end: {
            line: 114,
            column: 11
          }
        }],
        line: 105
      },
      '4': {
        loc: {
          start: {
            line: 108,
            column: 12
          },
          end: {
            line: 111,
            column: 76
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 108,
            column: 12
          },
          end: {
            line: 108,
            column: 39
          }
        }, {
          start: {
            line: 109,
            column: 12
          },
          end: {
            line: 109,
            column: 37
          }
        }, {
          start: {
            line: 111,
            column: 12
          },
          end: {
            line: 111,
            column: 76
          }
        }],
        line: 108
      },
      '5': {
        loc: {
          start: {
            line: 118,
            column: 12
          },
          end: {
            line: 124,
            column: 13
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 118,
            column: 12
          },
          end: {
            line: 124,
            column: 13
          }
        }, {
          start: {
            line: 118,
            column: 12
          },
          end: {
            line: 124,
            column: 13
          }
        }],
        line: 118
      },
      '6': {
        loc: {
          start: {
            line: 120,
            column: 16
          },
          end: {
            line: 122,
            column: 17
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 120,
            column: 16
          },
          end: {
            line: 122,
            column: 17
          }
        }, {
          start: {
            line: 120,
            column: 16
          },
          end: {
            line: 122,
            column: 17
          }
        }],
        line: 120
      },
      '7': {
        loc: {
          start: {
            line: 179,
            column: 31
          },
          end: {
            line: 179,
            column: 70
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 179,
            column: 31
          },
          end: {
            line: 179,
            column: 47
          }
        }, {
          start: {
            line: 179,
            column: 51
          },
          end: {
            line: 179,
            column: 70
          }
        }],
        line: 179
      },
      '8': {
        loc: {
          start: {
            line: 187,
            column: 21
          },
          end: {
            line: 187,
            column: 57
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 187,
            column: 21
          },
          end: {
            line: 187,
            column: 30
          }
        }, {
          start: {
            line: 187,
            column: 34
          },
          end: {
            line: 187,
            column: 57
          }
        }],
        line: 187
      },
      '9': {
        loc: {
          start: {
            line: 204,
            column: 6
          },
          end: {
            line: 206,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 204,
            column: 6
          },
          end: {
            line: 206,
            column: 7
          }
        }, {
          start: {
            line: 204,
            column: 6
          },
          end: {
            line: 206,
            column: 7
          }
        }],
        line: 204
      },
      '10': {
        loc: {
          start: {
            line: 204,
            column: 10
          },
          end: {
            line: 204,
            column: 73
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 204,
            column: 10
          },
          end: {
            line: 204,
            column: 32
          }
        }, {
          start: {
            line: 204,
            column: 36
          },
          end: {
            line: 204,
            column: 73
          }
        }],
        line: 204
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0],
      '10': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _log4js;

function _load_log4js() {
  return _log4js = require('log4js');
}

var _debounced;

function _load_debounced() {
  return _debounced = require('nuclide-commons-atom/debounced');
}

var _textEditor;

function _load_textEditor() {
  return _textEditor = require('nuclide-commons-atom/text-editor');
}

var _ProviderRegistry;

function _load_ProviderRegistry() {
  return _ProviderRegistry = _interopRequireDefault(require('nuclide-commons-atom/ProviderRegistry'));
}

var _event;

function _load_event() {
  return _event = require('nuclide-commons/event');
}

var _UniversalDisposable;

function _load_UniversalDisposable() {
  return _UniversalDisposable = _interopRequireDefault(require('nuclide-commons/UniversalDisposable'));
}

var _rxjsBundlesRxMinJs = require('rxjs/bundles/Rx.min.js');

var _getSignatureDatatip;

function _load_getSignatureDatatip() {
  return _getSignatureDatatip = _interopRequireDefault(require('./getSignatureDatatip'));
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Chosen to be a little more than the default key repeat rate.
/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

const CURSOR_DEBOUNCE_TIME = (cov_2np255chip.s[0]++, 200);

// Aggressively timeout signature requests to avoid 'stuck' signatures.
const SIGNATURE_TIMEOUT = (cov_2np255chip.s[1]++, 2500);

class SignatureHelpManager {

  constructor() {
    this._commands = new _rxjsBundlesRxMinJs.Subject();
    cov_2np255chip.f[0]++;
    cov_2np255chip.s[2]++;

    this._providerRegistry = new (_ProviderRegistry || _load_ProviderRegistry()).default();
    cov_2np255chip.s[3]++;
    this._disposables = new (_UniversalDisposable || _load_UniversalDisposable()).default(this._subscribeToEditors(),
    // Share the command subscription between all editors.
    atom.commands.add('atom-text-editor', 'signature-help:show', () => {
      cov_2np255chip.f[1]++;
      cov_2np255chip.s[4]++;

      this._commands.next(atom.workspace.getActiveTextEditor());
    }));
  }

  dispose() {
    cov_2np255chip.f[2]++;
    cov_2np255chip.s[5]++;

    this._disposables.dispose();
  }

  setDatatipService(service) {
    cov_2np255chip.f[3]++;
    cov_2np255chip.s[6]++;

    this._datatipService = service;
  }

  consumeSignatureHelp(provider) {
    cov_2np255chip.f[4]++;
    cov_2np255chip.s[7]++;

    return this._providerRegistry.addProvider(provider);
  }

  /**
   * The signature help flow looks like this:
   * 1) Wait for signature help to be triggered.
   *    This means that the user types a character matching triggerCharacters
   *    from at least one provider, or they activate the Atom command.
   * 2) Once signature help is triggered, we start fetching signatures for the cursor location.
   *    New signatures are continously fetched as the cursor moves.
   * 3) Signature help stops once we get a null signature, or once the user hits 'escape'.
   */
  _subscribeToEditors() {
    cov_2np255chip.f[5]++;
    cov_2np255chip.s[8]++;

    return (0, (_debounced || _load_debounced()).observeActiveEditorsDebounced)().switchMap(editor => {
      cov_2np255chip.f[6]++;
      cov_2np255chip.s[9]++;

      if (editor == null) {
        cov_2np255chip.b[0][0]++;
        cov_2np255chip.s[10]++;

        return _rxjsBundlesRxMinJs.Observable.of({ editor, signatureHelp: null });
      } else {
        cov_2np255chip.b[0][1]++;
      }
      cov_2np255chip.s[11]++;
      return this._signatureHelpTriggers(editor)
      // $FlowFixMe: add to rxjs libs
      .exhaustMap(() => {
        cov_2np255chip.f[7]++;
        cov_2np255chip.s[12]++;
        return this._getSignatureStream(editor);
      }).takeUntil((0, (_event || _load_event()).observableFromSubscribeFunction)(editor.onDidDestroy.bind(editor))).map(signatureHelp => {
        cov_2np255chip.f[8]++;
        cov_2np255chip.s[13]++;
        return { editor, signatureHelp };
      });
    }).switchMap(({ editor, signatureHelp }) => {
      cov_2np255chip.f[9]++;
      cov_2np255chip.s[14]++;

      if ((cov_2np255chip.b[2][0]++, editor != null) && (cov_2np255chip.b[2][1]++, signatureHelp != null)) {
        cov_2np255chip.b[1][0]++;
        cov_2np255chip.s[15]++;

        return this._showSignatureDatatip(editor, signatureHelp);
      } else {
        cov_2np255chip.b[1][1]++;
      }
      cov_2np255chip.s[16]++;
      return _rxjsBundlesRxMinJs.Observable.empty();
    }).subscribe();
  }

  /**
   * A stream of all signature help triggers.
   */
  _signatureHelpTriggers(editor) {
    cov_2np255chip.f[10]++;
    cov_2np255chip.s[17]++;

    return _rxjsBundlesRxMinJs.Observable.merge(
    // 1) Any keypresses that match a triggerCharacter.
    (0, (_event || _load_event()).observableFromSubscribeFunction)(cb => {
      cov_2np255chip.f[11]++;
      cov_2np255chip.s[18]++;
      return editor.getBuffer().onDidChange(cb);
    })
    // The change events and cursor changes are often sequential.
    // We need to make sure we use the final cursor position.
    .debounceTime(0).filter(change => {
      cov_2np255chip.f[12]++;
      cov_2np255chip.s[19]++;

      if (
      // Only handle single/double-character insertions.
      // (e.g. bracket-matcher inserts two characters on open parenthesis)
      (cov_2np255chip.b[4][0]++, change.newText.length === 0) || (cov_2np255chip.b[4][1]++, change.newText.length > 2) || (cov_2np255chip.b[4][2]++,
      // The change should cover the current cursor position.
      !change.newRange.containsPoint(editor.getCursorBufferPosition()))) {
        cov_2np255chip.b[3][0]++;
        cov_2np255chip.s[20]++;

        return false;
      } else {
        cov_2np255chip.b[3][1]++;
      }
      cov_2np255chip.s[21]++;
      for (const provider of this._providerRegistry.getAllProvidersForEditor(editor)) {
        cov_2np255chip.s[22]++;

        if (provider.triggerCharacters != null) {
          cov_2np255chip.b[5][0]++;
          cov_2np255chip.s[23]++;

          for (let i = 0; i < change.newText.length; i++) {
            cov_2np255chip.s[24]++;

            if (provider.triggerCharacters.has(change.newText[i])) {
              cov_2np255chip.b[6][0]++;
              cov_2np255chip.s[25]++;

              return true;
            } else {
              cov_2np255chip.b[6][1]++;
            }
          }
        } else {
          cov_2np255chip.b[5][1]++;
        }
      }
      cov_2np255chip.s[26]++;
      return false;
    }),
    // 2) Explicit usage of the Atom command.
    this._commands.filter(e => {
      cov_2np255chip.f[13]++;
      cov_2np255chip.s[27]++;
      return e === editor;
    }));
  }

  /**
   * A stream of all signatures from an editor.
   */
  _getSignatureStream(editor) {
    cov_2np255chip.f[14]++;
    cov_2np255chip.s[28]++;

    return _rxjsBundlesRxMinJs.Observable.concat(
    // Start with a null signature to clear out any prior signatures.
    _rxjsBundlesRxMinJs.Observable.of(null),
    // Immediately start fetching signatures for the current position.
    _rxjsBundlesRxMinJs.Observable.concat(_rxjsBundlesRxMinJs.Observable.defer(() => {
      cov_2np255chip.f[15]++;
      cov_2np255chip.s[29]++;
      return _rxjsBundlesRxMinJs.Observable.of(editor.getCursorBufferPosition());
    }),
    // Further cursor changes will be debounced.
    (0, (_textEditor || _load_textEditor()).getCursorPositions)(editor).debounceTime(CURSOR_DEBOUNCE_TIME)).distinctUntilChanged((a, b) => {
      cov_2np255chip.f[16]++;
      cov_2np255chip.s[30]++;
      return a.isEqual(b);
    }).switchMap(point => {
      cov_2np255chip.f[17]++;
      cov_2np255chip.s[31]++;
      return this._getSignatures(editor, point);
    })
    // Stop once we get a null result.
    .takeWhile(Boolean)
    // Stop once the escape key is pressed.
    // NOTE: we can't use core:cancel because plugins like vim-mode-plus override it.
    .takeUntil(_rxjsBundlesRxMinJs.Observable.fromEvent(editor.getElement(), 'keydown').filter(evt => {
      cov_2np255chip.f[18]++;
      cov_2np255chip.s[32]++;
      return evt.keyCode === 27;
    })),
    // Terminate with a null signature to clear any visible signatures.
    _rxjsBundlesRxMinJs.Observable.of(null));
  }

  /**
   * Retrieve a signature from all providers for an editor + point.
   * (Effectively just a cancellable promise).
   */
  _getSignatures(editor, point) {
    cov_2np255chip.f[19]++;
    cov_2np255chip.s[33]++;

    // Take the highest-priority non-empty result.
    return _rxjsBundlesRxMinJs.Observable.defer(() => {
      cov_2np255chip.f[20]++;
      cov_2np255chip.s[34]++;
      return _rxjsBundlesRxMinJs.Observable.from(this._providerRegistry.getAllProvidersForEditor(editor));
    }).concatMap(provider => {
      cov_2np255chip.f[21]++;
      cov_2np255chip.s[35]++;

      return provider.getSignatureHelp(editor, point).catch(err => {
        cov_2np255chip.f[22]++;

        const editorPath = (cov_2np255chip.s[36]++, (cov_2np255chip.b[7][0]++, editor.getPath()) || (cov_2np255chip.b[7][1]++, '<untitled editor>'));
        cov_2np255chip.s[37]++;
        (0, (_log4js || _load_log4js()).getLogger)('atom-ide-signature-help').error(`Caught error from signature help provider for ${editorPath}`, err);
        cov_2np255chip.s[38]++;
        return null;
      });
    }).filter(x => {
      cov_2np255chip.f[23]++;
      cov_2np255chip.s[39]++;
      return (cov_2np255chip.b[8][0]++, x != null) && (cov_2np255chip.b[8][1]++, x.signatures.length > 0);
    })
    // $FlowFixMe: Add timeoutWith to rxjs defs
    .timeoutWith(SIGNATURE_TIMEOUT, _rxjsBundlesRxMinJs.Observable.of(null)).take(1).defaultIfEmpty(null);
  }

  /**
   * Displays the signature datatip and wraps its lifetime in an Observable.
   */
  _showSignatureDatatip(editor, signatureHelp) {
    cov_2np255chip.f[24]++;
    cov_2np255chip.s[40]++;

    return _rxjsBundlesRxMinJs.Observable.defer(() => {
      cov_2np255chip.f[25]++;

      const datatipService = (cov_2np255chip.s[41]++, this._datatipService);
      cov_2np255chip.s[42]++;
      if ((cov_2np255chip.b[10][0]++, datatipService == null) || (cov_2np255chip.b[10][1]++, signatureHelp.signatures.length === 0)) {
        cov_2np255chip.b[9][0]++;
        cov_2np255chip.s[43]++;

        return _rxjsBundlesRxMinJs.Observable.empty();
      } else {
        cov_2np255chip.b[9][1]++;
      }

      const currentPosition = (cov_2np255chip.s[44]++, editor.getCursorBufferPosition());
      // Make sure the datatip follows the cursor position.
      cov_2np255chip.s[45]++;
      return (0, (_textEditor || _load_textEditor()).getCursorPositions)(editor)
      // But don't go too far.
      .takeWhile(position => {
        cov_2np255chip.f[26]++;
        cov_2np255chip.s[46]++;
        return Math.abs(currentPosition.row - position.row) + Math.abs(currentPosition.column - position.column) <= 2;
      }).switchMap(point => {
        cov_2np255chip.f[27]++;
        cov_2np255chip.s[47]++;

        return _rxjsBundlesRxMinJs.Observable.create(() => {
          cov_2np255chip.f[28]++;

          const disposable = (cov_2np255chip.s[48]++, datatipService.createPinnedDataTip((0, (_getSignatureDatatip || _load_getSignatureDatatip()).default)(signatureHelp, point), editor, {
            position: 'above-range',
            showRangeHighlight: false
          }));
          cov_2np255chip.s[49]++;
          return new (_UniversalDisposable || _load_UniversalDisposable()).default(disposable);
        });
      });
    });
  }
}
exports.default = SignatureHelpManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNpZ25hdHVyZUhlbHBNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbIkNVUlNPUl9ERUJPVU5DRV9USU1FIiwiU0lHTkFUVVJFX1RJTUVPVVQiLCJTaWduYXR1cmVIZWxwTWFuYWdlciIsImNvbnN0cnVjdG9yIiwiX2NvbW1hbmRzIiwiX3Byb3ZpZGVyUmVnaXN0cnkiLCJfZGlzcG9zYWJsZXMiLCJfc3Vic2NyaWJlVG9FZGl0b3JzIiwiYXRvbSIsImNvbW1hbmRzIiwiYWRkIiwibmV4dCIsIndvcmtzcGFjZSIsImdldEFjdGl2ZVRleHRFZGl0b3IiLCJkaXNwb3NlIiwic2V0RGF0YXRpcFNlcnZpY2UiLCJzZXJ2aWNlIiwiX2RhdGF0aXBTZXJ2aWNlIiwiY29uc3VtZVNpZ25hdHVyZUhlbHAiLCJwcm92aWRlciIsImFkZFByb3ZpZGVyIiwic3dpdGNoTWFwIiwiZWRpdG9yIiwib2YiLCJzaWduYXR1cmVIZWxwIiwiX3NpZ25hdHVyZUhlbHBUcmlnZ2VycyIsImV4aGF1c3RNYXAiLCJfZ2V0U2lnbmF0dXJlU3RyZWFtIiwidGFrZVVudGlsIiwib25EaWREZXN0cm95IiwiYmluZCIsIm1hcCIsIl9zaG93U2lnbmF0dXJlRGF0YXRpcCIsImVtcHR5Iiwic3Vic2NyaWJlIiwibWVyZ2UiLCJjYiIsImdldEJ1ZmZlciIsIm9uRGlkQ2hhbmdlIiwiZGVib3VuY2VUaW1lIiwiZmlsdGVyIiwiY2hhbmdlIiwibmV3VGV4dCIsImxlbmd0aCIsIm5ld1JhbmdlIiwiY29udGFpbnNQb2ludCIsImdldEN1cnNvckJ1ZmZlclBvc2l0aW9uIiwiZ2V0QWxsUHJvdmlkZXJzRm9yRWRpdG9yIiwidHJpZ2dlckNoYXJhY3RlcnMiLCJpIiwiaGFzIiwiZSIsImNvbmNhdCIsImRlZmVyIiwiZGlzdGluY3RVbnRpbENoYW5nZWQiLCJhIiwiYiIsImlzRXF1YWwiLCJwb2ludCIsIl9nZXRTaWduYXR1cmVzIiwidGFrZVdoaWxlIiwiQm9vbGVhbiIsImZyb21FdmVudCIsImdldEVsZW1lbnQiLCJldnQiLCJrZXlDb2RlIiwiZnJvbSIsImNvbmNhdE1hcCIsImdldFNpZ25hdHVyZUhlbHAiLCJjYXRjaCIsImVyciIsImVkaXRvclBhdGgiLCJnZXRQYXRoIiwiZXJyb3IiLCJ4Iiwic2lnbmF0dXJlcyIsInRpbWVvdXRXaXRoIiwidGFrZSIsImRlZmF1bHRJZkVtcHR5IiwiZGF0YXRpcFNlcnZpY2UiLCJjdXJyZW50UG9zaXRpb24iLCJwb3NpdGlvbiIsImFicyIsInJvdyIsIk1hdGgiLCJjb2x1bW4iLCJjcmVhdGUiLCJkaXNwb3NhYmxlIiwiY3JlYXRlUGlubmVkRGF0YVRpcCIsInNob3dSYW5nZUhpZ2hsaWdodCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QUFPd0IsdUJBQVAsRUFBbEIsQ0FBTjtBQUNBO0FBUDRCO0FBUTVCLGFBQ0UsNERBQW1CeEIsTUFBbkI7QUFDRTtBQURGLE9BRUdzQyxTQUZILENBR0lxQixZQUNFO0FBQUE7QUFBQTtBQUFBLG9CQUFLQyxHQUFMLENBQVNGLGdCQUFnQkcsR0FBaEIsR0FBc0JGLFNBQVNFLEdBQXhDLElBQ0VDLEtBQUtGLEdBQUwsQ0FBU0YsZ0JBQWdCSyxNQUFoQixHQUF5QkosU0FBU0ksTUFBM0MsQ0FERixJQUVBLENBRkE7QUFFQyxPQU5QLEVBUUdoRSxTQVJILENBUWFxQyxTQUFTO0FBQUE7QUFBQTs7QUFDbEIsZUFBTywrQkFBVzRCLE1BQVgsQ0FBa0IsTUFBTTtBQUFBOztBQUM3QixnQkFBTUMsc0NBQWFSLGVBQWVTLG1CQUFmLENBQ2pCLG1FQUFvQmhFLGFBQXBCLEVBQW1Da0MsS0FBbkMsQ0FEaUIsRUFFakJwQyxNQUZpQixFQUdqQjtBQUNFMkQsc0JBQVUsYUFEWjtBQUVFUSxnQ0FBb0I7QUFGdEIsV0FIaUIsQ0FBYixDQUFOO0FBRDZCO0FBUzdCLGlCQUFPLGtFQUF3QkYsVUFBeEIsQ0FBUDtBQUNELFNBVk0sQ0FBUDtBQVdELE9BcEJILENBREY7QUF1QkQsS0EvQk0sQ0FBUDtBQWdDRDtBQTNNdUM7a0JBQXJCckYsb0IiLCJmaWxlIjoiU2lnbmF0dXJlSGVscE1hbmFnZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQgdHlwZSB7RGF0YXRpcFNlcnZpY2V9IGZyb20gJy4uLy4uL2F0b20taWRlLWRhdGF0aXAvbGliL3R5cGVzJztcbmltcG9ydCB0eXBlIHtTaWduYXR1cmVIZWxwLCBTaWduYXR1cmVIZWxwUHJvdmlkZXJ9IGZyb20gJy4vdHlwZXMnO1xuXG5pbXBvcnQge2dldExvZ2dlcn0gZnJvbSAnbG9nNGpzJztcbmltcG9ydCB7b2JzZXJ2ZUFjdGl2ZUVkaXRvcnNEZWJvdW5jZWR9IGZyb20gJ251Y2xpZGUtY29tbW9ucy1hdG9tL2RlYm91bmNlZCc7XG5pbXBvcnQge2dldEN1cnNvclBvc2l0aW9uc30gZnJvbSAnbnVjbGlkZS1jb21tb25zLWF0b20vdGV4dC1lZGl0b3InO1xuaW1wb3J0IFByb3ZpZGVyUmVnaXN0cnkgZnJvbSAnbnVjbGlkZS1jb21tb25zLWF0b20vUHJvdmlkZXJSZWdpc3RyeSc7XG5pbXBvcnQge29ic2VydmFibGVGcm9tU3Vic2NyaWJlRnVuY3Rpb259IGZyb20gJ251Y2xpZGUtY29tbW9ucy9ldmVudCc7XG5pbXBvcnQgVW5pdmVyc2FsRGlzcG9zYWJsZSBmcm9tICdudWNsaWRlLWNvbW1vbnMvVW5pdmVyc2FsRGlzcG9zYWJsZSc7XG5pbXBvcnQge09ic2VydmFibGUsIFN1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IGdldFNpZ25hdHVyZURhdGF0aXAgZnJvbSAnLi9nZXRTaWduYXR1cmVEYXRhdGlwJztcblxuLy8gQ2hvc2VuIHRvIGJlIGEgbGl0dGxlIG1vcmUgdGhhbiB0aGUgZGVmYXVsdCBrZXkgcmVwZWF0IHJhdGUuXG5jb25zdCBDVVJTT1JfREVCT1VOQ0VfVElNRSA9IDIwMDtcblxuLy8gQWdncmVzc2l2ZWx5IHRpbWVvdXQgc2lnbmF0dXJlIHJlcXVlc3RzIHRvIGF2b2lkICdzdHVjaycgc2lnbmF0dXJlcy5cbmNvbnN0IFNJR05BVFVSRV9USU1FT1VUID0gMjUwMDtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2lnbmF0dXJlSGVscE1hbmFnZXIge1xuICBfZGlzcG9zYWJsZXM6IFVuaXZlcnNhbERpc3Bvc2FibGU7XG4gIF9kYXRhdGlwU2VydmljZTogP0RhdGF0aXBTZXJ2aWNlO1xuICBfcHJvdmlkZXJSZWdpc3RyeTogUHJvdmlkZXJSZWdpc3RyeTxTaWduYXR1cmVIZWxwUHJvdmlkZXI+O1xuICBfY29tbWFuZHM6IFN1YmplY3Q8P2F0b20kVGV4dEVkaXRvcj4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuX3Byb3ZpZGVyUmVnaXN0cnkgPSBuZXcgUHJvdmlkZXJSZWdpc3RyeSgpO1xuICAgIHRoaXMuX2Rpc3Bvc2FibGVzID0gbmV3IFVuaXZlcnNhbERpc3Bvc2FibGUoXG4gICAgICB0aGlzLl9zdWJzY3JpYmVUb0VkaXRvcnMoKSxcbiAgICAgIC8vIFNoYXJlIHRoZSBjb21tYW5kIHN1YnNjcmlwdGlvbiBiZXR3ZWVuIGFsbCBlZGl0b3JzLlxuICAgICAgYXRvbS5jb21tYW5kcy5hZGQoJ2F0b20tdGV4dC1lZGl0b3InLCAnc2lnbmF0dXJlLWhlbHA6c2hvdycsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY29tbWFuZHMubmV4dChhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKCkpO1xuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIGRpc3Bvc2UoKSB7XG4gICAgdGhpcy5fZGlzcG9zYWJsZXMuZGlzcG9zZSgpO1xuICB9XG5cbiAgc2V0RGF0YXRpcFNlcnZpY2Uoc2VydmljZTogP0RhdGF0aXBTZXJ2aWNlKSB7XG4gICAgdGhpcy5fZGF0YXRpcFNlcnZpY2UgPSBzZXJ2aWNlO1xuICB9XG5cbiAgY29uc3VtZVNpZ25hdHVyZUhlbHAocHJvdmlkZXI6IFNpZ25hdHVyZUhlbHBQcm92aWRlcikge1xuICAgIHJldHVybiB0aGlzLl9wcm92aWRlclJlZ2lzdHJ5LmFkZFByb3ZpZGVyKHByb3ZpZGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgc2lnbmF0dXJlIGhlbHAgZmxvdyBsb29rcyBsaWtlIHRoaXM6XG4gICAqIDEpIFdhaXQgZm9yIHNpZ25hdHVyZSBoZWxwIHRvIGJlIHRyaWdnZXJlZC5cbiAgICogICAgVGhpcyBtZWFucyB0aGF0IHRoZSB1c2VyIHR5cGVzIGEgY2hhcmFjdGVyIG1hdGNoaW5nIHRyaWdnZXJDaGFyYWN0ZXJzXG4gICAqICAgIGZyb20gYXQgbGVhc3Qgb25lIHByb3ZpZGVyLCBvciB0aGV5IGFjdGl2YXRlIHRoZSBBdG9tIGNvbW1hbmQuXG4gICAqIDIpIE9uY2Ugc2lnbmF0dXJlIGhlbHAgaXMgdHJpZ2dlcmVkLCB3ZSBzdGFydCBmZXRjaGluZyBzaWduYXR1cmVzIGZvciB0aGUgY3Vyc29yIGxvY2F0aW9uLlxuICAgKiAgICBOZXcgc2lnbmF0dXJlcyBhcmUgY29udGlub3VzbHkgZmV0Y2hlZCBhcyB0aGUgY3Vyc29yIG1vdmVzLlxuICAgKiAzKSBTaWduYXR1cmUgaGVscCBzdG9wcyBvbmNlIHdlIGdldCBhIG51bGwgc2lnbmF0dXJlLCBvciBvbmNlIHRoZSB1c2VyIGhpdHMgJ2VzY2FwZScuXG4gICAqL1xuICBfc3Vic2NyaWJlVG9FZGl0b3JzKCk6IHJ4anMkU3Vic2NyaXB0aW9uIHtcbiAgICByZXR1cm4gb2JzZXJ2ZUFjdGl2ZUVkaXRvcnNEZWJvdW5jZWQoKVxuICAgICAgLnN3aXRjaE1hcChlZGl0b3IgPT4ge1xuICAgICAgICBpZiAoZWRpdG9yID09IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5vZih7ZWRpdG9yLCBzaWduYXR1cmVIZWxwOiBudWxsfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICB0aGlzLl9zaWduYXR1cmVIZWxwVHJpZ2dlcnMoZWRpdG9yKVxuICAgICAgICAgICAgLy8gJEZsb3dGaXhNZTogYWRkIHRvIHJ4anMgbGlic1xuICAgICAgICAgICAgLmV4aGF1c3RNYXAoKCkgPT4gdGhpcy5fZ2V0U2lnbmF0dXJlU3RyZWFtKGVkaXRvcikpXG4gICAgICAgICAgICAudGFrZVVudGlsKFxuICAgICAgICAgICAgICBvYnNlcnZhYmxlRnJvbVN1YnNjcmliZUZ1bmN0aW9uKGVkaXRvci5vbkRpZERlc3Ryb3kuYmluZChlZGl0b3IpKSxcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5tYXAoc2lnbmF0dXJlSGVscCA9PiAoe2VkaXRvciwgc2lnbmF0dXJlSGVscH0pKVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICAgIC5zd2l0Y2hNYXAoKHtlZGl0b3IsIHNpZ25hdHVyZUhlbHB9KSA9PiB7XG4gICAgICAgIGlmIChlZGl0b3IgIT0gbnVsbCAmJiBzaWduYXR1cmVIZWxwICE9IG51bGwpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5fc2hvd1NpZ25hdHVyZURhdGF0aXAoZWRpdG9yLCBzaWduYXR1cmVIZWxwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5lbXB0eSgpO1xuICAgICAgfSlcbiAgICAgIC5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBIHN0cmVhbSBvZiBhbGwgc2lnbmF0dXJlIGhlbHAgdHJpZ2dlcnMuXG4gICAqL1xuICBfc2lnbmF0dXJlSGVscFRyaWdnZXJzKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogT2JzZXJ2YWJsZTxtaXhlZD4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLm1lcmdlKFxuICAgICAgLy8gMSkgQW55IGtleXByZXNzZXMgdGhhdCBtYXRjaCBhIHRyaWdnZXJDaGFyYWN0ZXIuXG4gICAgICBvYnNlcnZhYmxlRnJvbVN1YnNjcmliZUZ1bmN0aW9uKGNiID0+IGVkaXRvci5nZXRCdWZmZXIoKS5vbkRpZENoYW5nZShjYikpXG4gICAgICAgIC8vIFRoZSBjaGFuZ2UgZXZlbnRzIGFuZCBjdXJzb3IgY2hhbmdlcyBhcmUgb2Z0ZW4gc2VxdWVudGlhbC5cbiAgICAgICAgLy8gV2UgbmVlZCB0byBtYWtlIHN1cmUgd2UgdXNlIHRoZSBmaW5hbCBjdXJzb3IgcG9zaXRpb24uXG4gICAgICAgIC5kZWJvdW5jZVRpbWUoMClcbiAgICAgICAgLmZpbHRlcihjaGFuZ2UgPT4ge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIC8vIE9ubHkgaGFuZGxlIHNpbmdsZS9kb3VibGUtY2hhcmFjdGVyIGluc2VydGlvbnMuXG4gICAgICAgICAgICAvLyAoZS5nLiBicmFja2V0LW1hdGNoZXIgaW5zZXJ0cyB0d28gY2hhcmFjdGVycyBvbiBvcGVuIHBhcmVudGhlc2lzKVxuICAgICAgICAgICAgY2hhbmdlLm5ld1RleHQubGVuZ3RoID09PSAwIHx8XG4gICAgICAgICAgICBjaGFuZ2UubmV3VGV4dC5sZW5ndGggPiAyIHx8XG4gICAgICAgICAgICAvLyBUaGUgY2hhbmdlIHNob3VsZCBjb3ZlciB0aGUgY3VycmVudCBjdXJzb3IgcG9zaXRpb24uXG4gICAgICAgICAgICAhY2hhbmdlLm5ld1JhbmdlLmNvbnRhaW5zUG9pbnQoZWRpdG9yLmdldEN1cnNvckJ1ZmZlclBvc2l0aW9uKCkpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgcHJvdmlkZXIgb2YgdGhpcy5fcHJvdmlkZXJSZWdpc3RyeS5nZXRBbGxQcm92aWRlcnNGb3JFZGl0b3IoXG4gICAgICAgICAgICBlZGl0b3IsXG4gICAgICAgICAgKSkge1xuICAgICAgICAgICAgaWYgKHByb3ZpZGVyLnRyaWdnZXJDaGFyYWN0ZXJzICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGFuZ2UubmV3VGV4dC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChwcm92aWRlci50cmlnZ2VyQ2hhcmFjdGVycy5oYXMoY2hhbmdlLm5ld1RleHRbaV0pKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KSxcbiAgICAgIC8vIDIpIEV4cGxpY2l0IHVzYWdlIG9mIHRoZSBBdG9tIGNvbW1hbmQuXG4gICAgICB0aGlzLl9jb21tYW5kcy5maWx0ZXIoZSA9PiBlID09PSBlZGl0b3IpLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQSBzdHJlYW0gb2YgYWxsIHNpZ25hdHVyZXMgZnJvbSBhbiBlZGl0b3IuXG4gICAqL1xuICBfZ2V0U2lnbmF0dXJlU3RyZWFtKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKTogT2JzZXJ2YWJsZTw/U2lnbmF0dXJlSGVscD4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmNvbmNhdChcbiAgICAgIC8vIFN0YXJ0IHdpdGggYSBudWxsIHNpZ25hdHVyZSB0byBjbGVhciBvdXQgYW55IHByaW9yIHNpZ25hdHVyZXMuXG4gICAgICBPYnNlcnZhYmxlLm9mKG51bGwpLFxuICAgICAgLy8gSW1tZWRpYXRlbHkgc3RhcnQgZmV0Y2hpbmcgc2lnbmF0dXJlcyBmb3IgdGhlIGN1cnJlbnQgcG9zaXRpb24uXG4gICAgICBPYnNlcnZhYmxlLmNvbmNhdChcbiAgICAgICAgT2JzZXJ2YWJsZS5kZWZlcigoKSA9PiBPYnNlcnZhYmxlLm9mKGVkaXRvci5nZXRDdXJzb3JCdWZmZXJQb3NpdGlvbigpKSksXG4gICAgICAgIC8vIEZ1cnRoZXIgY3Vyc29yIGNoYW5nZXMgd2lsbCBiZSBkZWJvdW5jZWQuXG4gICAgICAgIGdldEN1cnNvclBvc2l0aW9ucyhlZGl0b3IpLmRlYm91bmNlVGltZShDVVJTT1JfREVCT1VOQ0VfVElNRSksXG4gICAgICApXG4gICAgICAgIC5kaXN0aW5jdFVudGlsQ2hhbmdlZCgoYSwgYikgPT4gYS5pc0VxdWFsKGIpKVxuICAgICAgICAuc3dpdGNoTWFwKHBvaW50ID0+IHRoaXMuX2dldFNpZ25hdHVyZXMoZWRpdG9yLCBwb2ludCkpXG4gICAgICAgIC8vIFN0b3Agb25jZSB3ZSBnZXQgYSBudWxsIHJlc3VsdC5cbiAgICAgICAgLnRha2VXaGlsZShCb29sZWFuKVxuICAgICAgICAvLyBTdG9wIG9uY2UgdGhlIGVzY2FwZSBrZXkgaXMgcHJlc3NlZC5cbiAgICAgICAgLy8gTk9URTogd2UgY2FuJ3QgdXNlIGNvcmU6Y2FuY2VsIGJlY2F1c2UgcGx1Z2lucyBsaWtlIHZpbS1tb2RlLXBsdXMgb3ZlcnJpZGUgaXQuXG4gICAgICAgIC50YWtlVW50aWwoXG4gICAgICAgICAgT2JzZXJ2YWJsZS5mcm9tRXZlbnQoZWRpdG9yLmdldEVsZW1lbnQoKSwgJ2tleWRvd24nKS5maWx0ZXIoXG4gICAgICAgICAgICAoZXZ0OiBLZXlib2FyZEV2ZW50KSA9PiBldnQua2V5Q29kZSA9PT0gMjcsXG4gICAgICAgICAgKSxcbiAgICAgICAgKSxcbiAgICAgIC8vIFRlcm1pbmF0ZSB3aXRoIGEgbnVsbCBzaWduYXR1cmUgdG8gY2xlYXIgYW55IHZpc2libGUgc2lnbmF0dXJlcy5cbiAgICAgIE9ic2VydmFibGUub2YobnVsbCksXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBhIHNpZ25hdHVyZSBmcm9tIGFsbCBwcm92aWRlcnMgZm9yIGFuIGVkaXRvciArIHBvaW50LlxuICAgKiAoRWZmZWN0aXZlbHkganVzdCBhIGNhbmNlbGxhYmxlIHByb21pc2UpLlxuICAgKi9cbiAgX2dldFNpZ25hdHVyZXMoXG4gICAgZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsXG4gICAgcG9pbnQ6IGF0b20kUG9pbnQsXG4gICk6IE9ic2VydmFibGU8P1NpZ25hdHVyZUhlbHA+IHtcbiAgICAvLyBUYWtlIHRoZSBoaWdoZXN0LXByaW9yaXR5IG5vbi1lbXB0eSByZXN1bHQuXG4gICAgcmV0dXJuIChcbiAgICAgIE9ic2VydmFibGUuZGVmZXIoKCkgPT5cbiAgICAgICAgT2JzZXJ2YWJsZS5mcm9tKFxuICAgICAgICAgIHRoaXMuX3Byb3ZpZGVyUmVnaXN0cnkuZ2V0QWxsUHJvdmlkZXJzRm9yRWRpdG9yKGVkaXRvciksXG4gICAgICAgICksXG4gICAgICApXG4gICAgICAgIC5jb25jYXRNYXAocHJvdmlkZXIgPT4ge1xuICAgICAgICAgIHJldHVybiBwcm92aWRlci5nZXRTaWduYXR1cmVIZWxwKGVkaXRvciwgcG9pbnQpLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICBjb25zdCBlZGl0b3JQYXRoID0gZWRpdG9yLmdldFBhdGgoKSB8fCAnPHVudGl0bGVkIGVkaXRvcj4nO1xuICAgICAgICAgICAgZ2V0TG9nZ2VyKCdhdG9tLWlkZS1zaWduYXR1cmUtaGVscCcpLmVycm9yKFxuICAgICAgICAgICAgICBgQ2F1Z2h0IGVycm9yIGZyb20gc2lnbmF0dXJlIGhlbHAgcHJvdmlkZXIgZm9yICR7ZWRpdG9yUGF0aH1gLFxuICAgICAgICAgICAgICBlcnIsXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5maWx0ZXIoeCA9PiB4ICE9IG51bGwgJiYgeC5zaWduYXR1cmVzLmxlbmd0aCA+IDApXG4gICAgICAgIC8vICRGbG93Rml4TWU6IEFkZCB0aW1lb3V0V2l0aCB0byByeGpzIGRlZnNcbiAgICAgICAgLnRpbWVvdXRXaXRoKFNJR05BVFVSRV9USU1FT1VULCBPYnNlcnZhYmxlLm9mKG51bGwpKVxuICAgICAgICAudGFrZSgxKVxuICAgICAgICAuZGVmYXVsdElmRW1wdHkobnVsbClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIERpc3BsYXlzIHRoZSBzaWduYXR1cmUgZGF0YXRpcCBhbmQgd3JhcHMgaXRzIGxpZmV0aW1lIGluIGFuIE9ic2VydmFibGUuXG4gICAqL1xuICBfc2hvd1NpZ25hdHVyZURhdGF0aXAoXG4gICAgZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsXG4gICAgc2lnbmF0dXJlSGVscDogU2lnbmF0dXJlSGVscCxcbiAgKTogT2JzZXJ2YWJsZTxtaXhlZD4ge1xuICAgIHJldHVybiBPYnNlcnZhYmxlLmRlZmVyKCgpID0+IHtcbiAgICAgIGNvbnN0IGRhdGF0aXBTZXJ2aWNlID0gdGhpcy5fZGF0YXRpcFNlcnZpY2U7XG4gICAgICBpZiAoZGF0YXRpcFNlcnZpY2UgPT0gbnVsbCB8fCBzaWduYXR1cmVIZWxwLnNpZ25hdHVyZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBPYnNlcnZhYmxlLmVtcHR5KCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGN1cnJlbnRQb3NpdGlvbiA9IGVkaXRvci5nZXRDdXJzb3JCdWZmZXJQb3NpdGlvbigpO1xuICAgICAgLy8gTWFrZSBzdXJlIHRoZSBkYXRhdGlwIGZvbGxvd3MgdGhlIGN1cnNvciBwb3NpdGlvbi5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIGdldEN1cnNvclBvc2l0aW9ucyhlZGl0b3IpXG4gICAgICAgICAgLy8gQnV0IGRvbid0IGdvIHRvbyBmYXIuXG4gICAgICAgICAgLnRha2VXaGlsZShcbiAgICAgICAgICAgIHBvc2l0aW9uID0+XG4gICAgICAgICAgICAgIE1hdGguYWJzKGN1cnJlbnRQb3NpdGlvbi5yb3cgLSBwb3NpdGlvbi5yb3cpICtcbiAgICAgICAgICAgICAgICBNYXRoLmFicyhjdXJyZW50UG9zaXRpb24uY29sdW1uIC0gcG9zaXRpb24uY29sdW1uKSA8PVxuICAgICAgICAgICAgICAyLFxuICAgICAgICAgIClcbiAgICAgICAgICAuc3dpdGNoTWFwKHBvaW50ID0+IHtcbiAgICAgICAgICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZSgoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGRpc3Bvc2FibGUgPSBkYXRhdGlwU2VydmljZS5jcmVhdGVQaW5uZWREYXRhVGlwKFxuICAgICAgICAgICAgICAgIGdldFNpZ25hdHVyZURhdGF0aXAoc2lnbmF0dXJlSGVscCwgcG9pbnQpLFxuICAgICAgICAgICAgICAgIGVkaXRvcixcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fib3ZlLXJhbmdlJyxcbiAgICAgICAgICAgICAgICAgIHNob3dSYW5nZUhpZ2hsaWdodDogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVbml2ZXJzYWxEaXNwb3NhYmxlKGRpc3Bvc2FibGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==