'use strict';

var cov_2jankiesba = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-find-references/lib/FindReferencesModel.js',
      hash = '2bb1e83a1fb8c1ab27acdcff2e8217015b672f3f',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/atom-ide-ui/pkg/atom-ide-find-references/lib/FindReferencesModel.js',
    statementMap: {
      '0': {
        start: {
          line: 24,
          column: 26
        },
        end: {
          line: 27,
          column: 1
        }
      },
      '1': {
        start: {
          line: 30,
          column: 2
        },
        end: {
          line: 30,
          column: 34
        }
      },
      '2': {
        start: {
          line: 34,
          column: 2
        },
        end: {
          line: 44,
          column: 3
        }
      },
      '3': {
        start: {
          line: 35,
          column: 17
        },
        end: {
          line: 35,
          column: 36
        }
      },
      '4': {
        start: {
          line: 36,
          column: 4
        },
        end: {
          line: 38,
          column: 5
        }
      },
      '5': {
        start: {
          line: 37,
          column: 6
        },
        end: {
          line: 37,
          column: 31
        }
      },
      '6': {
        start: {
          line: 40,
          column: 4
        },
        end: {
          line: 43,
          column: 6
        }
      },
      '7': {
        start: {
          line: 45,
          column: 2
        },
        end: {
          line: 45,
          column: 14
        }
      },
      '8': {
        start: {
          line: 54,
          column: 2
        },
        end: {
          line: 56,
          column: 3
        }
      },
      '9': {
        start: {
          line: 55,
          column: 4
        },
        end: {
          line: 55,
          column: 50
        }
      },
      '10': {
        start: {
          line: 78,
          column: 4
        },
        end: {
          line: 78,
          column: 30
        }
      },
      '11': {
        start: {
          line: 79,
          column: 4
        },
        end: {
          line: 79,
          column: 34
        }
      },
      '12': {
        start: {
          line: 80,
          column: 4
        },
        end: {
          line: 80,
          column: 45
        }
      },
      '13': {
        start: {
          line: 81,
          column: 4
        },
        end: {
          line: 81,
          column: 34
        }
      },
      '14': {
        start: {
          line: 83,
          column: 4
        },
        end: {
          line: 83,
          column: 44
        }
      },
      '15': {
        start: {
          line: 96,
          column: 51
        },
        end: {
          line: 100,
          column: 5
        }
      },
      '16': {
        start: {
          line: 101,
          column: 4
        },
        end: {
          line: 101,
          column: 40
        }
      },
      '17': {
        start: {
          line: 105,
          column: 4
        },
        end: {
          line: 105,
          column: 26
        }
      },
      '18': {
        start: {
          line: 109,
          column: 4
        },
        end: {
          line: 109,
          column: 28
        }
      },
      '19': {
        start: {
          line: 113,
          column: 4
        },
        end: {
          line: 113,
          column: 32
        }
      },
      '20': {
        start: {
          line: 117,
          column: 4
        },
        end: {
          line: 117,
          column: 35
        }
      },
      '21': {
        start: {
          line: 122,
          column: 4
        },
        end: {
          line: 122,
          column: 45
        }
      },
      '22': {
        start: {
          line: 127,
          column: 23
        },
        end: {
          line: 127,
          column: 32
        }
      },
      '23': {
        start: {
          line: 128,
          column: 4
        },
        end: {
          line: 134,
          column: 5
        }
      },
      '24': {
        start: {
          line: 129,
          column: 27
        },
        end: {
          line: 129,
          column: 56
        }
      },
      '25': {
        start: {
          line: 130,
          column: 6
        },
        end: {
          line: 132,
          column: 7
        }
      },
      '26': {
        start: {
          line: 131,
          column: 8
        },
        end: {
          line: 131,
          column: 61
        }
      },
      '27': {
        start: {
          line: 133,
          column: 6
        },
        end: {
          line: 133,
          column: 37
        }
      },
      '28': {
        start: {
          line: 137,
          column: 4
        },
        end: {
          line: 137,
          column: 26
        }
      },
      '29': {
        start: {
          line: 138,
          column: 4
        },
        end: {
          line: 168,
          column: 5
        }
      },
      '30': {
        start: {
          line: 139,
          column: 41
        },
        end: {
          line: 139,
          column: 46
        }
      },
      '31': {
        start: {
          line: 140,
          column: 6
        },
        end: {
          line: 140,
          column: 45
        }
      },
      '32': {
        start: {
          line: 142,
          column: 21
        },
        end: {
          line: 142,
          column: 23
        }
      },
      '33': {
        start: {
          line: 143,
          column: 21
        },
        end: {
          line: 143,
          column: 23
        }
      },
      '34': {
        start: {
          line: 144,
          column: 25
        },
        end: {
          line: 144,
          column: 28
        }
      },
      '35': {
        start: {
          line: 145,
          column: 23
        },
        end: {
          line: 145,
          column: 26
        }
      },
      '36': {
        start: {
          line: 146,
          column: 6
        },
        end: {
          line: 165,
          column: 7
        }
      },
      '37': {
        start: {
          line: 147,
          column: 22
        },
        end: {
          line: 147,
          column: 31
        }
      },
      '38': {
        start: {
          line: 148,
          column: 8
        },
        end: {
          line: 164,
          column: 9
        }
      },
      '39': {
        start: {
          line: 150,
          column: 10
        },
        end: {
          line: 158,
          column: 11
        }
      },
      '40': {
        start: {
          line: 154,
          column: 12
        },
        end: {
          line: 154,
          column: 31
        }
      },
      '41': {
        start: {
          line: 155,
          column: 12
        },
        end: {
          line: 155,
          column: 61
        }
      },
      '42': {
        start: {
          line: 157,
          column: 12
        },
        end: {
          line: 157,
          column: 35
        }
      },
      '43': {
        start: {
          line: 160,
          column: 10
        },
        end: {
          line: 160,
          column: 72
        }
      },
      '44': {
        start: {
          line: 161,
          column: 10
        },
        end: {
          line: 161,
          column: 27
        }
      },
      '45': {
        start: {
          line: 162,
          column: 10
        },
        end: {
          line: 162,
          column: 41
        }
      },
      '46': {
        start: {
          line: 163,
          column: 10
        },
        end: {
          line: 163,
          column: 37
        }
      },
      '47': {
        start: {
          line: 166,
          column: 6
        },
        end: {
          line: 166,
          column: 68
        }
      },
      '48': {
        start: {
          line: 167,
          column: 6
        },
        end: {
          line: 167,
          column: 47
        }
      },
      '49': {
        start: {
          line: 171,
          column: 4
        },
        end: {
          line: 171,
          column: 62
        }
      },
      '50': {
        start: {
          line: 171,
          column: 36
        },
        end: {
          line: 171,
          column: 60
        }
      },
      '51': {
        start: {
          line: 180,
          column: 16
        },
        end: {
          line: 180,
          column: 33
        }
      },
      '52': {
        start: {
          line: 181,
          column: 20
        },
        end: {
          line: 181,
          column: 37
        }
      },
      '53': {
        start: {
          line: 182,
          column: 25
        },
        end: {
          line: 182,
          column: 52
        }
      },
      '54': {
        start: {
          line: 184,
          column: 4
        },
        end: {
          line: 186,
          column: 5
        }
      },
      '55': {
        start: {
          line: 185,
          column: 6
        },
        end: {
          line: 185,
          column: 18
        }
      },
      '56': {
        start: {
          line: 187,
          column: 22
        },
        end: {
          line: 187,
          column: 46
        }
      },
      '57': {
        start: {
          line: 188,
          column: 24
        },
        end: {
          line: 188,
          column: 26
        }
      },
      '58': {
        start: {
          line: 189,
          column: 4
        },
        end: {
          line: 208,
          column: 7
        }
      },
      '59': {
        start: {
          line: 190,
          column: 27
        },
        end: {
          line: 190,
          column: 32
        }
      },
      '60': {
        start: {
          line: 191,
          column: 33
        },
        end: {
          line: 191,
          column: 38
        }
      },
      '61': {
        start: {
          line: 193,
          column: 6
        },
        end: {
          line: 193,
          column: 68
        }
      },
      '62': {
        start: {
          line: 194,
          column: 6
        },
        end: {
          line: 197,
          column: 8
        }
      },
      '63': {
        start: {
          line: 199,
          column: 6
        },
        end: {
          line: 201,
          column: 7
        }
      },
      '64': {
        start: {
          line: 200,
          column: 8
        },
        end: {
          line: 200,
          column: 20
        }
      },
      '65': {
        start: {
          line: 202,
          column: 6
        },
        end: {
          line: 204,
          column: 7
        }
      },
      '66': {
        start: {
          line: 203,
          column: 8
        },
        end: {
          line: 203,
          column: 18
        }
      },
      '67': {
        start: {
          line: 206,
          column: 6
        },
        end: {
          line: 206,
          column: 75
        }
      },
      '68': {
        start: {
          line: 207,
          column: 6
        },
        end: {
          line: 207,
          column: 46
        }
      },
      '69': {
        start: {
          line: 209,
          column: 18
        },
        end: {
          line: 209,
          column: 64
        }
      },
      '70': {
        start: {
          line: 210,
          column: 28
        },
        end: {
          line: 210,
          column: 64
        }
      },
      '71': {
        start: {
          line: 211,
          column: 4
        },
        end: {
          line: 213,
          column: 5
        }
      },
      '72': {
        start: {
          line: 212,
          column: 6
        },
        end: {
          line: 212,
          column: 78
        }
      },
      '73': {
        start: {
          line: 214,
          column: 4
        },
        end: {
          line: 219,
          column: 6
        }
      }
    },
    fnMap: {
      '0': {
        name: 'compareReference',
        decl: {
          start: {
            line: 29,
            column: 9
          },
          end: {
            line: 29,
            column: 25
          }
        },
        loc: {
          start: {
            line: 29,
            column: 62
          },
          end: {
            line: 31,
            column: 1
          }
        },
        line: 29
      },
      '1': {
        name: 'readFileContents',
        decl: {
          start: {
            line: 33,
            column: 15
          },
          end: {
            line: 33,
            column: 31
          }
        },
        loc: {
          start: {
            line: 33,
            column: 63
          },
          end: {
            line: 46,
            column: 1
          }
        },
        line: 33
      },
      '2': {
        name: 'addReferenceGroup',
        decl: {
          start: {
            line: 48,
            column: 9
          },
          end: {
            line: 48,
            column: 26
          }
        },
        loc: {
          start: {
            line: 53,
            column: 2
          },
          end: {
            line: 57,
            column: 1
          }
        },
        line: 53
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 72,
            column: 2
          },
          end: {
            line: 72,
            column: 3
          }
        },
        loc: {
          start: {
            line: 77,
            column: 4
          },
          end: {
            line: 84,
            column: 3
          }
        },
        line: 77
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 92,
            column: 2
          },
          end: {
            line: 92,
            column: 3
          }
        },
        loc: {
          start: {
            line: 95,
            column: 36
          },
          end: {
            line: 102,
            column: 3
          }
        },
        line: 95
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 104,
            column: 2
          },
          end: {
            line: 104,
            column: 3
          }
        },
        loc: {
          start: {
            line: 104,
            column: 24
          },
          end: {
            line: 106,
            column: 3
          }
        },
        line: 104
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 108,
            column: 2
          },
          end: {
            line: 108,
            column: 3
          }
        },
        loc: {
          start: {
            line: 108,
            column: 26
          },
          end: {
            line: 110,
            column: 3
          }
        },
        line: 108
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 112,
            column: 2
          },
          end: {
            line: 112,
            column: 3
          }
        },
        loc: {
          start: {
            line: 112,
            column: 30
          },
          end: {
            line: 114,
            column: 3
          }
        },
        line: 112
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 116,
            column: 2
          },
          end: {
            line: 116,
            column: 3
          }
        },
        loc: {
          start: {
            line: 116,
            column: 25
          },
          end: {
            line: 118,
            column: 3
          }
        },
        line: 116
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 120,
            column: 2
          },
          end: {
            line: 120,
            column: 3
          }
        },
        loc: {
          start: {
            line: 120,
            column: 30
          },
          end: {
            line: 123,
            column: 3
          }
        },
        line: 120
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 125,
            column: 2
          },
          end: {
            line: 125,
            column: 3
          }
        },
        loc: {
          start: {
            line: 125,
            column: 61
          },
          end: {
            line: 172,
            column: 3
          }
        },
        line: 125
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 171,
            column: 26
          },
          end: {
            line: 171,
            column: 27
          }
        },
        loc: {
          start: {
            line: 171,
            column: 36
          },
          end: {
            line: 171,
            column: 60
          }
        },
        line: 171
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 177,
            column: 2
          },
          end: {
            line: 177,
            column: 3
          }
        },
        loc: {
          start: {
            line: 179,
            column: 30
          },
          end: {
            line: 220,
            column: 3
          }
        },
        line: 179
      },
      '13': {
        name: '(anonymous_13)',
        decl: {
          start: {
            line: 189,
            column: 30
          },
          end: {
            line: 189,
            column: 31
          }
        },
        loc: {
          start: {
            line: 189,
            column: 39
          },
          end: {
            line: 208,
            column: 5
          }
        },
        line: 189
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 36,
            column: 4
          },
          end: {
            line: 38,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 36,
            column: 4
          },
          end: {
            line: 38,
            column: 5
          }
        }, {
          start: {
            line: 36,
            column: 4
          },
          end: {
            line: 38,
            column: 5
          }
        }],
        line: 36
      },
      '1': {
        loc: {
          start: {
            line: 54,
            column: 2
          },
          end: {
            line: 56,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 54,
            column: 2
          },
          end: {
            line: 56,
            column: 3
          }
        }, {
          start: {
            line: 54,
            column: 2
          },
          end: {
            line: 56,
            column: 3
          }
        }],
        line: 54
      },
      '2': {
        loc: {
          start: {
            line: 81,
            column: 20
          },
          end: {
            line: 81,
            column: 33
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 81,
            column: 20
          },
          end: {
            line: 81,
            column: 27
          }
        }, {
          start: {
            line: 81,
            column: 31
          },
          end: {
            line: 81,
            column: 33
          }
        }],
        line: 81
      },
      '3': {
        loc: {
          start: {
            line: 122,
            column: 11
          },
          end: {
            line: 122,
            column: 44
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 122,
            column: 11
          },
          end: {
            line: 122,
            column: 39
          }
        }, {
          start: {
            line: 122,
            column: 43
          },
          end: {
            line: 122,
            column: 44
          }
        }],
        line: 122
      },
      '4': {
        loc: {
          start: {
            line: 130,
            column: 6
          },
          end: {
            line: 132,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 130,
            column: 6
          },
          end: {
            line: 132,
            column: 7
          }
        }, {
          start: {
            line: 130,
            column: 6
          },
          end: {
            line: 132,
            column: 7
          }
        }],
        line: 130
      },
      '5': {
        loc: {
          start: {
            line: 148,
            column: 8
          },
          end: {
            line: 164,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 148,
            column: 8
          },
          end: {
            line: 164,
            column: 9
          }
        }, {
          start: {
            line: 148,
            column: 8
          },
          end: {
            line: 164,
            column: 9
          }
        }],
        line: 148
      },
      '6': {
        loc: {
          start: {
            line: 150,
            column: 10
          },
          end: {
            line: 158,
            column: 11
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 150,
            column: 10
          },
          end: {
            line: 158,
            column: 11
          }
        }, {
          start: {
            line: 150,
            column: 10
          },
          end: {
            line: 158,
            column: 11
          }
        }],
        line: 150
      },
      '7': {
        loc: {
          start: {
            line: 151,
            column: 12
          },
          end: {
            line: 152,
            column: 70
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 151,
            column: 12
          },
          end: {
            line: 151,
            column: 31
          }
        }, {
          start: {
            line: 152,
            column: 12
          },
          end: {
            line: 152,
            column: 70
          }
        }],
        line: 151
      },
      '8': {
        loc: {
          start: {
            line: 184,
            column: 4
          },
          end: {
            line: 186,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 184,
            column: 4
          },
          end: {
            line: 186,
            column: 5
          }
        }, {
          start: {
            line: 184,
            column: 4
          },
          end: {
            line: 186,
            column: 5
          }
        }],
        line: 184
      },
      '9': {
        loc: {
          start: {
            line: 199,
            column: 13
          },
          end: {
            line: 199,
            column: 63
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 199,
            column: 13
          },
          end: {
            line: 199,
            column: 32
          }
        }, {
          start: {
            line: 199,
            column: 36
          },
          end: {
            line: 199,
            column: 63
          }
        }],
        line: 199
      },
      '10': {
        loc: {
          start: {
            line: 202,
            column: 13
          },
          end: {
            line: 202,
            column: 61
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 202,
            column: 13
          },
          end: {
            line: 202,
            column: 32
          }
        }, {
          start: {
            line: 202,
            column: 36
          },
          end: {
            line: 202,
            column: 61
          }
        }],
        line: 202
      },
      '11': {
        loc: {
          start: {
            line: 211,
            column: 4
          },
          end: {
            line: 213,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 211,
            column: 4
          },
          end: {
            line: 213,
            column: 5
          }
        }, {
          start: {
            line: 211,
            column: 4
          },
          end: {
            line: 213,
            column: 5
          }
        }],
        line: 211
      },
      '12': {
        loc: {
          start: {
            line: 212,
            column: 16
          },
          end: {
            line: 212,
            column: 77
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 212,
            column: 16
          },
          end: {
            line: 212,
            column: 66
          }
        }, {
          start: {
            line: 212,
            column: 70
          },
          end: {
            line: 212,
            column: 77
          }
        }],
        line: 212
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0,
      '50': 0,
      '51': 0,
      '52': 0,
      '53': 0,
      '54': 0,
      '55': 0,
      '56': 0,
      '57': 0,
      '58': 0,
      '59': 0,
      '60': 0,
      '61': 0,
      '62': 0,
      '63': 0,
      '64': 0,
      '65': 0,
      '66': 0,
      '67': 0,
      '68': 0,
      '69': 0,
      '70': 0,
      '71': 0,
      '72': 0,
      '73': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0],
      '10': [0, 0],
      '11': [0, 0],
      '12': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _asyncToGenerator = _interopRequireDefault(require('async-to-generator'));

let readFileContents = (() => {
  var _ref = (0, _asyncToGenerator.default)(function* (uri) {
    cov_2jankiesba.f[1]++;
    cov_2jankiesba.s[2]++;

    try {
      const file = (cov_2jankiesba.s[3]++, (0, (_projects || _load_projects()).getFileForPath)(uri));
      cov_2jankiesba.s[4]++;
      if (file != null) {
        cov_2jankiesba.b[0][0]++;
        cov_2jankiesba.s[5]++;

        return yield file.read();
      } else {
        cov_2jankiesba.b[0][1]++;
      }
    } catch (e) {
      cov_2jankiesba.s[6]++;

      (0, (_log4js || _load_log4js()).getLogger)('atom-ide-find-references').error(`find-references: could not load file ${uri}`, e);
    }
    cov_2jankiesba.s[7]++;
    return null;
  });

  return function readFileContents(_x) {
    return _ref.apply(this, arguments);
  };
})();

var _projects;

function _load_projects() {
  return _projects = require('nuclide-commons-atom/projects');
}

var _collection;

function _load_collection() {
  return _collection = require('nuclide-commons/collection');
}

var _log4js;

function _load_log4js() {
  return _log4js = require('log4js');
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const FRAGMENT_GRAMMARS = (cov_2jankiesba.s[0]++, {
  'text.html.hack': 'source.hackfragment',
  'text.html.php': 'source.hackfragment'
}); /**
     * Copyright (c) 2017-present, Facebook, Inc.
     * All rights reserved.
     *
     * This source code is licensed under the BSD-style license found in the
     * LICENSE file in the root directory of this source tree. An additional grant
     * of patent rights can be found in the PATENTS file in the same directory.
     *
     * 
     * @format
     */

function compareReference(x, y) {
  cov_2jankiesba.f[0]++;
  cov_2jankiesba.s[1]++;

  return x.range.compare(y.range);
}

function addReferenceGroup(groups, references, startLine, endLine) {
  cov_2jankiesba.f[2]++;
  cov_2jankiesba.s[8]++;

  if (references.length) {
    cov_2jankiesba.b[1][0]++;
    cov_2jankiesba.s[9]++;

    groups.push({ references, startLine, endLine });
  } else {
    cov_2jankiesba.b[1][1]++;
  }
}

class FindReferencesModel {

  /**
   * @param basePath    Base path of the project. Used to display paths in a friendly way.
   * @param symbolName  The name of the symbol we're finding references for.
   * @param references  A list of references to `symbolName`.
   * @param options     See `FindReferencesOptions`.
   */
  constructor(basePath, symbolName, references, options) {
    cov_2jankiesba.f[3]++;
    cov_2jankiesba.s[10]++;

    this._basePath = basePath;
    cov_2jankiesba.s[11]++;
    this._symbolName = symbolName;
    cov_2jankiesba.s[12]++;
    this._referenceCount = references.length;
    cov_2jankiesba.s[13]++;
    this._options = (cov_2jankiesba.b[2][0]++, options) || (cov_2jankiesba.b[2][1]++, {});

    cov_2jankiesba.s[14]++;
    this._groupReferencesByFile(references);
  }

  /**
   * The main public entry point.
   * Returns a list of references, grouped by file (with previews),
   * according to the given offset and limit.
   * References in each file are grouped together if they're adjacent.
   */
  getFileReferences(offset, limit) {
    var _this = this;

    return (0, _asyncToGenerator.default)(function* () {
      cov_2jankiesba.f[4]++;

      const fileReferences = (cov_2jankiesba.s[15]++, yield Promise.all(_this._references.slice(offset, offset + limit).map(_this._makeFileReferences.bind(_this))));
      cov_2jankiesba.s[16]++;
      return (0, (_collection || _load_collection()).arrayCompact)(fileReferences);
    })();
  }

  getBasePath() {
    cov_2jankiesba.f[5]++;
    cov_2jankiesba.s[17]++;

    return this._basePath;
  }

  getSymbolName() {
    cov_2jankiesba.f[6]++;
    cov_2jankiesba.s[18]++;

    return this._symbolName;
  }

  getReferenceCount() {
    cov_2jankiesba.f[7]++;
    cov_2jankiesba.s[19]++;

    return this._referenceCount;
  }

  getFileCount() {
    cov_2jankiesba.f[8]++;
    cov_2jankiesba.s[20]++;

    return this._references.length;
  }

  getPreviewContext() {
    cov_2jankiesba.f[9]++;
    cov_2jankiesba.s[21]++;

    // flowlint-next-line sketchy-null-number:off
    return (cov_2jankiesba.b[3][0]++, this._options.previewContext) || (cov_2jankiesba.b[3][1]++, 1);
  }

  _groupReferencesByFile(references) {
    cov_2jankiesba.f[10]++;

    // 1. Group references by file.
    const refsByFile = (cov_2jankiesba.s[22]++, new Map());
    cov_2jankiesba.s[23]++;
    for (const reference of references) {
      let fileReferences = (cov_2jankiesba.s[24]++, refsByFile.get(reference.uri));
      cov_2jankiesba.s[25]++;
      if (fileReferences == null) {
        cov_2jankiesba.b[4][0]++;
        cov_2jankiesba.s[26]++;

        refsByFile.set(reference.uri, fileReferences = []);
      } else {
        cov_2jankiesba.b[4][1]++;
      }
      cov_2jankiesba.s[27]++;
      fileReferences.push(reference);
    }

    // 2. Group references within each file.
    cov_2jankiesba.s[28]++;
    this._references = [];
    cov_2jankiesba.s[29]++;
    for (const entry of refsByFile) {
      const [fileUri, entryReferences] = (cov_2jankiesba.s[30]++, entry);
      cov_2jankiesba.s[31]++;
      entryReferences.sort(compareReference);
      // Group references that are <= 1 line apart together.
      const groups = (cov_2jankiesba.s[32]++, []);
      let curGroup = (cov_2jankiesba.s[33]++, []);
      let curStartLine = (cov_2jankiesba.s[34]++, -11);
      let curEndLine = (cov_2jankiesba.s[35]++, -11);
      cov_2jankiesba.s[36]++;
      for (const ref of entryReferences) {
        const range = (cov_2jankiesba.s[37]++, ref.range);
        cov_2jankiesba.s[38]++;
        if (range.start.row <= curEndLine + 1 + this.getPreviewContext()) {
          cov_2jankiesba.b[5][0]++;
          cov_2jankiesba.s[39]++;

          // Remove references with the same range (happens in C++ with templates)
          if ((cov_2jankiesba.b[7][0]++, curGroup.length > 0) && (cov_2jankiesba.b[7][1]++, compareReference(curGroup[curGroup.length - 1], ref) !== 0)) {
            cov_2jankiesba.b[6][0]++;
            cov_2jankiesba.s[40]++;

            curGroup.push(ref);
            cov_2jankiesba.s[41]++;
            curEndLine = Math.max(curEndLine, range.end.row);
          } else {
            cov_2jankiesba.b[6][1]++;
            cov_2jankiesba.s[42]++;

            this._referenceCount--;
          }
        } else {
          cov_2jankiesba.b[5][1]++;
          cov_2jankiesba.s[43]++;

          addReferenceGroup(groups, curGroup, curStartLine, curEndLine);
          cov_2jankiesba.s[44]++;
          curGroup = [ref];
          cov_2jankiesba.s[45]++;
          curStartLine = range.start.row;
          cov_2jankiesba.s[46]++;
          curEndLine = range.end.row;
        }
      }
      cov_2jankiesba.s[47]++;
      addReferenceGroup(groups, curGroup, curStartLine, curEndLine);
      cov_2jankiesba.s[48]++;
      this._references.push([fileUri, groups]);
    }

    // Finally, sort by file name.
    cov_2jankiesba.s[49]++;
    this._references.sort((x, y) => {
      cov_2jankiesba.f[11]++;
      cov_2jankiesba.s[50]++;
      return x[0].localeCompare(y[0]);
    });
  }

  /**
   * Fetch file previews and expand line ranges with context.
   */
  _makeFileReferences(fileReferences) {
    var _this2 = this;

    return (0, _asyncToGenerator.default)(function* () {
      cov_2jankiesba.f[12]++;

      const uri = (cov_2jankiesba.s[51]++, fileReferences[0]);
      let refGroups = (cov_2jankiesba.s[52]++, fileReferences[1]);
      const fileContents = (cov_2jankiesba.s[53]++, yield readFileContents(uri));
      // flowlint-next-line sketchy-null-string:off
      cov_2jankiesba.s[54]++;
      if (!fileContents) {
        cov_2jankiesba.b[8][0]++;
        cov_2jankiesba.s[55]++;

        return null;
      } else {
        cov_2jankiesba.b[8][1]++;
      }
      const fileLines = (cov_2jankiesba.s[56]++, fileContents.split('\n'));
      const previewText = (cov_2jankiesba.s[57]++, []);
      cov_2jankiesba.s[58]++;
      refGroups = refGroups.map(function (group) {
        cov_2jankiesba.f[13]++;

        const { references } = (cov_2jankiesba.s[59]++, group);
        let { startLine, endLine } = (cov_2jankiesba.s[60]++, group);
        // Expand start/end lines with context.
        cov_2jankiesba.s[61]++;
        startLine = Math.max(startLine - _this2.getPreviewContext(), 0);
        cov_2jankiesba.s[62]++;
        endLine = Math.min(endLine + _this2.getPreviewContext(), fileLines.length - 1);
        // However, don't include blank lines.
        cov_2jankiesba.s[63]++;
        while ((cov_2jankiesba.b[9][0]++, startLine < endLine) && (cov_2jankiesba.b[9][1]++, fileLines[startLine] === '')) {
          cov_2jankiesba.s[64]++;

          startLine++;
        }
        cov_2jankiesba.s[65]++;
        while ((cov_2jankiesba.b[10][0]++, startLine < endLine) && (cov_2jankiesba.b[10][1]++, fileLines[endLine] === '')) {
          cov_2jankiesba.s[66]++;

          endLine--;
        }

        cov_2jankiesba.s[67]++;
        previewText.push(fileLines.slice(startLine, endLine + 1).join('\n'));
        cov_2jankiesba.s[68]++;
        return { references, startLine, endLine };
      });
      let grammar = (cov_2jankiesba.s[69]++, atom.grammars.selectGrammar(uri, fileContents));
      const fragmentGrammar = (cov_2jankiesba.s[70]++, FRAGMENT_GRAMMARS[grammar.scopeName]);
      cov_2jankiesba.s[71]++;
      if (fragmentGrammar) {
        cov_2jankiesba.b[11][0]++;
        cov_2jankiesba.s[72]++;

        grammar = (cov_2jankiesba.b[12][0]++, atom.grammars.grammarForScopeName(fragmentGrammar)) || (cov_2jankiesba.b[12][1]++, grammar);
      } else {
        cov_2jankiesba.b[11][1]++;
      }
      cov_2jankiesba.s[73]++;
      return {
        uri,
        grammar,
        previewText,
        refGroups
      };
    })();
  }
}
exports.default = FindReferencesModel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZpbmRSZWZlcmVuY2VzTW9kZWwuanMiXSwibmFtZXMiOlsidXJpIiwiZmlsZSIsInJlYWQiLCJlIiwiZXJyb3IiLCJyZWFkRmlsZUNvbnRlbnRzIiwiRlJBR01FTlRfR1JBTU1BUlMiLCJjb21wYXJlUmVmZXJlbmNlIiwieCIsInkiLCJyYW5nZSIsImNvbXBhcmUiLCJhZGRSZWZlcmVuY2VHcm91cCIsImdyb3VwcyIsInJlZmVyZW5jZXMiLCJzdGFydExpbmUiLCJlbmRMaW5lIiwibGVuZ3RoIiwicHVzaCIsIkZpbmRSZWZlcmVuY2VzTW9kZWwiLCJjb25zdHJ1Y3RvciIsImJhc2VQYXRoIiwic3ltYm9sTmFtZSIsIm9wdGlvbnMiLCJfYmFzZVBhdGgiLCJfc3ltYm9sTmFtZSIsIl9yZWZlcmVuY2VDb3VudCIsIl9vcHRpb25zIiwiX2dyb3VwUmVmZXJlbmNlc0J5RmlsZSIsImdldEZpbGVSZWZlcmVuY2VzIiwib2Zmc2V0IiwibGltaXQiLCJmaWxlUmVmZXJlbmNlcyIsIlByb21pc2UiLCJhbGwiLCJfcmVmZXJlbmNlcyIsInNsaWNlIiwibWFwIiwiX21ha2VGaWxlUmVmZXJlbmNlcyIsImJpbmQiLCJnZXRCYXNlUGF0aCIsImdldFN5bWJvbE5hbWUiLCJnZXRSZWZlcmVuY2VDb3VudCIsImdldEZpbGVDb3VudCIsImdldFByZXZpZXdDb250ZXh0IiwicHJldmlld0NvbnRleHQiLCJyZWZzQnlGaWxlIiwiTWFwIiwicmVmZXJlbmNlIiwiZ2V0Iiwic2V0IiwiZW50cnkiLCJmaWxlVXJpIiwiZW50cnlSZWZlcmVuY2VzIiwic29ydCIsImN1ckdyb3VwIiwiY3VyU3RhcnRMaW5lIiwiY3VyRW5kTGluZSIsInJlZiIsInN0YXJ0Iiwicm93IiwiTWF0aCIsIm1heCIsImVuZCIsImxvY2FsZUNvbXBhcmUiLCJyZWZHcm91cHMiLCJmaWxlQ29udGVudHMiLCJmaWxlTGluZXMiLCJzcGxpdCIsInByZXZpZXdUZXh0IiwiZ3JvdXAiLCJtaW4iLCJqb2luIiwiZ3JhbW1hciIsImF0b20iLCJncmFtbWFycyIsInNlbGVjdEdyYW1tYXIiLCJmcmFnbWVudEdyYW1tYXIiLCJzY29wZU5hbWUiLCJncmFtbWFyRm9yU2NvcGVOYW1lIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs0Q0FnQ0EsV0FBZ0NBLEdBQWhDLEVBQStEO0FBQUE7QUFBQTs7QUFDN0QsUUFBSTtB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QjtBQWdDMUIsVUFBSUQsZUFBSixFQUFxQjtBQUFBO0FBQUE7O0FBQ25CSixrQkFBVSxpQ0FBS0UsUUFBTCxDQUFjSSxtQkFBZCxDQUFrQ0YsZUFBbEMsa0NBQXNESixPQUF0RCxDQUFWO0FBQ0QsT0FGRDtBQUFBO0FBQUE7QUFoQzBCO0FBbUMxQixhQUFPO0FBQ0x6RSxXQURLO0FBRUx5RSxlQUZLO0FBR0xKLG1CQUhLO0FBSUxKO0FBSkssT0FBUDtBQW5DMEI7QUF5QzNCO0FBaktzQztrQkFBcEI5QyxtQiIsImZpbGUiOiJGaW5kUmVmZXJlbmNlc01vZGVsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuaW1wb3J0IHR5cGUge0ZpbGVSZWZlcmVuY2VzLCBSZWZlcmVuY2UsIFJlZmVyZW5jZUdyb3VwfSBmcm9tICcuL3R5cGVzJztcblxudHlwZSBGaW5kUmVmZXJlbmNlc09wdGlvbnMgPSB7XG4gIC8vIExpbmVzIG9mIGNvbnRleHQgdG8gc2hvdyBhcm91bmQgZWFjaCBwcmV2aWV3IGJsb2NrLiBEZWZhdWx0cyB0byAxLlxuICBwcmV2aWV3Q29udGV4dD86IG51bWJlcixcbn07XG5cbmltcG9ydCB7Z2V0RmlsZUZvclBhdGh9IGZyb20gJ251Y2xpZGUtY29tbW9ucy1hdG9tL3Byb2plY3RzJztcbmltcG9ydCB7YXJyYXlDb21wYWN0fSBmcm9tICdudWNsaWRlLWNvbW1vbnMvY29sbGVjdGlvbic7XG5pbXBvcnQge2dldExvZ2dlcn0gZnJvbSAnbG9nNGpzJztcblxuY29uc3QgRlJBR01FTlRfR1JBTU1BUlMgPSB7XG4gICd0ZXh0Lmh0bWwuaGFjayc6ICdzb3VyY2UuaGFja2ZyYWdtZW50JyxcbiAgJ3RleHQuaHRtbC5waHAnOiAnc291cmNlLmhhY2tmcmFnbWVudCcsXG59O1xuXG5mdW5jdGlvbiBjb21wYXJlUmVmZXJlbmNlKHg6IFJlZmVyZW5jZSwgeTogUmVmZXJlbmNlKTogbnVtYmVyIHtcbiAgcmV0dXJuIHgucmFuZ2UuY29tcGFyZSh5LnJhbmdlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVhZEZpbGVDb250ZW50cyh1cmk6IHN0cmluZyk6IFByb21pc2U8P3N0cmluZz4ge1xuICB0cnkge1xuICAgIGNvbnN0IGZpbGUgPSBnZXRGaWxlRm9yUGF0aCh1cmkpO1xuICAgIGlmIChmaWxlICE9IG51bGwpIHtcbiAgICAgIHJldHVybiBhd2FpdCBmaWxlLnJlYWQoKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBnZXRMb2dnZXIoJ2F0b20taWRlLWZpbmQtcmVmZXJlbmNlcycpLmVycm9yKFxuICAgICAgYGZpbmQtcmVmZXJlbmNlczogY291bGQgbm90IGxvYWQgZmlsZSAke3VyaX1gLFxuICAgICAgZSxcbiAgICApO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBhZGRSZWZlcmVuY2VHcm91cChcbiAgZ3JvdXBzOiBBcnJheTxSZWZlcmVuY2VHcm91cD4sXG4gIHJlZmVyZW5jZXM6IEFycmF5PFJlZmVyZW5jZT4sXG4gIHN0YXJ0TGluZTogbnVtYmVyLFxuICBlbmRMaW5lOiBudW1iZXIsXG4pIHtcbiAgaWYgKHJlZmVyZW5jZXMubGVuZ3RoKSB7XG4gICAgZ3JvdXBzLnB1c2goe3JlZmVyZW5jZXMsIHN0YXJ0TGluZSwgZW5kTGluZX0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZpbmRSZWZlcmVuY2VzTW9kZWwge1xuICBfYmFzZVBhdGg6IHN0cmluZztcbiAgX3N5bWJvbE5hbWU6IHN0cmluZztcbiAgX3JlZmVyZW5jZXM6IEFycmF5PFtzdHJpbmcsIEFycmF5PFJlZmVyZW5jZUdyb3VwPl0+O1xuICBfcmVmZXJlbmNlQ291bnQ6IG51bWJlcjtcbiAgX29wdGlvbnM6IEZpbmRSZWZlcmVuY2VzT3B0aW9ucztcblxuICAvKipcbiAgICogQHBhcmFtIGJhc2VQYXRoICAgIEJhc2UgcGF0aCBvZiB0aGUgcHJvamVjdC4gVXNlZCB0byBkaXNwbGF5IHBhdGhzIGluIGEgZnJpZW5kbHkgd2F5LlxuICAgKiBAcGFyYW0gc3ltYm9sTmFtZSAgVGhlIG5hbWUgb2YgdGhlIHN5bWJvbCB3ZSdyZSBmaW5kaW5nIHJlZmVyZW5jZXMgZm9yLlxuICAgKiBAcGFyYW0gcmVmZXJlbmNlcyAgQSBsaXN0IG9mIHJlZmVyZW5jZXMgdG8gYHN5bWJvbE5hbWVgLlxuICAgKiBAcGFyYW0gb3B0aW9ucyAgICAgU2VlIGBGaW5kUmVmZXJlbmNlc09wdGlvbnNgLlxuICAgKi9cbiAgY29uc3RydWN0b3IoXG4gICAgYmFzZVBhdGg6IHN0cmluZyxcbiAgICBzeW1ib2xOYW1lOiBzdHJpbmcsXG4gICAgcmVmZXJlbmNlczogQXJyYXk8UmVmZXJlbmNlPixcbiAgICBvcHRpb25zPzogRmluZFJlZmVyZW5jZXNPcHRpb25zLFxuICApIHtcbiAgICB0aGlzLl9iYXNlUGF0aCA9IGJhc2VQYXRoO1xuICAgIHRoaXMuX3N5bWJvbE5hbWUgPSBzeW1ib2xOYW1lO1xuICAgIHRoaXMuX3JlZmVyZW5jZUNvdW50ID0gcmVmZXJlbmNlcy5sZW5ndGg7XG4gICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICB0aGlzLl9ncm91cFJlZmVyZW5jZXNCeUZpbGUocmVmZXJlbmNlcyk7XG4gIH1cblxuICAvKipcbiAgICogVGhlIG1haW4gcHVibGljIGVudHJ5IHBvaW50LlxuICAgKiBSZXR1cm5zIGEgbGlzdCBvZiByZWZlcmVuY2VzLCBncm91cGVkIGJ5IGZpbGUgKHdpdGggcHJldmlld3MpLFxuICAgKiBhY2NvcmRpbmcgdG8gdGhlIGdpdmVuIG9mZnNldCBhbmQgbGltaXQuXG4gICAqIFJlZmVyZW5jZXMgaW4gZWFjaCBmaWxlIGFyZSBncm91cGVkIHRvZ2V0aGVyIGlmIHRoZXkncmUgYWRqYWNlbnQuXG4gICAqL1xuICBhc3luYyBnZXRGaWxlUmVmZXJlbmNlcyhcbiAgICBvZmZzZXQ6IG51bWJlcixcbiAgICBsaW1pdDogbnVtYmVyLFxuICApOiBQcm9taXNlPEFycmF5PEZpbGVSZWZlcmVuY2VzPj4ge1xuICAgIGNvbnN0IGZpbGVSZWZlcmVuY2VzOiBBcnJheTw/RmlsZVJlZmVyZW5jZXM+ID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICB0aGlzLl9yZWZlcmVuY2VzXG4gICAgICAgIC5zbGljZShvZmZzZXQsIG9mZnNldCArIGxpbWl0KVxuICAgICAgICAubWFwKHRoaXMuX21ha2VGaWxlUmVmZXJlbmNlcy5iaW5kKHRoaXMpKSxcbiAgICApO1xuICAgIHJldHVybiBhcnJheUNvbXBhY3QoZmlsZVJlZmVyZW5jZXMpO1xuICB9XG5cbiAgZ2V0QmFzZVBhdGgoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fYmFzZVBhdGg7XG4gIH1cblxuICBnZXRTeW1ib2xOYW1lKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX3N5bWJvbE5hbWU7XG4gIH1cblxuICBnZXRSZWZlcmVuY2VDb3VudCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9yZWZlcmVuY2VDb3VudDtcbiAgfVxuXG4gIGdldEZpbGVDb3VudCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9yZWZlcmVuY2VzLmxlbmd0aDtcbiAgfVxuXG4gIGdldFByZXZpZXdDb250ZXh0KCk6IG51bWJlciB7XG4gICAgLy8gZmxvd2xpbnQtbmV4dC1saW5lIHNrZXRjaHktbnVsbC1udW1iZXI6b2ZmXG4gICAgcmV0dXJuIHRoaXMuX29wdGlvbnMucHJldmlld0NvbnRleHQgfHwgMTtcbiAgfVxuXG4gIF9ncm91cFJlZmVyZW5jZXNCeUZpbGUocmVmZXJlbmNlczogQXJyYXk8UmVmZXJlbmNlPik6IHZvaWQge1xuICAgIC8vIDEuIEdyb3VwIHJlZmVyZW5jZXMgYnkgZmlsZS5cbiAgICBjb25zdCByZWZzQnlGaWxlID0gbmV3IE1hcCgpO1xuICAgIGZvciAoY29uc3QgcmVmZXJlbmNlIG9mIHJlZmVyZW5jZXMpIHtcbiAgICAgIGxldCBmaWxlUmVmZXJlbmNlcyA9IHJlZnNCeUZpbGUuZ2V0KHJlZmVyZW5jZS51cmkpO1xuICAgICAgaWYgKGZpbGVSZWZlcmVuY2VzID09IG51bGwpIHtcbiAgICAgICAgcmVmc0J5RmlsZS5zZXQocmVmZXJlbmNlLnVyaSwgKGZpbGVSZWZlcmVuY2VzID0gW10pKTtcbiAgICAgIH1cbiAgICAgIGZpbGVSZWZlcmVuY2VzLnB1c2gocmVmZXJlbmNlKTtcbiAgICB9XG5cbiAgICAvLyAyLiBHcm91cCByZWZlcmVuY2VzIHdpdGhpbiBlYWNoIGZpbGUuXG4gICAgdGhpcy5fcmVmZXJlbmNlcyA9IFtdO1xuICAgIGZvciAoY29uc3QgZW50cnkgb2YgcmVmc0J5RmlsZSkge1xuICAgICAgY29uc3QgW2ZpbGVVcmksIGVudHJ5UmVmZXJlbmNlc10gPSBlbnRyeTtcbiAgICAgIGVudHJ5UmVmZXJlbmNlcy5zb3J0KGNvbXBhcmVSZWZlcmVuY2UpO1xuICAgICAgLy8gR3JvdXAgcmVmZXJlbmNlcyB0aGF0IGFyZSA8PSAxIGxpbmUgYXBhcnQgdG9nZXRoZXIuXG4gICAgICBjb25zdCBncm91cHMgPSBbXTtcbiAgICAgIGxldCBjdXJHcm91cCA9IFtdO1xuICAgICAgbGV0IGN1clN0YXJ0TGluZSA9IC0xMTtcbiAgICAgIGxldCBjdXJFbmRMaW5lID0gLTExO1xuICAgICAgZm9yIChjb25zdCByZWYgb2YgZW50cnlSZWZlcmVuY2VzKSB7XG4gICAgICAgIGNvbnN0IHJhbmdlID0gcmVmLnJhbmdlO1xuICAgICAgICBpZiAocmFuZ2Uuc3RhcnQucm93IDw9IGN1ckVuZExpbmUgKyAxICsgdGhpcy5nZXRQcmV2aWV3Q29udGV4dCgpKSB7XG4gICAgICAgICAgLy8gUmVtb3ZlIHJlZmVyZW5jZXMgd2l0aCB0aGUgc2FtZSByYW5nZSAoaGFwcGVucyBpbiBDKysgd2l0aCB0ZW1wbGF0ZXMpXG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgY3VyR3JvdXAubGVuZ3RoID4gMCAmJlxuICAgICAgICAgICAgY29tcGFyZVJlZmVyZW5jZShjdXJHcm91cFtjdXJHcm91cC5sZW5ndGggLSAxXSwgcmVmKSAhPT0gMFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY3VyR3JvdXAucHVzaChyZWYpO1xuICAgICAgICAgICAgY3VyRW5kTGluZSA9IE1hdGgubWF4KGN1ckVuZExpbmUsIHJhbmdlLmVuZC5yb3cpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZlcmVuY2VDb3VudC0tO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhZGRSZWZlcmVuY2VHcm91cChncm91cHMsIGN1ckdyb3VwLCBjdXJTdGFydExpbmUsIGN1ckVuZExpbmUpO1xuICAgICAgICAgIGN1ckdyb3VwID0gW3JlZl07XG4gICAgICAgICAgY3VyU3RhcnRMaW5lID0gcmFuZ2Uuc3RhcnQucm93O1xuICAgICAgICAgIGN1ckVuZExpbmUgPSByYW5nZS5lbmQucm93O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBhZGRSZWZlcmVuY2VHcm91cChncm91cHMsIGN1ckdyb3VwLCBjdXJTdGFydExpbmUsIGN1ckVuZExpbmUpO1xuICAgICAgdGhpcy5fcmVmZXJlbmNlcy5wdXNoKFtmaWxlVXJpLCBncm91cHNdKTtcbiAgICB9XG5cbiAgICAvLyBGaW5hbGx5LCBzb3J0IGJ5IGZpbGUgbmFtZS5cbiAgICB0aGlzLl9yZWZlcmVuY2VzLnNvcnQoKHgsIHkpID0+IHhbMF0ubG9jYWxlQ29tcGFyZSh5WzBdKSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggZmlsZSBwcmV2aWV3cyBhbmQgZXhwYW5kIGxpbmUgcmFuZ2VzIHdpdGggY29udGV4dC5cbiAgICovXG4gIGFzeW5jIF9tYWtlRmlsZVJlZmVyZW5jZXMoXG4gICAgZmlsZVJlZmVyZW5jZXM6IFtzdHJpbmcsIEFycmF5PFJlZmVyZW5jZUdyb3VwPl0sXG4gICk6IFByb21pc2U8P0ZpbGVSZWZlcmVuY2VzPiB7XG4gICAgY29uc3QgdXJpID0gZmlsZVJlZmVyZW5jZXNbMF07XG4gICAgbGV0IHJlZkdyb3VwcyA9IGZpbGVSZWZlcmVuY2VzWzFdO1xuICAgIGNvbnN0IGZpbGVDb250ZW50cyA9IGF3YWl0IHJlYWRGaWxlQ29udGVudHModXJpKTtcbiAgICAvLyBmbG93bGludC1uZXh0LWxpbmUgc2tldGNoeS1udWxsLXN0cmluZzpvZmZcbiAgICBpZiAoIWZpbGVDb250ZW50cykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGZpbGVMaW5lcyA9IGZpbGVDb250ZW50cy5zcGxpdCgnXFxuJyk7XG4gICAgY29uc3QgcHJldmlld1RleHQgPSBbXTtcbiAgICByZWZHcm91cHMgPSByZWZHcm91cHMubWFwKGdyb3VwID0+IHtcbiAgICAgIGNvbnN0IHtyZWZlcmVuY2VzfSA9IGdyb3VwO1xuICAgICAgbGV0IHtzdGFydExpbmUsIGVuZExpbmV9ID0gZ3JvdXA7XG4gICAgICAvLyBFeHBhbmQgc3RhcnQvZW5kIGxpbmVzIHdpdGggY29udGV4dC5cbiAgICAgIHN0YXJ0TGluZSA9IE1hdGgubWF4KHN0YXJ0TGluZSAtIHRoaXMuZ2V0UHJldmlld0NvbnRleHQoKSwgMCk7XG4gICAgICBlbmRMaW5lID0gTWF0aC5taW4oXG4gICAgICAgIGVuZExpbmUgKyB0aGlzLmdldFByZXZpZXdDb250ZXh0KCksXG4gICAgICAgIGZpbGVMaW5lcy5sZW5ndGggLSAxLFxuICAgICAgKTtcbiAgICAgIC8vIEhvd2V2ZXIsIGRvbid0IGluY2x1ZGUgYmxhbmsgbGluZXMuXG4gICAgICB3aGlsZSAoc3RhcnRMaW5lIDwgZW5kTGluZSAmJiBmaWxlTGluZXNbc3RhcnRMaW5lXSA9PT0gJycpIHtcbiAgICAgICAgc3RhcnRMaW5lKys7XG4gICAgICB9XG4gICAgICB3aGlsZSAoc3RhcnRMaW5lIDwgZW5kTGluZSAmJiBmaWxlTGluZXNbZW5kTGluZV0gPT09ICcnKSB7XG4gICAgICAgIGVuZExpbmUtLTtcbiAgICAgIH1cblxuICAgICAgcHJldmlld1RleHQucHVzaChmaWxlTGluZXMuc2xpY2Uoc3RhcnRMaW5lLCBlbmRMaW5lICsgMSkuam9pbignXFxuJykpO1xuICAgICAgcmV0dXJuIHtyZWZlcmVuY2VzLCBzdGFydExpbmUsIGVuZExpbmV9O1xuICAgIH0pO1xuICAgIGxldCBncmFtbWFyID0gYXRvbS5ncmFtbWFycy5zZWxlY3RHcmFtbWFyKHVyaSwgZmlsZUNvbnRlbnRzKTtcbiAgICBjb25zdCBmcmFnbWVudEdyYW1tYXIgPSBGUkFHTUVOVF9HUkFNTUFSU1tncmFtbWFyLnNjb3BlTmFtZV07XG4gICAgaWYgKGZyYWdtZW50R3JhbW1hcikge1xuICAgICAgZ3JhbW1hciA9IGF0b20uZ3JhbW1hcnMuZ3JhbW1hckZvclNjb3BlTmFtZShmcmFnbWVudEdyYW1tYXIpIHx8IGdyYW1tYXI7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICB1cmksXG4gICAgICBncmFtbWFyLFxuICAgICAgcHJldmlld1RleHQsXG4gICAgICByZWZHcm91cHMsXG4gICAgfTtcbiAgfVxufVxuIl19