'use strict';

var cov_fhsmjtlql = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/nuclide-commons-atom/observePaneItemVisibility.js',
      hash = 'ae8739bf789f8760325bb9f7aeff4a3fcddc10c7',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/nuclide-commons-atom/observePaneItemVisibility.js',
    statementMap: {
      '0': {
        start: {
          line: 24,
          column: 2
        },
        end: {
          line: 24,
          column: 15
        }
      },
      '1': {
        start: {
          line: 26,
          column: 22
        },
        end: {
          line: 26,
          column: 49
        }
      },
      '2': {
        start: {
          line: 27,
          column: 2
        },
        end: {
          line: 44,
          column: 28
        }
      },
      '3': {
        start: {
          line: 35,
          column: 6
        },
        end: {
          line: 37,
          column: 7
        }
      },
      '4': {
        start: {
          line: 36,
          column: 8
        },
        end: {
          line: 36,
          column: 21
        }
      },
      '5': {
        start: {
          line: 39,
          column: 28
        },
        end: {
          line: 39,
          column: 69
        }
      },
      '6': {
        start: {
          line: 40,
          column: 6
        },
        end: {
          line: 42,
          column: 60
        }
      },
      '7': {
        start: {
          line: 48,
          column: 2
        },
        end: {
          line: 48,
          column: 15
        }
      },
      '8': {
        start: {
          line: 50,
          column: 22
        },
        end: {
          line: 50,
          column: 49
        }
      },
      '9': {
        start: {
          line: 51,
          column: 2
        },
        end: {
          line: 62,
          column: 5
        }
      },
      '10': {
        start: {
          line: 57,
          column: 4
        },
        end: {
          line: 61,
          column: 7
        }
      },
      '11': {
        start: {
          line: 58,
          column: 28
        },
        end: {
          line: 58,
          column: 69
        }
      },
      '12': {
        start: {
          line: 59,
          column: 23
        },
        end: {
          line: 59,
          column: 67
        }
      },
      '13': {
        start: {
          line: 60,
          column: 6
        },
        end: {
          line: 60,
          column: 72
        }
      },
      '14': {
        start: {
          line: 65,
          column: 27
        },
        end: {
          line: 104,
          column: 2
        }
      },
      '15': {
        start: {
          line: 67,
          column: 26
        },
        end: {
          line: 83,
          column: 3
        }
      },
      '16': {
        start: {
          line: 69,
          column: 27
        },
        end: {
          line: 69,
          column: 73
        }
      },
      '17': {
        start: {
          line: 70,
          column: 6
        },
        end: {
          line: 81,
          column: 9
        }
      },
      '18': {
        start: {
          line: 71,
          column: 30
        },
        end: {
          line: 73,
          column: 9
        }
      },
      '19': {
        start: {
          line: 74,
          column: 28
        },
        end: {
          line: 76,
          column: 34
        }
      },
      '20': {
        start: {
          line: 77,
          column: 8
        },
        end: {
          line: 80,
          column: 10
        }
      },
      '21': {
        start: {
          line: 78,
          column: 35
        },
        end: {
          line: 78,
          column: 47
        }
      },
      '22': {
        start: {
          line: 87,
          column: 28
        },
        end: {
          line: 94,
          column: 15
        }
      },
      '23': {
        start: {
          line: 88,
          column: 4
        },
        end: {
          line: 92,
          column: 5
        }
      },
      '24': {
        start: {
          line: 89,
          column: 6
        },
        end: {
          line: 89,
          column: 23
        }
      },
      '25': {
        start: {
          line: 91,
          column: 6
        },
        end: {
          line: 91,
          column: 26
        }
      },
      '26': {
        start: {
          line: 93,
          column: 4
        },
        end: {
          line: 93,
          column: 15
        }
      },
      '27': {
        start: {
          line: 96,
          column: 2
        },
        end: {
          line: 103,
          column: 4
        }
      },
      '28': {
        start: {
          line: 101,
          column: 18
        },
        end: {
          line: 101,
          column: 39
        }
      },
      '29': {
        start: {
          line: 108,
          column: 41
        },
        end: {
          line: 145,
          column: 2
        }
      },
      '30': {
        start: {
          line: 109,
          column: 29
        },
        end: {
          line: 120,
          column: 3
        }
      },
      '31': {
        start: {
          line: 110,
          column: 4
        },
        end: {
          line: 119,
          column: 41
        }
      },
      '32': {
        start: {
          line: 111,
          column: 30
        },
        end: {
          line: 111,
          column: 46
        }
      },
      '33': {
        start: {
          line: 115,
          column: 10
        },
        end: {
          line: 117,
          column: 59
        }
      },
      '34': {
        start: {
          line: 122,
          column: 30
        },
        end: {
          line: 128,
          column: 3
        }
      },
      '35': {
        start: {
          line: 131,
          column: 27
        },
        end: {
          line: 141,
          column: 21
        }
      },
      '36': {
        start: {
          line: 133,
          column: 37
        },
        end: {
          line: 136,
          column: 7
        }
      },
      '37': {
        start: {
          line: 142,
          column: 2
        },
        end: {
          line: 142,
          column: 29
        }
      },
      '38': {
        start: {
          line: 144,
          column: 2
        },
        end: {
          line: 144,
          column: 26
        }
      },
      '39': {
        start: {
          line: 149,
          column: 19
        },
        end: {
          line: 149,
          column: 24
        }
      },
      '40': {
        start: {
          line: 150,
          column: 25
        },
        end: {
          line: 150,
          column: 38
        }
      },
      '41': {
        start: {
          line: 152,
          column: 2
        },
        end: {
          line: 154,
          column: 3
        }
      },
      '42': {
        start: {
          line: 153,
          column: 4
        },
        end: {
          line: 153,
          column: 11
        }
      },
      '43': {
        start: {
          line: 155,
          column: 2
        },
        end: {
          line: 155,
          column: 22
        }
      },
      '44': {
        start: {
          line: 156,
          column: 15
        },
        end: {
          line: 156,
          column: 55
        }
      },
      '45': {
        start: {
          line: 157,
          column: 16
        },
        end: {
          line: 157,
          column: 30
        }
      },
      '46': {
        start: {
          line: 159,
          column: 27
        },
        end: {
          line: 159,
          column: 41
        }
      },
      '47': {
        start: {
          line: 161,
          column: 2
        },
        end: {
          line: 169,
          column: 4
        }
      },
      '48': {
        start: {
          line: 162,
          column: 4
        },
        end: {
          line: 162,
          column: 51
        }
      },
      '49': {
        start: {
          line: 163,
          column: 4
        },
        end: {
          line: 168,
          column: 5
        }
      },
      '50': {
        start: {
          line: 164,
          column: 6
        },
        end: {
          line: 167,
          column: 9
        }
      }
    },
    fnMap: {
      '0': {
        name: 'observePaneItemVisibility',
        decl: {
          start: {
            line: 21,
            column: 24
          },
          end: {
            line: 21,
            column: 49
          }
        },
        loc: {
          start: {
            line: 23,
            column: 23
          },
          end: {
            line: 45,
            column: 1
          }
        },
        line: 23
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 33,
            column: 9
          },
          end: {
            line: 33,
            column: 10
          }
        },
        loc: {
          start: {
            line: 33,
            column: 50
          },
          end: {
            line: 43,
            column: 5
          }
        },
        line: 33
      },
      '2': {
        name: 'observeVisibleItems',
        decl: {
          start: {
            line: 47,
            column: 16
          },
          end: {
            line: 47,
            column: 35
          }
        },
        loc: {
          start: {
            line: 47,
            column: 38
          },
          end: {
            line: 63,
            column: 1
          }
        },
        line: 47
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 54,
            column: 8
          },
          end: {
            line: 54,
            column: 9
          }
        },
        loc: {
          start: {
            line: 54,
            column: 49
          },
          end: {
            line: 62,
            column: 3
          }
        },
        line: 54
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 57,
            column: 34
          },
          end: {
            line: 57,
            column: 35
          }
        },
        loc: {
          start: {
            line: 57,
            column: 42
          },
          end: {
            line: 61,
            column: 5
          }
        },
        line: 57
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 65,
            column: 47
          },
          end: {
            line: 65,
            column: 48
          }
        },
        loc: {
          start: {
            line: 65,
            column: 60
          },
          end: {
            line: 104,
            column: 1
          }
        },
        line: 65
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 68,
            column: 46
          },
          end: {
            line: 68,
            column: 47
          }
        },
        loc: {
          start: {
            line: 68,
            column: 63
          },
          end: {
            line: 82,
            column: 5
          }
        },
        line: 68
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 70,
            column: 67
          },
          end: {
            line: 70,
            column: 68
          }
        },
        loc: {
          start: {
            line: 70,
            column: 75
          },
          end: {
            line: 81,
            column: 7
          }
        },
        line: 70
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 78,
            column: 26
          },
          end: {
            line: 78,
            column: 27
          }
        },
        loc: {
          start: {
            line: 78,
            column: 35
          },
          end: {
            line: 78,
            column: 47
          }
        },
        line: 78
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 87,
            column: 49
          },
          end: {
            line: 87,
            column: 50
          }
        },
        loc: {
          start: {
            line: 87,
            column: 72
          },
          end: {
            line: 94,
            column: 3
          }
        },
        line: 87
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 101,
            column: 11
          },
          end: {
            line: 101,
            column: 12
          }
        },
        loc: {
          start: {
            line: 101,
            column: 18
          },
          end: {
            line: 101,
            column: 39
          }
        },
        line: 101
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 108,
            column: 61
          },
          end: {
            line: 108,
            column: 62
          }
        },
        loc: {
          start: {
            line: 108,
            column: 74
          },
          end: {
            line: 145,
            column: 1
          }
        },
        line: 108
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 109,
            column: 61
          },
          end: {
            line: 109,
            column: 62
          }
        },
        loc: {
          start: {
            line: 110,
            column: 4
          },
          end: {
            line: 119,
            column: 41
          }
        },
        line: 110
      },
      '13': {
        name: '(anonymous_13)',
        decl: {
          start: {
            line: 111,
            column: 14
          },
          end: {
            line: 111,
            column: 15
          }
        },
        loc: {
          start: {
            line: 111,
            column: 30
          },
          end: {
            line: 111,
            column: 46
          }
        },
        line: 111
      },
      '14': {
        name: '(anonymous_14)',
        decl: {
          start: {
            line: 113,
            column: 8
          },
          end: {
            line: 113,
            column: 9
          }
        },
        loc: {
          start: {
            line: 115,
            column: 10
          },
          end: {
            line: 117,
            column: 59
          }
        },
        line: 115
      },
      '15': {
        name: '(anonymous_15)',
        decl: {
          start: {
            line: 133,
            column: 6
          },
          end: {
            line: 133,
            column: 7
          }
        },
        loc: {
          start: {
            line: 133,
            column: 37
          },
          end: {
            line: 136,
            column: 7
          }
        },
        line: 133
      },
      '16': {
        name: 'patchDocks',
        decl: {
          start: {
            line: 151,
            column: 9
          },
          end: {
            line: 151,
            column: 19
          }
        },
        loc: {
          start: {
            line: 151,
            column: 22
          },
          end: {
            line: 170,
            column: 1
          }
        },
        line: 151
      },
      '17': {
        name: '(anonymous_17)',
        decl: {
          start: {
            line: 161,
            column: 19
          },
          end: {
            line: 161,
            column: 20
          }
        },
        loc: {
          start: {
            line: 161,
            column: 47
          },
          end: {
            line: 169,
            column: 3
          }
        },
        line: 161
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 35,
            column: 6
          },
          end: {
            line: 37,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 35,
            column: 6
          },
          end: {
            line: 37,
            column: 7
          }
        }, {
          start: {
            line: 35,
            column: 6
          },
          end: {
            line: 37,
            column: 7
          }
        }],
        line: 35
      },
      '1': {
        loc: {
          start: {
            line: 40,
            column: 13
          },
          end: {
            line: 42,
            column: 59
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 41,
            column: 10
          },
          end: {
            line: 41,
            column: 15
          }
        }, {
          start: {
            line: 42,
            column: 10
          },
          end: {
            line: 42,
            column: 59
          }
        }],
        line: 40
      },
      '2': {
        loc: {
          start: {
            line: 59,
            column: 23
          },
          end: {
            line: 59,
            column: 67
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 59,
            column: 23
          },
          end: {
            line: 59,
            column: 36
          }
        }, {
          start: {
            line: 59,
            column: 40
          },
          end: {
            line: 59,
            column: 67
          }
        }],
        line: 59
      },
      '3': {
        loc: {
          start: {
            line: 60,
            column: 13
          },
          end: {
            line: 60,
            column: 71
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 60,
            column: 24
          },
          end: {
            line: 60,
            column: 63
          }
        }, {
          start: {
            line: 60,
            column: 66
          },
          end: {
            line: 60,
            column: 71
          }
        }],
        line: 60
      },
      '4': {
        loc: {
          start: {
            line: 88,
            column: 4
          },
          end: {
            line: 92,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 88,
            column: 4
          },
          end: {
            line: 92,
            column: 5
          }
        }, {
          start: {
            line: 88,
            column: 4
          },
          end: {
            line: 92,
            column: 5
          }
        }],
        line: 88
      },
      '5': {
        loc: {
          start: {
            line: 115,
            column: 10
          },
          end: {
            line: 117,
            column: 59
          }
        },
        type: 'cond-expr',
        locations: [{
          start: {
            line: 116,
            column: 14
          },
          end: {
            line: 116,
            column: 48
          }
        }, {
          start: {
            line: 117,
            column: 14
          },
          end: {
            line: 117,
            column: 59
          }
        }],
        line: 115
      },
      '6': {
        loc: {
          start: {
            line: 152,
            column: 2
          },
          end: {
            line: 154,
            column: 3
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 152,
            column: 2
          },
          end: {
            line: 154,
            column: 3
          }
        }, {
          start: {
            line: 152,
            column: 2
          },
          end: {
            line: 154,
            column: 3
          }
        }],
        line: 152
      },
      '7': {
        loc: {
          start: {
            line: 152,
            column: 6
          },
          end: {
            line: 152,
            column: 70
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 152,
            column: 6
          },
          end: {
            line: 152,
            column: 18
          }
        }, {
          start: {
            line: 152,
            column: 22
          },
          end: {
            line: 152,
            column: 70
          }
        }],
        line: 152
      },
      '8': {
        loc: {
          start: {
            line: 163,
            column: 4
          },
          end: {
            line: 168,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 163,
            column: 4
          },
          end: {
            line: 168,
            column: 5
          }
        }, {
          start: {
            line: 163,
            column: 4
          },
          end: {
            line: 168,
            column: 5
          }
        }],
        line: 163
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0,
      '50': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = observePaneItemVisibility;
exports.observeVisibleItems = observeVisibleItems;

var _event;

function _load_event() {
  return _event = require('nuclide-commons/event');
}

var _memoizeUntilChanged;

function _load_memoizeUntilChanged() {
  return _memoizeUntilChanged = _interopRequireDefault(require('nuclide-commons/memoizeUntilChanged'));
}

var _collection;

function _load_collection() {
  return _collection = require('nuclide-commons/collection');
}

var _rxjsBundlesRxMinJs = require('rxjs/bundles/Rx.min.js');

var _shallowequal;

function _load_shallowequal() {
  return _shallowequal = _interopRequireDefault(require('shallowequal'));
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// TODO(T17495608): Currently, docks don't have a way of observing their visibility so this will
//   have some false positives when an item is its pane's active item but its dock is hidden.
function observePaneItemVisibility(item) {
  cov_fhsmjtlql.f[0]++;
  cov_fhsmjtlql.s[0]++;

  patchDocks();

  const workspaceEl = (cov_fhsmjtlql.s[1]++, atom.workspace.getElement());
  cov_fhsmjtlql.s[2]++;
  return _rxjsBundlesRxMinJs.Observable.combineLatest(
  // atom.workspace.reset() (in tests) resets all the panes.
  // Pass in the workspace dom element to act as a cache-breaker.
  observeActiveItems(workspaceEl), observePaneContainerVisibilities(workspaceEl)).map(([activeItems, locationVisibilities]) => {
    cov_fhsmjtlql.f[1]++;
    cov_fhsmjtlql.s[3]++;

    // If it's not active, it's not visible.
    if (!activeItems.has(item)) {
      cov_fhsmjtlql.b[0][0]++;
      cov_fhsmjtlql.s[4]++;

      return false;
    } else {
      cov_fhsmjtlql.b[0][1]++;
    }
    // If it's active, it's only visible if its container is.
    const paneContainer = (cov_fhsmjtlql.s[5]++, atom.workspace.paneContainerForItem(item));
    cov_fhsmjtlql.s[6]++;
    return paneContainer == null ? (cov_fhsmjtlql.b[1][0]++, false) : (cov_fhsmjtlql.b[1][1]++, locationVisibilities[paneContainer.getLocation()]);
  }).distinctUntilChanged();
} /**
   * Copyright (c) 2017-present, Facebook, Inc.
   * All rights reserved.
   *
   * This source code is licensed under the BSD-style license found in the
   * LICENSE file in the root directory of this source tree. An additional grant
   * of patent rights can be found in the PATENTS file in the same directory.
   *
   * 
   * @format
   */

function observeVisibleItems() {
  cov_fhsmjtlql.f[2]++;
  cov_fhsmjtlql.s[7]++;

  patchDocks();

  const workspaceEl = (cov_fhsmjtlql.s[8]++, atom.workspace.getElement());
  cov_fhsmjtlql.s[9]++;
  return _rxjsBundlesRxMinJs.Observable.combineLatest(observeActiveItems(workspaceEl), observePaneContainerVisibilities(workspaceEl)).map(([activeItems, locationVisibilities]) => {
    cov_fhsmjtlql.f[3]++;
    cov_fhsmjtlql.s[10]++;

    // If it's not active, it's not visible.
    // If it's active, it's only visible if its container is.
    return (0, (_collection || _load_collection()).setFilter)(activeItems, item => {
      cov_fhsmjtlql.f[4]++;

      const paneContainer = (cov_fhsmjtlql.s[11]++, atom.workspace.paneContainerForItem(item));
      const location = (cov_fhsmjtlql.s[12]++, (cov_fhsmjtlql.b[2][0]++, paneContainer) && (cov_fhsmjtlql.b[2][1]++, paneContainer.getLocation()));
      cov_fhsmjtlql.s[13]++;
      return location ? (cov_fhsmjtlql.b[3][0]++, Boolean(locationVisibilities[location])) : (cov_fhsmjtlql.b[3][1]++, false);
    });
  });
}

const observeActiveItems = (cov_fhsmjtlql.s[14]++, (0, (_memoizeUntilChanged || _load_memoizeUntilChanged()).default)(_cacheKey => {
  cov_fhsmjtlql.f[5]++;

  // An observable that emits `{pane, item}` whenever the active item of a pane changes.
  const itemActivations = (cov_fhsmjtlql.s[15]++, _rxjsBundlesRxMinJs.Observable.merge(...atom.workspace.getPaneContainers().map(paneContainer => {
    cov_fhsmjtlql.f[6]++;

    const observePanes = (cov_fhsmjtlql.s[16]++, paneContainer.observePanes.bind(paneContainer));
    cov_fhsmjtlql.s[17]++;
    return (0, (_event || _load_event()).observableFromSubscribeFunction)(observePanes).flatMap(pane => {
      cov_fhsmjtlql.f[7]++;

      const paneDestroyed = (cov_fhsmjtlql.s[18]++, (0, (_event || _load_event()).observableFromSubscribeFunction)(pane.onDidDestroy.bind(pane)));
      const activeItems = (cov_fhsmjtlql.s[19]++, (0, (_event || _load_event()).observableFromSubscribeFunction)(pane.observeActiveItem.bind(pane)).takeUntil(paneDestroyed));
      cov_fhsmjtlql.s[20]++;
      return _rxjsBundlesRxMinJs.Observable.concat(activeItems.map(item => {
        cov_fhsmjtlql.f[8]++;
        cov_fhsmjtlql.s[21]++;
        return { pane, item };
      }), _rxjsBundlesRxMinJs.Observable.of({ pane, item: null }));
    });
  })));

  // Create a map of panes to their active items. We could look this up by examining the workspace
  // every time; this is an optimization.
  const panesToActiveItem = (cov_fhsmjtlql.s[22]++, itemActivations.scan((acc, { pane, item }) => {
    cov_fhsmjtlql.f[9]++;
    cov_fhsmjtlql.s[23]++;

    if (item == null) {
      cov_fhsmjtlql.b[4][0]++;
      cov_fhsmjtlql.s[24]++;

      acc.delete(pane);
    } else {
      cov_fhsmjtlql.b[4][1]++;
      cov_fhsmjtlql.s[25]++;

      acc.set(pane, item);
    }
    cov_fhsmjtlql.s[26]++;
    return acc;
  }, new Map()));

  cov_fhsmjtlql.s[27]++;
  return panesToActiveItem
  // When dragging items between panes, they'll be quickly deactivated and activated again. To
  // avoid doing extra work, we debounce and use the rAF scheduler.
  .debounceTime(0, _rxjsBundlesRxMinJs.Scheduler.animationFrame).map(map => {
    cov_fhsmjtlql.f[10]++;
    cov_fhsmjtlql.s[28]++;
    return new Set(map.values());
  }).share();
}));

// Create an observable that contains the current visibility state of each dock, but where the
// "false" values are delayed to account for the time it takes to animate the dock closed.
const observePaneContainerVisibilities = (cov_fhsmjtlql.s[29]++, (0, (_memoizeUntilChanged || _load_memoizeUntilChanged()).default)(_cacheKey => {
  cov_fhsmjtlql.f[11]++;

  const visibilitiesByDock = (cov_fhsmjtlql.s[30]++, ['left', 'right', 'bottom'].map(loc => {
    cov_fhsmjtlql.f[12]++;
    cov_fhsmjtlql.s[31]++;
    return dockStateChanges.filter(({ location }) => {
      cov_fhsmjtlql.f[13]++;
      cov_fhsmjtlql.s[32]++;
      return location === loc;
    }).switchMap(({ location, visible }) => {
      cov_fhsmjtlql.f[14]++;
      cov_fhsmjtlql.s[33]++;
      return (
        // Delay the "false" values so they don't occur while the dock is being animated closed.
        visible ? (cov_fhsmjtlql.b[5][0]++, _rxjsBundlesRxMinJs.Observable.of({ location, visible })) : (cov_fhsmjtlql.b[5][1]++, _rxjsBundlesRxMinJs.Observable.of({ location, visible }).delay(300))
      );
    }).distinctUntilKeyChanged('visible');
  }));

  const initialVisibilities = (cov_fhsmjtlql.s[34]++, {
    // The center is always visible.
    center: true,
    left: atom.workspace.getLeftDock().isVisible(),
    right: atom.workspace.getRightDock().isVisible(),
    bottom: atom.workspace.getBottomDock().isVisible()
  });

  // Accumulate the dock visibilities.
  const visibilityStates = (cov_fhsmjtlql.s[35]++, _rxjsBundlesRxMinJs.Observable.merge(...visibilitiesByDock).scan((acc, { location, visible }) => {
    cov_fhsmjtlql.f[15]++;
    cov_fhsmjtlql.s[36]++;
    return Object.assign({}, acc, {
      [location]: visible
    });
  }, initialVisibilities).startWith(initialVisibilities).distinctUntilChanged((_shallowequal || _load_shallowequal()).default).publishReplay(1));
  cov_fhsmjtlql.s[37]++;
  visibilityStates.connect();

  cov_fhsmjtlql.s[38]++;
  return visibilityStates;
}));

// HACK: Monkey-patch Docks in order to observe visibility toggling.
// TODO: Use `Dock::observeVisibility` once atom/atom#14736 is in our lowest-supported version
let docksPatched = (cov_fhsmjtlql.s[39]++, false);
const dockStateChanges = (cov_fhsmjtlql.s[40]++, new _rxjsBundlesRxMinJs.Subject());
function patchDocks() {
  cov_fhsmjtlql.f[16]++;
  cov_fhsmjtlql.s[41]++;

  if ((cov_fhsmjtlql.b[7][0]++, docksPatched) || (cov_fhsmjtlql.b[7][1]++, typeof atom.workspace.getLeftDock !== 'function')) {
    cov_fhsmjtlql.b[6][0]++;
    cov_fhsmjtlql.s[42]++;

    return;
  } else {
    cov_fhsmjtlql.b[6][1]++;
  }
  cov_fhsmjtlql.s[43]++;
  docksPatched = true;
  const ctor = (cov_fhsmjtlql.s[44]++, atom.workspace.getLeftDock().constructor);
  const proto = (cov_fhsmjtlql.s[45]++, ctor.prototype);
  // $FlowIgnore
  const originalSetState = (cov_fhsmjtlql.s[46]++, proto.setState);
  // $FlowIgnore
  cov_fhsmjtlql.s[47]++;
  proto.setState = function (newState, ...args) {
    cov_fhsmjtlql.f[17]++;
    cov_fhsmjtlql.s[48]++;

    originalSetState.call(this, newState, ...args);
    cov_fhsmjtlql.s[49]++;
    if (newState.hasOwnProperty('visible')) {
      cov_fhsmjtlql.b[8][0]++;
      cov_fhsmjtlql.s[50]++;

      dockStateChanges.next({
        location: this.getLocation(),
        visible: newState.visible
      });
    } else {
      cov_fhsmjtlql.b[8][1]++;
    }
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9ic2VydmVQYW5lSXRlbVZpc2liaWxpdHkuanMiXSwibmFtZXMiOlsib2JzZXJ2ZVBhbmVJdGVtVmlzaWJpbGl0eSIsIm9ic2VydmVWaXNpYmxlSXRlbXMiLCJpdGVtIiwicGF0Y2hEb2NrcyIsIndvcmtzcGFjZUVsIiwiYXRvbSIsIndvcmtzcGFjZSIsImdldEVsZW1lbnQiLCJjb21iaW5lTGF0ZXN0Iiwib2JzZXJ2ZUFjdGl2ZUl0ZW1zIiwib2JzZXJ2ZVBhbmVDb250YWluZXJWaXNpYmlsaXRpZXMiLCJtYXAiLCJhY3RpdmVJdGVtcyIsImxvY2F0aW9uVmlzaWJpbGl0aWVzIiwiaGFzIiwicGFuZUNvbnRhaW5lciIsInBhbmVDb250YWluZXJGb3JJdGVtIiwiZ2V0TG9jYXRpb24iLCJkaXN0aW5jdFVudGlsQ2hhbmdlZCIsImxvY2F0aW9uIiwiQm9vbGVhbiIsIl9jYWNoZUtleSIsIml0ZW1BY3RpdmF0aW9ucyIsIm1lcmdlIiwiZ2V0UGFuZUNvbnRhaW5lcnMiLCJvYnNlcnZlUGFuZXMiLCJiaW5kIiwiZmxhdE1hcCIsInBhbmUiLCJwYW5lRGVzdHJveWVkIiwib25EaWREZXN0cm95Iiwib2JzZXJ2ZUFjdGl2ZUl0ZW0iLCJ0YWtlVW50aWwiLCJjb25jYXQiLCJvZiIsInBhbmVzVG9BY3RpdmVJdGVtIiwic2NhbiIsImFjYyIsImRlbGV0ZSIsInNldCIsIk1hcCIsImRlYm91bmNlVGltZSIsImFuaW1hdGlvbkZyYW1lIiwiU2V0IiwidmFsdWVzIiwic2hhcmUiLCJ2aXNpYmlsaXRpZXNCeURvY2siLCJsb2MiLCJmaWx0ZXIiLCJzd2l0Y2hNYXAiLCJ2aXNpYmxlIiwiZGVsYXkiLCJkaXN0aW5jdFVudGlsS2V5Q2hhbmdlZCIsImluaXRpYWxWaXNpYmlsaXRpZXMiLCJjZW50ZXIiLCJsZWZ0IiwiZ2V0TGVmdERvY2siLCJpc1Zpc2libGUiLCJyaWdodCIsImdldFJpZ2h0RG9jayIsImJvdHRvbSIsImdldEJvdHRvbURvY2siLCJ2aXNpYmlsaXR5U3RhdGVzIiwic3RhcnRXaXRoIiwicHVibGlzaFJlcGxheSIsImNvbm5lY3QiLCJkb2Nrc1BhdGNoZWQiLCJkb2NrU3RhdGVDaGFuZ2VzIiwiY3RvciIsImNvbnN0cnVjdG9yIiwicHJvdG8iLCJwcm90b3R5cGUiLCJvcmlnaW5hbFNldFN0YXRlIiwic2V0U3RhdGUiLCJuZXdTdGF0ZSIsImFyZ3MiLCJjYWxsIiwiaGFzT3duUHJvcGVydHkiLCJuZXh0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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S0csU0FBYixDQUFOO0FBQ0E7QUFDQSxRQUFNQywyQ0FBbUJGLE1BQU1HLFFBQXpCLENBQU47QUFDQTtBQVRvQjtBQVVwQkgsUUFBTUcsUUFBTixHQUFpQixVQUFTQyxRQUFULEVBQW1CLEdBQUdDLElBQXRCLEVBQTRCO0FBQUE7QUFBQTs7QUFDM0NILHFCQUFpQkksSUFBakIsQ0FBc0IsSUFBdEIsRUFBNEJGLFFBQTVCLEVBQXNDLEdBQUdDLElBQXpDO0FBRDJDO0FBRTNDLFFBQUlELFNBQVNHLGNBQVQsQ0FBd0IsU0FBeEIsQ0FBSixFQUF3QztBQUFBO0FBQUE7O0FBQ3RDVix1QkFBaUJXLElBQWpCLENBQXNCO0FBQ3BCM0Qsa0JBQVUsS0FBS0YsV0FBTCxFQURVO0FBRXBCaUMsaUJBQVN3QixTQUFTeEI7QUFGRSxPQUF0QjtBQUlELEtBTEQ7QUFBQTtBQUFBO0FBTUQsR0FSRDtBQVNEIiwiZmlsZSI6Im9ic2VydmVQYW5lSXRlbVZpc2liaWxpdHkuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNy1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBCU0Qtc3R5bGUgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4gQW4gYWRkaXRpb25hbCBncmFudFxuICogb2YgcGF0ZW50IHJpZ2h0cyBjYW4gYmUgZm91bmQgaW4gdGhlIFBBVEVOVFMgZmlsZSBpbiB0aGUgc2FtZSBkaXJlY3RvcnkuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQge29ic2VydmFibGVGcm9tU3Vic2NyaWJlRnVuY3Rpb259IGZyb20gJ251Y2xpZGUtY29tbW9ucy9ldmVudCc7XG5pbXBvcnQgbWVtb2l6ZVVudGlsQ2hhbmdlZCBmcm9tICdudWNsaWRlLWNvbW1vbnMvbWVtb2l6ZVVudGlsQ2hhbmdlZCc7XG5pbXBvcnQge3NldEZpbHRlcn0gZnJvbSAnbnVjbGlkZS1jb21tb25zL2NvbGxlY3Rpb24nO1xuaW1wb3J0IHtPYnNlcnZhYmxlLCBTY2hlZHVsZXIsIFN1YmplY3R9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHNoYWxsb3dFcXVhbCBmcm9tICdzaGFsbG93ZXF1YWwnO1xuXG4vLyBUT0RPKFQxNzQ5NTYwOCk6IEN1cnJlbnRseSwgZG9ja3MgZG9uJ3QgaGF2ZSBhIHdheSBvZiBvYnNlcnZpbmcgdGhlaXIgdmlzaWJpbGl0eSBzbyB0aGlzIHdpbGxcbi8vICAgaGF2ZSBzb21lIGZhbHNlIHBvc2l0aXZlcyB3aGVuIGFuIGl0ZW0gaXMgaXRzIHBhbmUncyBhY3RpdmUgaXRlbSBidXQgaXRzIGRvY2sgaXMgaGlkZGVuLlxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gb2JzZXJ2ZVBhbmVJdGVtVmlzaWJpbGl0eShcbiAgaXRlbTogT2JqZWN0LFxuKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gIHBhdGNoRG9ja3MoKTtcblxuICBjb25zdCB3b3Jrc3BhY2VFbCA9IGF0b20ud29ya3NwYWNlLmdldEVsZW1lbnQoKTtcbiAgcmV0dXJuIE9ic2VydmFibGUuY29tYmluZUxhdGVzdChcbiAgICAvLyBhdG9tLndvcmtzcGFjZS5yZXNldCgpIChpbiB0ZXN0cykgcmVzZXRzIGFsbCB0aGUgcGFuZXMuXG4gICAgLy8gUGFzcyBpbiB0aGUgd29ya3NwYWNlIGRvbSBlbGVtZW50IHRvIGFjdCBhcyBhIGNhY2hlLWJyZWFrZXIuXG4gICAgb2JzZXJ2ZUFjdGl2ZUl0ZW1zKHdvcmtzcGFjZUVsKSxcbiAgICBvYnNlcnZlUGFuZUNvbnRhaW5lclZpc2liaWxpdGllcyh3b3Jrc3BhY2VFbCksXG4gIClcbiAgICAubWFwKChbYWN0aXZlSXRlbXMsIGxvY2F0aW9uVmlzaWJpbGl0aWVzXSkgPT4ge1xuICAgICAgLy8gSWYgaXQncyBub3QgYWN0aXZlLCBpdCdzIG5vdCB2aXNpYmxlLlxuICAgICAgaWYgKCFhY3RpdmVJdGVtcy5oYXMoaXRlbSkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgLy8gSWYgaXQncyBhY3RpdmUsIGl0J3Mgb25seSB2aXNpYmxlIGlmIGl0cyBjb250YWluZXIgaXMuXG4gICAgICBjb25zdCBwYW5lQ29udGFpbmVyID0gYXRvbS53b3Jrc3BhY2UucGFuZUNvbnRhaW5lckZvckl0ZW0oaXRlbSk7XG4gICAgICByZXR1cm4gcGFuZUNvbnRhaW5lciA9PSBudWxsXG4gICAgICAgID8gZmFsc2VcbiAgICAgICAgOiBsb2NhdGlvblZpc2liaWxpdGllc1twYW5lQ29udGFpbmVyLmdldExvY2F0aW9uKCldO1xuICAgIH0pXG4gICAgLmRpc3RpbmN0VW50aWxDaGFuZ2VkKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBvYnNlcnZlVmlzaWJsZUl0ZW1zKCkge1xuICBwYXRjaERvY2tzKCk7XG5cbiAgY29uc3Qgd29ya3NwYWNlRWwgPSBhdG9tLndvcmtzcGFjZS5nZXRFbGVtZW50KCk7XG4gIHJldHVybiBPYnNlcnZhYmxlLmNvbWJpbmVMYXRlc3QoXG4gICAgb2JzZXJ2ZUFjdGl2ZUl0ZW1zKHdvcmtzcGFjZUVsKSxcbiAgICBvYnNlcnZlUGFuZUNvbnRhaW5lclZpc2liaWxpdGllcyh3b3Jrc3BhY2VFbCksXG4gICkubWFwKChbYWN0aXZlSXRlbXMsIGxvY2F0aW9uVmlzaWJpbGl0aWVzXSkgPT4ge1xuICAgIC8vIElmIGl0J3Mgbm90IGFjdGl2ZSwgaXQncyBub3QgdmlzaWJsZS5cbiAgICAvLyBJZiBpdCdzIGFjdGl2ZSwgaXQncyBvbmx5IHZpc2libGUgaWYgaXRzIGNvbnRhaW5lciBpcy5cbiAgICByZXR1cm4gc2V0RmlsdGVyKGFjdGl2ZUl0ZW1zLCBpdGVtID0+IHtcbiAgICAgIGNvbnN0IHBhbmVDb250YWluZXIgPSBhdG9tLndvcmtzcGFjZS5wYW5lQ29udGFpbmVyRm9ySXRlbShpdGVtKTtcbiAgICAgIGNvbnN0IGxvY2F0aW9uID0gcGFuZUNvbnRhaW5lciAmJiBwYW5lQ29udGFpbmVyLmdldExvY2F0aW9uKCk7XG4gICAgICByZXR1cm4gbG9jYXRpb24gPyBCb29sZWFuKGxvY2F0aW9uVmlzaWJpbGl0aWVzW2xvY2F0aW9uXSkgOiBmYWxzZTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmNvbnN0IG9ic2VydmVBY3RpdmVJdGVtcyA9IG1lbW9pemVVbnRpbENoYW5nZWQoX2NhY2hlS2V5ID0+IHtcbiAgLy8gQW4gb2JzZXJ2YWJsZSB0aGF0IGVtaXRzIGB7cGFuZSwgaXRlbX1gIHdoZW5ldmVyIHRoZSBhY3RpdmUgaXRlbSBvZiBhIHBhbmUgY2hhbmdlcy5cbiAgY29uc3QgaXRlbUFjdGl2YXRpb25zID0gT2JzZXJ2YWJsZS5tZXJnZShcbiAgICAuLi5hdG9tLndvcmtzcGFjZS5nZXRQYW5lQ29udGFpbmVycygpLm1hcChwYW5lQ29udGFpbmVyID0+IHtcbiAgICAgIGNvbnN0IG9ic2VydmVQYW5lcyA9IHBhbmVDb250YWluZXIub2JzZXJ2ZVBhbmVzLmJpbmQocGFuZUNvbnRhaW5lcik7XG4gICAgICByZXR1cm4gb2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbihvYnNlcnZlUGFuZXMpLmZsYXRNYXAocGFuZSA9PiB7XG4gICAgICAgIGNvbnN0IHBhbmVEZXN0cm95ZWQgPSBvYnNlcnZhYmxlRnJvbVN1YnNjcmliZUZ1bmN0aW9uKFxuICAgICAgICAgIHBhbmUub25EaWREZXN0cm95LmJpbmQocGFuZSksXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IGFjdGl2ZUl0ZW1zID0gb2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbihcbiAgICAgICAgICBwYW5lLm9ic2VydmVBY3RpdmVJdGVtLmJpbmQocGFuZSksXG4gICAgICAgICkudGFrZVVudGlsKHBhbmVEZXN0cm95ZWQpO1xuICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5jb25jYXQoXG4gICAgICAgICAgYWN0aXZlSXRlbXMubWFwKGl0ZW0gPT4gKHtwYW5lLCBpdGVtfSkpLFxuICAgICAgICAgIE9ic2VydmFibGUub2Yoe3BhbmUsIGl0ZW06IG51bGx9KSxcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pLFxuICApO1xuXG4gIC8vIENyZWF0ZSBhIG1hcCBvZiBwYW5lcyB0byB0aGVpciBhY3RpdmUgaXRlbXMuIFdlIGNvdWxkIGxvb2sgdGhpcyB1cCBieSBleGFtaW5pbmcgdGhlIHdvcmtzcGFjZVxuICAvLyBldmVyeSB0aW1lOyB0aGlzIGlzIGFuIG9wdGltaXphdGlvbi5cbiAgY29uc3QgcGFuZXNUb0FjdGl2ZUl0ZW0gPSBpdGVtQWN0aXZhdGlvbnMuc2NhbigoYWNjLCB7cGFuZSwgaXRlbX0pID0+IHtcbiAgICBpZiAoaXRlbSA9PSBudWxsKSB7XG4gICAgICBhY2MuZGVsZXRlKHBhbmUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhY2Muc2V0KHBhbmUsIGl0ZW0pO1xuICAgIH1cbiAgICByZXR1cm4gYWNjO1xuICB9LCBuZXcgTWFwKCkpO1xuXG4gIHJldHVybiAoXG4gICAgcGFuZXNUb0FjdGl2ZUl0ZW1cbiAgICAgIC8vIFdoZW4gZHJhZ2dpbmcgaXRlbXMgYmV0d2VlbiBwYW5lcywgdGhleSdsbCBiZSBxdWlja2x5IGRlYWN0aXZhdGVkIGFuZCBhY3RpdmF0ZWQgYWdhaW4uIFRvXG4gICAgICAvLyBhdm9pZCBkb2luZyBleHRyYSB3b3JrLCB3ZSBkZWJvdW5jZSBhbmQgdXNlIHRoZSByQUYgc2NoZWR1bGVyLlxuICAgICAgLmRlYm91bmNlVGltZSgwLCBTY2hlZHVsZXIuYW5pbWF0aW9uRnJhbWUpXG4gICAgICAubWFwKG1hcCA9PiBuZXcgU2V0KG1hcC52YWx1ZXMoKSkpXG4gICAgICAuc2hhcmUoKVxuICApO1xufSk7XG5cbi8vIENyZWF0ZSBhbiBvYnNlcnZhYmxlIHRoYXQgY29udGFpbnMgdGhlIGN1cnJlbnQgdmlzaWJpbGl0eSBzdGF0ZSBvZiBlYWNoIGRvY2ssIGJ1dCB3aGVyZSB0aGVcbi8vIFwiZmFsc2VcIiB2YWx1ZXMgYXJlIGRlbGF5ZWQgdG8gYWNjb3VudCBmb3IgdGhlIHRpbWUgaXQgdGFrZXMgdG8gYW5pbWF0ZSB0aGUgZG9jayBjbG9zZWQuXG5jb25zdCBvYnNlcnZlUGFuZUNvbnRhaW5lclZpc2liaWxpdGllcyA9IG1lbW9pemVVbnRpbENoYW5nZWQoX2NhY2hlS2V5ID0+IHtcbiAgY29uc3QgdmlzaWJpbGl0aWVzQnlEb2NrID0gWydsZWZ0JywgJ3JpZ2h0JywgJ2JvdHRvbSddLm1hcChsb2MgPT5cbiAgICBkb2NrU3RhdGVDaGFuZ2VzXG4gICAgICAuZmlsdGVyKCh7bG9jYXRpb259KSA9PiBsb2NhdGlvbiA9PT0gbG9jKVxuICAgICAgLnN3aXRjaE1hcChcbiAgICAgICAgKHtsb2NhdGlvbiwgdmlzaWJsZX0pID0+XG4gICAgICAgICAgLy8gRGVsYXkgdGhlIFwiZmFsc2VcIiB2YWx1ZXMgc28gdGhleSBkb24ndCBvY2N1ciB3aGlsZSB0aGUgZG9jayBpcyBiZWluZyBhbmltYXRlZCBjbG9zZWQuXG4gICAgICAgICAgdmlzaWJsZVxuICAgICAgICAgICAgPyBPYnNlcnZhYmxlLm9mKHtsb2NhdGlvbiwgdmlzaWJsZX0pXG4gICAgICAgICAgICA6IE9ic2VydmFibGUub2Yoe2xvY2F0aW9uLCB2aXNpYmxlfSkuZGVsYXkoMzAwKSxcbiAgICAgIClcbiAgICAgIC5kaXN0aW5jdFVudGlsS2V5Q2hhbmdlZCgndmlzaWJsZScpLFxuICApO1xuXG4gIGNvbnN0IGluaXRpYWxWaXNpYmlsaXRpZXMgPSB7XG4gICAgLy8gVGhlIGNlbnRlciBpcyBhbHdheXMgdmlzaWJsZS5cbiAgICBjZW50ZXI6IHRydWUsXG4gICAgbGVmdDogYXRvbS53b3Jrc3BhY2UuZ2V0TGVmdERvY2soKS5pc1Zpc2libGUoKSxcbiAgICByaWdodDogYXRvbS53b3Jrc3BhY2UuZ2V0UmlnaHREb2NrKCkuaXNWaXNpYmxlKCksXG4gICAgYm90dG9tOiBhdG9tLndvcmtzcGFjZS5nZXRCb3R0b21Eb2NrKCkuaXNWaXNpYmxlKCksXG4gIH07XG5cbiAgLy8gQWNjdW11bGF0ZSB0aGUgZG9jayB2aXNpYmlsaXRpZXMuXG4gIGNvbnN0IHZpc2liaWxpdHlTdGF0ZXMgPSBPYnNlcnZhYmxlLm1lcmdlKC4uLnZpc2liaWxpdGllc0J5RG9jaylcbiAgICAuc2NhbihcbiAgICAgIChhY2MsIHtsb2NhdGlvbiwgdmlzaWJsZX0pID0+ICh7XG4gICAgICAgIC4uLmFjYyxcbiAgICAgICAgW2xvY2F0aW9uXTogdmlzaWJsZSxcbiAgICAgIH0pLFxuICAgICAgaW5pdGlhbFZpc2liaWxpdGllcyxcbiAgICApXG4gICAgLnN0YXJ0V2l0aChpbml0aWFsVmlzaWJpbGl0aWVzKVxuICAgIC5kaXN0aW5jdFVudGlsQ2hhbmdlZChzaGFsbG93RXF1YWwpXG4gICAgLnB1Ymxpc2hSZXBsYXkoMSk7XG4gIHZpc2liaWxpdHlTdGF0ZXMuY29ubmVjdCgpO1xuXG4gIHJldHVybiB2aXNpYmlsaXR5U3RhdGVzO1xufSk7XG5cbi8vIEhBQ0s6IE1vbmtleS1wYXRjaCBEb2NrcyBpbiBvcmRlciB0byBvYnNlcnZlIHZpc2liaWxpdHkgdG9nZ2xpbmcuXG4vLyBUT0RPOiBVc2UgYERvY2s6Om9ic2VydmVWaXNpYmlsaXR5YCBvbmNlIGF0b20vYXRvbSMxNDczNiBpcyBpbiBvdXIgbG93ZXN0LXN1cHBvcnRlZCB2ZXJzaW9uXG5sZXQgZG9ja3NQYXRjaGVkID0gZmFsc2U7XG5jb25zdCBkb2NrU3RhdGVDaGFuZ2VzID0gbmV3IFN1YmplY3QoKTtcbmZ1bmN0aW9uIHBhdGNoRG9ja3MoKSB7XG4gIGlmIChkb2Nrc1BhdGNoZWQgfHwgdHlwZW9mIGF0b20ud29ya3NwYWNlLmdldExlZnREb2NrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGRvY2tzUGF0Y2hlZCA9IHRydWU7XG4gIGNvbnN0IGN0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRMZWZ0RG9jaygpLmNvbnN0cnVjdG9yO1xuICBjb25zdCBwcm90byA9IGN0b3IucHJvdG90eXBlO1xuICAvLyAkRmxvd0lnbm9yZVxuICBjb25zdCBvcmlnaW5hbFNldFN0YXRlID0gcHJvdG8uc2V0U3RhdGU7XG4gIC8vICRGbG93SWdub3JlXG4gIHByb3RvLnNldFN0YXRlID0gZnVuY3Rpb24obmV3U3RhdGUsIC4uLmFyZ3MpIHtcbiAgICBvcmlnaW5hbFNldFN0YXRlLmNhbGwodGhpcywgbmV3U3RhdGUsIC4uLmFyZ3MpO1xuICAgIGlmIChuZXdTdGF0ZS5oYXNPd25Qcm9wZXJ0eSgndmlzaWJsZScpKSB7XG4gICAgICBkb2NrU3RhdGVDaGFuZ2VzLm5leHQoe1xuICAgICAgICBsb2NhdGlvbjogdGhpcy5nZXRMb2NhdGlvbigpLFxuICAgICAgICB2aXNpYmxlOiBuZXdTdGF0ZS52aXNpYmxlLFxuICAgICAgfSk7XG4gICAgfVxuICB9O1xufVxuIl19