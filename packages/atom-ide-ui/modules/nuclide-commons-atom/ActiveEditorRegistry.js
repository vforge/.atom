'use strict';

var cov_2642yv2rbq = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/nuclide-commons-atom/ActiveEditorRegistry.js',
      hash = '00e15805872651b439ec870f1c7f9c2bc5b2c782',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/nuclide-commons-atom/ActiveEditorRegistry.js',
    statementMap: {
      '0': {
        start: {
          line: 105,
          column: 39
        },
        end: {
          line: 107,
          column: 1
        }
      },
      '1': {
        start: {
          line: 110,
          column: 2
        },
        end: {
          line: 113,
          column: 4
        }
      },
      '2': {
        start: {
          line: 128,
          column: 4
        },
        end: {
          line: 128,
          column: 45
        }
      },
      '3': {
        start: {
          line: 129,
          column: 4
        },
        end: {
          line: 129,
          column: 42
        }
      },
      '4': {
        start: {
          line: 130,
          column: 4
        },
        end: {
          line: 130,
          column: 52
        }
      },
      '5': {
        start: {
          line: 131,
          column: 4
        },
        end: {
          line: 131,
          column: 44
        }
      },
      '6': {
        start: {
          line: 132,
          column: 4
        },
        end: {
          line: 145,
          column: 7
        }
      },
      '7': {
        start: {
          line: 137,
          column: 19
        },
        end: {
          line: 137,
          column: 49
        }
      },
      '8': {
        start: {
          line: 141,
          column: 10
        },
        end: {
          line: 143,
          column: 29
        }
      },
      '9': {
        start: {
          line: 142,
          column: 12
        },
        end: {
          line: 142,
          column: 38
        }
      },
      '10': {
        start: {
          line: 149,
          column: 4
        },
        end: {
          line: 149,
          column: 49
        }
      },
      '11': {
        start: {
          line: 150,
          column: 4
        },
        end: {
          line: 150,
          column: 35
        }
      },
      '12': {
        start: {
          line: 151,
          column: 4
        },
        end: {
          line: 153,
          column: 7
        }
      },
      '13': {
        start: {
          line: 152,
          column: 6
        },
        end: {
          line: 152,
          column: 54
        }
      },
      '14': {
        start: {
          line: 157,
          column: 4
        },
        end: {
          line: 157,
          column: 31
        }
      },
      '15': {
        start: {
          line: 161,
          column: 28
        },
        end: {
          line: 169,
          column: 6
        }
      },
      '16': {
        start: {
          line: 162,
          column: 6
        },
        end: {
          line: 164,
          column: 7
        }
      },
      '17': {
        start: {
          line: 163,
          column: 8
        },
        end: {
          line: 163,
          column: 37
        }
      },
      '18': {
        start: {
          line: 165,
          column: 6
        },
        end: {
          line: 168,
          column: 8
        }
      },
      '19': {
        start: {
          line: 170,
          column: 20
        },
        end: {
          line: 189,
          column: 6
        }
      },
      '20': {
        start: {
          line: 172,
          column: 21
        },
        end: {
          line: 172,
          column: 30
        }
      },
      '21': {
        start: {
          line: 173,
          column: 6
        },
        end: {
          line: 175,
          column: 7
        }
      },
      '22': {
        start: {
          line: 174,
          column: 8
        },
        end: {
          line: 174,
          column: 56
        }
      },
      '23': {
        start: {
          line: 177,
          column: 6
        },
        end: {
          line: 188,
          column: 8
        }
      },
      '24': {
        start: {
          line: 190,
          column: 4
        },
        end: {
          line: 190,
          column: 41
        }
      },
      '25': {
        start: {
          line: 199,
          column: 4
        },
        end: {
          line: 219,
          column: 7
        }
      },
      '26': {
        start: {
          line: 200,
          column: 54
        },
        end: {
          line: 200,
          column: 60
        }
      },
      '27': {
        start: {
          line: 201,
          column: 52
        },
        end: {
          line: 201,
          column: 58
        }
      },
      '28': {
        start: {
          line: 203,
          column: 23
        },
        end: {
          line: 203,
          column: 57
        }
      },
      '29': {
        start: {
          line: 204,
          column: 6
        },
        end: {
          line: 213,
          column: 7
        }
      },
      '30': {
        start: {
          line: 205,
          column: 27
        },
        end: {
          line: 205,
          column: 48
        }
      },
      '31': {
        start: {
          line: 207,
          column: 8
        },
        end: {
          line: 209,
          column: 9
        }
      },
      '32': {
        start: {
          line: 208,
          column: 10
        },
        end: {
          line: 208,
          column: 51
        }
      },
      '33': {
        start: {
          line: 210,
          column: 8
        },
        end: {
          line: 212,
          column: 9
        }
      },
      '34': {
        start: {
          line: 211,
          column: 10
        },
        end: {
          line: 211,
          column: 36
        }
      },
      '35': {
        start: {
          line: 214,
          column: 6
        },
        end: {
          line: 218,
          column: 8
        }
      },
      '36': {
        start: {
          line: 223,
          column: 4
        },
        end: {
          line: 223,
          column: 63
        }
      },
      '37': {
        start: {
          line: 230,
          column: 4
        },
        end: {
          line: 235,
          column: 5
        }
      },
      '38': {
        start: {
          line: 231,
          column: 6
        },
        end: {
          line: 234,
          column: 8
        }
      },
      '39': {
        start: {
          line: 236,
          column: 4
        },
        end: {
          line: 252,
          column: 5
        }
      },
      '40': {
        start: {
          line: 237,
          column: 6
        },
        end: {
          line: 242,
          column: 8
        }
      },
      '41': {
        start: {
          line: 244,
          column: 6
        },
        end: {
          line: 247,
          column: 8
        }
      },
      '42': {
        start: {
          line: 248,
          column: 6
        },
        end: {
          line: 251,
          column: 8
        }
      }
    },
    fnMap: {
      '0': {
        name: 'getConcreteConfig',
        decl: {
          start: {
            line: 109,
            column: 9
          },
          end: {
            line: 109,
            column: 26
          }
        },
        loc: {
          start: {
            line: 109,
            column: 59
          },
          end: {
            line: 114,
            column: 1
          }
        },
        line: 109
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 123,
            column: 2
          },
          end: {
            line: 123,
            column: 3
          }
        },
        loc: {
          start: {
            line: 127,
            column: 4
          },
          end: {
            line: 146,
            column: 3
          }
        },
        line: 127
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 137,
            column: 9
          },
          end: {
            line: 137,
            column: 10
          }
        },
        loc: {
          start: {
            line: 137,
            column: 19
          },
          end: {
            line: 137,
            column: 49
          }
        },
        line: 137
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 140,
            column: 9
          },
          end: {
            line: 140,
            column: 10
          }
        },
        loc: {
          start: {
            line: 140,
            column: 19
          },
          end: {
            line: 144,
            column: 9
          }
        },
        line: 140
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 141,
            column: 49
          },
          end: {
            line: 141,
            column: 50
          }
        },
        loc: {
          start: {
            line: 142,
            column: 12
          },
          end: {
            line: 142,
            column: 38
          }
        },
        line: 142
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 148,
            column: 2
          },
          end: {
            line: 148,
            column: 3
          }
        },
        loc: {
          start: {
            line: 148,
            column: 44
          },
          end: {
            line: 154,
            column: 3
          }
        },
        line: 148
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 151,
            column: 26
          },
          end: {
            line: 151,
            column: 27
          }
        },
        loc: {
          start: {
            line: 151,
            column: 32
          },
          end: {
            line: 153,
            column: 5
          }
        },
        line: 151
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 156,
            column: 2
          },
          end: {
            line: 156,
            column: 3
          }
        },
        loc: {
          start: {
            line: 156,
            column: 47
          },
          end: {
            line: 158,
            column: 3
          }
        },
        line: 156
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 160,
            column: 2
          },
          end: {
            line: 160,
            column: 3
          }
        },
        loc: {
          start: {
            line: 160,
            column: 77
          },
          end: {
            line: 191,
            column: 3
          }
        },
        line: 160
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 161,
            column: 65
          },
          end: {
            line: 161,
            column: 66
          }
        },
        loc: {
          start: {
            line: 161,
            column: 75
          },
          end: {
            line: 169,
            column: 5
          }
        },
        line: 161
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 170,
            column: 46
          },
          end: {
            line: 170,
            column: 47
          }
        },
        loc: {
          start: {
            line: 170,
            column: 59
          },
          end: {
            line: 189,
            column: 5
          }
        },
        line: 170
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 193,
            column: 2
          },
          end: {
            line: 193,
            column: 3
          }
        },
        loc: {
          start: {
            line: 196,
            column: 30
          },
          end: {
            line: 220,
            column: 3
          }
        },
        line: 196
      },
      '12': {
        name: '(anonymous_12)',
        decl: {
          start: {
            line: 200,
            column: 48
          },
          end: {
            line: 200,
            column: 49
          }
        },
        loc: {
          start: {
            line: 200,
            column: 54
          },
          end: {
            line: 200,
            column: 60
          }
        },
        line: 200
      },
      '13': {
        name: '(anonymous_13)',
        decl: {
          start: {
            line: 201,
            column: 46
          },
          end: {
            line: 201,
            column: 47
          }
        },
        loc: {
          start: {
            line: 201,
            column: 52
          },
          end: {
            line: 201,
            column: 58
          }
        },
        line: 201
      },
      '14': {
        name: '(anonymous_14)',
        decl: {
          start: {
            line: 202,
            column: 14
          },
          end: {
            line: 202,
            column: 15
          }
        },
        loc: {
          start: {
            line: 202,
            column: 23
          },
          end: {
            line: 219,
            column: 5
          }
        },
        line: 202
      },
      '15': {
        name: '(anonymous_15)',
        decl: {
          start: {
            line: 222,
            column: 2
          },
          end: {
            line: 222,
            column: 3
          }
        },
        loc: {
          start: {
            line: 222,
            column: 53
          },
          end: {
            line: 224,
            column: 3
          }
        },
        line: 222
      },
      '16': {
        name: '(anonymous_16)',
        decl: {
          start: {
            line: 226,
            column: 2
          },
          end: {
            line: 226,
            column: 3
          }
        },
        loc: {
          start: {
            line: 229,
            column: 27
          },
          end: {
            line: 253,
            column: 3
          }
        },
        line: 229
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 125,
            column: 4
          },
          end: {
            line: 125,
            column: 23
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 125,
            column: 21
          },
          end: {
            line: 125,
            column: 23
          }
        }],
        line: 125
      },
      '1': {
        loc: {
          start: {
            line: 126,
            column: 4
          },
          end: {
            line: 126,
            column: 42
          }
        },
        type: 'default-arg',
        locations: [{
          start: {
            line: 126,
            column: 40
          },
          end: {
            line: 126,
            column: 42
          }
        }],
        line: 126
      },
      '2': {
        loc: {
          start: {
            line: 134,
            column: 8
          },
          end: {
            line: 134,
            column: 69
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 134,
            column: 8
          },
          end: {
            line: 134,
            column: 34
          }
        }, {
          start: {
            line: 134,
            column: 38
          },
          end: {
            line: 134,
            column: 69
          }
        }],
        line: 134
      },
      '3': {
        loc: {
          start: {
            line: 136,
            column: 8
          },
          end: {
            line: 137,
            column: 50
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 136,
            column: 8
          },
          end: {
            line: 136,
            column: 37
          }
        }, {
          start: {
            line: 137,
            column: 9
          },
          end: {
            line: 137,
            column: 49
          }
        }],
        line: 136
      },
      '4': {
        loc: {
          start: {
            line: 139,
            column: 8
          },
          end: {
            line: 144,
            column: 10
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 139,
            column: 8
          },
          end: {
            line: 139,
            column: 35
          }
        }, {
          start: {
            line: 140,
            column: 9
          },
          end: {
            line: 144,
            column: 9
          }
        }],
        line: 139
      },
      '5': {
        loc: {
          start: {
            line: 162,
            column: 6
          },
          end: {
            line: 164,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 162,
            column: 6
          },
          end: {
            line: 164,
            column: 7
          }
        }, {
          start: {
            line: 162,
            column: 6
          },
          end: {
            line: 164,
            column: 7
          }
        }],
        line: 162
      },
      '6': {
        loc: {
          start: {
            line: 173,
            column: 6
          },
          end: {
            line: 175,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 173,
            column: 6
          },
          end: {
            line: 175,
            column: 7
          }
        }, {
          start: {
            line: 173,
            column: 6
          },
          end: {
            line: 175,
            column: 7
          }
        }],
        line: 173
      },
      '7': {
        loc: {
          start: {
            line: 204,
            column: 6
          },
          end: {
            line: 213,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 204,
            column: 6
          },
          end: {
            line: 213,
            column: 7
          }
        }, {
          start: {
            line: 204,
            column: 6
          },
          end: {
            line: 213,
            column: 7
          }
        }],
        line: 204
      },
      '8': {
        loc: {
          start: {
            line: 207,
            column: 8
          },
          end: {
            line: 209,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 207,
            column: 8
          },
          end: {
            line: 209,
            column: 9
          }
        }, {
          start: {
            line: 207,
            column: 8
          },
          end: {
            line: 209,
            column: 9
          }
        }],
        line: 207
      },
      '9': {
        loc: {
          start: {
            line: 210,
            column: 8
          },
          end: {
            line: 212,
            column: 9
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 210,
            column: 8
          },
          end: {
            line: 212,
            column: 9
          }
        }, {
          start: {
            line: 210,
            column: 8
          },
          end: {
            line: 212,
            column: 9
          }
        }],
        line: 210
      },
      '10': {
        loc: {
          start: {
            line: 230,
            column: 4
          },
          end: {
            line: 235,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 230,
            column: 4
          },
          end: {
            line: 235,
            column: 5
          }
        }, {
          start: {
            line: 230,
            column: 4
          },
          end: {
            line: 235,
            column: 5
          }
        }],
        line: 230
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0
    },
    b: {
      '0': [0],
      '1': [0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0],
      '10': [0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _asyncToGenerator = _interopRequireDefault(require('async-to-generator'));

var _atom = require('atom');

var _rxjsBundlesRxMinJs = require('rxjs/bundles/Rx.min.js');

var _debounced;

function _load_debounced() {
  return _debounced = require('./debounced');
}

var _event;

function _load_event() {
  return _event = require('nuclide-commons/event');
}

var _observable;

function _load_observable() {
  return _observable = require('nuclide-commons/observable');
}

var _log4js;

function _load_log4js() {
  return _log4js = require('log4js');
}

var _ProviderRegistry;

function _load_ProviderRegistry() {
  return _ProviderRegistry = _interopRequireDefault(require('./ProviderRegistry'));
}

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const DEFAULT_CONFIG = (cov_2642yv2rbq.s[0]++, {
  updateOnEdit: true
}); /**
     * Copyright (c) 2017-present, Facebook, Inc.
     * All rights reserved.
     *
     * This source code is licensed under the BSD-style license found in the
     * LICENSE file in the root directory of this source tree. An additional grant
     * of patent rights can be found in the PATENTS file in the same directory.
     *
     * 
     * @format
     */

/**
 * ActiveEditorRegistry provides abstractions for creating services that operate
 * on text editor contents.
 */

function getConcreteConfig(config) {
  cov_2642yv2rbq.f[0]++;
  cov_2642yv2rbq.s[1]++;

  return Object.assign({}, DEFAULT_CONFIG, config);
}

class ActiveEditorRegistry {

  constructor(resultFunction, config = (cov_2642yv2rbq.b[0][0]++, {}), eventSources = (cov_2642yv2rbq.b[1][0]++, {})) {
    cov_2642yv2rbq.f[1]++;
    cov_2642yv2rbq.s[2]++;

    this._config = getConcreteConfig(config);
    cov_2642yv2rbq.s[3]++;
    this._resultFunction = resultFunction;
    cov_2642yv2rbq.s[4]++;
    this._providerRegistry = new (_ProviderRegistry || _load_ProviderRegistry()).default();
    cov_2642yv2rbq.s[5]++;
    this._newProviderEvents = new _rxjsBundlesRxMinJs.Subject();
    cov_2642yv2rbq.s[6]++;
    this._resultsStream = this._createResultsStream({
      activeEditors: (cov_2642yv2rbq.b[2][0]++, eventSources.activeEditors) || (cov_2642yv2rbq.b[2][1]++, (0, (_debounced || _load_debounced()).observeActiveEditorsDebounced)()),
      changesForEditor: (cov_2642yv2rbq.b[3][0]++, eventSources.changesForEditor) || (cov_2642yv2rbq.b[3][1]++, editor => {
        cov_2642yv2rbq.f[2]++;
        cov_2642yv2rbq.s[7]++;
        return (0, (_debounced || _load_debounced()).editorChangesDebounced)(editor);
      }),
      savesForEditor: (cov_2642yv2rbq.b[4][0]++, eventSources.savesForEditor) || (cov_2642yv2rbq.b[4][1]++, editor => {
        cov_2642yv2rbq.f[3]++;
        cov_2642yv2rbq.s[8]++;

        return (0, (_event || _load_event()).observableFromSubscribeFunction)(callback => {
          cov_2642yv2rbq.f[4]++;
          cov_2642yv2rbq.s[9]++;
          return editor.onDidSave(callback);
        }).mapTo(undefined);
      })
    });
  }

  consumeProvider(provider) {
    cov_2642yv2rbq.f[5]++;
    cov_2642yv2rbq.s[10]++;

    this._providerRegistry.addProvider(provider);
    cov_2642yv2rbq.s[11]++;
    this._newProviderEvents.next();
    cov_2642yv2rbq.s[12]++;
    return new _atom.Disposable(() => {
      cov_2642yv2rbq.f[6]++;
      cov_2642yv2rbq.s[13]++;

      this._providerRegistry.removeProvider(provider);
    });
  }

  getResultsStream() {
    cov_2642yv2rbq.f[7]++;
    cov_2642yv2rbq.s[14]++;

    return this._resultsStream;
  }

  _createResultsStream(eventSources) {
    cov_2642yv2rbq.f[8]++;

    const repeatedEditors = (cov_2642yv2rbq.s[15]++, eventSources.activeEditors.switchMap(editor => {
      cov_2642yv2rbq.f[9]++;
      cov_2642yv2rbq.s[16]++;

      if (editor == null) {
        cov_2642yv2rbq.b[5][0]++;
        cov_2642yv2rbq.s[17]++;

        return _rxjsBundlesRxMinJs.Observable.of(editor);
      } else {
        cov_2642yv2rbq.b[5][1]++;
      }
      cov_2642yv2rbq.s[18]++;
      return _rxjsBundlesRxMinJs.Observable.concat(_rxjsBundlesRxMinJs.Observable.of(editor), this._newProviderEvents.mapTo(editor));
    }));
    const results = (cov_2642yv2rbq.s[19]++, repeatedEditors.switchMap(editorArg => {
      cov_2642yv2rbq.f[10]++;

      // Necessary so the type refinement holds in the callback later
      const editor = (cov_2642yv2rbq.s[20]++, editorArg);
      cov_2642yv2rbq.s[21]++;
      if (editor == null) {
        cov_2642yv2rbq.b[6][0]++;
        cov_2642yv2rbq.s[22]++;

        return _rxjsBundlesRxMinJs.Observable.of({ kind: 'not-text-editor' });
      } else {
        cov_2642yv2rbq.b[6][1]++;
      }

      cov_2642yv2rbq.s[23]++;
      return _rxjsBundlesRxMinJs.Observable.concat(
      // Emit a pane change event first, so that clients can do something while waiting for a
      // provider to give a result.
      _rxjsBundlesRxMinJs.Observable.of({
        kind: 'pane-change',
        editor
      }), _rxjsBundlesRxMinJs.Observable.fromPromise(this._getResultForEditor(this._getProviderForEditor(editor), editor)), this._resultsForEditor(editor, eventSources));
    }));
    cov_2642yv2rbq.s[24]++;
    return (0, (_observable || _load_observable()).cacheWhileSubscribed)(results);
  }

  _resultsForEditor(editor, eventSources) {
    cov_2642yv2rbq.f[11]++;
    cov_2642yv2rbq.s[25]++;

    // It's possible that the active provider for an editor changes over time.
    // Thus, we have to subscribe to both edits and saves.
    return _rxjsBundlesRxMinJs.Observable.merge(eventSources.changesForEditor(editor).map(() => {
      cov_2642yv2rbq.f[12]++;
      cov_2642yv2rbq.s[26]++;
      return 'edit';
    }), eventSources.savesForEditor(editor).map(() => {
      cov_2642yv2rbq.f[13]++;
      cov_2642yv2rbq.s[27]++;
      return 'save';
    })).flatMap(event => {
      cov_2642yv2rbq.f[14]++;

      const provider = (cov_2642yv2rbq.s[28]++, this._getProviderForEditor(editor));
      cov_2642yv2rbq.s[29]++;
      if (provider != null) {
        cov_2642yv2rbq.b[7][0]++;

        let updateOnEdit = (cov_2642yv2rbq.s[30]++, provider.updateOnEdit);
        // Fall back to the config's updateOnEdit if not provided.
        cov_2642yv2rbq.s[31]++;
        if (updateOnEdit == null) {
          cov_2642yv2rbq.b[8][0]++;
          cov_2642yv2rbq.s[32]++;

          updateOnEdit = this._config.updateOnEdit;
        } else {
          cov_2642yv2rbq.b[8][1]++;
        }
        cov_2642yv2rbq.s[33]++;
        if (updateOnEdit !== (event === 'edit')) {
          cov_2642yv2rbq.b[9][0]++;
          cov_2642yv2rbq.s[34]++;

          return _rxjsBundlesRxMinJs.Observable.empty();
        } else {
          cov_2642yv2rbq.b[9][1]++;
        }
      } else {
        cov_2642yv2rbq.b[7][1]++;
      }
      cov_2642yv2rbq.s[35]++;
      return _rxjsBundlesRxMinJs.Observable.concat(
      // $FlowIssue: {kind: edit | save} <=> {kind: edit} | {kind: save}
      _rxjsBundlesRxMinJs.Observable.of({ kind: event, editor }), _rxjsBundlesRxMinJs.Observable.fromPromise(this._getResultForEditor(provider, editor)));
    });
  }

  _getProviderForEditor(editor) {
    cov_2642yv2rbq.f[15]++;
    cov_2642yv2rbq.s[36]++;

    return this._providerRegistry.getProviderForEditor(editor);
  }

  _getResultForEditor(provider, editor) {
    var _this = this;

    return (0, _asyncToGenerator.default)(function* () {
      cov_2642yv2rbq.f[16]++;
      cov_2642yv2rbq.s[37]++;

      if (provider == null) {
        cov_2642yv2rbq.b[10][0]++;
        cov_2642yv2rbq.s[38]++;

        return {
          kind: 'no-provider',
          grammar: editor.getGrammar()
        };
      } else {
        cov_2642yv2rbq.b[10][1]++;
      }
      cov_2642yv2rbq.s[39]++;
      try {
        cov_2642yv2rbq.s[40]++;

        return {
          kind: 'result',
          result: yield _this._resultFunction(provider, editor),
          provider,
          editor
        };
      } catch (e) {
        cov_2642yv2rbq.s[41]++;

        (0, (_log4js || _load_log4js()).getLogger)(_this.constructor.name).error(`Error from provider for ${editor.getGrammar().scopeName}`, e);
        cov_2642yv2rbq.s[42]++;
        return {
          provider,
          kind: 'provider-error'
        };
      }
    })();
  }
}
exports.default = ActiveEditorRegistry;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFjdGl2ZUVkaXRvclJlZ2lzdHJ5LmpzIl0sIm5hbWVzIjpbIkRFRkFVTFRfQ09ORklHIiwidXBkYXRlT25FZGl0IiwiZ2V0Q29uY3JldGVDb25maWciLCJjb25maWciLCJBY3RpdmVFZGl0b3JSZWdpc3RyeSIsImNvbnN0cnVjdG9yIiwicmVzdWx0RnVuY3Rpb24iLCJldmVudFNvdXJjZXMiLCJfY29uZmlnIiwiX3Jlc3VsdEZ1bmN0aW9uIiwiX3Byb3ZpZGVyUmVnaXN0cnkiLCJfbmV3UHJvdmlkZXJFdmVudHMiLCJfcmVzdWx0c1N0cmVhbSIsIl9jcmVhdGVSZXN1bHRzU3RyZWFtIiwiYWN0aXZlRWRpdG9ycyIsImNoYW5nZXNGb3JFZGl0b3IiLCJlZGl0b3IiLCJzYXZlc0ZvckVkaXRvciIsImNhbGxiYWNrIiwib25EaWRTYXZlIiwibWFwVG8iLCJ1bmRlZmluZWQiLCJjb25zdW1lUHJvdmlkZXIiLCJwcm92aWRlciIsImFkZFByb3ZpZGVyIiwibmV4dCIsInJlbW92ZVByb3ZpZGVyIiwiZ2V0UmVzdWx0c1N0cmVhbSIsInJlcGVhdGVkRWRpdG9ycyIsInN3aXRjaE1hcCIsIm9mIiwiY29uY2F0IiwicmVzdWx0cyIsImVkaXRvckFyZyIsImtpbmQiLCJmcm9tUHJvbWlzZSIsIl9nZXRSZXN1bHRGb3JFZGl0b3IiLCJfZ2V0UHJvdmlkZXJGb3JFZGl0b3IiLCJfcmVzdWx0c0ZvckVkaXRvciIsIm1lcmdlIiwibWFwIiwiZmxhdE1hcCIsImV2ZW50IiwiZW1wdHkiLCJnZXRQcm92aWRlckZvckVkaXRvciIsImdyYW1tYXIiLCJnZXRHcmFtbWFyIiwicmVzdWx0IiwiZSIsIm5hbWUiLCJlcnJvciIsInNjb3BlTmFtZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QTs7QUFDVixtREFBVSxNQUFLM0MsV0FBTCxDQUFpQjRDLElBQTNCLEVBQWlDQyxLQUFqQyxDQUNHLDJCQUEwQmxDLE9BQU84QixVQUFQLEdBQW9CSyxTQUFVLEVBRDNELEVBRUVILENBRkY7QUFEVTtBQUtWLGVBQU87QUFDTHpCLGtCQURLO0FBRUxXLGdCQUFNO0FBRkQsU0FBUDtBQUlEO0FBdkJzQjtBQXdCeEI7QUF6SXVEO2tCQUFyQzlCLG9CIiwiZmlsZSI6IkFjdGl2ZUVkaXRvclJlZ2lzdHJ5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTctcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cblxuLyoqXG4gKiBBY3RpdmVFZGl0b3JSZWdpc3RyeSBwcm92aWRlcyBhYnN0cmFjdGlvbnMgZm9yIGNyZWF0aW5nIHNlcnZpY2VzIHRoYXQgb3BlcmF0ZVxuICogb24gdGV4dCBlZGl0b3IgY29udGVudHMuXG4gKi9cblxuaW1wb3J0IHtEaXNwb3NhYmxlfSBmcm9tICdhdG9tJztcbmltcG9ydCB7T2JzZXJ2YWJsZSwgU3ViamVjdH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7XG4gIG9ic2VydmVBY3RpdmVFZGl0b3JzRGVib3VuY2VkLFxuICBlZGl0b3JDaGFuZ2VzRGVib3VuY2VkLFxufSBmcm9tICcuL2RlYm91bmNlZCc7XG5cbmltcG9ydCB7b2JzZXJ2YWJsZUZyb21TdWJzY3JpYmVGdW5jdGlvbn0gZnJvbSAnbnVjbGlkZS1jb21tb25zL2V2ZW50JztcbmltcG9ydCB7Y2FjaGVXaGlsZVN1YnNjcmliZWR9IGZyb20gJ251Y2xpZGUtY29tbW9ucy9vYnNlcnZhYmxlJztcblxuaW1wb3J0IHtnZXRMb2dnZXJ9IGZyb20gJ2xvZzRqcyc7XG5cbmltcG9ydCBQcm92aWRlclJlZ2lzdHJ5IGZyb20gJy4vUHJvdmlkZXJSZWdpc3RyeSc7XG5cbmV4cG9ydCB0eXBlIFByb3ZpZGVyID0ge1xuICBwcmlvcml0eTogbnVtYmVyLFxuICBncmFtbWFyU2NvcGVzOiBBcnJheTxzdHJpbmc+LFxuICAvLyBUaGlzIG92ZXJyaWRlcyB0aGUgdXBkYXRlT25FZGl0IHNldHRpbmcgaW4gQWN0aXZlRWRpdG9yUmVnaXN0cnkncyBjb25maWcuXG4gIHVwZGF0ZU9uRWRpdD86IGJvb2xlYW4sXG59O1xuXG5leHBvcnQgdHlwZSBSZXN1bHQ8VCwgVj4gPVxuICB8IHtcbiAgICAgIGtpbmQ6ICdub3QtdGV4dC1lZGl0b3InLFxuICAgIH1cbiAgfCB7XG4gICAgICBraW5kOiAnbm8tcHJvdmlkZXInLFxuICAgICAgZ3JhbW1hcjogYXRvbSRHcmFtbWFyLFxuICAgIH1cbiAgfCB7XG4gICAgICBraW5kOiAncHJvdmlkZXItZXJyb3InLFxuICAgICAgcHJvdmlkZXI6IFQsXG4gICAgfVxuICB8IHtcbiAgICAgIC8vIFNpbmNlIHByb3ZpZGVycyBjYW4gYmUgc2xvdywgdGhlIHBhbmUtY2hhbmdlIGFuZCBlZGl0IGV2ZW50cyBhcmUgZW1pdHRlZCBpbW1lZGlhdGVseSBpbiBjYXNlXG4gICAgICAvLyB0aGUgVUkgbmVlZHMgdG8gY2xlYXIgb3V0ZGF0ZWQgcmVzdWx0cy5cbiAgICAgIGtpbmQ6ICdwYW5lLWNoYW5nZScsXG4gICAgICBlZGl0b3I6IGF0b20kVGV4dEVkaXRvcixcbiAgICB9XG4gIHwge1xuICAgICAga2luZDogJ2VkaXQnLFxuICAgICAgZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IsXG4gICAgfVxuICB8IHtcbiAgICAgIGtpbmQ6ICdzYXZlJyxcbiAgICAgIGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLFxuICAgIH1cbiAgfCB7XG4gICAgICBraW5kOiAncmVzdWx0JyxcbiAgICAgIHJlc3VsdDogVixcbiAgICAgIC8vIFRoZSBlZGl0b3IgdGhhdCB0aGUgcmVzdWx0IHdhcyBjb21wdXRlZCBmcm9tXG4gICAgICBlZGl0b3I6IGF0b20kVGV4dEVkaXRvcixcbiAgICAgIC8vIFRoZSBwcm92aWRlciB0aGF0IGNvbXB1dGVkIHRoZSByZXN1bHRcbiAgICAgIC8vIFRPRE8gVXNlIGEgdHlwZSBwYXJhbWV0ZXIgZm9yIHRoaXMgdHlwZVxuICAgICAgcHJvdmlkZXI6IFQsXG4gICAgfTtcblxuZXhwb3J0IHR5cGUgUmVzdWx0RnVuY3Rpb248VCwgVj4gPSAoXG4gIHByb3ZpZGVyOiBULFxuICBlZGl0b3I6IGF0b20kVGV4dEVkaXRvcixcbikgPT4gUHJvbWlzZTxWPjtcblxudHlwZSBQYXJ0aWFsRXZlbnRTb3VyY2VzID0ge1xuICArYWN0aXZlRWRpdG9ycz86IE9ic2VydmFibGU8P2F0b20kVGV4dEVkaXRvcj4sXG4gICtjaGFuZ2VzRm9yRWRpdG9yPzogKGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yKSA9PiBPYnNlcnZhYmxlPHZvaWQ+LFxuICArc2F2ZXNGb3JFZGl0b3I/OiAoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IpID0+IE9ic2VydmFibGU8dm9pZD4sXG59O1xuXG5leHBvcnQgdHlwZSBFdmVudFNvdXJjZXMgPSB7XG4gIGFjdGl2ZUVkaXRvcnM6IE9ic2VydmFibGU8P2F0b20kVGV4dEVkaXRvcj4sXG4gIGNoYW5nZXNGb3JFZGl0b3I6IChlZGl0b3I6IGF0b20kVGV4dEVkaXRvcikgPT4gT2JzZXJ2YWJsZTx2b2lkPixcbiAgc2F2ZXNGb3JFZGl0b3I6IChlZGl0b3I6IGF0b20kVGV4dEVkaXRvcikgPT4gT2JzZXJ2YWJsZTx2b2lkPixcbn07XG5cbmV4cG9ydCB0eXBlIENvbmZpZyA9IHtcbiAgLyoqXG4gICAqIElmIHRydWUsIHdlIHdpbGwgcXVlcnkgcHJvdmlkZXJzIGZvciB1cGRhdGVzIHdoZW5ldmVyIHRoZSB0ZXh0IGluIHRoZSBlZGl0b3IgaXMgY2hhbmdlZC5cbiAgICogT3RoZXJ3aXNlLCB3ZSB3aWxsIHF1ZXJ5IG9ubHkgd2hlbiB0aGVyZSBpcyBhIHNhdmUgZXZlbnQuXG4gICAqL1xuICB1cGRhdGVPbkVkaXQ/OiBib29sZWFuLFxufTtcblxudHlwZSBDb25jcmV0ZUNvbmZpZyA9IHtcbiAgdXBkYXRlT25FZGl0OiBib29sZWFuLFxufTtcblxuY29uc3QgREVGQVVMVF9DT05GSUc6IENvbmNyZXRlQ29uZmlnID0ge1xuICB1cGRhdGVPbkVkaXQ6IHRydWUsXG59O1xuXG5mdW5jdGlvbiBnZXRDb25jcmV0ZUNvbmZpZyhjb25maWc6IENvbmZpZyk6IENvbmNyZXRlQ29uZmlnIHtcbiAgcmV0dXJuIHtcbiAgICAuLi5ERUZBVUxUX0NPTkZJRyxcbiAgICAuLi5jb25maWcsXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEFjdGl2ZUVkaXRvclJlZ2lzdHJ5PFQ6IFByb3ZpZGVyLCBWPiB7XG4gIF9yZXN1bHRGdW5jdGlvbjogUmVzdWx0RnVuY3Rpb248VCwgVj47XG4gIF9wcm92aWRlclJlZ2lzdHJ5OiBQcm92aWRlclJlZ2lzdHJ5PFQ+O1xuICBfbmV3UHJvdmlkZXJFdmVudHM6IFN1YmplY3Q8dm9pZD47XG4gIF9yZXN1bHRzU3RyZWFtOiBPYnNlcnZhYmxlPFJlc3VsdDxULCBWPj47XG4gIF9jb25maWc6IENvbmNyZXRlQ29uZmlnO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHJlc3VsdEZ1bmN0aW9uOiBSZXN1bHRGdW5jdGlvbjxULCBWPixcbiAgICBjb25maWc6IENvbmZpZyA9IHt9LFxuICAgIGV2ZW50U291cmNlczogUGFydGlhbEV2ZW50U291cmNlcyA9IHt9LFxuICApIHtcbiAgICB0aGlzLl9jb25maWcgPSBnZXRDb25jcmV0ZUNvbmZpZyhjb25maWcpO1xuICAgIHRoaXMuX3Jlc3VsdEZ1bmN0aW9uID0gcmVzdWx0RnVuY3Rpb247XG4gICAgdGhpcy5fcHJvdmlkZXJSZWdpc3RyeSA9IG5ldyBQcm92aWRlclJlZ2lzdHJ5KCk7XG4gICAgdGhpcy5fbmV3UHJvdmlkZXJFdmVudHMgPSBuZXcgU3ViamVjdCgpO1xuICAgIHRoaXMuX3Jlc3VsdHNTdHJlYW0gPSB0aGlzLl9jcmVhdGVSZXN1bHRzU3RyZWFtKHtcbiAgICAgIGFjdGl2ZUVkaXRvcnM6XG4gICAgICAgIGV2ZW50U291cmNlcy5hY3RpdmVFZGl0b3JzIHx8IG9ic2VydmVBY3RpdmVFZGl0b3JzRGVib3VuY2VkKCksXG4gICAgICBjaGFuZ2VzRm9yRWRpdG9yOlxuICAgICAgICBldmVudFNvdXJjZXMuY2hhbmdlc0ZvckVkaXRvciB8fFxuICAgICAgICAoZWRpdG9yID0+IGVkaXRvckNoYW5nZXNEZWJvdW5jZWQoZWRpdG9yKSksXG4gICAgICBzYXZlc0ZvckVkaXRvcjpcbiAgICAgICAgZXZlbnRTb3VyY2VzLnNhdmVzRm9yRWRpdG9yIHx8XG4gICAgICAgIChlZGl0b3IgPT4ge1xuICAgICAgICAgIHJldHVybiBvYnNlcnZhYmxlRnJvbVN1YnNjcmliZUZ1bmN0aW9uKGNhbGxiYWNrID0+XG4gICAgICAgICAgICBlZGl0b3Iub25EaWRTYXZlKGNhbGxiYWNrKSxcbiAgICAgICAgICApLm1hcFRvKHVuZGVmaW5lZCk7XG4gICAgICAgIH0pLFxuICAgIH0pO1xuICB9XG5cbiAgY29uc3VtZVByb3ZpZGVyKHByb3ZpZGVyOiBUKTogSURpc3Bvc2FibGUge1xuICAgIHRoaXMuX3Byb3ZpZGVyUmVnaXN0cnkuYWRkUHJvdmlkZXIocHJvdmlkZXIpO1xuICAgIHRoaXMuX25ld1Byb3ZpZGVyRXZlbnRzLm5leHQoKTtcbiAgICByZXR1cm4gbmV3IERpc3Bvc2FibGUoKCkgPT4ge1xuICAgICAgdGhpcy5fcHJvdmlkZXJSZWdpc3RyeS5yZW1vdmVQcm92aWRlcihwcm92aWRlcik7XG4gICAgfSk7XG4gIH1cblxuICBnZXRSZXN1bHRzU3RyZWFtKCk6IE9ic2VydmFibGU8UmVzdWx0PFQsIFY+PiB7XG4gICAgcmV0dXJuIHRoaXMuX3Jlc3VsdHNTdHJlYW07XG4gIH1cblxuICBfY3JlYXRlUmVzdWx0c1N0cmVhbShldmVudFNvdXJjZXM6IEV2ZW50U291cmNlcyk6IE9ic2VydmFibGU8UmVzdWx0PFQsIFY+PiB7XG4gICAgY29uc3QgcmVwZWF0ZWRFZGl0b3JzID0gZXZlbnRTb3VyY2VzLmFjdGl2ZUVkaXRvcnMuc3dpdGNoTWFwKGVkaXRvciA9PiB7XG4gICAgICBpZiAoZWRpdG9yID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2YoZWRpdG9yKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBPYnNlcnZhYmxlLmNvbmNhdChcbiAgICAgICAgT2JzZXJ2YWJsZS5vZihlZGl0b3IpLFxuICAgICAgICB0aGlzLl9uZXdQcm92aWRlckV2ZW50cy5tYXBUbyhlZGl0b3IpLFxuICAgICAgKTtcbiAgICB9KTtcbiAgICBjb25zdCByZXN1bHRzID0gcmVwZWF0ZWRFZGl0b3JzLnN3aXRjaE1hcChlZGl0b3JBcmcgPT4ge1xuICAgICAgLy8gTmVjZXNzYXJ5IHNvIHRoZSB0eXBlIHJlZmluZW1lbnQgaG9sZHMgaW4gdGhlIGNhbGxiYWNrIGxhdGVyXG4gICAgICBjb25zdCBlZGl0b3IgPSBlZGl0b3JBcmc7XG4gICAgICBpZiAoZWRpdG9yID09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUub2Yoe2tpbmQ6ICdub3QtdGV4dC1lZGl0b3InfSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBPYnNlcnZhYmxlLmNvbmNhdChcbiAgICAgICAgLy8gRW1pdCBhIHBhbmUgY2hhbmdlIGV2ZW50IGZpcnN0LCBzbyB0aGF0IGNsaWVudHMgY2FuIGRvIHNvbWV0aGluZyB3aGlsZSB3YWl0aW5nIGZvciBhXG4gICAgICAgIC8vIHByb3ZpZGVyIHRvIGdpdmUgYSByZXN1bHQuXG4gICAgICAgIE9ic2VydmFibGUub2Yoe1xuICAgICAgICAgIGtpbmQ6ICdwYW5lLWNoYW5nZScsXG4gICAgICAgICAgZWRpdG9yLFxuICAgICAgICB9KSxcbiAgICAgICAgT2JzZXJ2YWJsZS5mcm9tUHJvbWlzZShcbiAgICAgICAgICB0aGlzLl9nZXRSZXN1bHRGb3JFZGl0b3IodGhpcy5fZ2V0UHJvdmlkZXJGb3JFZGl0b3IoZWRpdG9yKSwgZWRpdG9yKSxcbiAgICAgICAgKSxcbiAgICAgICAgdGhpcy5fcmVzdWx0c0ZvckVkaXRvcihlZGl0b3IsIGV2ZW50U291cmNlcyksXG4gICAgICApO1xuICAgIH0pO1xuICAgIHJldHVybiBjYWNoZVdoaWxlU3Vic2NyaWJlZChyZXN1bHRzKTtcbiAgfVxuXG4gIF9yZXN1bHRzRm9yRWRpdG9yKFxuICAgIGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLFxuICAgIGV2ZW50U291cmNlczogRXZlbnRTb3VyY2VzLFxuICApOiBPYnNlcnZhYmxlPFJlc3VsdDxULCBWPj4ge1xuICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB0aGUgYWN0aXZlIHByb3ZpZGVyIGZvciBhbiBlZGl0b3IgY2hhbmdlcyBvdmVyIHRpbWUuXG4gICAgLy8gVGh1cywgd2UgaGF2ZSB0byBzdWJzY3JpYmUgdG8gYm90aCBlZGl0cyBhbmQgc2F2ZXMuXG4gICAgcmV0dXJuIE9ic2VydmFibGUubWVyZ2UoXG4gICAgICBldmVudFNvdXJjZXMuY2hhbmdlc0ZvckVkaXRvcihlZGl0b3IpLm1hcCgoKSA9PiAnZWRpdCcpLFxuICAgICAgZXZlbnRTb3VyY2VzLnNhdmVzRm9yRWRpdG9yKGVkaXRvcikubWFwKCgpID0+ICdzYXZlJyksXG4gICAgKS5mbGF0TWFwKGV2ZW50ID0+IHtcbiAgICAgIGNvbnN0IHByb3ZpZGVyID0gdGhpcy5fZ2V0UHJvdmlkZXJGb3JFZGl0b3IoZWRpdG9yKTtcbiAgICAgIGlmIChwcm92aWRlciAhPSBudWxsKSB7XG4gICAgICAgIGxldCB1cGRhdGVPbkVkaXQgPSBwcm92aWRlci51cGRhdGVPbkVkaXQ7XG4gICAgICAgIC8vIEZhbGwgYmFjayB0byB0aGUgY29uZmlnJ3MgdXBkYXRlT25FZGl0IGlmIG5vdCBwcm92aWRlZC5cbiAgICAgICAgaWYgKHVwZGF0ZU9uRWRpdCA9PSBudWxsKSB7XG4gICAgICAgICAgdXBkYXRlT25FZGl0ID0gdGhpcy5fY29uZmlnLnVwZGF0ZU9uRWRpdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodXBkYXRlT25FZGl0ICE9PSAoZXZlbnQgPT09ICdlZGl0JykpIHtcbiAgICAgICAgICByZXR1cm4gT2JzZXJ2YWJsZS5lbXB0eSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gT2JzZXJ2YWJsZS5jb25jYXQoXG4gICAgICAgIC8vICRGbG93SXNzdWU6IHtraW5kOiBlZGl0IHwgc2F2ZX0gPD0+IHtraW5kOiBlZGl0fSB8IHtraW5kOiBzYXZlfVxuICAgICAgICBPYnNlcnZhYmxlLm9mKHtraW5kOiBldmVudCwgZWRpdG9yfSksXG4gICAgICAgIE9ic2VydmFibGUuZnJvbVByb21pc2UodGhpcy5fZ2V0UmVzdWx0Rm9yRWRpdG9yKHByb3ZpZGVyLCBlZGl0b3IpKSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBfZ2V0UHJvdmlkZXJGb3JFZGl0b3IoZWRpdG9yOiBhdG9tJFRleHRFZGl0b3IpOiA/VCB7XG4gICAgcmV0dXJuIHRoaXMuX3Byb3ZpZGVyUmVnaXN0cnkuZ2V0UHJvdmlkZXJGb3JFZGl0b3IoZWRpdG9yKTtcbiAgfVxuXG4gIGFzeW5jIF9nZXRSZXN1bHRGb3JFZGl0b3IoXG4gICAgcHJvdmlkZXI6ID9ULFxuICAgIGVkaXRvcjogYXRvbSRUZXh0RWRpdG9yLFxuICApOiBQcm9taXNlPFJlc3VsdDxULCBWPj4ge1xuICAgIGlmIChwcm92aWRlciA9PSBudWxsKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBraW5kOiAnbm8tcHJvdmlkZXInLFxuICAgICAgICBncmFtbWFyOiBlZGl0b3IuZ2V0R3JhbW1hcigpLFxuICAgICAgfTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGtpbmQ6ICdyZXN1bHQnLFxuICAgICAgICByZXN1bHQ6IGF3YWl0IHRoaXMuX3Jlc3VsdEZ1bmN0aW9uKHByb3ZpZGVyLCBlZGl0b3IpLFxuICAgICAgICBwcm92aWRlcixcbiAgICAgICAgZWRpdG9yLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBnZXRMb2dnZXIodGhpcy5jb25zdHJ1Y3Rvci5uYW1lKS5lcnJvcihcbiAgICAgICAgYEVycm9yIGZyb20gcHJvdmlkZXIgZm9yICR7ZWRpdG9yLmdldEdyYW1tYXIoKS5zY29wZU5hbWV9YCxcbiAgICAgICAgZSxcbiAgICAgICk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcm92aWRlcixcbiAgICAgICAga2luZDogJ3Byb3ZpZGVyLWVycm9yJyxcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG4iXX0=