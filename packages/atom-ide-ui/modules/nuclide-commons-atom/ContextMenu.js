'use strict';

var cov_1tj7g5ohkq = function () {
  var path = '/Users/hansonw/atom-ide-ui/modules/nuclide-commons-atom/ContextMenu.js',
      hash = '9e8ddceea6ec66a8111acc41f30cceb612450c82',
      global = new Function('return this')(),
      gcv = '__coverage__',
      coverageData = {
    path: '/Users/hansonw/atom-ide-ui/modules/nuclide-commons-atom/ContextMenu.js',
    statementMap: {
      '0': {
        start: {
          line: 81,
          column: 4
        },
        end: {
          line: 81,
          column: 36
        }
      },
      '1': {
        start: {
          line: 82,
          column: 4
        },
        end: {
          line: 82,
          column: 21
        }
      },
      '2': {
        start: {
          line: 83,
          column: 4
        },
        end: {
          line: 83,
          column: 28
        }
      },
      '3': {
        start: {
          line: 84,
          column: 4
        },
        end: {
          line: 84,
          column: 39
        }
      },
      '4': {
        start: {
          line: 85,
          column: 4
        },
        end: {
          line: 85,
          column: 28
        }
      },
      '5': {
        start: {
          line: 93,
          column: 4
        },
        end: {
          line: 93,
          column: 36
        }
      },
      '6': {
        start: {
          line: 105,
          column: 18
        },
        end: {
          line: 105,
          column: 48
        }
      },
      '7': {
        start: {
          line: 106,
          column: 4
        },
        end: {
          line: 106,
          column: 38
        }
      },
      '8': {
        start: {
          line: 118,
          column: 18
        },
        end: {
          line: 118,
          column: 61
        }
      },
      '9': {
        start: {
          line: 119,
          column: 4
        },
        end: {
          line: 119,
          column: 38
        }
      },
      '10': {
        start: {
          line: 123,
          column: 4
        },
        end: {
          line: 123,
          column: 28
        }
      },
      '11': {
        start: {
          line: 124,
          column: 4
        },
        end: {
          line: 124,
          column: 27
        }
      },
      '12': {
        start: {
          line: 125,
          column: 4
        },
        end: {
          line: 125,
          column: 33
        }
      },
      '13': {
        start: {
          line: 129,
          column: 4
        },
        end: {
          line: 136,
          column: 7
        }
      },
      '14': {
        start: {
          line: 130,
          column: 20
        },
        end: {
          line: 130,
          column: 46
        }
      },
      '15': {
        start: {
          line: 131,
          column: 6
        },
        end: {
          line: 131,
          column: 35
        }
      },
      '16': {
        start: {
          line: 134,
          column: 6
        },
        end: {
          line: 134,
          column: 29
        }
      },
      '17': {
        start: {
          line: 135,
          column: 6
        },
        end: {
          line: 135,
          column: 19
        }
      },
      '18': {
        start: {
          line: 145,
          column: 4
        },
        end: {
          line: 147,
          column: 5
        }
      },
      '19': {
        start: {
          line: 146,
          column: 6
        },
        end: {
          line: 146,
          column: 13
        }
      },
      '20': {
        start: {
          line: 149,
          column: 4
        },
        end: {
          line: 149,
          column: 28
        }
      },
      '21': {
        start: {
          line: 151,
          column: 4
        },
        end: {
          line: 153,
          column: 5
        }
      },
      '22': {
        start: {
          line: 152,
          column: 6
        },
        end: {
          line: 152,
          column: 33
        }
      },
      '23': {
        start: {
          line: 155,
          column: 24
        },
        end: {
          line: 155,
          column: 41
        }
      },
      '24': {
        start: {
          line: 156,
          column: 4
        },
        end: {
          line: 168,
          column: 5
        }
      },
      '25': {
        start: {
          line: 157,
          column: 20
        },
        end: {
          line: 157,
          column: 46
        }
      },
      '26': {
        start: {
          line: 158,
          column: 6
        },
        end: {
          line: 163,
          column: 9
        }
      },
      '27': {
        start: {
          line: 164,
          column: 11
        },
        end: {
          line: 168,
          column: 5
        }
      },
      '28': {
        start: {
          line: 166,
          column: 6
        },
        end: {
          line: 166,
          column: 43
        }
      },
      '29': {
        start: {
          line: 167,
          column: 6
        },
        end: {
          line: 167,
          column: 33
        }
      },
      '30': {
        start: {
          line: 175,
          column: 4
        },
        end: {
          line: 190,
          column: 5
        }
      },
      '31': {
        start: {
          line: 176,
          column: 6
        },
        end: {
          line: 176,
          column: 31
        }
      },
      '32': {
        start: {
          line: 177,
          column: 11
        },
        end: {
          line: 190,
          column: 5
        }
      },
      '33': {
        start: {
          line: 180,
          column: 26
        },
        end: {
          line: 180,
          column: 56
        }
      },
      '34': {
        start: {
          line: 181,
          column: 6
        },
        end: {
          line: 181,
          column: 48
        }
      },
      '35': {
        start: {
          line: 182,
          column: 20
        },
        end: {
          line: 182,
          column: 59
        }
      },
      '36': {
        start: {
          line: 183,
          column: 6
        },
        end: {
          line: 187,
          column: 8
        }
      },
      '37': {
        start: {
          line: 189,
          column: 6
        },
        end: {
          line: 189,
          column: 23
        }
      },
      '38': {
        start: {
          line: 194,
          column: 18
        },
        end: {
          line: 201,
          column: 6
        }
      },
      '39': {
        start: {
          line: 195,
          column: 6
        },
        end: {
          line: 200,
          column: 7
        }
      },
      '40': {
        start: {
          line: 196,
          column: 8
        },
        end: {
          line: 196,
          column: 20
        }
      },
      '41': {
        start: {
          line: 197,
          column: 13
        },
        end: {
          line: 200,
          column: 7
        }
      },
      '42': {
        start: {
          line: 198,
          column: 28
        },
        end: {
          line: 198,
          column: 37
        }
      },
      '43': {
        start: {
          line: 199,
          column: 8
        },
        end: {
          line: 199,
          column: 38
        }
      },
      '44': {
        start: {
          line: 202,
          column: 4
        },
        end: {
          line: 202,
          column: 37
        }
      },
      '45': {
        start: {
          line: 203,
          column: 4
        },
        end: {
          line: 203,
          column: 17
        }
      },
      '46': {
        start: {
          line: 208,
          column: 4
        },
        end: {
          line: 208,
          column: 28
        }
      },
      '47': {
        start: {
          line: 209,
          column: 4
        },
        end: {
          line: 211,
          column: 5
        }
      },
      '48': {
        start: {
          line: 210,
          column: 6
        },
        end: {
          line: 210,
          column: 33
        }
      },
      '49': {
        start: {
          line: 212,
          column: 4
        },
        end: {
          line: 212,
          column: 27
        }
      },
      '50': {
        start: {
          line: 218,
          column: 4
        },
        end: {
          line: 223,
          column: 6
        }
      },
      '51': {
        start: {
          line: 229,
          column: 2
        },
        end: {
          line: 229,
          column: 33
        }
      }
    },
    fnMap: {
      '0': {
        name: '(anonymous_0)',
        decl: {
          start: {
            line: 80,
            column: 2
          },
          end: {
            line: 80,
            column: 3
          }
        },
        loc: {
          start: {
            line: 80,
            column: 40
          },
          end: {
            line: 86,
            column: 3
          }
        },
        line: 80
      },
      '1': {
        name: '(anonymous_1)',
        decl: {
          start: {
            line: 92,
            column: 2
          },
          end: {
            line: 92,
            column: 3
          }
        },
        loc: {
          start: {
            line: 92,
            column: 21
          },
          end: {
            line: 94,
            column: 3
          }
        },
        line: 92
      },
      '2': {
        name: '(anonymous_2)',
        decl: {
          start: {
            line: 104,
            column: 2
          },
          end: {
            line: 104,
            column: 3
          }
        },
        loc: {
          start: {
            line: 104,
            column: 69
          },
          end: {
            line: 107,
            column: 3
          }
        },
        line: 104
      },
      '3': {
        name: '(anonymous_3)',
        decl: {
          start: {
            line: 117,
            column: 2
          },
          end: {
            line: 117,
            column: 3
          }
        },
        loc: {
          start: {
            line: 117,
            column: 70
          },
          end: {
            line: 120,
            column: 3
          }
        },
        line: 117
      },
      '4': {
        name: '(anonymous_4)',
        decl: {
          start: {
            line: 122,
            column: 2
          },
          end: {
            line: 122,
            column: 3
          }
        },
        loc: {
          start: {
            line: 122,
            column: 51
          },
          end: {
            line: 137,
            column: 3
          }
        },
        line: 122
      },
      '5': {
        name: '(anonymous_5)',
        decl: {
          start: {
            line: 129,
            column: 26
          },
          end: {
            line: 129,
            column: 27
          }
        },
        loc: {
          start: {
            line: 129,
            column: 32
          },
          end: {
            line: 136,
            column: 5
          }
        },
        line: 129
      },
      '6': {
        name: '(anonymous_6)',
        decl: {
          start: {
            line: 144,
            column: 2
          },
          end: {
            line: 144,
            column: 3
          }
        },
        loc: {
          start: {
            line: 144,
            column: 16
          },
          end: {
            line: 169,
            column: 3
          }
        },
        line: 144
      },
      '7': {
        name: '(anonymous_7)',
        decl: {
          start: {
            line: 172,
            column: 2
          },
          end: {
            line: 172,
            column: 3
          }
        },
        loc: {
          start: {
            line: 174,
            column: 26
          },
          end: {
            line: 191,
            column: 3
          }
        },
        line: 174
      },
      '8': {
        name: '(anonymous_8)',
        decl: {
          start: {
            line: 193,
            column: 2
          },
          end: {
            line: 193,
            column: 3
          }
        },
        loc: {
          start: {
            line: 193,
            column: 45
          },
          end: {
            line: 204,
            column: 3
          }
        },
        line: 193
      },
      '9': {
        name: '(anonymous_9)',
        decl: {
          start: {
            line: 194,
            column: 37
          },
          end: {
            line: 194,
            column: 38
          }
        },
        loc: {
          start: {
            line: 194,
            column: 61
          },
          end: {
            line: 201,
            column: 5
          }
        },
        line: 194
      },
      '10': {
        name: '(anonymous_10)',
        decl: {
          start: {
            line: 207,
            column: 2
          },
          end: {
            line: 207,
            column: 3
          }
        },
        loc: {
          start: {
            line: 207,
            column: 12
          },
          end: {
            line: 213,
            column: 3
          }
        },
        line: 207
      },
      '11': {
        name: '(anonymous_11)',
        decl: {
          start: {
            line: 215,
            column: 2
          },
          end: {
            line: 215,
            column: 3
          }
        },
        loc: {
          start: {
            line: 215,
            column: 46
          },
          end: {
            line: 224,
            column: 3
          }
        },
        line: 215
      },
      '12': {
        name: 'compareInternalItems',
        decl: {
          start: {
            line: 228,
            column: 9
          },
          end: {
            line: 228,
            column: 29
          }
        },
        loc: {
          start: {
            line: 228,
            column: 72
          },
          end: {
            line: 230,
            column: 1
          }
        },
        line: 228
      }
    },
    branchMap: {
      '0': {
        loc: {
          start: {
            line: 145,
            column: 4
          },
          end: {
            line: 147,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 145,
            column: 4
          },
          end: {
            line: 147,
            column: 5
          }
        }, {
          start: {
            line: 145,
            column: 4
          },
          end: {
            line: 147,
            column: 5
          }
        }],
        line: 145
      },
      '1': {
        loc: {
          start: {
            line: 151,
            column: 4
          },
          end: {
            line: 153,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 151,
            column: 4
          },
          end: {
            line: 153,
            column: 5
          }
        }, {
          start: {
            line: 151,
            column: 4
          },
          end: {
            line: 153,
            column: 5
          }
        }],
        line: 151
      },
      '2': {
        loc: {
          start: {
            line: 156,
            column: 4
          },
          end: {
            line: 168,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 156,
            column: 4
          },
          end: {
            line: 168,
            column: 5
          }
        }, {
          start: {
            line: 156,
            column: 4
          },
          end: {
            line: 168,
            column: 5
          }
        }],
        line: 156
      },
      '3': {
        loc: {
          start: {
            line: 164,
            column: 11
          },
          end: {
            line: 168,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 164,
            column: 11
          },
          end: {
            line: 168,
            column: 5
          }
        }, {
          start: {
            line: 164,
            column: 11
          },
          end: {
            line: 168,
            column: 5
          }
        }],
        line: 164
      },
      '4': {
        loc: {
          start: {
            line: 175,
            column: 4
          },
          end: {
            line: 190,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 175,
            column: 4
          },
          end: {
            line: 190,
            column: 5
          }
        }, {
          start: {
            line: 175,
            column: 4
          },
          end: {
            line: 190,
            column: 5
          }
        }],
        line: 175
      },
      '5': {
        loc: {
          start: {
            line: 177,
            column: 11
          },
          end: {
            line: 190,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 177,
            column: 11
          },
          end: {
            line: 190,
            column: 5
          }
        }, {
          start: {
            line: 177,
            column: 11
          },
          end: {
            line: 190,
            column: 5
          }
        }],
        line: 177
      },
      '6': {
        loc: {
          start: {
            line: 195,
            column: 6
          },
          end: {
            line: 200,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 195,
            column: 6
          },
          end: {
            line: 200,
            column: 7
          }
        }, {
          start: {
            line: 195,
            column: 6
          },
          end: {
            line: 200,
            column: 7
          }
        }],
        line: 195
      },
      '7': {
        loc: {
          start: {
            line: 197,
            column: 13
          },
          end: {
            line: 200,
            column: 7
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 197,
            column: 13
          },
          end: {
            line: 200,
            column: 7
          }
        }, {
          start: {
            line: 197,
            column: 13
          },
          end: {
            line: 200,
            column: 7
          }
        }],
        line: 197
      },
      '8': {
        loc: {
          start: {
            line: 209,
            column: 4
          },
          end: {
            line: 211,
            column: 5
          }
        },
        type: 'if',
        locations: [{
          start: {
            line: 209,
            column: 4
          },
          end: {
            line: 211,
            column: 5
          }
        }, {
          start: {
            line: 209,
            column: 4
          },
          end: {
            line: 211,
            column: 5
          }
        }],
        line: 209
      },
      '9': {
        loc: {
          start: {
            line: 219,
            column: 6
          },
          end: {
            line: 222,
            column: 43
          }
        },
        type: 'binary-expr',
        locations: [{
          start: {
            line: 219,
            column: 6
          },
          end: {
            line: 219,
            column: 33
          }
        }, {
          start: {
            line: 221,
            column: 6
          },
          end: {
            line: 221,
            column: 21
          }
        }, {
          start: {
            line: 222,
            column: 6
          },
          end: {
            line: 222,
            column: 43
          }
        }],
        line: 219
      }
    },
    s: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0,
      '13': 0,
      '14': 0,
      '15': 0,
      '16': 0,
      '17': 0,
      '18': 0,
      '19': 0,
      '20': 0,
      '21': 0,
      '22': 0,
      '23': 0,
      '24': 0,
      '25': 0,
      '26': 0,
      '27': 0,
      '28': 0,
      '29': 0,
      '30': 0,
      '31': 0,
      '32': 0,
      '33': 0,
      '34': 0,
      '35': 0,
      '36': 0,
      '37': 0,
      '38': 0,
      '39': 0,
      '40': 0,
      '41': 0,
      '42': 0,
      '43': 0,
      '44': 0,
      '45': 0,
      '46': 0,
      '47': 0,
      '48': 0,
      '49': 0,
      '50': 0,
      '51': 0
    },
    f: {
      '0': 0,
      '1': 0,
      '2': 0,
      '3': 0,
      '4': 0,
      '5': 0,
      '6': 0,
      '7': 0,
      '8': 0,
      '9': 0,
      '10': 0,
      '11': 0,
      '12': 0
    },
    b: {
      '0': [0, 0],
      '1': [0, 0],
      '2': [0, 0],
      '3': [0, 0],
      '4': [0, 0],
      '5': [0, 0],
      '6': [0, 0],
      '7': [0, 0],
      '8': [0, 0],
      '9': [0, 0, 0]
    },
    _coverageSchema: '332fd63041d2c1bcb487cc26dd0d5f7d97098a6c'
  },
      coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  coverageData.hash = hash;
  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _atom = require('atom');

/**
 * This class represents a collection of context menu items that have been registered with Atom's
 * ContextMenuManager under a single CSS selector. These items are ordered based on the specified
 * priority with which they are added to this object. (The CSS selector is either specified
 * explicitly via the `cssSelector` property of the RootMenuOptions passed to the constructor, or
 * implicitly via the `parent` property of the SubmenuOptions passed to the constructor.)
 *
 * This is in contrast to Atom's ContextMenuManager, which relies on the specificity of the CSS
 * selector for a menu item to determine its precedence. The motivation behind this approach is to
 * provide a total order on menu item ordering rather than a partial order. As such, this class
 * serves as an adapter between the numeric priority model and ContextMenuManager's model.
 *
 * Note that this class also provides support for submenu items. This requires Atom 1.6 or later
 * because it relies on this fix: https://github.com/atom/atom/pull/10486.
 */
class ContextMenu {

  /**
   * List of items that have been added to this context menu in the order they were added.
   * Note that this list does not get sorted: only a filtered version of it does.
   * Further, this list is mutated heavily, but it is never reassigned.
   */
  constructor(menuOptions) {
    cov_1tj7g5ohkq.f[0]++;
    cov_1tj7g5ohkq.s[0]++;

    this._menuOptions = menuOptions;
    cov_1tj7g5ohkq.s[1]++;
    this._items = [];
    cov_1tj7g5ohkq.s[2]++;
    this._needsSort = false;
    cov_1tj7g5ohkq.s[3]++;
    this._sort = this._sort.bind(this);
    cov_1tj7g5ohkq.s[4]++;
    this._disposable = null;
  }

  /**
   * @return true if this menu does not contain any items; otherwise, returns false. Note this will
   *   return true if it contains only empty submenu items.
   */


  /**
   * This is the Disposable that represents adding all of this object's menu items to Atom's own
   * ContextMenuManager. When a new item is added to this object, we must remove all of the items
   * that we previously added to the ContextMenuManager and then re-add them based on the new
   * ordering of priorities that results from the new item.
   */
  isEmpty() {
    cov_1tj7g5ohkq.f[1]++;
    cov_1tj7g5ohkq.s[5]++;

    return this._items.length === 0;
  }

  /**
   * Adds the specified item to this contenxt menu.
   *
   * Items with lower priority values appear earlier in the context menu
   * (i.e., items appear in numerical order with respect to priority).
   *
   * @return object whose dispose() method can be used to remove the menu item from this object.
   */
  addItem(item, priority) {
    cov_1tj7g5ohkq.f[2]++;

    const value = (cov_1tj7g5ohkq.s[6]++, { type: 'item', item, priority });
    cov_1tj7g5ohkq.s[7]++;
    return this._addItemToList(value);
  }

  /**
   * Adds the specified submenu to this contenxt menu.
   *
   * Items with lower priority values appear earlier in the context menu
   * (i.e., items appear in numerical order with respect to priority).
   *
   * @return object whose dispose() method can be used to remove the submenu from this object.
   */
  addSubmenu(contextMenu, priority) {
    cov_1tj7g5ohkq.f[3]++;

    const value = (cov_1tj7g5ohkq.s[8]++, { type: 'menu', menu: contextMenu, priority });
    cov_1tj7g5ohkq.s[9]++;
    return this._addItemToList(value);
  }

  _addItemToList(value) {
    cov_1tj7g5ohkq.f[4]++;
    cov_1tj7g5ohkq.s[10]++;

    this._items.push(value);
    cov_1tj7g5ohkq.s[11]++;
    this._needsSort = true;
    cov_1tj7g5ohkq.s[12]++;
    process.nextTick(this._sort);

    // TODO(mbolin): Ideally, this Disposable should be garbage-collected if this ContextMenu is
    // disposed.
    cov_1tj7g5ohkq.s[13]++;
    return new _atom.Disposable(() => {
      cov_1tj7g5ohkq.f[5]++;

      const index = (cov_1tj7g5ohkq.s[14]++, this._items.indexOf(value));
      cov_1tj7g5ohkq.s[15]++;
      this._items.splice(index, 1);

      // We need to invoke _sort for the management of this._disposable and atom.contextMenu.add.
      cov_1tj7g5ohkq.s[16]++;
      this._needsSort = true;
      cov_1tj7g5ohkq.s[17]++;
      this._sort();
    });
  }

  /**
   * This method must be invoked after this._items has been modified. If necessary, it will remove
   * all items that this object previously registered with Atom's ContextMenuManager. Then it will
   * re-register everything in this._items once it has been sorted.
   */
  _sort() {
    cov_1tj7g5ohkq.f[6]++;
    cov_1tj7g5ohkq.s[18]++;

    if (!this._needsSort) {
      cov_1tj7g5ohkq.b[0][0]++;
      cov_1tj7g5ohkq.s[19]++;

      return;
    } else {
      cov_1tj7g5ohkq.b[0][1]++;
    }

    cov_1tj7g5ohkq.s[20]++;
    this._needsSort = false;

    cov_1tj7g5ohkq.s[21]++;
    if (this._disposable != null) {
      cov_1tj7g5ohkq.b[1][0]++;
      cov_1tj7g5ohkq.s[22]++;

      this._disposable.dispose();
    } else {
      cov_1tj7g5ohkq.b[1][1]++;
    }

    const menuOptions = (cov_1tj7g5ohkq.s[23]++, this._menuOptions);
    cov_1tj7g5ohkq.s[24]++;
    if (menuOptions.type === 'root') {
      cov_1tj7g5ohkq.b[2][0]++;

      const items = (cov_1tj7g5ohkq.s[25]++, this._sortAndFilterItems());
      cov_1tj7g5ohkq.s[26]++;
      this._disposable = atom.contextMenu.add({
        [menuOptions.cssSelector]: items.map(this._contextMenuItemForInternalItem, this)
      });
    } else {
        cov_1tj7g5ohkq.b[2][1]++;
        cov_1tj7g5ohkq.s[27]++;
        if (menuOptions.type === 'submenu') {
          cov_1tj7g5ohkq.b[3][0]++;
          cov_1tj7g5ohkq.s[28]++;

          // Tell the parent menu to sort itself.
          menuOptions.parent._needsSort = true;
          cov_1tj7g5ohkq.s[29]++;
          menuOptions.parent._sort();
        } else {
          cov_1tj7g5ohkq.b[3][1]++;
        }
      }
  }

  /** Translates this object's internal representation of a menu item to Atom's representation. */
  _contextMenuItemForInternalItem(internalItem) {
    cov_1tj7g5ohkq.f[7]++;
    cov_1tj7g5ohkq.s[30]++;

    if (internalItem.type === 'item') {
      cov_1tj7g5ohkq.b[4][0]++;
      cov_1tj7g5ohkq.s[31]++;

      return internalItem.item;
    } else {
        cov_1tj7g5ohkq.b[4][1]++;
        cov_1tj7g5ohkq.s[32]++;
        if (internalItem.type === 'menu') {
          cov_1tj7g5ohkq.b[5][0]++;

          // Note that due to our own strict renaming rules, this must be a private method instead of a
          // static function because of the access to _menuOptions and _items.
          const menuOptions = (cov_1tj7g5ohkq.s[33]++, internalItem.menu._menuOptions);
          cov_1tj7g5ohkq.s[34]++;

          if (!(menuOptions.type === 'submenu')) {
            throw new Error('Invariant violation: "menuOptions.type === \'submenu\'"');
          }

          const items = (cov_1tj7g5ohkq.s[35]++, internalItem.menu._sortAndFilterItems());
          cov_1tj7g5ohkq.s[36]++;
          return {
            label: menuOptions.label,
            submenu: items.map(this._contextMenuItemForInternalItem, this),
            shouldDisplay: menuOptions.shouldDisplay
          };
        } else {
          cov_1tj7g5ohkq.b[5][1]++;
          cov_1tj7g5ohkq.s[37]++;

          if (!false) {
            throw new Error('Invariant violation: "false"');
          }
        }
      }
  }

  _sortAndFilterItems() {
    cov_1tj7g5ohkq.f[8]++;

    const items = (cov_1tj7g5ohkq.s[38]++, this._items.filter(item => {
      cov_1tj7g5ohkq.f[9]++;
      cov_1tj7g5ohkq.s[39]++;

      if (item.type === 'item') {
        cov_1tj7g5ohkq.b[6][0]++;
        cov_1tj7g5ohkq.s[40]++;

        return true;
      } else {
          cov_1tj7g5ohkq.b[6][1]++;
          cov_1tj7g5ohkq.s[41]++;
          if (item.type === 'menu') {
            cov_1tj7g5ohkq.b[7][0]++;

            const contextMenu = (cov_1tj7g5ohkq.s[42]++, item.menu);
            cov_1tj7g5ohkq.s[43]++;
            return !contextMenu.isEmpty();
          } else {
            cov_1tj7g5ohkq.b[7][1]++;
          }
        }
    }));
    cov_1tj7g5ohkq.s[44]++;
    items.sort(compareInternalItems);
    cov_1tj7g5ohkq.s[45]++;
    return items;
  }

  /** Removes all items this object has added to Atom's ContextMenuManager. */
  dispose() {
    cov_1tj7g5ohkq.f[10]++;
    cov_1tj7g5ohkq.s[46]++;

    this._needsSort = false;
    cov_1tj7g5ohkq.s[47]++;
    if (this._disposable != null) {
      cov_1tj7g5ohkq.b[8][0]++;
      cov_1tj7g5ohkq.s[48]++;

      this._disposable.dispose();
    } else {
      cov_1tj7g5ohkq.b[8][1]++;
    }
    cov_1tj7g5ohkq.s[49]++;
    this._items.length = 0;
  }

  static isEventFromContextMenu(event) {
    cov_1tj7g5ohkq.f[11]++;
    cov_1tj7g5ohkq.s[50]++;

    // Context menu commands contain a specific `detail` parameter:
    // https://github.com/atom/atom/blob/v1.15.0/src/main-process/context-menu.coffee#L17
    return (cov_1tj7g5ohkq.b[9][0]++, Array.isArray(event.detail)) && (cov_1tj7g5ohkq.b[9][1]++,
    // flowlint-next-line sketchy-null-mixed:off
    event.detail[0]) && (cov_1tj7g5ohkq.b[9][2]++, event.detail[0].contextCommand);
  }
}

exports.default = ContextMenu; /** Comparator used to sort menu items by priority: lower priorities appear earlier. */
/**
 * Copyright (c) 2017-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 * @format
 */

function compareInternalItems(a, b) {
  cov_1tj7g5ohkq.f[12]++;
  cov_1tj7g5ohkq.s[51]++;

  return a.priority - b.priority;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbnRleHRNZW51LmpzIl0sIm5hbWVzIjpbIkNvbnRleHRNZW51IiwiY29uc3RydWN0b3IiLCJtZW51T3B0aW9ucyIsIl9tZW51T3B0aW9ucyIsIl9pdGVtcyIsIl9uZWVkc1NvcnQiLCJfc29ydCIsImJpbmQiLCJfZGlzcG9zYWJsZSIsImlzRW1wdHkiLCJsZW5ndGgiLCJhZGRJdGVtIiwiaXRlbSIsInByaW9yaXR5IiwidmFsdWUiLCJ0eXBlIiwiX2FkZEl0ZW1Ub0xpc3QiLCJhZGRTdWJtZW51IiwiY29udGV4dE1lbnUiLCJtZW51IiwicHVzaCIsInByb2Nlc3MiLCJuZXh0VGljayIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsImRpc3Bvc2UiLCJpdGVtcyIsIl9zb3J0QW5kRmlsdGVySXRlbXMiLCJhdG9tIiwiYWRkIiwiY3NzU2VsZWN0b3IiLCJtYXAiLCJfY29udGV4dE1lbnVJdGVtRm9ySW50ZXJuYWxJdGVtIiwicGFyZW50IiwiaW50ZXJuYWxJdGVtIiwibGFiZWwiLCJzdWJtZW51Iiwic2hvdWxkRGlzcGxheSIsImZpbHRlciIsInNvcnQiLCJjb21wYXJlSW50ZXJuYWxJdGVtcyIsImlzRXZlbnRGcm9tQ29udGV4dE1lbnUiLCJldmVudCIsImlzQXJyYXkiLCJkZXRhaWwiLCJjb250ZXh0Q29tbWFuZCIsImEiLCJiIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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LGVBQU8sSUFBUDtBQUNELE9BRkQsTUFFTztBQUFBO0FBQUE7QUFBQSxjQUFJSCxLQUFLRyxJQUFMLEtBQWMsTUFBbEIsRUFBMEI7QUFBQTs7QUFDL0Isa0JBQU1HLHVDQUFjTixLQUFLTyxJQUFuQixDQUFOO0FBRCtCO0FBRS9CLG1CQUFPLENBQUNELFlBQVlULE9BQVosRUFBUjtBQUNELFdBSE07QUFBQTtBQUFBO0FBR047QUFDRixLQVBhLENBQVIsQ0FBTjtBQUR5QztBQVN6Q2tCLFVBQU1hLElBQU4sQ0FBV0Msb0JBQVg7QUFUeUM7QUFVekMsV0FBT2QsS0FBUDtBQUNEOztBQUVEO0FBQ0FELFlBQVU7QUFBQTtBQUFBOztBQUNSLFNBQUtyQixVQUFMLEdBQWtCLEtBQWxCO0FBRFE7QUFFUixRQUFJLEtBQUtHLFdBQUwsSUFBb0IsSUFBeEIsRUFBOEI7QUFBQTtBQUFBOztBQUM1QixXQUFLQSxXQUFMLENBQWlCa0IsT0FBakI7QUFDRCxLQUZEO0FBQUE7QUFBQTtBQUZRO0FBS1IsU0FBS3RCLE1BQUwsQ0FBWU0sTUFBWixHQUFxQixDQUFyQjtBQUNEOztBQUVELFNBQU9nQyxzQkFBUCxDQUE4QkMsS0FBOUIsRUFBNEM7QUFBQTtBQUFBOztBQUMxQztBQUNBO0FBQ0EsV0FDRSxpQ0FBTUMsT0FBTixDQUFjRCxNQUFNRSxNQUFwQjtBQUNBO0FBQ0FGLFVBQU1FLE1BQU4sQ0FBYSxDQUFiLENBRkEsZ0NBR0NGLE1BQU1FLE1BQU4sQ0FBYSxDQUFiLENBQUQsQ0FBdUJDLGNBSHZCLENBREY7QUFNRDtBQXJLOEI7O2tCQUFaOUMsVyxFQXdLckI7QUFsT0E7Ozs7Ozs7Ozs7OztBQW1PQSxTQUFTeUMsb0JBQVQsQ0FBOEJNLENBQTlCLEVBQStDQyxDQUEvQyxFQUF3RTtBQUFBO0FBQUE7O0FBQ3RFLFNBQU9ELEVBQUVsQyxRQUFGLEdBQWFtQyxFQUFFbkMsUUFBdEI7QUFDRCIsImZpbGUiOiJDb250ZXh0TWVudS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE3LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIEJTRC1zdHlsZSBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLiBBbiBhZGRpdGlvbmFsIGdyYW50XG4gKiBvZiBwYXRlbnQgcmlnaHRzIGNhbiBiZSBmb3VuZCBpbiB0aGUgUEFURU5UUyBmaWxlIGluIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG5cbmltcG9ydCB7RGlzcG9zYWJsZX0gZnJvbSAnYXRvbSc7XG5pbXBvcnQgaW52YXJpYW50IGZyb20gJ2Fzc2VydCc7XG5cbnR5cGUgSXRlbSA9IHtcbiAgdHlwZTogJ2l0ZW0nLFxuICBpdGVtOiBhdG9tJENvbnRleHRNZW51SXRlbSxcbiAgcHJpb3JpdHk6IG51bWJlcixcbn07XG5cbnR5cGUgTWVudSA9IHtcbiAgdHlwZTogJ21lbnUnLFxuICBtZW51OiBDb250ZXh0TWVudSxcbiAgcHJpb3JpdHk6IG51bWJlcixcbn07XG5cbnR5cGUgSW50ZXJuYWxJdGVtID0gSXRlbSB8IE1lbnU7XG5cbnR5cGUgUm9vdE1lbnVPcHRpb25zID0ge1xuICB0eXBlOiAncm9vdCcsXG4gIGNzc1NlbGVjdG9yOiBzdHJpbmcsXG59O1xuXG50eXBlIFN1Ym1lbnVPcHRpb25zID0ge1xuICB0eXBlOiAnc3VibWVudScsXG4gIGxhYmVsOiBzdHJpbmcsXG4gIHBhcmVudDogQ29udGV4dE1lbnUsXG4gIHNob3VsZERpc3BsYXk/OiAoZTogTW91c2VFdmVudCkgPT4gYm9vbGVhbixcbn07XG5cbnR5cGUgTWVudU9wdGlvbnMgPSBSb290TWVudU9wdGlvbnMgfCBTdWJtZW51T3B0aW9ucztcblxuLyoqXG4gKiBUaGlzIGNsYXNzIHJlcHJlc2VudHMgYSBjb2xsZWN0aW9uIG9mIGNvbnRleHQgbWVudSBpdGVtcyB0aGF0IGhhdmUgYmVlbiByZWdpc3RlcmVkIHdpdGggQXRvbSdzXG4gKiBDb250ZXh0TWVudU1hbmFnZXIgdW5kZXIgYSBzaW5nbGUgQ1NTIHNlbGVjdG9yLiBUaGVzZSBpdGVtcyBhcmUgb3JkZXJlZCBiYXNlZCBvbiB0aGUgc3BlY2lmaWVkXG4gKiBwcmlvcml0eSB3aXRoIHdoaWNoIHRoZXkgYXJlIGFkZGVkIHRvIHRoaXMgb2JqZWN0LiAoVGhlIENTUyBzZWxlY3RvciBpcyBlaXRoZXIgc3BlY2lmaWVkXG4gKiBleHBsaWNpdGx5IHZpYSB0aGUgYGNzc1NlbGVjdG9yYCBwcm9wZXJ0eSBvZiB0aGUgUm9vdE1lbnVPcHRpb25zIHBhc3NlZCB0byB0aGUgY29uc3RydWN0b3IsIG9yXG4gKiBpbXBsaWNpdGx5IHZpYSB0aGUgYHBhcmVudGAgcHJvcGVydHkgb2YgdGhlIFN1Ym1lbnVPcHRpb25zIHBhc3NlZCB0byB0aGUgY29uc3RydWN0b3IuKVxuICpcbiAqIFRoaXMgaXMgaW4gY29udHJhc3QgdG8gQXRvbSdzIENvbnRleHRNZW51TWFuYWdlciwgd2hpY2ggcmVsaWVzIG9uIHRoZSBzcGVjaWZpY2l0eSBvZiB0aGUgQ1NTXG4gKiBzZWxlY3RvciBmb3IgYSBtZW51IGl0ZW0gdG8gZGV0ZXJtaW5lIGl0cyBwcmVjZWRlbmNlLiBUaGUgbW90aXZhdGlvbiBiZWhpbmQgdGhpcyBhcHByb2FjaCBpcyB0b1xuICogcHJvdmlkZSBhIHRvdGFsIG9yZGVyIG9uIG1lbnUgaXRlbSBvcmRlcmluZyByYXRoZXIgdGhhbiBhIHBhcnRpYWwgb3JkZXIuIEFzIHN1Y2gsIHRoaXMgY2xhc3NcbiAqIHNlcnZlcyBhcyBhbiBhZGFwdGVyIGJldHdlZW4gdGhlIG51bWVyaWMgcHJpb3JpdHkgbW9kZWwgYW5kIENvbnRleHRNZW51TWFuYWdlcidzIG1vZGVsLlxuICpcbiAqIE5vdGUgdGhhdCB0aGlzIGNsYXNzIGFsc28gcHJvdmlkZXMgc3VwcG9ydCBmb3Igc3VibWVudSBpdGVtcy4gVGhpcyByZXF1aXJlcyBBdG9tIDEuNiBvciBsYXRlclxuICogYmVjYXVzZSBpdCByZWxpZXMgb24gdGhpcyBmaXg6IGh0dHBzOi8vZ2l0aHViLmNvbS9hdG9tL2F0b20vcHVsbC8xMDQ4Ni5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29udGV4dE1lbnUge1xuICBfbWVudU9wdGlvbnM6IE1lbnVPcHRpb25zO1xuXG4gIC8qKlxuICAgKiBMaXN0IG9mIGl0ZW1zIHRoYXQgaGF2ZSBiZWVuIGFkZGVkIHRvIHRoaXMgY29udGV4dCBtZW51IGluIHRoZSBvcmRlciB0aGV5IHdlcmUgYWRkZWQuXG4gICAqIE5vdGUgdGhhdCB0aGlzIGxpc3QgZG9lcyBub3QgZ2V0IHNvcnRlZDogb25seSBhIGZpbHRlcmVkIHZlcnNpb24gb2YgaXQgZG9lcy5cbiAgICogRnVydGhlciwgdGhpcyBsaXN0IGlzIG11dGF0ZWQgaGVhdmlseSwgYnV0IGl0IGlzIG5ldmVyIHJlYXNzaWduZWQuXG4gICAqL1xuICBfaXRlbXM6IEFycmF5PEludGVybmFsSXRlbT47XG5cbiAgX25lZWRzU29ydDogYm9vbGVhbjtcbiAgX3NvcnQ6IEZ1bmN0aW9uO1xuXG4gIC8qKlxuICAgKiBUaGlzIGlzIHRoZSBEaXNwb3NhYmxlIHRoYXQgcmVwcmVzZW50cyBhZGRpbmcgYWxsIG9mIHRoaXMgb2JqZWN0J3MgbWVudSBpdGVtcyB0byBBdG9tJ3Mgb3duXG4gICAqIENvbnRleHRNZW51TWFuYWdlci4gV2hlbiBhIG5ldyBpdGVtIGlzIGFkZGVkIHRvIHRoaXMgb2JqZWN0LCB3ZSBtdXN0IHJlbW92ZSBhbGwgb2YgdGhlIGl0ZW1zXG4gICAqIHRoYXQgd2UgcHJldmlvdXNseSBhZGRlZCB0byB0aGUgQ29udGV4dE1lbnVNYW5hZ2VyIGFuZCB0aGVuIHJlLWFkZCB0aGVtIGJhc2VkIG9uIHRoZSBuZXdcbiAgICogb3JkZXJpbmcgb2YgcHJpb3JpdGllcyB0aGF0IHJlc3VsdHMgZnJvbSB0aGUgbmV3IGl0ZW0uXG4gICAqL1xuICBfZGlzcG9zYWJsZTogP0lEaXNwb3NhYmxlO1xuXG4gIGNvbnN0cnVjdG9yKG1lbnVPcHRpb25zOiBNZW51T3B0aW9ucykge1xuICAgIHRoaXMuX21lbnVPcHRpb25zID0gbWVudU9wdGlvbnM7XG4gICAgdGhpcy5faXRlbXMgPSBbXTtcbiAgICB0aGlzLl9uZWVkc1NvcnQgPSBmYWxzZTtcbiAgICB0aGlzLl9zb3J0ID0gdGhpcy5fc29ydC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX2Rpc3Bvc2FibGUgPSBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGlzIG1lbnUgZG9lcyBub3QgY29udGFpbiBhbnkgaXRlbXM7IG90aGVyd2lzZSwgcmV0dXJucyBmYWxzZS4gTm90ZSB0aGlzIHdpbGxcbiAgICogICByZXR1cm4gdHJ1ZSBpZiBpdCBjb250YWlucyBvbmx5IGVtcHR5IHN1Ym1lbnUgaXRlbXMuXG4gICAqL1xuICBpc0VtcHR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9pdGVtcy5sZW5ndGggPT09IDA7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyB0aGUgc3BlY2lmaWVkIGl0ZW0gdG8gdGhpcyBjb250ZW54dCBtZW51LlxuICAgKlxuICAgKiBJdGVtcyB3aXRoIGxvd2VyIHByaW9yaXR5IHZhbHVlcyBhcHBlYXIgZWFybGllciBpbiB0aGUgY29udGV4dCBtZW51XG4gICAqIChpLmUuLCBpdGVtcyBhcHBlYXIgaW4gbnVtZXJpY2FsIG9yZGVyIHdpdGggcmVzcGVjdCB0byBwcmlvcml0eSkuXG4gICAqXG4gICAqIEByZXR1cm4gb2JqZWN0IHdob3NlIGRpc3Bvc2UoKSBtZXRob2QgY2FuIGJlIHVzZWQgdG8gcmVtb3ZlIHRoZSBtZW51IGl0ZW0gZnJvbSB0aGlzIG9iamVjdC5cbiAgICovXG4gIGFkZEl0ZW0oaXRlbTogYXRvbSRDb250ZXh0TWVudUl0ZW0sIHByaW9yaXR5OiBudW1iZXIpOiBJRGlzcG9zYWJsZSB7XG4gICAgY29uc3QgdmFsdWUgPSB7dHlwZTogJ2l0ZW0nLCBpdGVtLCBwcmlvcml0eX07XG4gICAgcmV0dXJuIHRoaXMuX2FkZEl0ZW1Ub0xpc3QodmFsdWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgdGhlIHNwZWNpZmllZCBzdWJtZW51IHRvIHRoaXMgY29udGVueHQgbWVudS5cbiAgICpcbiAgICogSXRlbXMgd2l0aCBsb3dlciBwcmlvcml0eSB2YWx1ZXMgYXBwZWFyIGVhcmxpZXIgaW4gdGhlIGNvbnRleHQgbWVudVxuICAgKiAoaS5lLiwgaXRlbXMgYXBwZWFyIGluIG51bWVyaWNhbCBvcmRlciB3aXRoIHJlc3BlY3QgdG8gcHJpb3JpdHkpLlxuICAgKlxuICAgKiBAcmV0dXJuIG9iamVjdCB3aG9zZSBkaXNwb3NlKCkgbWV0aG9kIGNhbiBiZSB1c2VkIHRvIHJlbW92ZSB0aGUgc3VibWVudSBmcm9tIHRoaXMgb2JqZWN0LlxuICAgKi9cbiAgYWRkU3VibWVudShjb250ZXh0TWVudTogQ29udGV4dE1lbnUsIHByaW9yaXR5OiBudW1iZXIpOiBJRGlzcG9zYWJsZSB7XG4gICAgY29uc3QgdmFsdWUgPSB7dHlwZTogJ21lbnUnLCBtZW51OiBjb250ZXh0TWVudSwgcHJpb3JpdHl9O1xuICAgIHJldHVybiB0aGlzLl9hZGRJdGVtVG9MaXN0KHZhbHVlKTtcbiAgfVxuXG4gIF9hZGRJdGVtVG9MaXN0KHZhbHVlOiBJbnRlcm5hbEl0ZW0pOiBJRGlzcG9zYWJsZSB7XG4gICAgdGhpcy5faXRlbXMucHVzaCh2YWx1ZSk7XG4gICAgdGhpcy5fbmVlZHNTb3J0ID0gdHJ1ZTtcbiAgICBwcm9jZXNzLm5leHRUaWNrKHRoaXMuX3NvcnQpO1xuXG4gICAgLy8gVE9ETyhtYm9saW4pOiBJZGVhbGx5LCB0aGlzIERpc3Bvc2FibGUgc2hvdWxkIGJlIGdhcmJhZ2UtY29sbGVjdGVkIGlmIHRoaXMgQ29udGV4dE1lbnUgaXNcbiAgICAvLyBkaXNwb3NlZC5cbiAgICByZXR1cm4gbmV3IERpc3Bvc2FibGUoKCkgPT4ge1xuICAgICAgY29uc3QgaW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKHZhbHVlKTtcbiAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICAgIC8vIFdlIG5lZWQgdG8gaW52b2tlIF9zb3J0IGZvciB0aGUgbWFuYWdlbWVudCBvZiB0aGlzLl9kaXNwb3NhYmxlIGFuZCBhdG9tLmNvbnRleHRNZW51LmFkZC5cbiAgICAgIHRoaXMuX25lZWRzU29ydCA9IHRydWU7XG4gICAgICB0aGlzLl9zb3J0KCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBtZXRob2QgbXVzdCBiZSBpbnZva2VkIGFmdGVyIHRoaXMuX2l0ZW1zIGhhcyBiZWVuIG1vZGlmaWVkLiBJZiBuZWNlc3NhcnksIGl0IHdpbGwgcmVtb3ZlXG4gICAqIGFsbCBpdGVtcyB0aGF0IHRoaXMgb2JqZWN0IHByZXZpb3VzbHkgcmVnaXN0ZXJlZCB3aXRoIEF0b20ncyBDb250ZXh0TWVudU1hbmFnZXIuIFRoZW4gaXQgd2lsbFxuICAgKiByZS1yZWdpc3RlciBldmVyeXRoaW5nIGluIHRoaXMuX2l0ZW1zIG9uY2UgaXQgaGFzIGJlZW4gc29ydGVkLlxuICAgKi9cbiAgX3NvcnQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLl9uZWVkc1NvcnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9uZWVkc1NvcnQgPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLl9kaXNwb3NhYmxlICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX2Rpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICAgIH1cblxuICAgIGNvbnN0IG1lbnVPcHRpb25zID0gdGhpcy5fbWVudU9wdGlvbnM7XG4gICAgaWYgKG1lbnVPcHRpb25zLnR5cGUgPT09ICdyb290Jykge1xuICAgICAgY29uc3QgaXRlbXMgPSB0aGlzLl9zb3J0QW5kRmlsdGVySXRlbXMoKTtcbiAgICAgIHRoaXMuX2Rpc3Bvc2FibGUgPSBhdG9tLmNvbnRleHRNZW51LmFkZCh7XG4gICAgICAgIFttZW51T3B0aW9ucy5jc3NTZWxlY3Rvcl06IGl0ZW1zLm1hcChcbiAgICAgICAgICB0aGlzLl9jb250ZXh0TWVudUl0ZW1Gb3JJbnRlcm5hbEl0ZW0sXG4gICAgICAgICAgdGhpcyxcbiAgICAgICAgKSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAobWVudU9wdGlvbnMudHlwZSA9PT0gJ3N1Ym1lbnUnKSB7XG4gICAgICAvLyBUZWxsIHRoZSBwYXJlbnQgbWVudSB0byBzb3J0IGl0c2VsZi5cbiAgICAgIG1lbnVPcHRpb25zLnBhcmVudC5fbmVlZHNTb3J0ID0gdHJ1ZTtcbiAgICAgIG1lbnVPcHRpb25zLnBhcmVudC5fc29ydCgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBUcmFuc2xhdGVzIHRoaXMgb2JqZWN0J3MgaW50ZXJuYWwgcmVwcmVzZW50YXRpb24gb2YgYSBtZW51IGl0ZW0gdG8gQXRvbSdzIHJlcHJlc2VudGF0aW9uLiAqL1xuICBfY29udGV4dE1lbnVJdGVtRm9ySW50ZXJuYWxJdGVtKFxuICAgIGludGVybmFsSXRlbTogSW50ZXJuYWxJdGVtLFxuICApOiBhdG9tJENvbnRleHRNZW51SXRlbSB7XG4gICAgaWYgKGludGVybmFsSXRlbS50eXBlID09PSAnaXRlbScpIHtcbiAgICAgIHJldHVybiBpbnRlcm5hbEl0ZW0uaXRlbTtcbiAgICB9IGVsc2UgaWYgKGludGVybmFsSXRlbS50eXBlID09PSAnbWVudScpIHtcbiAgICAgIC8vIE5vdGUgdGhhdCBkdWUgdG8gb3VyIG93biBzdHJpY3QgcmVuYW1pbmcgcnVsZXMsIHRoaXMgbXVzdCBiZSBhIHByaXZhdGUgbWV0aG9kIGluc3RlYWQgb2YgYVxuICAgICAgLy8gc3RhdGljIGZ1bmN0aW9uIGJlY2F1c2Ugb2YgdGhlIGFjY2VzcyB0byBfbWVudU9wdGlvbnMgYW5kIF9pdGVtcy5cbiAgICAgIGNvbnN0IG1lbnVPcHRpb25zID0gaW50ZXJuYWxJdGVtLm1lbnUuX21lbnVPcHRpb25zO1xuICAgICAgaW52YXJpYW50KG1lbnVPcHRpb25zLnR5cGUgPT09ICdzdWJtZW51Jyk7XG4gICAgICBjb25zdCBpdGVtcyA9IGludGVybmFsSXRlbS5tZW51Ll9zb3J0QW5kRmlsdGVySXRlbXMoKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxhYmVsOiBtZW51T3B0aW9ucy5sYWJlbCxcbiAgICAgICAgc3VibWVudTogaXRlbXMubWFwKHRoaXMuX2NvbnRleHRNZW51SXRlbUZvckludGVybmFsSXRlbSwgdGhpcyksXG4gICAgICAgIHNob3VsZERpc3BsYXk6IG1lbnVPcHRpb25zLnNob3VsZERpc3BsYXksXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnZhcmlhbnQoZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIF9zb3J0QW5kRmlsdGVySXRlbXMoKTogQXJyYXk8SW50ZXJuYWxJdGVtPiB7XG4gICAgY29uc3QgaXRlbXMgPSB0aGlzLl9pdGVtcy5maWx0ZXIoKGl0ZW06IEludGVybmFsSXRlbSkgPT4ge1xuICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gJ2l0ZW0nKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChpdGVtLnR5cGUgPT09ICdtZW51Jykge1xuICAgICAgICBjb25zdCBjb250ZXh0TWVudSA9IGl0ZW0ubWVudTtcbiAgICAgICAgcmV0dXJuICFjb250ZXh0TWVudS5pc0VtcHR5KCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaXRlbXMuc29ydChjb21wYXJlSW50ZXJuYWxJdGVtcyk7XG4gICAgcmV0dXJuIGl0ZW1zO1xuICB9XG5cbiAgLyoqIFJlbW92ZXMgYWxsIGl0ZW1zIHRoaXMgb2JqZWN0IGhhcyBhZGRlZCB0byBBdG9tJ3MgQ29udGV4dE1lbnVNYW5hZ2VyLiAqL1xuICBkaXNwb3NlKCkge1xuICAgIHRoaXMuX25lZWRzU29ydCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLl9kaXNwb3NhYmxlICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX2Rpc3Bvc2FibGUuZGlzcG9zZSgpO1xuICAgIH1cbiAgICB0aGlzLl9pdGVtcy5sZW5ndGggPSAwO1xuICB9XG5cbiAgc3RhdGljIGlzRXZlbnRGcm9tQ29udGV4dE1lbnUoZXZlbnQ6IEV2ZW50KSB7XG4gICAgLy8gQ29udGV4dCBtZW51IGNvbW1hbmRzIGNvbnRhaW4gYSBzcGVjaWZpYyBgZGV0YWlsYCBwYXJhbWV0ZXI6XG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2F0b20vYXRvbS9ibG9iL3YxLjE1LjAvc3JjL21haW4tcHJvY2Vzcy9jb250ZXh0LW1lbnUuY29mZmVlI0wxN1xuICAgIHJldHVybiAoXG4gICAgICBBcnJheS5pc0FycmF5KGV2ZW50LmRldGFpbCkgJiZcbiAgICAgIC8vIGZsb3dsaW50LW5leHQtbGluZSBza2V0Y2h5LW51bGwtbWl4ZWQ6b2ZmXG4gICAgICBldmVudC5kZXRhaWxbMF0gJiZcbiAgICAgIChldmVudC5kZXRhaWxbMF06IGFueSkuY29udGV4dENvbW1hbmRcbiAgICApO1xuICB9XG59XG5cbi8qKiBDb21wYXJhdG9yIHVzZWQgdG8gc29ydCBtZW51IGl0ZW1zIGJ5IHByaW9yaXR5OiBsb3dlciBwcmlvcml0aWVzIGFwcGVhciBlYXJsaWVyLiAqL1xuZnVuY3Rpb24gY29tcGFyZUludGVybmFsSXRlbXMoYTogSW50ZXJuYWxJdGVtLCBiOiBJbnRlcm5hbEl0ZW0pOiBudW1iZXIge1xuICByZXR1cm4gYS5wcmlvcml0eSAtIGIucHJpb3JpdHk7XG59XG4iXX0=